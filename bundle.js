/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t={9:(t,e,r)=>{"use strict";r.d(e,{Z:()=>a});var i=r(537),n=r.n(i),s=r(645),o=r.n(s)()(n());o.push([t.id,":root {\n  --main-background-color: #161d25;\n  --main-border-color: transparent;\n  --main-border-radius: 2px;\n  --main-border-size: 0px;\n  --main-border-style: solid;\n  --main-shadow-color: rgba(0, 0, 0, 0.7);\n  --main-box-shadow: var(--main-shadow-color) 0px 0px 3px 0px;\n}\n\nhtml,\nbody,\ninput,\ntextarea,\nselect,\nbutton {\n  border-color: #5e5d5a;\n  color: #e5e0d8;\n  font-size: 12px;\n  text-shadow: 1px 1px black;\n  font-family: sans-serif;\n  -webkit-font-smoothing: none;\n}\n\nbody {\n  height: 100vh;\n  overflow: hidden;\n  margin: 0;\n  user-select: none;\n  background-color: black;\n}\n\n.loading {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n}\n\n#game {\n  flex: 1;\n}\n\n.bar {\n  background: var(--main-background-color);\n  width: 100%;\n}\n\n.img {\n  object-fit: none;\n  height: 45px;\n  width: 45px;\n  border: var(--main-border-size) var(--main-border-style) var(--main-border-color);\n  border-radius: var(--main-border-radius);\n  box-shadow: var(--main-box-shadow);\n}\n\n.topbar {\n  position: absolute;\n  top: 0;\n  padding: 5px 10px;\n  display: grid;\n  font-weight: bold;\n  grid-template-columns: 33% 33% 33%;\n  width: calc(100% - 20px);\n  align-items: center;\n  justify-content: center;\n}\n\n.bottombar {\n  position: absolute;\n  bottom: 0;\n  display: grid;\n  height: 122px;\n  grid-template-columns: 120px auto 242px;\n  width: calc(100% - 10px);\n  grid-gap: 5px;\n  padding: 5px;\n  border-top: 2px solid var(--main-background-color);\n}\n\n.bottombar-info {\n  position: relative;\n  border: var(--main-border-size) var(--main-border-style) var(--main-border-color);\n  border-radius: var(--main-border-radius);\n  box-shadow: var(--main-box-shadow);\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  padding: 2px;\n  gap: 1px;\n}\n\n.bottombar-info #icon {\n  object-fit: none;\n  height: 45px;\n  width: 45px;\n}\n\n.bottombar-menu {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 5px;\n  padding: 5px 0;\n  overflow: auto;\n  max-width: 500px;\n}\n\n.bottombar-menu-column {\n  display: flex;\n  flex-direction: column;\n  gap: 5px;\n}\n\n.bottombar-menu-box {\n  position: relative;\n  display: flex;\n}\n\n.bottombar-map-wrap {\n  position: relative;\n  top: 2px;\n  filter: drop-shadow(0px 0px 3px var(--main-shadow-color));\n}\n\n.bottombar-map {\n  width: 100%;\n  height: 100%;\n  background: black;\n  clip-path: polygon(50% 1%, 100% 48%, 50% 96%, 0% 48%);\n}\n\n.bottombar-map canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n}\n\n.age {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.resources {\n  display: flex;\n  gap: 10px;\n}\n\n.resource {\n  display: flex;\n  gap: 2px;\n  align-items: center;\n}\n\n.resource > div {\n  width: 40px;\n}\n\n.resource-content {\n  object-fit: none;\n  height: 13px;\n  width: 20px;\n  border: var(--main-border-size) var(--main-border-style) var(--main-border-color);\n  border-radius: var(--main-border-radius);\n  box-shadow: var(--main-box-shadow);\n}\n\n.message {\n  z-index: 1000;\n  position: fixed;\n  width: 100%;\n  text-align: center;\n}\n\n.message-content {\n  color: #da2424;\n  background: rgba(0, 0, 0, 0.4);\n  padding: 3px;\n}\n\n.resource-quantity,\n.unit-loading {\n  display: flex;\n  align-items: center;\n}\n\n.resource-quantity-icon,\n.unit-loading-icon {\n  object-fit: none;\n  height: 13px;\n  width: 20px;\n  margin-right: 2px;\n  border-radius: 2px;\n}\n","",{version:3,sources:["webpack://./app/styles.css"],names:[],mappings:"AAAA;EACE,gCAAgC;EAChC,gCAAgC;EAChC,yBAAyB;EACzB,uBAAuB;EACvB,0BAA0B;EAC1B,uCAAuC;EACvC,2DAA2D;AAC7D;;AAEA;;;;;;EAME,qBAAqB;EACrB,cAAc;EACd,eAAe;EACf,0BAA0B;EAC1B,uBAAuB;EACvB,4BAA4B;AAC9B;;AAEA;EACE,aAAa;EACb,gBAAgB;EAChB,SAAS;EACT,iBAAiB;EACjB,uBAAuB;AACzB;;AAEA;EACE,aAAa;EACb,mBAAmB;EACnB,uBAAuB;EACvB,YAAY;AACd;;AAEA;EACE,OAAO;AACT;;AAEA;EACE,wCAAwC;EACxC,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,YAAY;EACZ,WAAW;EACX,iFAAiF;EACjF,wCAAwC;EACxC,kCAAkC;AACpC;;AAEA;EACE,kBAAkB;EAClB,MAAM;EACN,iBAAiB;EACjB,aAAa;EACb,iBAAiB;EACjB,kCAAkC;EAClC,wBAAwB;EACxB,mBAAmB;EACnB,uBAAuB;AACzB;;AAEA;EACE,kBAAkB;EAClB,SAAS;EACT,aAAa;EACb,aAAa;EACb,uCAAuC;EACvC,wBAAwB;EACxB,aAAa;EACb,YAAY;EACZ,kDAAkD;AACpD;;AAEA;EACE,kBAAkB;EAClB,iFAAiF;EACjF,wCAAwC;EACxC,kCAAkC;EAClC,gBAAgB;EAChB,aAAa;EACb,sBAAsB;EACtB,YAAY;EACZ,QAAQ;AACV;;AAEA;EACE,gBAAgB;EAChB,YAAY;EACZ,WAAW;AACb;;AAEA;EACE,aAAa;EACb,eAAe;EACf,QAAQ;EACR,cAAc;EACd,cAAc;EACd,gBAAgB;AAClB;;AAEA;EACE,aAAa;EACb,sBAAsB;EACtB,QAAQ;AACV;;AAEA;EACE,kBAAkB;EAClB,aAAa;AACf;;AAEA;EACE,kBAAkB;EAClB,QAAQ;EACR,yDAAyD;AAC3D;;AAEA;EACE,WAAW;EACX,YAAY;EACZ,iBAAiB;EACjB,qDAAqD;AACvD;;AAEA;EACE,kBAAkB;EAClB,OAAO;EACP,MAAM;EACN,WAAW;EACX,YAAY;AACd;;AAEA;EACE,aAAa;EACb,mBAAmB;EACnB,uBAAuB;AACzB;;AAEA;EACE,aAAa;EACb,SAAS;AACX;;AAEA;EACE,aAAa;EACb,QAAQ;EACR,mBAAmB;AACrB;;AAEA;EACE,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,YAAY;EACZ,WAAW;EACX,iFAAiF;EACjF,wCAAwC;EACxC,kCAAkC;AACpC;;AAEA;EACE,aAAa;EACb,eAAe;EACf,WAAW;EACX,kBAAkB;AACpB;;AAEA;EACE,cAAc;EACd,8BAA8B;EAC9B,YAAY;AACd;;AAEA;;EAEE,aAAa;EACb,mBAAmB;AACrB;;AAEA;;EAEE,gBAAgB;EAChB,YAAY;EACZ,WAAW;EACX,iBAAiB;EACjB,kBAAkB;AACpB",sourcesContent:[":root {\n  --main-background-color: #161d25;\n  --main-border-color: transparent;\n  --main-border-radius: 2px;\n  --main-border-size: 0px;\n  --main-border-style: solid;\n  --main-shadow-color: rgba(0, 0, 0, 0.7);\n  --main-box-shadow: var(--main-shadow-color) 0px 0px 3px 0px;\n}\n\nhtml,\nbody,\ninput,\ntextarea,\nselect,\nbutton {\n  border-color: #5e5d5a;\n  color: #e5e0d8;\n  font-size: 12px;\n  text-shadow: 1px 1px black;\n  font-family: sans-serif;\n  -webkit-font-smoothing: none;\n}\n\nbody {\n  height: 100vh;\n  overflow: hidden;\n  margin: 0;\n  user-select: none;\n  background-color: black;\n}\n\n.loading {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n}\n\n#game {\n  flex: 1;\n}\n\n.bar {\n  background: var(--main-background-color);\n  width: 100%;\n}\n\n.img {\n  object-fit: none;\n  height: 45px;\n  width: 45px;\n  border: var(--main-border-size) var(--main-border-style) var(--main-border-color);\n  border-radius: var(--main-border-radius);\n  box-shadow: var(--main-box-shadow);\n}\n\n.topbar {\n  position: absolute;\n  top: 0;\n  padding: 5px 10px;\n  display: grid;\n  font-weight: bold;\n  grid-template-columns: 33% 33% 33%;\n  width: calc(100% - 20px);\n  align-items: center;\n  justify-content: center;\n}\n\n.bottombar {\n  position: absolute;\n  bottom: 0;\n  display: grid;\n  height: 122px;\n  grid-template-columns: 120px auto 242px;\n  width: calc(100% - 10px);\n  grid-gap: 5px;\n  padding: 5px;\n  border-top: 2px solid var(--main-background-color);\n}\n\n.bottombar-info {\n  position: relative;\n  border: var(--main-border-size) var(--main-border-style) var(--main-border-color);\n  border-radius: var(--main-border-radius);\n  box-shadow: var(--main-box-shadow);\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  padding: 2px;\n  gap: 1px;\n}\n\n.bottombar-info #icon {\n  object-fit: none;\n  height: 45px;\n  width: 45px;\n}\n\n.bottombar-menu {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 5px;\n  padding: 5px 0;\n  overflow: auto;\n  max-width: 500px;\n}\n\n.bottombar-menu-column {\n  display: flex;\n  flex-direction: column;\n  gap: 5px;\n}\n\n.bottombar-menu-box {\n  position: relative;\n  display: flex;\n}\n\n.bottombar-map-wrap {\n  position: relative;\n  top: 2px;\n  filter: drop-shadow(0px 0px 3px var(--main-shadow-color));\n}\n\n.bottombar-map {\n  width: 100%;\n  height: 100%;\n  background: black;\n  clip-path: polygon(50% 1%, 100% 48%, 50% 96%, 0% 48%);\n}\n\n.bottombar-map canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n}\n\n.age {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.resources {\n  display: flex;\n  gap: 10px;\n}\n\n.resource {\n  display: flex;\n  gap: 2px;\n  align-items: center;\n}\n\n.resource > div {\n  width: 40px;\n}\n\n.resource-content {\n  object-fit: none;\n  height: 13px;\n  width: 20px;\n  border: var(--main-border-size) var(--main-border-style) var(--main-border-color);\n  border-radius: var(--main-border-radius);\n  box-shadow: var(--main-box-shadow);\n}\n\n.message {\n  z-index: 1000;\n  position: fixed;\n  width: 100%;\n  text-align: center;\n}\n\n.message-content {\n  color: #da2424;\n  background: rgba(0, 0, 0, 0.4);\n  padding: 3px;\n}\n\n.resource-quantity,\n.unit-loading {\n  display: flex;\n  align-items: center;\n}\n\n.resource-quantity-icon,\n.unit-loading-icon {\n  object-fit: none;\n  height: 13px;\n  width: 20px;\n  margin-right: 2px;\n  border-radius: 2px;\n}\n"],sourceRoot:""}]);const a=o},645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r="",i=void 0!==e[5];return e[4]&&(r+="@supports (".concat(e[4],") {")),e[2]&&(r+="@media ".concat(e[2]," {")),i&&(r+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),r+=t(e),i&&(r+="}"),e[2]&&(r+="}"),e[4]&&(r+="}"),r})).join("")},e.i=function(t,r,i,n,s){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(i)for(var a=0;a<this.length;a++){var h=this[a][0];null!=h&&(o[h]=!0)}for(var l=0;l<t.length;l++){var c=[].concat(t[l]);i&&o[c[0]]||(void 0!==s&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=s),r&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=r):c[2]=r),n&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=n):c[4]="".concat(n)),e.push(c))}},e}},537:t=>{"use strict";t.exports=function(t){var e=t[1],r=t[3];if(!r)return e;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),s="/*# ".concat(n," */");return[e].concat([s]).join("\n")}return[e].join("\n")}},187:t=>{"use strict";function e(t,e,i){i=i||2;var s,o,a,h,u,d,p,m=e&&e.length,g=m?e[0]*i:t.length,y=r(t,0,g,i,!0),v=[];if(!y||y.next===y.prev)return v;if(m&&(y=function(t,e,i,n){var s,o,a,h=[];for(s=0,o=e.length;s<o;s++)(a=r(t,e[s]*n,s<o-1?e[s+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),h.push(f(a));for(h.sort(l),s=0;s<h.length;s++)i=c(h[s],i);return i}(t,e,y,i)),t.length>80*i){s=a=t[0],o=h=t[1];for(var b=i;b<g;b+=i)(u=t[b])<s&&(s=u),(d=t[b+1])<o&&(o=d),u>a&&(a=u),d>h&&(h=d);p=0!==(p=Math.max(a-s,h-o))?32767/p:0}return n(y,v,i,s,o,p,0),v}function r(t,e,r,i,n){var s,o;if(n===S(t,e,r,i)>0)for(s=e;s<r;s+=i)o=E(s,t[s],t[s+1],o);else for(s=r-i;s>=e;s-=i)o=E(s,t[s],t[s+1],o);return o&&y(o,o.next)&&(T(o),o=o.next),o}function i(t,e){if(!t)return t;e||(e=t);var r,i=t;do{if(r=!1,i.steiner||!y(i,i.next)&&0!==g(i.prev,i,i.next))i=i.next;else{if(T(i),(i=e=i.prev)===i.next)break;r=!0}}while(r||i!==e);return e}function n(t,e,r,l,c,u,f){if(t){!f&&u&&function(t,e,r,i){var n=t;do{0===n.z&&(n.z=d(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,r,i,n,s,o,a,h,l=1;do{for(r=t,t=null,s=null,o=0;r;){for(o++,i=r,a=0,e=0;e<l&&(a++,i=i.nextZ);e++);for(h=l;a>0||h>0&&i;)0!==a&&(0===h||!i||r.z<=i.z)?(n=r,r=r.nextZ,a--):(n=i,i=i.nextZ,h--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;r=i}s.nextZ=null,l*=2}while(o>1)}(n)}(t,l,c,u);for(var p,m,g=t;t.prev!==t.next;)if(p=t.prev,m=t.next,u?o(t,l,c,u):s(t))e.push(p.i/r|0),e.push(t.i/r|0),e.push(m.i/r|0),T(t),t=m.next,g=m.next;else if((t=m)===g){f?1===f?n(t=a(i(t),e,r),e,r,l,c,u,2):2===f&&h(t,e,r,l,c,u):n(i(t),e,r,l,c,u,1);break}}}function s(t){var e=t.prev,r=t,i=t.next;if(g(e,r,i)>=0)return!1;for(var n=e.x,s=r.x,o=i.x,a=e.y,h=r.y,l=i.y,c=n<s?n<o?n:o:s<o?s:o,u=a<h?a<l?a:l:h<l?h:l,d=n>s?n>o?n:o:s>o?s:o,f=a>h?a>l?a:l:h>l?h:l,m=i.next;m!==e;){if(m.x>=c&&m.x<=d&&m.y>=u&&m.y<=f&&p(n,a,s,h,o,l,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function o(t,e,r,i){var n=t.prev,s=t,o=t.next;if(g(n,s,o)>=0)return!1;for(var a=n.x,h=s.x,l=o.x,c=n.y,u=s.y,f=o.y,m=a<h?a<l?a:l:h<l?h:l,y=c<u?c<f?c:f:u<f?u:f,v=a>h?a>l?a:l:h>l?h:l,b=c>u?c>f?c:f:u>f?u:f,x=d(m,y,e,r,i),_=d(v,b,e,r,i),w=t.prevZ,E=t.nextZ;w&&w.z>=x&&E&&E.z<=_;){if(w.x>=m&&w.x<=v&&w.y>=y&&w.y<=b&&w!==n&&w!==o&&p(a,c,h,u,l,f,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,E.x>=m&&E.x<=v&&E.y>=y&&E.y<=b&&E!==n&&E!==o&&p(a,c,h,u,l,f,E.x,E.y)&&g(E.prev,E,E.next)>=0)return!1;E=E.nextZ}for(;w&&w.z>=x;){if(w.x>=m&&w.x<=v&&w.y>=y&&w.y<=b&&w!==n&&w!==o&&p(a,c,h,u,l,f,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;E&&E.z<=_;){if(E.x>=m&&E.x<=v&&E.y>=y&&E.y<=b&&E!==n&&E!==o&&p(a,c,h,u,l,f,E.x,E.y)&&g(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function a(t,e,r){var n=t;do{var s=n.prev,o=n.next.next;!y(s,o)&&v(s,n,n.next,o)&&_(s,o)&&_(o,s)&&(e.push(s.i/r|0),e.push(n.i/r|0),e.push(o.i/r|0),T(n),T(n.next),n=t=o),n=n.next}while(n!==t);return i(n)}function h(t,e,r,s,o,a){var h=t;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&m(h,l)){var c=w(h,l);return h=i(h,h.next),c=i(c,c.next),n(h,e,r,s,o,a,0),void n(c,e,r,s,o,a,0)}l=l.next}h=h.next}while(h!==t)}function l(t,e){return t.x-e.x}function c(t,e){var r=function(t,e){var r,i=e,n=t.x,s=t.y,o=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>o&&(o=a,r=i.x<i.next.x?i:i.next,a===n))return r}i=i.next}while(i!==e);if(!r)return null;var h,l=r,c=r.x,d=r.y,f=1/0;i=r;do{n>=i.x&&i.x>=c&&n!==i.x&&p(s<d?n:o,s,c,d,s<d?o:n,s,i.x,i.y)&&(h=Math.abs(s-i.y)/(n-i.x),_(i,t)&&(h<f||h===f&&(i.x>r.x||i.x===r.x&&u(r,i)))&&(r=i,f=h)),i=i.next}while(i!==l);return r}(t,e);if(!r)return e;var n=w(r,t);return i(n,n.next),i(r,r.next)}function u(t,e){return g(t.prev,t,e.prev)<0&&g(e.next,t,t.next)<0}function d(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function f(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function p(t,e,r,i,n,s,o,a){return(n-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(r-o)*(e-a)&&(r-o)*(s-a)>=(n-o)*(i-a)}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&v(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(_(t,e)&&_(e,t)&&function(t,e){var r=t,i=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}(t,e)&&(g(t.prev,t,e.prev)||g(t,e.prev,e))||y(t,e)&&g(t.prev,t,t.next)>0&&g(e.prev,e,e.next)>0)}function g(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function y(t,e){return t.x===e.x&&t.y===e.y}function v(t,e,r,i){var n=x(g(t,e,r)),s=x(g(t,e,i)),o=x(g(r,i,t)),a=x(g(r,i,e));return n!==s&&o!==a||!(0!==n||!b(t,r,e))||!(0!==s||!b(t,i,e))||!(0!==o||!b(r,t,i))||!(0!==a||!b(r,e,i))}function b(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function x(t){return t>0?1:t<0?-1:0}function _(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function w(t,e){var r=new A(t.i,t.x,t.y),i=new A(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function E(t,e,r,i){var n=new A(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function T(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function A(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function S(t,e,r,i){for(var n=0,s=e,o=r-i;s<r;s+=i)n+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return n}t.exports=e,t.exports.default=e,e.deviation=function(t,e,r,i){var n=e&&e.length,s=n?e[0]*r:t.length,o=Math.abs(S(t,0,s,r));if(n)for(var a=0,h=e.length;a<h;a++){var l=e[a]*r,c=a<h-1?e[a+1]*r:t.length;o-=Math.abs(S(t,l,c,r))}var u=0;for(a=0;a<i.length;a+=3){var d=i[a]*r,f=i[a+1]*r,p=i[a+2]*r;u+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},e.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var s=0;s<t[n].length;s++)for(var o=0;o<e;o++)r.vertices.push(t[n][s][o]);n>0&&(i+=t[n-1].length,r.holes.push(i))}return r}},729:t=>{"use strict";var e=Object.prototype.hasOwnProperty,r="~";function i(){}function n(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function s(t,e,i,s,o){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new n(i,s||t,o),h=r?r+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,i,n=[];if(0===this._eventsCount)return n;for(i in t=this._events)e.call(t,i)&&n.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},a.prototype.listeners=function(t){var e=r?r+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,s=i.length,o=new Array(s);n<s;n++)o[n]=i[n].fn;return o},a.prototype.listenerCount=function(t){var e=r?r+t:t,i=this._events[e];return i?i.fn?1:i.length:0},a.prototype.emit=function(t,e,i,n,s,o){var a=r?r+t:t;if(!this._events[a])return!1;var h,l,c=this._events[a],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,i),!0;case 4:return c.fn.call(c.context,e,i,n),!0;case 5:return c.fn.call(c.context,e,i,n,s),!0;case 6:return c.fn.call(c.context,e,i,n,s,o),!0}for(l=1,h=new Array(u-1);l<u;l++)h[l-1]=arguments[l];c.fn.apply(c.context,h)}else{var d,f=c.length;for(l=0;l<f;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),u){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,i);break;case 4:c[l].fn.call(c[l].context,e,i,n);break;default:if(!h)for(d=1,h=new Array(u-1);d<u;d++)h[d-1]=arguments[d];c[l].fn.apply(c[l].context,h)}}return!0},a.prototype.on=function(t,e,r){return s(this,t,e,r,!1)},a.prototype.once=function(t,e,r){return s(this,t,e,r,!0)},a.prototype.removeListener=function(t,e,i,n){var s=r?r+t:t;if(!this._events[s])return this;if(!e)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==e||n&&!a.once||i&&a.context!==i||o(this,s);else{for(var h=0,l=[],c=a.length;h<c;h++)(a[h].fn!==e||n&&!a[h].once||i&&a[h].context!==i)&&l.push(a[h]);l.length?this._events[s]=1===l.length?l[0]:l:o(this,s)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&o(this,e)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a},971:function(t,e,r){var i;t=r.nmd(t),function(n){e&&e.nodeType,t&&t.nodeType;var s="object"==typeof r.g&&r.g;s.global!==s&&s.window!==s&&s.self;var o,a=2147483647,h=36,l=1,c=26,u=38,d=700,f=72,p=128,m="-",g=/^xn--/,y=/[^\x20-\x7E]/,v=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=h-l,_=Math.floor,w=String.fromCharCode;function E(t){throw RangeError(b[t])}function T(t,e){for(var r=t.length,i=[];r--;)i[r]=e(t[r]);return i}function A(t,e){var r=t.split("@"),i="";return r.length>1&&(i=r[0]+"@",t=r[1]),i+T((t=t.replace(v,".")).split("."),e).join(".")}function S(t){for(var e,r,i=[],n=0,s=t.length;n<s;)(e=t.charCodeAt(n++))>=55296&&e<=56319&&n<s?56320==(64512&(r=t.charCodeAt(n++)))?i.push(((1023&e)<<10)+(1023&r)+65536):(i.push(e),n--):i.push(e);return i}function P(t){return T(t,(function(t){var e="";return t>65535&&(e+=w((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+w(t)})).join("")}function O(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function C(t,e,r){var i=0;for(t=r?_(t/d):t>>1,t+=_(t/e);t>x*c>>1;i+=h)t=_(t/x);return _(i+(x+1)*t/(t+u))}function R(t){var e,r,i,n,s,o,u,d,g,y,v,b=[],x=t.length,w=0,T=p,A=f;for((r=t.lastIndexOf(m))<0&&(r=0),i=0;i<r;++i)t.charCodeAt(i)>=128&&E("not-basic"),b.push(t.charCodeAt(i));for(n=r>0?r+1:0;n<x;){for(s=w,o=1,u=h;n>=x&&E("invalid-input"),((d=(v=t.charCodeAt(n++))-48<10?v-22:v-65<26?v-65:v-97<26?v-97:h)>=h||d>_((a-w)/o))&&E("overflow"),w+=d*o,!(d<(g=u<=A?l:u>=A+c?c:u-A));u+=h)o>_(a/(y=h-g))&&E("overflow"),o*=y;A=C(w-s,e=b.length+1,0==s),_(w/e)>a-T&&E("overflow"),T+=_(w/e),w%=e,b.splice(w++,0,T)}return P(b)}function I(t){var e,r,i,n,s,o,u,d,g,y,v,b,x,T,A,P=[];for(b=(t=S(t)).length,e=p,r=0,s=f,o=0;o<b;++o)(v=t[o])<128&&P.push(w(v));for(i=n=P.length,n&&P.push(m);i<b;){for(u=a,o=0;o<b;++o)(v=t[o])>=e&&v<u&&(u=v);for(u-e>_((a-r)/(x=i+1))&&E("overflow"),r+=(u-e)*x,e=u,o=0;o<b;++o)if((v=t[o])<e&&++r>a&&E("overflow"),v==e){for(d=r,g=h;!(d<(y=g<=s?l:g>=s+c?c:g-s));g+=h)A=d-y,T=h-y,P.push(w(O(y+A%T,0))),d=_(A/T);P.push(w(O(d,0))),s=C(r,x,i==n),r=0,++i}++r,++e}return P.join("")}o={version:"1.3.2",ucs2:{decode:S,encode:P},decode:R,encode:I,toASCII:function(t){return A(t,(function(t){return y.test(t)?"xn--"+I(t):t}))},toUnicode:function(t){return A(t,(function(t){return g.test(t)?R(t.slice(4).toLowerCase()):t}))}},void 0===(i=function(){return o}.call(e,r,e,t))||(t.exports=i)}()},587:t=>{"use strict";function e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,r,i,n){r=r||"&",i=i||"=";var s={};if("string"!=typeof t||0===t.length)return s;var o=/\+/g;t=t.split(r);var a=1e3;n&&"number"==typeof n.maxKeys&&(a=n.maxKeys);var h=t.length;a>0&&h>a&&(h=a);for(var l=0;l<h;++l){var c,u,d,f,p=t[l].replace(o,"%20"),m=p.indexOf(i);m>=0?(c=p.substr(0,m),u=p.substr(m+1)):(c=p,u=""),d=decodeURIComponent(c),f=decodeURIComponent(u),e(s,d)?Array.isArray(s[d])?s[d].push(f):s[d]=[s[d],f]:s[d]=f}return s}},361:t=>{"use strict";var e=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,r,i,n){return r=r||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map((function(n){var s=encodeURIComponent(e(n))+i;return Array.isArray(t[n])?t[n].map((function(t){return s+encodeURIComponent(e(t))})).join(r):s+encodeURIComponent(e(t[n]))})).join(r):n?encodeURIComponent(e(n))+i+encodeURIComponent(e(t)):""}},673:(t,e,r)=>{"use strict";e.decode=e.parse=r(587),e.encode=e.stringify=r(361)},379:t=>{"use strict";var e=[];function r(t){for(var r=-1,i=0;i<e.length;i++)if(e[i].identifier===t){r=i;break}return r}function i(t,i){for(var s={},o=[],a=0;a<t.length;a++){var h=t[a],l=i.base?h[0]+i.base:h[0],c=s[l]||0,u="".concat(l," ").concat(c);s[l]=c+1;var d=r(u),f={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==d)e[d].references++,e[d].updater(f);else{var p=n(f,i);i.byIndex=a,e.splice(a,0,{identifier:u,updater:p,references:1})}o.push(u)}return o}function n(t,e){var r=e.domAPI(e);return r.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;r.update(t=e)}else r.remove()}}t.exports=function(t,n){var s=i(t=t||[],n=n||{});return function(t){t=t||[];for(var o=0;o<s.length;o++){var a=r(s[o]);e[a].references--}for(var h=i(t,n),l=0;l<s.length;l++){var c=r(s[l]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}s=h}}},569:t=>{"use strict";var e={};t.exports=function(t,r){var i=function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(r)}},216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,r)=>{"use strict";t.exports=function(t){var e=r.nc;e&&t.setAttribute("nonce",e)}},795:t=>{"use strict";t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(r){!function(t,e,r){var i="";r.supports&&(i+="@supports (".concat(r.supports,") {")),r.media&&(i+="@media ".concat(r.media," {"));var n=void 0!==r.layer;n&&(i+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),i+=r.css,n&&(i+="}"),r.media&&(i+="}"),r.supports&&(i+="}");var s=r.sourceMap;s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,r)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},575:(t,e,r)=>{"use strict";var i=r(971),n=r(502);function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.Qc=b,e.DB=function(t,e){return b(t,!1,!0).resolve(e)},e.WU=function(t){return n.isString(t)&&(t=b(t)),t instanceof s?t.format():s.prototype.format.call(t)};var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,h=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),c=["'"].concat(l),u=["%","/","?",";","#"].concat(c),d=["/","?","#"],f=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=r(673);function b(t,e,r){if(t&&n.isObject(t)&&t instanceof s)return t;var i=new s;return i.parse(t,e,r),i}s.prototype.parse=function(t,e,r){if(!n.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var s=t.indexOf("?"),a=-1!==s&&s<t.indexOf("#")?"?":"#",l=t.split(a);l[0]=l[0].replace(/\\/g,"/");var b=t=l.join(a);if(b=b.trim(),!r&&1===t.split("#").length){var x=h.exec(b);if(x)return this.path=b,this.href=b,this.pathname=x[1],x[2]?(this.search=x[2],this.query=e?v.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var _=o.exec(b);if(_){var w=(_=_[0]).toLowerCase();this.protocol=w,b=b.substr(_.length)}if(r||_||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var E="//"===b.substr(0,2);!E||_&&g[_]||(b=b.substr(2),this.slashes=!0)}if(!g[_]&&(E||_&&!y[_])){for(var T,A,S=-1,P=0;P<d.length;P++)-1!==(O=b.indexOf(d[P]))&&(-1===S||O<S)&&(S=O);for(-1!==(A=-1===S?b.lastIndexOf("@"):b.lastIndexOf("@",S))&&(T=b.slice(0,A),b=b.slice(A+1),this.auth=decodeURIComponent(T)),S=-1,P=0;P<u.length;P++){var O;-1!==(O=b.indexOf(u[P]))&&(-1===S||O<S)&&(S=O)}-1===S&&(S=b.length),this.host=b.slice(0,S),b=b.slice(S),this.parseHost(),this.hostname=this.hostname||"";var C="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!C)for(var R=this.hostname.split(/\./),I=(P=0,R.length);P<I;P++){var M=R[P];if(M&&!M.match(f)){for(var B="",D=0,j=M.length;D<j;D++)M.charCodeAt(D)>127?B+="x":B+=M[D];if(!B.match(f)){var k=R.slice(0,P),N=R.slice(P+1),L=M.match(p);L&&(k.push(L[1]),N.unshift(L[2])),N.length&&(b="/"+N.join(".")+b),this.hostname=k.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),C||(this.hostname=i.toASCII(this.hostname));var F=this.port?":"+this.port:"",U=this.hostname||"";this.host=U+F,this.href+=this.host,C&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!m[w])for(P=0,I=c.length;P<I;P++){var G=c[P];if(-1!==b.indexOf(G)){var z=encodeURIComponent(G);z===G&&(z=escape(G)),b=b.split(G).join(z)}}var H=b.indexOf("#");-1!==H&&(this.hash=b.substr(H),b=b.slice(0,H));var X=b.indexOf("?");if(-1!==X?(this.search=b.substr(X),this.query=b.substr(X+1),e&&(this.query=v.parse(this.query)),b=b.slice(0,X)):e&&(this.search="",this.query={}),b&&(this.pathname=b),y[w]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){F=this.pathname||"";var V=this.search||"";this.path=F+V}return this.href=this.format(),this},s.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",i=this.hash||"",s=!1,o="";this.host?s=t+this.host:this.hostname&&(s=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&n.isObject(this.query)&&Object.keys(this.query).length&&(o=v.stringify(this.query));var a=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||y[e])&&!1!==s?(s="//"+(s||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):s||(s=""),i&&"#"!==i.charAt(0)&&(i="#"+i),a&&"?"!==a.charAt(0)&&(a="?"+a),e+s+(r=r.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(a=a.replace("#","%23"))+i},s.prototype.resolve=function(t){return this.resolveObject(b(t,!1,!0)).format()},s.prototype.resolveObject=function(t){if(n.isString(t)){var e=new s;e.parse(t,!1,!0),t=e}for(var r=new s,i=Object.keys(this),o=0;o<i.length;o++){var a=i[o];r[a]=this[a]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var h=Object.keys(t),l=0;l<h.length;l++){var c=h[l];"protocol"!==c&&(r[c]=t[c])}return y[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!y[t.protocol]){for(var u=Object.keys(t),d=0;d<u.length;d++){var f=u[d];r[f]=t[f]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||g[t.protocol])r.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),r.pathname=p.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var m=r.pathname||"",v=r.search||"";r.path=m+v}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var b=r.pathname&&"/"===r.pathname.charAt(0),x=t.host||t.pathname&&"/"===t.pathname.charAt(0),_=x||b||r.host&&t.pathname,w=_,E=r.pathname&&r.pathname.split("/")||[],T=(p=t.pathname&&t.pathname.split("/")||[],r.protocol&&!y[r.protocol]);if(T&&(r.hostname="",r.port=null,r.host&&(""===E[0]?E[0]=r.host:E.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),_=_&&(""===p[0]||""===E[0])),x)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,E=p;else if(p.length)E||(E=[]),E.pop(),E=E.concat(p),r.search=t.search,r.query=t.query;else if(!n.isNullOrUndefined(t.search))return T&&(r.hostname=r.host=E.shift(),(C=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=C.shift(),r.host=r.hostname=C.shift())),r.search=t.search,r.query=t.query,n.isNull(r.pathname)&&n.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!E.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var A=E.slice(-1)[0],S=(r.host||t.host||E.length>1)&&("."===A||".."===A)||""===A,P=0,O=E.length;O>=0;O--)"."===(A=E[O])?E.splice(O,1):".."===A?(E.splice(O,1),P++):P&&(E.splice(O,1),P--);if(!_&&!w)for(;P--;P)E.unshift("..");!_||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),S&&"/"!==E.join("/").substr(-1)&&E.push("");var C,R=""===E[0]||E[0]&&"/"===E[0].charAt(0);return T&&(r.hostname=r.host=R?"":E.length?E.shift():"",(C=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=C.shift(),r.host=r.hostname=C.shift())),(_=_||r.host&&E.length)&&!R&&E.unshift(""),E.length?r.pathname=E.join("/"):(r.pathname=null,r.path=null),n.isNull(r.pathname)&&n.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},s.prototype.parseHost=function(){var t=this.host,e=a.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},502:t=>{"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}}},e={};function r(i){var n=e[i];if(void 0!==n)return n.exports;var s=e[i]={id:i,loaded:!1,exports:{}};return t[i].call(s.exports,s,s.exports,r),s.loaded=!0,s.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t;r.g.importScripts&&(t=r.g.location+"");var e=r.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t})(),r.nc=void 0,(()=>{"use strict";var t={};r.r(t),r.d(t,{average:()=>Rh,cartesianToIsometric:()=>Sh,cellIsDiag:()=>zh,degreeToDirection:()=>Hh,degreesToRadians:()=>Fh,diff:()=>kh,formatNumber:()=>Ah,getInstanceDegree:()=>Nh,getInstanceZIndex:()=>jh,getPercentage:()=>Oh,getPointsDegree:()=>Lh,getValuePercentage:()=>Ch,instancesDistance:()=>Dh,isometricToCartesian:()=>Ph,pointInRectangle:()=>Gh,pointIsBetweenTwoPoint:()=>Ih,pointsDistance:()=>Uh,randomItem:()=>Bh,randomRange:()=>Mh,uuidv4:()=>Th});var e={};r.r(e),r.d(e,{Arrow:()=>xc,Spear:()=>Oc});var i={};r.r(i),r.d(i,{Academy:()=>zc,ArcheryRange:()=>Qc,Barracks:()=>hu,Farm:()=>gu,GovernmentCenter:()=>Tu,Granary:()=>Mu,House:()=>Gu,Market:()=>qu,SiegeWorkshop:()=>id,Stable:()=>ud,StoragePit:()=>bd,Temple:()=>Pd,TownCenter:()=>kd,WatchTower:()=>Xd});var n={};r.r(n),r.d(n,{Crocodile:()=>Qf,Elephant:()=>op,Gazelle:()=>pp,Lion:()=>wp});var s=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(s||{}),o=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(o||{}),a=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(a||{}),h=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(h||{}),l=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(l||{}),c=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(c||{}),u=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(u||{}),d=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(d||{}),f=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(f||{}),p=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(p||{}),m=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(m||{}),g=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(g||{}),y=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(y||{}),v=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(v||{}),b=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(b||{}),x=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(x||{}),_=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(_||{}),w=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(w||{});const E={createCanvas:(t,e)=>{const r=document.createElement("canvas");return r.width=t,r.height=e,r},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")},T={ADAPTER:E,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var A=/iPhone/i,S=/iPod/i,P=/iPad/i,O=/\biOS-universal(?:.+)Mac\b/i,C=/\bAndroid(?:.+)Mobile\b/i,R=/Android/i,I=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,M=/Silk/i,B=/Windows Phone/i,D=/\bWindows(?:.+)ARM\b/i,j=/BlackBerry/i,k=/BB10/i,N=/Opera Mini/i,L=/\b(CriOS|Chrome)(?:.+)Mobile/i,F=/Mobile(?:.+)Firefox\b/i,U=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};const G=function(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var r=e.userAgent,i=r.split("[FBAN");void 0!==i[1]&&(r=i[0]),void 0!==(i=r.split("Twitter"))[1]&&(r=i[0]);var n=function(t){return function(e){return e.test(t)}}(r),s={apple:{phone:n(A)&&!n(B),ipod:n(S),tablet:!n(A)&&(n(P)||U(e))&&!n(B),universal:n(O),device:(n(A)||n(S)||n(P)||n(O)||U(e))&&!n(B)},amazon:{phone:n(I),tablet:!n(I)&&n(M),device:n(I)||n(M)},android:{phone:!n(B)&&n(I)||!n(B)&&n(C),tablet:!n(B)&&!n(I)&&!n(C)&&(n(M)||n(R)),device:!n(B)&&(n(I)||n(M)||n(C)||n(R))||n(/\bokhttp\b/i)},windows:{phone:n(B),tablet:n(D),device:n(B)||n(D)},other:{blackberry:n(j),blackberry10:n(k),opera:n(N),firefox:n(F),chrome:n(L),device:n(j)||n(k)||n(N)||n(F)||n(L)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}(globalThis.navigator);T.RETINA_PREFIX=/@([0-9\.]+)x/,T.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var z=r(729),H=r(187),X=r(575);const V={parse:X.Qc,format:X.WU,resolve:X.DB};function W(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function Y(t){return t.split("?")[0].split("#")[0]}const $={toPosix:t=>("\\","/",t.replace(new RegExp("\\".replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),"/")),isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),hasProtocol(t){return/^[^/:]+:\//.test(this.toPosix(t))},getProtocol(t){W(t),t=this.toPosix(t);let e="";const r=/^file:\/\/\//.exec(t),i=/^[^/:]+:\/\//.exec(t),n=/^[^/:]+:\//.exec(t);if(r||i||n){const s=r?.[0]||i?.[0]||n?.[0];e=s,t=t.slice(s.length)}return e},toAbsolute(t,e,r){if(this.isDataUrl(t))return t;const i=Y(this.toPosix(e??T.ADAPTER.getBaseUrl())),n=Y(this.toPosix(r??this.rootname(i)));return W(t),(t=this.toPosix(t)).startsWith("/")?$.join(n,t.slice(1)):this.isAbsolute(t)?t:this.join(i,t)},normalize(t){if(W(t=this.toPosix(t)),0===t.length)return".";let e="";const r=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const i=t.endsWith("/");return t=function(t,e){let r="",i=0,n=-1,s=0,o=-1;for(let e=0;e<=t.length;++e){if(e<t.length)o=t.charCodeAt(e);else{if(47===o)break;o=47}if(47===o){if(n===e-1||1===s);else if(n!==e-1&&2===s){if(r.length<2||2!==i||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){const t=r.lastIndexOf("/");if(t!==r.length-1){-1===t?(r="",i=0):(r=r.slice(0,t),i=r.length-1-r.lastIndexOf("/")),n=e,s=0;continue}}else if(2===r.length||1===r.length){r="",i=0,n=e,s=0;continue}}else r.length>0?r+=`/${t.slice(n+1,e)}`:r=t.slice(n+1,e),i=e-n-1;n=e,s=0}else 46===o&&-1!==s?++s:s=-1}return r}(t),t.length>0&&i&&(t+="/"),r?`/${t}`:e+t},isAbsolute(t){return W(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){if(0===t.length)return".";let e;for(let r=0;r<t.length;++r){const i=t[r];if(W(i),i.length>0)if(void 0===e)e=i;else{const n=t[r-1]??"";this.extname(n)?e+=`/../${i}`:e+=`/${i}`}}return void 0===e?".":this.normalize(e)},dirname(t){if(W(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const r=47===e;let i=-1,n=!0;const s=this.getProtocol(t),o=t;for(let r=(t=t.slice(s.length)).length-1;r>=1;--r)if(e=t.charCodeAt(r),47===e){if(!n){i=r;break}}else n=!1;return-1===i?r?"/":this.isUrl(o)?s+t:s:r&&1===i?"//":s+t.slice(0,i)},rootname(t){W(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const r=t.indexOf("/",e.length);e=-1!==r?t.slice(0,r):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){W(t),e&&W(e),t=Y(this.toPosix(t));let r,i=0,n=-1,s=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(r=t.length-1;r>=0;--r){const h=t.charCodeAt(r);if(47===h){if(!s){i=r+1;break}}else-1===a&&(s=!1,a=r+1),o>=0&&(h===e.charCodeAt(o)?-1==--o&&(n=r):(o=-1,n=a))}return i===n?n=a:-1===n&&(n=t.length),t.slice(i,n)}for(r=t.length-1;r>=0;--r)if(47===t.charCodeAt(r)){if(!s){i=r+1;break}}else-1===n&&(s=!1,n=r+1);return-1===n?"":t.slice(i,n)},extname(t){W(t);let e=-1,r=0,i=-1,n=!0,s=0;for(let o=(t=Y(this.toPosix(t))).length-1;o>=0;--o){const a=t.charCodeAt(o);if(47!==a)-1===i&&(n=!1,i=o+1),46===a?-1===e?e=o:1!==s&&(s=1):-1!==e&&(s=-1);else if(!n){r=o+1;break}}return-1===e||-1===i||0===s||1===s&&e===i-1&&e===r+1?"":t.slice(e,i)},parse(t){W(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let r=(t=Y(this.toPosix(t))).charCodeAt(0);const i=this.isAbsolute(t);let n;e.root=this.rootname(t),n=i||this.hasProtocol(t)?1:0;let s=-1,o=0,a=-1,h=!0,l=t.length-1,c=0;for(;l>=n;--l)if(r=t.charCodeAt(l),47!==r)-1===a&&(h=!1,a=l+1),46===r?-1===s?s=l:1!==c&&(c=1):-1!==s&&(c=-1);else if(!h){o=l+1;break}return-1===s||-1===a||0===c||1===c&&s===a-1&&s===o+1?-1!==a&&(e.base=e.name=0===o&&i?t.slice(1,a):t.slice(o,a)):(0===o&&i?(e.name=t.slice(1,s),e.base=t.slice(1,a)):(e.name=t.slice(o,s),e.base=t.slice(o,a)),e.ext=t.slice(s,a)),e.dir=this.dirname(t),e},sep:"/",delimiter:":"},q={};function K(t,e,r=3){if(q[e])return;let i=(new Error).stack;void 0===i?console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`):(i=i.split("\n").splice(r).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}\nDeprecated since v${t}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`),console.warn(i))),q[e]=!0}let Z;var Q={grad:.9,turn:360,rad:360/(2*Math.PI)},J=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},tt=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=Math.pow(10,e)),Math.round(r*t)/r+0},et=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=1),t>r?r:t>e?t:e},rt=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},it=function(t){return{r:et(t.r,0,255),g:et(t.g,0,255),b:et(t.b,0,255),a:et(t.a)}},nt=function(t){return{r:tt(t.r),g:tt(t.g),b:tt(t.b),a:tt(t.a,3)}},st=/^#([0-9a-f]{3,8})$/i,ot=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},at=function(t){var e=t.r,r=t.g,i=t.b,n=t.a,s=Math.max(e,r,i),o=s-Math.min(e,r,i),a=o?s===e?(r-i)/o:s===r?2+(i-e)/o:4+(e-r)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:n}},ht=function(t){var e=t.h,r=t.s,i=t.v,n=t.a;e=e/360*6,r/=100,i/=100;var s=Math.floor(e),o=i*(1-r),a=i*(1-(e-s)*r),h=i*(1-(1-e+s)*r),l=s%6;return{r:255*[i,a,o,o,h,i][l],g:255*[h,i,i,a,o,o][l],b:255*[o,o,h,i,i,a][l],a:n}},lt=function(t){return{h:rt(t.h),s:et(t.s,0,100),l:et(t.l,0,100),a:et(t.a)}},ct=function(t){return{h:tt(t.h),s:tt(t.s),l:tt(t.l),a:tt(t.a,3)}},ut=function(t){return ht((r=(e=t).s,{h:e.h,s:(r*=((i=e.l)<50?i:100-i)/100)>0?2*r/(i+r)*100:0,v:i+r,a:e.a}));var e,r,i},dt=function(t){return{h:(e=at(t)).h,s:(n=(200-(r=e.s))*(i=e.v)/100)>0&&n<200?r*i/100/(n<=100?n:200-n)*100:0,l:n/2,a:e.a};var e,r,i,n},ft=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,pt=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,mt=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,gt=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,yt={string:[[function(t){var e=st.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?tt(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?tt(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=mt.exec(t)||gt.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:it({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=ft.exec(t)||pt.exec(t);if(!e)return null;var r,i,n=lt({h:(r=e[1],i=e[2],void 0===i&&(i="deg"),Number(r)*(Q[i]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return ut(n)},"hsl"]],object:[[function(t){var e=t.r,r=t.g,i=t.b,n=t.a,s=void 0===n?1:n;return J(e)&&J(r)&&J(i)?it({r:Number(e),g:Number(r),b:Number(i),a:Number(s)}):null},"rgb"],[function(t){var e=t.h,r=t.s,i=t.l,n=t.a,s=void 0===n?1:n;if(!J(e)||!J(r)||!J(i))return null;var o=lt({h:Number(e),s:Number(r),l:Number(i),a:Number(s)});return ut(o)},"hsl"],[function(t){var e=t.h,r=t.s,i=t.v,n=t.a,s=void 0===n?1:n;if(!J(e)||!J(r)||!J(i))return null;var o=function(t){return{h:rt(t.h),s:et(t.s,0,100),v:et(t.v,0,100),a:et(t.a)}}({h:Number(e),s:Number(r),v:Number(i),a:Number(s)});return ht(o)},"hsv"]]},vt=function(t,e){for(var r=0;r<e.length;r++){var i=e[r][0](t);if(i)return[i,e[r][1]]}return[null,void 0]},bt=function(t){return"string"==typeof t?vt(t.trim(),yt.string):"object"==typeof t&&null!==t?vt(t,yt.object):[null,void 0]},xt=function(t,e){var r=dt(t);return{h:r.h,s:et(r.s+100*e,0,100),l:r.l,a:r.a}},_t=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},wt=function(t,e){var r=dt(t);return{h:r.h,s:r.s,l:et(r.l+100*e,0,100),a:r.a}},Et=function(){function t(t){this.parsed=bt(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return tt(_t(this.rgba),2)},t.prototype.isDark=function(){return _t(this.rgba)<.5},t.prototype.isLight=function(){return _t(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=nt(this.rgba)).r,r=t.g,i=t.b,s=(n=t.a)<1?ot(tt(255*n)):"","#"+ot(e)+ot(r)+ot(i)+s;var t,e,r,i,n,s},t.prototype.toRgb=function(){return nt(this.rgba)},t.prototype.toRgbString=function(){return e=(t=nt(this.rgba)).r,r=t.g,i=t.b,(n=t.a)<1?"rgba("+e+", "+r+", "+i+", "+n+")":"rgb("+e+", "+r+", "+i+")";var t,e,r,i,n},t.prototype.toHsl=function(){return ct(dt(this.rgba))},t.prototype.toHslString=function(){return e=(t=ct(dt(this.rgba))).h,r=t.s,i=t.l,(n=t.a)<1?"hsla("+e+", "+r+"%, "+i+"%, "+n+")":"hsl("+e+", "+r+"%, "+i+"%)";var t,e,r,i,n},t.prototype.toHsv=function(){return t=at(this.rgba),{h:tt(t.h),s:tt(t.s),v:tt(t.v),a:tt(t.a,3)};var t},t.prototype.invert=function(){return Tt({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),Tt(xt(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),Tt(xt(this.rgba,-t))},t.prototype.grayscale=function(){return Tt(xt(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),Tt(wt(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),Tt(wt(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?Tt({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):tt(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=dt(this.rgba);return"number"==typeof t?Tt({h:t,s:e.s,l:e.l,a:e.a}):tt(e.h)},t.prototype.isEqual=function(t){return this.toHex()===Tt(t).toHex()},t}(),Tt=function(t){return t instanceof Et?t:new Et(t)},At=[];!function(t){t.forEach((function(t){At.indexOf(t)<0&&(t(Et,yt),At.push(t))}))}([function(t,e){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var n in r)i[r[n]]=n;var s={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var n,o,a=i[this.toHex()];if(a)return a;if(null==e?void 0:e.closest){var h=this.toRgb(),l=1/0,c="black";if(!s.length)for(var u in r)s[u]=new t(r[u]).toRgb();for(var d in r){var f=(n=h,o=s[d],Math.pow(n.r-o.r,2)+Math.pow(n.g-o.g,2)+Math.pow(n.b-o.b,2));f<l&&(l=f,c=d)}return c}},e.string.push([function(e){var i=e.toLowerCase(),n="transparent"===i?"#0000":r[i];return n?new t(n).toRgb():null},"name"])}]);const St=class{constructor(t=16777215){this._components=new Float32Array(4),this._components.fill(1),this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){t instanceof St?(this._value=t._value,this._int=t._int,this._components.set(t._components)):this._value!==t&&(this.normalize(t),this._value=t)}get value(){return this._value}toRgba(){const[t,e,r,i]=this._components;return{r:t,g:e,b:r,a:i}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,i]=this._components;return(t=t??[])[0]=Math.round(255*e),t[1]=Math.round(255*r),t[2]=Math.round(255*i),t}toRgbArray(t){t=t??[];const[e,r,i]=this._components;return t[0]=e,t[1]=r,t[2]=i,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(t){const[e,r,i,n]=St.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=r,this._components[2]*=i,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t){if(1===t)return(255*t<<24)+this._int;if(0===t)return 0;let e=this._int>>16&255,r=this._int>>8&255,i=255&this._int;return e=e*t+.5|0,r=r*t+.5|0,i=i*t+.5|0,(255*t<<24)+(e<<16)+(r<<8)+i}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=t,this}round(t){const[e,r,i]=this._components;return this._components.set([Math.min(255,e/t*t),Math.min(255,r/t*t),Math.min(255,i/t*t)]),this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,r,i,n]=this._components;return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}normalize(t){let e;if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4&&t.every((t=>t<=1&&t>=0))){const[r,i,n,s=1]=t;e=[r,i,n,s]}else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4){const[r,i,n,s=255]=t;e=[r/255,i/255,n/255,s/255]}else if("string"==typeof t||"object"==typeof t){if("string"==typeof t){const e=St.HEX_PATTERN.exec(t);e&&(t=`#${e[2]}`)}const r=Tt(t);if(r.isValid()){const{r:t,g:i,b:n,a:s}=r.rgba;e=[t/255,i/255,n/255,s]}}else"number"==typeof t&&t>=0&&t<=16777215&&(e=[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255,1]);if(!e)throw new Error(`Unable to convert color ${t}`);this._components.set(e),this.refreshInt()}refreshInt(){const[t,e,r]=this._components;this._int=(255*t<<16)+(255*e<<8)+(255*r|0)}};let Pt=St;function Ot(t,e=[]){return K("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),Pt.shared.setValue(t).toRgbArray(e)}function Ct(t){return K("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Pt.shared.setValue(t).toNumber()}Pt.shared=new St,Pt.temp=new St,Pt.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;const Rt=function(){const t=[],e=[];for(let r=0;r<32;r++)t[r]=r,e[r]=r;t[a.NORMAL_NPM]=a.NORMAL,t[a.ADD_NPM]=a.ADD,t[a.SCREEN_NPM]=a.SCREEN,e[a.NORMAL]=a.NORMAL_NPM,e[a.ADD]=a.ADD_NPM,e[a.SCREEN]=a.SCREEN_NPM;const r=[];return r.push(e),r.push(t),r}();function It(t,e){return Rt[e?1:0][t]}function Mt(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}function Bt(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)}function Dt(t){return!(t&t-1||!t)}function jt(t){let e=(t>65535?1:0)<<4,r=((t>>>=e)>255?1:0)<<3;return e|=r,r=((t>>>=r)>15?1:0)<<2,e|=r,r=((t>>>=r)>3?1:0)<<1,e|=r,e|(t>>>=r)>>1}function kt(t,e,r){const i=t.length;let n;if(e>=i||0===r)return;const s=i-(r=e+r>i?i-e:r);for(n=e;n<s;++n)t[n]=t[n+r];t.length=s}function Nt(t){return 0===t?0:t<0?-1:1}Float32Array,Uint32Array,Int32Array,Uint8Array;let Lt=0;function Ft(){return++Lt}const Ut=class{constructor(t,e,r,i){this.left=t,this.top=e,this.right=r,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let Gt=Ut;Gt.EMPTY=new Ut(0,0,0,0);const zt={},Ht=Object.create(null),Xt=Object.create(null);class Vt{constructor(t,e,r){this._canvas=T.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||T.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Wt(t,e,r){for(let i=0,n=4*r*e;i<e;++i,n+=4)if(0!==t[n+3])return!1;return!0}function Yt(t,e,r,i,n){const s=4*e;for(let e=i,o=i*s+4*r;e<=n;++e,o+=s)if(0!==t[o+3])return!1;return!0}let $t;function qt(t,e=1){const r=T.RETINA_PREFIX?.exec(t);return r?parseFloat(r[1]):e}var Kt=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(Kt||{});const Zt=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={..."object"!=typeof t.extension?{type:t.extension}:t.extension,ref:t}}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t={...t}).type&&(t.type=[t.type]),t},Qt=(t,e)=>Zt(t).priority??e,Jt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(Zt).forEach((t=>{t.type.forEach((e=>this._removeHandlers[e]?.(t)))})),this},add(...t){return t.map(Zt).forEach((t=>{t.type.forEach((e=>{const r=this._addHandlers,i=this._queue;r[e]?r[e](t):(i[e]=i[e]||[],i[e].push(t))}))})),this},handle(t,e,r){const i=this._addHandlers,n=this._removeHandlers;if(i[t]||n[t])throw new Error(`Extension type ${t} already has a handler`);i[t]=e,n[t]=r;const s=this._queue;return s[t]&&(s[t].forEach((t=>e(t))),delete s[t]),this},handleByMap(t,e){return this.handle(t,(t=>{e[t.name]=t.ref}),(t=>{delete e[t.name]}))},handleByList(t,e,r=-1){return this.handle(t,(t=>{e.includes(t.ref)||(e.push(t.ref),e.sort(((t,e)=>Qt(e,r)-Qt(t,r))))}),(t=>{const r=e.indexOf(t.ref);-1!==r&&e.splice(r,1)}))}};class te{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const ee=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function re(t){let e="";for(let r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}class ie{constructor(){this.data=0,this.blendMode=a.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==a.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new ie;return t.depthTest=!1,t.blend=!0,t}}const ne=[];function se(t,e){if(!t)return null;let r="";if("string"==typeof t){const e=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);e&&(r=e[1].toLowerCase())}for(let i=ne.length-1;i>=0;--i){const n=ne[i];if(n.test&&n.test(t,r))return new n(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class oe{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,i,n,s,o,a){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:l}=this;this._aliasCount++;for(let c=0,u=l.length;c<u;c++)l[c][h](t,e,r,i,n,s,o,a);return l===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(oe.prototype,{dispatch:{value:oe.prototype.emit},run:{value:oe.prototype.emit}});class ae{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new oe("setRealSize"),this.onUpdate=new oe("update"),this.onError=new oe("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class he extends ae{constructor(t,e){const{width:r,height:i}=e||{};if(!r||!i)throw new Error("BufferResource width or height invalid");super(r,i),this.data=t}upload(t,e,r){const i=t.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===g.UNPACK);const n=e.realWidth,s=e.realHeight;return r.width===n&&r.height===s?i.texSubImage2D(e.target,0,0,0,n,s,e.format,r.type,this.data):(r.width=n,r.height=s,i.texImage2D(e.target,0,r.internalFormat,n,s,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const le={scaleMode:f.NEAREST,format:l.RGBA,alphaMode:g.NPM},ce=class extends z{constructor(t=null,e=null){super(),e=Object.assign({},ce.defaultOptions,e);const{alphaMode:r,mipmap:i,anisotropicLevel:n,scaleMode:s,width:o,height:a,wrapMode:h,format:l,type:c,target:u,resolution:d,resourceOptions:f}=e;!t||t instanceof ae||((t=se(t,f)).internal=!0),this.resolution=d||T.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=i,this.anisotropicLevel=n,this._wrapMode=h,this._scaleMode=s,this.format=l,this.type=c,this.target=u,this.alphaMode=r,this.uid=Ft(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let r;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this}setSize(t,e,r){return r=r||this.resolution,this.setRealSize(t*r,e*r,r)}setRealSize(t,e,r){return this.resolution=r||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Dt(this.realWidth)&&Dt(this.realHeight)}setResolution(t){const e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Xt[this.cacheId],delete Ht[this.cacheId],this.cacheId=null),this.dispose(),ce.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,r=T.STRICT_TEXTURE_CACHE){const i="string"==typeof t;let n=null;if(i)n=t;else{if(!t._pixiId){const r=e?.pixiIdPrefix||"pixiid";t._pixiId=`${r}_${Ft()}`}n=t._pixiId}let s=Xt[n];if(i&&r&&!s)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return s||(s=new ce(t,e),s.cacheId=n,ce.addToCache(s,n)),s}static fromBuffer(t,e,r,i){t=t||new Float32Array(e*r*4);const n=new he(t,{width:e,height:r}),s=t instanceof Float32Array?u.FLOAT:u.UNSIGNED_BYTE;return new ce(n,Object.assign({},le,i||{width:e,height:r,type:s}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Xt[e]&&Xt[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Xt[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=Xt[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Xt[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Xt[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};let ue=ce;ue.defaultOptions={mipmap:m.POW2,anisotropicLevel:0,scaleMode:f.LINEAR,wrapMode:p.CLAMP,alphaMode:g.UNPACK,target:c.TEXTURE_2D,format:l.RGBA,type:u.UNSIGNED_BYTE},ue._globalBatch=0;class de{constructor(){this.texArray=null,this.blend=0,this.type=h.TRIANGLES,this.start=0,this.size=0,this.data=null}}let fe=0;class pe{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=fe++,this.disposeRunner=new oe("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?w.ELEMENT_ARRAY_BUFFER:w.ARRAY_BUFFER}get index(){return this.type===w.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new pe(t)}}class me{constructor(t,e=0,r=!1,i=u.FLOAT,n,s,o,a=1){this.buffer=t,this.size=e,this.normalized=r,this.type=i,this.stride=n,this.start=s,this.instance=o,this.divisor=a}destroy(){this.buffer=null}static from(t,e,r,i,n){return new me(t,e,r,i,n)}}const ge={Float32Array,Uint32Array,Int32Array,Uint8Array},ye={5126:4,5123:2,5121:1};let ve=0;const be={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class xe{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=ve++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new oe("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,i=!1,n,s,o,a=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof pe||(e instanceof Array&&(e=new Float32Array(e)),e=new pe(e));const h=t.split("|");if(h.length>1){for(let t=0;t<h.length;t++)this.addAttribute(h[t],e,r,i,n);return this}let l=this.buffers.indexOf(e);return-1===l&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new me(l,r,i,n,s,o,a),this.instanced=this.instanced||a,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof pe||(t instanceof Array&&(t=new Uint16Array(t)),t=new pe(t)),t.type=w.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],r=new pe;let i;for(i in this.attributes){const r=this.attributes[i],n=this.buffers[r.buffer];t.push(n.data),e.push(r.size*ye[r.type]/4),r.buffer=0}for(r.data=function(t,e){let r=0,i=0;const n={};for(let n=0;n<t.length;n++)i+=e[n],r+=t[n].length;const s=new ArrayBuffer(4*r);let o=null,a=0;for(let r=0;r<t.length;r++){const h=e[r],l=t[r],c=Mt(l);n[c]||(n[c]=new ge[c](s)),o=n[c];for(let t=0;t<l.length;t++)o[(t/h|0)*i+a+t%h]=l[t];a+=h}return new Float32Array(s)}(t,e),i=0;i<this.buffers.length;i++)this.buffers[i]!==this.indexBuffer&&this.buffers[i].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new xe;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new pe(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new me(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=w.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new xe,r=[],i=[],n=[];let s;for(let e=0;e<t.length;e++){s=t[e];for(let t=0;t<s.buffers.length;t++)i[t]=i[t]||0,i[t]+=s.buffers[t].data.length,n[t]=0}for(let t=0;t<s.buffers.length;t++)r[t]=new(be[Mt(s.buffers[t].data)])(i[t]),e.buffers[t]=new pe(r[t]);for(let e=0;e<t.length;e++){s=t[e];for(let t=0;t<s.buffers.length;t++)r[t].set(s.buffers[t].data,n[t]),n[t]+=s.buffers[t].data.length}if(e.attributes=s.attributes,s.indexBuffer){e.indexBuffer=e.buffers[s.buffers.indexOf(s.indexBuffer)],e.indexBuffer.type=w.ELEMENT_ARRAY_BUFFER;let r=0,i=0,n=0,o=0;for(let t=0;t<s.buffers.length;t++)if(s.buffers[t]!==s.indexBuffer){o=t;break}for(const t in s.attributes){const e=s.attributes[t];(0|e.buffer)===o&&(i+=e.size*ye[e.type]/4)}for(let s=0;s<t.length;s++){const a=t[s].indexBuffer.data;for(let t=0;t<a.length;t++)e.indexBuffer.data[t+n]+=r;r+=t[s].buffers[o].data.length/i,n+=a.length}}return e}}class _e extends xe{constructor(t=!1){super(),this._buffer=new pe(null,t,!1),this._indexBuffer=new pe(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,u.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,u.FLOAT).addAttribute("aColor",this._buffer,4,!0,u.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,u.FLOAT).addIndex(this._indexBuffer)}}const we=2*Math.PI,Ee=180/Math.PI,Te=Math.PI/180;var Ae=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(Ae||{});class Se{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Se(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const Pe=[new Se,new Se,new Se,new Se];class Oe{constructor(t=0,e=0,r=0,i=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(i),this.type=Ae.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Oe(0,0,0,0)}clone(){return new Oe(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const r=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>r}const r=this.left,i=this.right,n=this.top,s=this.bottom;if(i<=r||s<=n)return!1;const o=Pe[0].set(t.left,t.top),a=Pe[1].set(t.left,t.bottom),h=Pe[2].set(t.right,t.top),l=Pe[3].set(t.right,t.bottom);if(h.x<=o.x||a.y<=o.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(0===c)return!1;if(e.apply(o,o),e.apply(a,a),e.apply(h,h),e.apply(l,l),Math.max(o.x,a.x,h.x,l.x)<=r||Math.min(o.x,a.x,h.x,l.x)>=i||Math.max(o.y,a.y,h.y,l.y)<=n||Math.min(o.y,a.y,h.y,l.y)>=s)return!1;const u=c*(a.y-o.y),d=c*(o.x-a.x),f=u*r+d*n,p=u*i+d*n,m=u*r+d*s,g=u*i+d*s;if(Math.max(f,p,m,g)<=u*o.x+d*o.y||Math.min(f,p,m,g)>=u*l.x+d*l.y)return!1;const y=c*(o.y-h.y),v=c*(h.x-o.x),b=y*r+v*n,x=y*i+v*n,_=y*r+v*s,w=y*i+v*s;return!(Math.max(b,x,_,w)<=y*o.x+v*o.y||Math.min(b,x,_,w)>=y*l.x+v*l.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),i=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=i,this.height=Math.max(n-i,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,i=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=i-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),i=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=i,this.height=n-i,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Ce{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.radius=r,this.type=Ae.CIRC}clone(){return new Ce(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let i=this.x-t,n=this.y-e;return i*=i,n*=n,i+n<=r}getBounds(){return new Oe(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Re{constructor(t=0,e=0,r=0,i=0){this.x=t,this.y=e,this.width=r,this.height=i,this.type=Ae.ELIP}clone(){return new Re(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let r=(t-this.x)/this.width,i=(e-this.y)/this.height;return r*=r,i*=i,r+i<=1}getBounds(){return new Oe(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Ie{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let r=0,i=e.length;r<i;r++)t.push(e[r].x,e[r].y);e=t}this.points=e,this.type=Ae.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Ie(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let r=!1;const i=this.points.length/2;for(let n=0,s=i-1;n<i;s=n++){const i=this.points[2*n],o=this.points[2*n+1],a=this.points[2*s],h=this.points[2*s+1];o>e!=h>e&&t<(e-o)/(h-o)*(a-i)+i&&(r=!r)}return r}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`}}class Me{constructor(t=0,e=0,r=0,i=0,n=20){this.x=t,this.y=e,this.width=r,this.height=i,this.radius=n,this.type=Ae.RREC}clone(){return new Me(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let i=t-(this.x+r),n=e-(this.y+r);const s=r*r;if(i*i+n*n<=s)return!0;if(i=t-(this.x+this.width-r),i*i+n*n<=s)return!0;if(n=e-(this.y+this.height-r),i*i+n*n<=s)return!0;if(i=t-(this.x+r),i*i+n*n<=s)return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class Be{constructor(t=1,e=0,r=0,i=1,n=0,s=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=i,this.tx=n,this.ty=s}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,i,n,s){return this.a=t,this.b=e,this.c=r,this.d=i,this.tx=n,this.ty=s,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new Se;const r=t.x,i=t.y;return e.x=this.a*r+this.c*i+this.tx,e.y=this.b*r+this.d*i+this.ty,e}applyInverse(t,e){e=e||new Se;const r=1/(this.a*this.d+this.c*-this.b),i=t.x,n=t.y;return e.x=this.d*r*i+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*n+-this.b*r*i+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),i=this.a,n=this.c,s=this.tx;return this.a=i*e-this.b*r,this.b=i*r+this.b*e,this.c=n*e-this.d*r,this.d=n*r+this.d*e,this.tx=s*e-this.ty*r,this.ty=s*r+this.ty*e,this}append(t){const e=this.a,r=this.b,i=this.c,n=this.d;return this.a=t.a*e+t.b*i,this.b=t.a*r+t.b*n,this.c=t.c*e+t.d*i,this.d=t.c*r+t.d*n,this.tx=t.tx*e+t.ty*i+this.tx,this.ty=t.tx*r+t.ty*n+this.ty,this}setTransform(t,e,r,i,n,s,o,a,h){return this.a=Math.cos(o+h)*n,this.b=Math.sin(o+h)*n,this.c=-Math.sin(o-a)*s,this.d=Math.cos(o-a)*s,this.tx=t-(r*this.a+i*this.c),this.ty=e-(r*this.b+i*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,r=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,i=this.c,n=this.d,s=t.pivot,o=-Math.atan2(-i,n),a=Math.atan2(r,e),h=Math.abs(o+a);return h<1e-5||Math.abs(we-h)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(i*i+n*n),t.position.x=this.tx+(s.x*e+s.y*i),t.position.y=this.ty+(s.x*r+s.y*n),t}invert(){const t=this.a,e=this.b,r=this.c,i=this.d,n=this.tx,s=t*i-e*r;return this.a=i/s,this.b=-e/s,this.c=-r/s,this.d=t/s,this.tx=(r*this.ty-i*n)/s,this.ty=-(t*this.ty-e*n)/s,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Be;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new Be}static get TEMP_MATRIX(){return new Be}}const De=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],je=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],ke=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Ne=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Le=[],Fe=[],Ue=Math.sign;!function(){for(let t=0;t<16;t++){const e=[];Le.push(e);for(let r=0;r<16;r++){const i=Ue(De[t]*De[r]+ke[t]*je[r]),n=Ue(je[t]*De[r]+Ne[t]*je[r]),s=Ue(De[t]*ke[r]+ke[t]*Ne[r]),o=Ue(je[t]*ke[r]+Ne[t]*Ne[r]);for(let t=0;t<16;t++)if(De[t]===i&&je[t]===n&&ke[t]===s&&Ne[t]===o){e.push(t);break}}}for(let t=0;t<16;t++){const e=new Be;e.set(De[t],je[t],ke[t],Ne[t],0,0),Fe.push(e)}}();const Ge={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>De[t],uY:t=>je[t],vX:t=>ke[t],vY:t=>Ne[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>Le[t][e],sub:(t,e)=>Le[t][Ge.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?Ge.S:Ge.N:2*Math.abs(e)<=Math.abs(t)?t>0?Ge.E:Ge.W:e>0?t>0?Ge.SE:Ge.SW:t>0?Ge.NE:Ge.NW,matrixAppendRotationInv:(t,e,r=0,i=0)=>{const n=Fe[Ge.inv(e)];n.tx=r,n.ty=i,t.append(n)}};class ze{constructor(t,e,r=0,i=0){this._x=r,this._y=i,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new ze(t,e,this._x,this._y)}set(t=0,e=t){return this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const He=class{constructor(){this.worldTransform=new Be,this.localTransform=new Be,this.position=new ze(this.onChange,this,0,0),this.scale=new ze(this.onChange,this,1,1),this.pivot=new ze(this.onChange,this,0,0),this.skew=new ze(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const r=t.worldTransform,i=this.worldTransform;i.a=e.a*r.a+e.b*r.c,i.b=e.a*r.b+e.b*r.d,i.c=e.c*r.a+e.d*r.c,i.d=e.c*r.b+e.d*r.d,i.tx=e.tx*r.a+e.ty*r.c+r.tx,i.ty=e.tx*r.b+e.ty*r.d+r.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};let Xe=He;Xe.IDENTITY=new He;const Ve=[{test:t=>"float"===t.type&&1===t.size&&!t.isArray,code:t=>`\n            if(uv["${t}"] !== ud["${t}"].value)\n            {\n                ud["${t}"].value = uv["${t}"]\n                gl.uniform1f(ud["${t}"].location, uv["${t}"])\n            }\n            `},{test:(t,e)=>!("sampler2D"!==t.type&&"samplerCube"!==t.type&&"sampler2DArray"!==t.type||1!==t.size||t.isArray||null!=e&&void 0===e.castToBaseTexture),code:t=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${t}"], t);\n\n            if(ud["${t}"].value !== t)\n            {\n                ud["${t}"].value = t;\n                gl.uniform1i(ud["${t}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(t,e)=>"mat3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.a,code:t=>`\n            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));\n            `,codeUbo:t=>`\n                var ${t}_matrix = uv.${t}.toArray(true);\n\n                data[offset] = ${t}_matrix[0];\n                data[offset+1] = ${t}_matrix[1];\n                data[offset+2] = ${t}_matrix[2];\n        \n                data[offset + 4] = ${t}_matrix[3];\n                data[offset + 5] = ${t}_matrix[4];\n                data[offset + 6] = ${t}_matrix[5];\n        \n                data[offset + 8] = ${t}_matrix[6];\n                data[offset + 9] = ${t}_matrix[7];\n                data[offset + 10] = ${t}_matrix[8];\n            `},{test:(t,e)=>"vec2"===t.type&&1===t.size&&!t.isArray&&void 0!==e.x,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${t}"].location, v.x, v.y);\n                }`,codeUbo:t=>`\n                v = uv.${t};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:t=>"vec2"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);\n                }\n            `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.width,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(t,e)=>"vec3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:t=>"vec4"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])\n                }`}],We={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},Ye={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},$e={};let qe,Ke=$e;const Ze={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Qe(t){return Ze[t]}let Je=null;const tr={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function er(t,e){if(!Je){const e=Object.keys(tr);Je={};for(let r=0;r<e.length;++r){const i=e[r];Je[t[i]]=tr[i]}}return Je[e]}function rr(t,e,r){if("precision"!==t.substring(0,9)){let i=e;return e===b.HIGH&&r!==b.HIGH&&(i=b.MEDIUM),`precision ${i} float;\n${t}`}return r!==b.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}let ir=0;const nr={},sr=class{constructor(t,e,r="pixi-shader",i={}){this.extra={},this.id=ir++,this.vertexSrc=t||sr.defaultVertexSrc,this.fragmentSrc=e||sr.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=i,"#version"!==this.vertexSrc.substring(0,8)&&(r=r.replace(/\s+/g,"-"),nr[r]?(nr[r]++,r+=`-${nr[r]}`):nr[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}\n${this.fragmentSrc}`,this.vertexSrc=rr(this.vertexSrc,sr.defaultVertexPrecision,b.HIGH),this.fragmentSrc=rr(this.fragmentSrc,sr.defaultFragmentPrecision,function(){if(!qe){qe=b.MEDIUM;const t=function(){if(Ke===$e||Ke?.isContextLost()){const t=T.ADAPTER.createCanvas();let e;T.PREFER_ENV>=s.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),Ke=e}return Ke}();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);qe=e.precision?b.HIGH:b.MEDIUM}}return qe}())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(t,e,r){const i=t+e;let n=zt[i];return n||(zt[i]=n=new sr(t,e,r)),n}};let or=sr;or.defaultVertexPrecision=b.HIGH,or.defaultFragmentPrecision=G.apple.device?b.HIGH:b.MEDIUM;let ar=0;class hr{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=ar++,this.static=!!e,this.ubo=!!r,t instanceof pe?(this.buffer=t,this.buffer.type=w.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new pe(new Float32Array(1)),this.buffer.type=w.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new hr(e,r)}static from(t,e,r){return new hr(t,e,r)}static uboFrom(t,e){return new hr(t,e??!0,!0)}}class lr{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof hr?e:new hr(e):new hr({}),this.disposeRunner=new oe("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const i=e.uniforms[r];if(i.group&&this.checkUniformExists(t,i))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const i=or.from(t,e);return new lr(i,r)}}class cr{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const e=new Int32Array(t);for(let r=0;r<t;r++)e[r]=r;this.defaultGroupCache[t]=hr.from({uSamplers:e},!0);let r=this.fragTemplate;r=r.replace(/%count%/gi,`${t}`),r=r.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new or(this.vertexSrc,r)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Be,default:this.defaultGroupCache[t]};return new lr(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let r=0;r<t;r++)r>0&&(e+="\nelse "),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${r}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class ur{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class dr{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}const fr=class extends dr{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=_e,this.vertexSize=6,this.state=ie.for2d(),this.size=4*fr.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(t){let e=!0;const r=T.ADAPTER.getNavigator();if(G.tablet||G.phone){if(G.apple.device){const t=r.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(G.android.device){const t=r.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?32:4}(),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!G.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return K("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:t=fr.defaultVertexSrc,fragment:e=fr.defaultFragmentTemplate}={}){this.shaderGenerator=new cr(t,e)}contextChange(){const t=this.renderer.gl;T.PREFER_ENV===s.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),fr.defaultMaxTextures),this.maxTextures=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=e.createShader(e.FRAGMENT_SHADER);for(;;){const i=ee.replace(/%forloop%/gi,re(t));if(e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=fr,r=this.size/4,i=Math.floor(r/this.maxTextures)+1;for(;t.length<r;)t.push(new de);for(;e.length<i;)e.push(new ur);for(let t=0;t<this.maxTextures;t++)this._tempBoundTextures[t]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,r=fr._textureArrayPool,i=this.renderer.batch,n=this._tempBoundTextures,s=this.renderer.textureGC.count;let o=++ue._globalBatch,a=0,h=r[0],l=0;i.copyBoundTextures(n,e);for(let c=0;c<this._bufferSize;++c){const u=t[c];t[c]=null,u._batchEnabled!==o&&(h.count>=e&&(i.boundArray(h,n,o,e),this.buildDrawCalls(h,l,c),l=c,h=r[++a],++o),u._batchEnabled=o,u.touched=s,h.elements[h.count++]=u)}h.count>0&&(i.boundArray(h,n,o,e),this.buildDrawCalls(h,l,this._bufferSize),++a,++o);for(let t=0;t<n.length;t++)n[t]=null;ue._globalBatch=o}buildDrawCalls(t,e,r){const{_bufferedElements:i,_attributeBuffer:n,_indexBuffer:s,vertexSize:o}=this,a=fr._drawCallPool;let h=this._dcIndex,l=this._aIndex,c=this._iIndex,u=a[h];u.start=this._iIndex,u.texArray=t;for(let d=e;d<r;++d){const r=i[d],f=r._texture.baseTexture,p=Rt[f.alphaMode?1:0][r.blendMode];i[d]=null,e<d&&u.blend!==p&&(u.size=c-u.start,e=d,u=a[++h],u.texArray=t,u.start=c),this.packInterleavedGeometry(r,n,s,l,c),l+=r.vertexData.length/2*o,c+=r.indices.length,u.blend=p}e<r&&(u.size=c-u.start,++h),this._dcIndex=h,this._aIndex=l,this._iIndex=c}bindAndClearTexArray(t){const e=this.renderer.texture;for(let r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:r}=this;fr.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:r}=this.renderer,i=fr._drawCallPool;let n=null;for(let s=0;s<t;s++){const{texArray:t,type:o,size:a,start:h,blend:l}=i[s];n!==t&&(n=t,this.bindAndClearTexArray(t)),this.state.blendMode=l,r.set(this.state),e.drawElements(o,a,e.UNSIGNED_SHORT,2*h)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),fr.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=Bt(Math.ceil(t/8)),r=jt(e),i=8*e;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._aBuffers[i];return n||(this._aBuffers[i]=n=new te(i*this.vertexSize*4)),n}getIndexBuffer(t){const e=Bt(Math.ceil(t/12)),r=jt(e),i=12*e;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._iBuffers[r];return n||(this._iBuffers[r]=n=new Uint16Array(i)),n}packInterleavedGeometry(t,e,r,i,n){const{uint32View:s,float32View:o}=e,a=i/this.vertexSize,h=t.uvs,l=t.indices,c=t.vertexData,u=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),f=Pt.shared.setValue(t._tintRGB).toPremultiplied(d);for(let t=0;t<c.length;t+=2)o[i++]=c[t],o[i++]=c[t+1],o[i++]=h[t],o[i++]=h[t+1],s[i++]=f,o[i++]=u;for(let t=0;t<l.length;t++)r[n++]=a+l[t]}};let pr=fr;pr.defaultBatchSize=4096,pr.extension={name:"batch",type:Kt.RendererPlugin},pr._drawCallPool=[],pr._textureArrayPool=[],Jt.add(pr);const mr=class extends lr{constructor(t,e,r){super(or.from(t||mr.defaultVertexSrc,e||mr.defaultFragmentSrc),r),this.padding=0,this.resolution=mr.defaultResolution,this.multisample=mr.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new ie}apply(t,e,r,i,n){t.applyFilter(this,e,r,i)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};let gr=mr;gr.defaultResolution=1,gr.defaultMultisample=_.NONE;class yr{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Pt(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:r,backgroundAlpha:i}=t,n=r??e;void 0!==n&&(this.color=n),this.alpha=i}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}yr.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},yr.extension={type:[Kt.RendererSystem,Kt.CanvasRendererSystem],name:"background"},Jt.add(yr);class vr{constructor(t){this.renderer=t,this.emptyRenderer=new dr(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let i=e-1;i>=0;--i)t[i]=r[i]||null,t[i]&&(t[i]._batchLocation=i)}boundArray(t,e,r,i){const{elements:n,ids:s,count:o}=t;let a=0;for(let t=0;t<o;t++){const o=n[t],h=o._batchLocation;if(h>=0&&h<i&&e[h]===o)s[t]=h;else for(;a<i;){const i=e[a];if(!i||i._batchEnabled!==r||i._batchLocation!==a){s[t]=a,o._batchLocation=a,e[a]=o;break}a++}}}destroy(){this.renderer=null}}vr.extension={type:Kt.RendererSystem,name:"batch"},Jt.add(vr);let br=0;class xr{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=br++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=br++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(T.PREFER_ENV>=s.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const i=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=i,i||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}xr.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},xr.extension={type:Kt.RendererSystem,name:"context"},Jt.add(xr);class _r extends he{upload(t,e,r){const i=t.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===g.UNPACK);const n=e.realWidth,s=e.realHeight;return r.width===n&&r.height===s?i.texSubImage2D(e.target,0,0,0,n,s,e.format,r.type,this.data):(r.width=n,r.height=s,i.texImage2D(e.target,0,r.internalFormat,n,s,0,e.format,r.type,this.data)),!0}}class wr{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new oe("disposeFramebuffer"),this.multisample=_.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new ue(null,{scaleMode:f.NEAREST,resolution:1,mipmap:m.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new ue(new _r(null,{width:this.width,height:this.height}),{scaleMode:f.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:m.OFF,format:l.DEPTH_COMPONENT,type:u.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const i=this.colorTextures[r],n=i.resolution;i.setSize(t/n,e/n)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Er extends ue{constructor(t={}){"number"==typeof t&&(t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=_.NONE),super(null,t),this.mipmap=m.OFF,this.valid=!0,this._clear=new Pt([0,0,0,0]),this.framebuffer=new wr(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Tr extends ae{constructor(t){const e=t;super(e.naturalWidth||e.videoWidth||e.width,e.naturalHeight||e.videoHeight||e.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){void 0!==r||e.startsWith("data:")?!1!==r&&(t.crossOrigin="string"==typeof r?r:"anonymous"):t.crossOrigin=function(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location,$t||($t=document.createElement("a")),$t.href=t;const r=V.parse($t.href),i=!r.port&&""===e.port||r.port===e.port;return r.hostname===e.hostname&&i&&r.protocol===e.protocol?"":"anonymous"}(e)}upload(t,e,r,i){const n=t.gl,s=e.realWidth,o=e.realHeight;if(i=i||this.source,"undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement){if(!i.complete||0===i.naturalWidth)return!1}else if("undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement&&i.readyState<=1&&0===i.buffered.length)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===g.UNPACK),this.noSubImage||e.target!==n.TEXTURE_2D||r.width!==s||r.height!==o?(r.width=s,r.height=o,n.texImage2D(e.target,0,r.internalFormat,e.format,r.type,i)):n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,r.type,i),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}}class Ar extends Tr{constructor(t,e){if(e=e||{},"string"==typeof t){const r=new Image;Tr.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??T.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(((t,e)=>{const r=this.source;this.url=r.src;const i=()=>{this.destroyed||(r.onload=null,r.onerror=null,this.resize(r.width,r.height),this._load=null,this.createBitmap?t(this.process()):t(this))};r.complete&&r.src?i():(r.onload=i,r.onerror=t=>{e(t),this.onError.emit(t)})}))),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||"anonymous"===t.crossOrigin;return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then((t=>t.blob())).then((r=>e(r,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===g.UNPACK?"premultiply":"none"}))).then((t=>this.destroyed?Promise.reject():(this.bitmap=t,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(t,e,r){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let t=!0;const i=e._glTextures;for(const n in i){const s=i[n];if(s!==r&&s.dirtyId!==e.dirtyId){t=!1;break}}t&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return"undefined"!=typeof HTMLImageElement&&("string"==typeof t||t instanceof HTMLImageElement)}}class Sr{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const i=e.width,n=e.height;if(r){const e=t.width/2/i,s=t.height/2/n,o=t.x/i+e,a=t.y/n+s;r=Ge.add(r,Ge.NW),this.x0=o+e*Ge.uX(r),this.y0=a+s*Ge.uY(r),r=Ge.add(r,2),this.x1=o+e*Ge.uX(r),this.y1=a+s*Ge.uY(r),r=Ge.add(r,2),this.x2=o+e*Ge.uX(r),this.y2=a+s*Ge.uY(r),r=Ge.add(r,2),this.x3=o+e*Ge.uX(r),this.y3=a+s*Ge.uY(r)}else this.x0=t.x/i,this.y0=t.y/n,this.x1=(t.x+t.width)/i,this.y1=t.y/n,this.x2=(t.x+t.width)/i,this.y2=(t.y+t.height)/n,this.x3=t.x/i,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const Pr=new Sr;function Or(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}class Cr extends z{constructor(t,e,r,i,n,s,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Oe(0,0,1,1)),t instanceof Cr&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=i,this.valid=!1,this._uvs=Pr,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(n||0),!0===n)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=s?new Se(s.x,s.y):new Se(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:t}=this.baseTexture;t?.url&&Ht[t.url]&&Cr.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Cr.removeFromCache(this),this.textureCacheIds=null}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new Cr(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===Pr&&(this._uvs=new Sr),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=T.STRICT_TEXTURE_CACHE){const i="string"==typeof t;let n=null;if(i)n=t;else if(t instanceof ue){if(!t.cacheId){const r=e?.pixiIdPrefix||"pixiid";t.cacheId=`${r}-${Ft()}`,ue.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const r=e?.pixiIdPrefix||"pixiid";t._pixiId=`${r}_${Ft()}`}n=t._pixiId}let s=Ht[n];if(i&&r&&!s)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return s||t instanceof ue?!s&&t instanceof ue&&(s=new Cr(t),Cr.addToCache(s,n)):(e.resolution||(e.resolution=qt(t)),s=new Cr(new ue(t,e)),s.baseTexture.cacheId=n,ue.addToCache(s.baseTexture,n),Cr.addToCache(s,n)),s}static fromURL(t,e){const r=Object.assign({autoLoad:!1},e?.resourceOptions),i=Cr.from(t,Object.assign({resourceOptions:r},e),!1),n=i.baseTexture.resource;return i.baseTexture.valid?Promise.resolve(i):n.load().then((()=>Promise.resolve(i)))}static fromBuffer(t,e,r,i){return new Cr(ue.fromBuffer(t,e,r,i))}static fromLoader(t,e,r,i){const n=new ue(t,Object.assign({scaleMode:ue.defaultOptions.scaleMode,resolution:qt(e)},i)),{resource:s}=n;s instanceof Ar&&(s.url=e);const o=new Cr(n);return r||(r=e),ue.addToCache(o.baseTexture,r),Cr.addToCache(o,r),r!==e&&(ue.addToCache(o.baseTexture,e),Cr.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise((t=>{o.baseTexture.once("loaded",(()=>t(o)))}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Ht[e]&&Ht[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Ht[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=Ht[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Ht[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Ht[t.textureCacheIds[e]]===t&&delete Ht[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:i,height:n}=t,s=e+i>this.baseTexture.width,o=r+n>this.baseTexture.height;if(s||o){const t=s&&o?"and":"or",a=`X: ${e} + ${i} = ${e+i} > ${this.baseTexture.width}`,h=`Y: ${r} + ${n} = ${r+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${a} ${t} ${h}`)}this.valid=i&&n&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Cr._EMPTY||(Cr._EMPTY=new Cr(new ue),Or(Cr._EMPTY),Or(Cr._EMPTY.baseTexture)),Cr._EMPTY}static get WHITE(){if(!Cr._WHITE){const t=T.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Cr._WHITE=new Cr(ue.from(t)),Or(Cr._WHITE),Or(Cr._WHITE.baseTexture)}return Cr._WHITE}}class Rr extends Cr{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const i=this.baseTexture.resolution,n=Math.round(t*i)/i,s=Math.round(e*i)/i;this.valid=n>0&&s>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=s,r&&this.baseTexture.resize(n,s),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Rr(new Er(t))}}class Ir{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=_.NONE){const i=new Er(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new Rr(i)}getOptimalTexture(t,e,r=1,i=_.NONE){let n;t=Math.ceil(t*r-1e-6),e=Math.ceil(e*r-1e-6),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?n=i>1?-i:-1:(n=((65535&(t=Bt(t)))<<16|65535&(e=Bt(e)))>>>0,i>1&&(n+=4294967296*i)),this.texturePool[n]||(this.texturePool[n]=[]);let s=this.texturePool[n].pop();return s||(s=this.createTexture(t,e,i)),s.filterPoolKey=n,s.setResolution(r),s}getFilterTexture(t,e,r){const i=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||_.NONE);return i.filterFrame=t.filterFrame,i}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=!1!==t)for(const t in this.texturePool){const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0)}this.texturePool={}}setScreenSize(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){this.enableFullScreen=t.width>0&&t.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Ir.SCREEN_KEY=-1;class Mr extends xe{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Br extends xe{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new pe(this.vertices),this.uvBuffer=new pe(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,i=0;return this.uvs[0]=r,this.uvs[1]=i,this.uvs[2]=r+e.width/t.width,this.uvs[3]=i,this.uvs[4]=r+e.width/t.width,this.uvs[5]=i+e.height/t.height,this.uvs[6]=r,this.uvs[7]=i+e.height/t.height,r=e.x,i=e.y,this.vertices[0]=r,this.vertices[1]=i,this.vertices[2]=r+e.width,this.vertices[3]=i,this.vertices[4]=r+e.width,this.vertices[5]=i+e.height,this.vertices[6]=r,this.vertices[7]=i+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Dr{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=_.NONE,this.sourceFrame=new Oe,this.destinationFrame=new Oe,this.bindingSourceFrame=new Oe,this.bindingDestinationFrame=new Oe,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const jr=[new Se,new Se,new Se,new Se],kr=new Be;class Nr{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Ir,this.statePool=[],this.quad=new Mr,this.quadUv=new Br,this.tempRect=new Oe,this.activeState={},this.globalUniforms=new hr({outputFrame:new Oe,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const r=this.renderer,i=this.defaultFilterStack,n=this.statePool.pop()||new Dr,s=this.renderer.renderTexture;let o=e[0].resolution,a=e[0].multisample,h=e[0].padding,l=e[0].autoFit,c=e[0].legacy??!0;for(let t=1;t<e.length;t++){const r=e[t];o=Math.min(o,r.resolution),a=Math.min(a,r.multisample),h=this.useMaxPadding?Math.max(h,r.padding):h+r.padding,l=l&&r.autoFit,c=c||(r.legacy??!0)}1===i.length&&(this.defaultFilterStack[0].renderTexture=s.current),i.push(n),n.resolution=o,n.multisample=a,n.legacy=c,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(h);const u=this.tempRect.copyFrom(s.sourceFrame);r.projection.transform&&this.transformAABB(kr.copyFrom(r.projection.transform).invert(),u),l?(n.sourceFrame.fit(u),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(u)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,s.current?s.current.resolution:r.resolution,s.sourceFrame,s.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,o,a),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const d=this.tempRect;d.x=0,d.y=0,d.width=n.sourceFrame.width,d.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(s.sourceFrame),n.bindingDestinationFrame.copyFrom(s.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,s.bind(n.renderTexture,n.sourceFrame,d),r.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const i=this.globalUniforms.uniforms;i.outputFrame=e.sourceFrame,i.resolution=e.resolution;const n=i.inputSize,s=i.inputPixel,o=i.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],s[0]=Math.round(n[0]*e.resolution),s[1]=Math.round(n[1]*e.resolution),s[2]=1/s[0],s[3]=1/s[1],o[0]=.5*s[2],o[1]=.5*s[3],o[2]=e.sourceFrame.width*n[2]-.5*s[2],o[3]=e.sourceFrame.height*n[3]-.5*s[3],e.legacy){const t=i.filterArea;t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=e.sourceFrame.x,t[3]=e.sourceFrame.y,i.filterClamp=i.inputClamp}this.globalUniforms.update();const a=t[t.length-1];if(this.renderer.framebuffer.blit(),1===r.length)r[0].apply(this,e.renderTexture,a.renderTexture,y.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let t=e.renderTexture,i=this.getOptimalFilterTexture(t.width,t.height,e.resolution);i.filterFrame=t.filterFrame;let n=0;for(n=0;n<r.length-1;++n){1===n&&e.multisample>1&&(i=this.getOptimalFilterTexture(t.width,t.height,e.resolution),i.filterFrame=t.filterFrame),r[n].apply(this,t,i,y.CLEAR,e);const s=t;t=i,i=s}r[n].apply(this,t,a.renderTexture,y.BLEND,e),n>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(t),this.returnFilterTexture(i)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=y.CLEAR){const{renderTexture:r,state:i}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const e=this.tempRect;e.x=0,e.y=0,e.width=t.filterFrame.width,e.height=t.filterFrame.height,r.bind(t,t.filterFrame,e)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=1&i.stateId||this.forceClear;(e===y.CLEAR||e===y.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,i){const n=this.renderer;n.state.set(t.state),this.bindAndClear(r,i),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(h.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(h.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:i}=this.activeState,{orig:n}=e._texture,s=t.set(i.width,0,0,i.height,r.x,r.y),o=e.worldTransform.copyTo(Be.TEMP_MATRIX);return o.invert(),s.prepend(o),s.scale(1/n.width,1/n.height),s.translate(e.anchor.x,e.anchor.y),s}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,i=_.NONE){return this.texturePool.getOptimalTexture(t,e,r,i)}getFilterTexture(t,e,r){if("number"==typeof t){const r=t;t=e,e=r}t=t||this.activeState.renderTexture;const i=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||_.NONE);return i.filterFrame=t.filterFrame,i}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=jr[0],i=jr[1],n=jr[2],s=jr[3];r.set(e.left,e.top),i.set(e.left,e.bottom),n.set(e.right,e.top),s.set(e.right,e.bottom),t.apply(r,r),t.apply(i,i),t.apply(n,n),t.apply(s,s);const o=Math.min(r.x,i.x,n.x,s.x),a=Math.min(r.y,i.y,n.y,s.y),h=Math.max(r.x,i.x,n.x,s.x),l=Math.max(r.y,i.y,n.y,s.y);e.x=o,e.y=a,e.width=h-o,e.height=l-a}roundFrame(t,e,r,i,n){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(n){const{a:t,b:e,c:r,d:i}=n;if((Math.abs(e)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(i)>1e-4))return}(n=n?kr.copyFrom(n):kr.identity()).translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)}}}Nr.extension={type:Kt.RendererSystem,name:"filter"},Jt.add(Nr);class Lr{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=_.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Fr=new Oe;class Ur{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new wr(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Oe,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;T.PREFER_ENV===s.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=t=>e.drawBuffersWEBGL(t):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:i}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,i.bindFramebuffer(i.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=r),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let e=0;e<t.colorTextures.length;e++){const r=t.colorTextures[e];this.renderer.texture.unbind(r.parentTextureArray||r)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const t=e.width>>r,i=e.height>>r,n=t/e.width;this.setViewport(e.x*n,e.y*n,t,i)}else{const e=t.width>>r,i=t.height>>r;this.setViewport(0,0,e,i)}}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,i){const n=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),i=Math.round(i),n.width===r&&n.height===i&&n.x===t&&n.y===e||(n.x=t,n.y=e,n.width=r,n.height=i,this.gl.viewport(t,e,r,i))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,i,n=o.COLOR|o.DEPTH){const{gl:s}=this;s.clearColor(t,e,r,i),s.clear(n)}initFramebuffer(t){const{gl:e}=this,r=new Lr(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];r.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,r.stencil),r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const i=t.colorTextures;let n=i.length;e.drawBuffers||(n=Math.min(n,1));for(let s=0;s<n;s++){const n=i[s],o=n.parentTextureArray||n;this.renderer.texture.bind(o,0),0===s&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,o._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,i=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let s=n.length;r.drawBuffers||(s=Math.min(s,1)),i.multisample>1&&this.canMultisampleFramebuffer(t)?i.msaaBuffer=i.msaaBuffer||r.createRenderbuffer():i.msaaBuffer&&(r.deleteRenderbuffer(i.msaaBuffer),i.msaaBuffer=null,i.blitFramebuffer&&(i.blitFramebuffer.dispose(),i.blitFramebuffer=null));const o=[];for(let a=0;a<s;a++){const s=n[a],h=s.parentTextureArray||s;this.renderer.texture.bind(h,0),0===a&&i.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,i.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,i.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+a,s.target,h._glTextures[this.CONTEXT_UID].texture,e),o.push(r.COLOR_ATTACHMENT0+a))}if(o.length>1&&r.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const i=t.depthTexture;this.renderer.texture.bind(i,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,i._glTextures[this.CONTEXT_UID].texture,e)}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?i.stencil&&(r.deleteRenderbuffer(i.stencil),i.stencil=null):(i.stencil=i.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,i.stencil),i.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,r.DEPTH24_STENCIL8,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,i.stencil))}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=_.NONE;if(t<=1||null===e)return r;for(let i=0;i<e.length;i++)if(e[i]<=t){r=e[i];break}return 1===r&&(r=_.NONE),r}blit(t,e,r){const{current:i,renderer:n,gl:s,CONTEXT_UID:o}=this;if(2!==n.context.webGLVersion)return;if(!i)return;const a=i.glFramebuffers[o];if(!a)return;if(!t){if(!a.msaaBuffer)return;const e=i.colorTextures[0];if(!e)return;a.blitFramebuffer||(a.blitFramebuffer=new wr(i.width,i.height),a.blitFramebuffer.addColorTexture(0,e)),(t=a.blitFramebuffer).colorTextures[0]!==e&&(t.colorTextures[0]=e,t.dirtyId++,t.dirtyFormat++),t.width===i.width&&t.height===i.height||(t.width=i.width,t.height=i.height,t.dirtyId++,t.dirtySize++)}e||((e=Fr).width=i.width,e.height=i.height),r||(r=e);const h=e.width===r.width&&e.height===r.height;this.bind(t),s.bindFramebuffer(s.READ_FRAMEBUFFER,a.framebuffer),s.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,s.COLOR_BUFFER_BIT,h?s.NEAREST:s.LINEAR)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],i=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(i.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&i.deleteRenderbuffer(r.msaaBuffer),r.stencil&&i.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&r.blitFramebuffer.dispose()}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const r=t.width,i=t.height,n=this.gl,s=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,s),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,n.DEPTH24_STENCIL8,r,i):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,r,i),e.stencil=s,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,s)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Oe}destroy(){this.renderer=null}}Ur.extension={type:Kt.RendererSystem,name:"framebuffer"},Jt.add(Ur);const Gr={5126:4,5123:2,5121:1};class zr{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){let e=this.renderer.context.extensions.vertexArrayObject;T.PREFER_ENV===s.WEBGL_LEGACY&&(e=null),e?(t.createVertexArray=()=>e.createVertexArrayOES(),t.bindVertexArray=t=>e.bindVertexArrayOES(t),t.deleteVertexArray=t=>e.deleteVertexArrayOES(t)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(2!==e.webGLVersion){const e=t.getExtension("ANGLE_instanced_arrays");e?(t.vertexAttribDivisor=(t,r)=>e.vertexAttribDivisorANGLE(t,r),t.drawElementsInstanced=(t,r,i,n,s)=>e.drawElementsInstancedANGLE(t,r,i,n,s),t.drawArraysInstanced=(t,r,i,n)=>e.drawArraysInstancedANGLE(t,r,i,n)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let i=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;i||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=i={},n=!0);const s=i[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==s&&(this._activeVao=s,this.hasVao?r.bindVertexArray(s):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const i=t.buffers[r];e.update(i)}}checkCompatibility(t,e){const r=t.attributes,i=e.attributeData;for(const t in i)if(!r[t])throw new Error(`shader and geometry incompatible, geometry missing the "${t}" attribute`)}getSignature(t,e){const r=t.attributes,i=e.attributeData,n=["g",t.id];for(const t in r)i[t]&&n.push(t,i[t].location);return n.join("-")}initGeometryVao(t,e,r=!0){const i=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,o=e.program;o.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const a=this.getSignature(t,o),h=t.glVertexArrayObjects[this.CONTEXT_UID];let l=h[a];if(l)return h[o.id]=l,l;const c=t.buffers,u=t.attributes,d={},f={};for(const t in c)d[t]=0,f[t]=0;for(const t in u)!u[t].size&&o.attributeData[t]?u[t].size=o.attributeData[t].size:u[t].size||console.warn(`PIXI Geometry attribute '${t}' size cannot be determined (likely the bound shader does not have the attribute)`),d[u[t].buffer]+=u[t].size*Gr[u[t].type];for(const t in u){const e=u[t],r=e.size;void 0===e.stride&&(d[e.buffer]===r*Gr[e.type]?e.stride=0:e.stride=d[e.buffer]),void 0===e.start&&(e.start=f[e.buffer],f[e.buffer]+=r*Gr[e.type])}l=i.createVertexArray(),i.bindVertexArray(l);for(let t=0;t<c.length;t++){const e=c[t];s.bind(e),r&&e._glBuffers[n].refCount++}return this.activateVao(t,o),h[o.id]=l,h[a]=l,i.bindVertexArray(null),s.unbind(w.ARRAY_BUFFER),l}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],i=this.gl,n=t.buffers,s=this.renderer?.buffer;if(t.disposeRunner.remove(this),r){if(s)for(let t=0;t<n.length;t++){const r=n[t]._glBuffers[this.CONTEXT_UID];r&&(r.refCount--,0!==r.refCount||e||s.dispose(n[t],e))}if(!e)for(const t in r)if("g"===t[0]){const e=r[t];this._activeVao===e&&this.unbind(),i.deleteVertexArray(e)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,i=this.CONTEXT_UID,n=this.renderer.buffer,s=t.buffers,o=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let a=null;for(const t in o){const h=o[t],l=s[h.buffer],c=l._glBuffers[i];if(e.attributeData[t]){a!==c&&(n.bind(l),a=c);const i=e.attributeData[t].location;if(r.enableVertexAttribArray(i),r.vertexAttribPointer(i,h.size,h.type||r.FLOAT,h.normalized,h.stride,h.start),h.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");r.vertexAttribDivisor(i,h.divisor)}}}}draw(t,e,r,i){const{gl:n}=this,s=this._activeGeometry;if(s.indexBuffer){const o=s.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?n.UNSIGNED_SHORT:n.UNSIGNED_INT;2===o||4===o&&this.canUseUInt32ElementIndex?s.instanced?n.drawElementsInstanced(t,e||s.indexBuffer.data.length,a,(r||0)*o,i||1):n.drawElements(t,e||s.indexBuffer.data.length,a,(r||0)*o):console.warn("unsupported index buffer type: uint32")}else s.instanced?n.drawArraysInstanced(t,r,e||s.getSize(),i||1):n.drawArrays(t,r,e||s.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}zr.extension={type:Kt.RendererSystem,name:"geometry"},Jt.add(zr);const Hr=new Be;class Xr{constructor(t,e){this._texture=t,this.mapCoord=new Be,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const r=this.mapCoord;for(let i=0;i<t.length;i+=2){const n=t[i],s=t[i+1];e[i]=n*r.a+s*r.c+r.tx,e[i+1]=n*r.b+s*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const i=e.orig,n=e.trim;n&&(Hr.set(i.width/n.width,0,0,i.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Hr));const s=e.baseTexture,o=this.uClampFrame,a=this.clampMargin/s.resolution,h=this.clampOffset;return o[0]=(e._frame.x+a+h)/s.width,o[1]=(e._frame.y+a+h)/s.height,o[2]=(e._frame.x+e._frame.width-a+h)/s.width,o[3]=(e._frame.y+e._frame.height-a+h)/s.height,this.uClampOffset[0]=h/s.realWidth,this.uClampOffset[1]=h/s.realHeight,this.isSimple=e._frame.width===s.width&&e._frame.height===s.height&&0===e.rotate,!0}}class Vr extends gr{constructor(t,e,r){let i=null;"string"!=typeof t&&void 0===e&&void 0===r&&(i=t,t=void 0,e=void 0,r=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",r),this.maskSprite=i,this.maskMatrix=new Be}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,i){const n=this._maskSprite,s=n._texture;s.valid&&(s.uvMatrix||(s.uvMatrix=new Xr(s,0)),s.uvMatrix.update(),this.uniforms.npmAlpha=s.baseTexture.alphaMode?0:1,this.uniforms.mask=s,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(s.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=s.uvMatrix.uClampFrame,t.applyFilter(this,e,r,i))}}class Wr{constructor(t=null){this.type=x.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=gr.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=x.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Yr{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const t=this.maskDataPool.pop()||new Wr;t.pooled=!0,t.maskObject=e,r=t}const i=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(i),r._colorMask=i?i._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==x.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case x.SCISSOR:this.renderer.scissor.push(r);break;case x.STENCIL:this.renderer.stencil.push(r);break;case x.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case x.COLOR:this.pushColorMask(r)}r.type===x.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case x.SCISSOR:this.renderer.scissor.pop(e);break;case x.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case x.SPRITE:this.popSpriteMask(e);break;case x.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const t=this.maskStack[this.maskStack.length-1];t.type===x.SPRITE&&t._filters&&(t._filters[0].maskSprite=t.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=x.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=x.SCISSOR:t.type=x.STENCIL:t.type=x.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let i=t._filters;i||(i=this.alphaMaskPool[this.alphaMaskIndex],i||(i=this.alphaMaskPool[this.alphaMaskIndex]=[new Vr]));const n=this.renderer,s=n.renderTexture;let o,a;if(s.current){const e=s.current;o=t.resolution||e.resolution,a=t.multisample??e.multisample}else o=t.resolution||n.resolution,a=t.multisample??n.multisample;i[0].resolution=o,i[0].multisample=a,i[0].maskSprite=e;const h=r.filterArea;r.filterArea=e.getBounds(!0),n.filter.push(r,i),r.filterArea=h,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))}destroy(){this.renderer=null}}Yr.extension={type:Kt.RendererSystem,name:"mask"},Jt.add(Yr);class $r{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const i=this.getStackLength();i!==r&&(0===i?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const qr=new Be,Kr=[],Zr=class extends $r{constructor(t){super(t),this.glConst=T.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:r}=t,{renderer:i}=this,n=i.renderTexture,s=r.getBounds(!0,Kr.pop()??new Oe);this.roundFrameToPixels(s,n.current?n.current.resolution:i.resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),e&&s.fit(e),t._scissorRectLocal=s}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:r,c:i,d:n}=t;return(Math.abs(r)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(n)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect())return!1;if(Zr.isMatrixRotated(e.worldTransform))return!1;if(Zr.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const r=t._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(t,e,r,i,n){Zr.isMatrixRotated(n)||((n=n?qr.copyFrom(n):qr.identity()).translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.renderer.filter.transformAABB(n,t),t.fit(i),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Kr.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};let Qr=Zr;Qr.extension={type:Kt.RendererSystem,name:"scissor"},Jt.add(Qr);class Jr extends $r{constructor(t){super(t),this.glConst=T.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,i=t._stencilCounter;0===i&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;0!==n&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,i,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==n&&(t._colorMask=n,r.colorMask(0!=(1&n),0!=(2&n),0!=(4&n),0!=(8&n))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const r=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,i=r?r._colorMask:15;0!==i&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==i&&(r._colorMask=i,e.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Jr.extension={type:Kt.RendererSystem,name:"stencil"},Jt.add(Jr);class ti{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(K("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract)},prepare:{enumerable:!1,get:()=>(K("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare)},interaction:{enumerable:!1,get:()=>(K("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events)}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}ti.extension={type:[Kt.RendererSystem,Kt.CanvasRendererSystem],name:"_plugin"},Jt.add(ti);class ei{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Be,this.transform=null}update(t,e,r,i){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,i),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,e,r,i){const n=this.projectionMatrix,s=i?-1:1;n.identity(),n.a=1/e.width*2,n.d=s*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-s-e.y*n.d}setTransform(t){}destroy(){this.renderer=null}}ei.extension={type:Kt.RendererSystem,name:"projection"},Jt.add(ei);const ri=new Xe;class ii{constructor(t){this.renderer=t,this._tempMatrix=new Be}generateTexture(t,e){const{region:r,...i}=e||{},n=r||t.getLocalBounds(null,!0);0===n.width&&(n.width=1),0===n.height&&(n.height=1);const s=Rr.create({width:n.width,height:n.height,...i});this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const o=t.transform;return t.transform=ri,this.renderer.render(t,{renderTexture:s,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=o,s}destroy(){}}ii.extension={type:[Kt.RendererSystem,Kt.CanvasRendererSystem],name:"textureGenerator"},Jt.add(ii);const ni=new Oe,si=new Oe;class oi{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Oe,this.destinationFrame=new Oe,this.viewportFrame=new Oe}bind(t=null,e,r){const i=this.renderer;let n,s,o;this.current=t,t?(n=t.baseTexture,o=n.resolution,e||(ni.width=t.frame.width,ni.height=t.frame.height,e=ni),r||(si.x=t.frame.x,si.y=t.frame.y,si.width=e.width,si.height=e.height,r=si),s=n.framebuffer):(o=i.resolution,e||(ni.width=i._view.screen.width,ni.height=i._view.screen.height,e=ni),r||((r=ni).width=e.width,r.height=e.height));const a=this.viewportFrame;a.x=r.x*o,a.y=r.y*o,a.width=r.width*o,a.height=r.height*o,t||(a.y=i.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(s,a),this.renderer.projection.update(r,e,o,!s),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,i=t?Pt.shared.setValue(t):r,n=this.destinationFrame,s=this.current?this.current.baseTexture:this.renderer._view.screen,o=n.width!==s.width||n.height!==s.height;if(o){let{x:t,y:e,width:r,height:i}=this.viewportFrame;t=Math.round(t),e=Math.round(e),r=Math.round(r),i=Math.round(i),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(t,e,r,i)}this.renderer.framebuffer.clear(i.red,i.green,i.blue,i.alpha,e),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}oi.extension={type:Kt.RendererSystem,name:"renderTexture"},Jt.add(oi);class ai{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function hi(t,e,r){const i=t.createShader(e);return t.shaderSource(i,r),t.compileShader(i),i}function li(t){const e=new Array(t);for(let t=0;t<e.length;t++)e[t]=!1;return e}function ci(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return li(2*e);case"bvec3":return li(3*e);case"bvec4":return li(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function ui(t,e){const r=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),i=t.getShaderInfoLog(e),n=i.split("\n"),s={},o=n.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||s[t]||(s[t]=!0,0)))),a=[""];o.forEach((t=>{r[t-1]=`%c${r[t-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const h=r.join("\n");a[0]=h,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function di(t,e,r,i,n){r.buffer.update(n)}const fi={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},pi={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};let mi,gi=0;const yi={textureCount:0,uboCount:0};class vi{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=gi++}systemCheck(){if(!function(){if("boolean"==typeof mi)return mi;try{const t=new Function("param1","param2","param3","return param1[param2] === param3;");mi=!0===t({a:"b"},"a","b")}catch(t){mi=!1}return mi}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,i=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(i.program)),e||(yi.textureCount=0,yi.uboCount=0,this.syncUniformGroup(t.uniformGroup,yi)),i}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();t.static&&t.dirtyId===r.uniformDirtyGroups[t.id]||(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){const r=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const i in t.uniforms){const n=e[i];if(!n){t.uniforms[i]?.group&&(t.uniforms[i].ubo?r.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');\n                    `):r.push(`\n                        renderer.shader.syncUniformGroup(uv.${i}, syncData);\n                    `));continue}const s=t.uniforms[i];let o=!1;for(let t=0;t<Ve.length;t++)if(Ve[t].test(n,s)){r.push(Ve[t].code(i,s)),o=!0;break}if(!o){const t=(1!==n.size||n.isArray?Ye:We)[n.type].replace("location",`ud["${i}"].location`);r.push(`\n            cu = ud["${i}"];\n            cv = cu.value;\n            v = uv["${i}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",r.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t.static||0!==t.dirtyId||!r.uniformGroups[t.id]){t.dirtyId=0;const i=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),i(r.uniformData,t.uniforms,this.renderer,yi,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:i}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,i.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const s=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[s];if(o||(o=this._uboCache[s]=function(t,e){if(!t.autoManage)return{size:0,syncFunc:di};const r=function(t,e){const r=[];for(const i in t)e[i]&&r.push(e[i]);return r.sort(((t,e)=>t.index-e.index)),r}(t.uniforms,e),{uboElements:i,size:n}=function(t){const e=t.map((t=>({data:t,offset:0,dataLen:0,dirty:0})));let r=0,i=0,n=0;for(let t=0;t<e.length;t++){const s=e[t];if(r=pi[s.data.type],s.data.size>1&&(r=Math.max(r,16)*s.data.size),s.dataLen=r,i%r!=0&&i<16){const t=i%r%16;i+=t,n+=t}i+r>16?(n=16*Math.ceil(n/16),s.offset=n,n+=r,i=r):(s.offset=n,i+=r,n+=r)}return n=16*Math.ceil(n/16),{uboElements:e,size:n}}(r),s=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let e=0;e<i.length;e++){const r=i[e],n=t.uniforms[r.data.name],o=r.data.name;let a=!1;for(let t=0;t<Ve.length;t++){const e=Ve[t];if(e.codeUbo&&e.test(r.data,n)){s.push(`offset = ${r.offset/4};`,Ve[t].codeUbo(r.data.name,n)),a=!0;break}}if(!a)if(r.data.size>1){const t=Qe(r.data.type),e=Math.max(pi[r.data.type]/16,1),i=t/e,n=(4-i%4)%4;s.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${r.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${r.data.size*e}; i++)\n                {\n                    for(var j = 0; j < ${i}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${n};\n                }\n\n                `)}else{const t=fi[r.data.type];s.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${r.offset/4};\n                ${t};\n                `)}}return s.push("\n       renderer.buffer.update(buffer);\n    "),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join("\n"))}}(t,this.shader.program.uniformData)),t.autoManage){const e=new Float32Array(o.size/4);t.buffer.update(e)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const i=t.uniforms,n=[`${r}-`];for(const t in i)n.push(t),e[t]&&n.push(e[t].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,i=function(t,e){const r=hi(t,t.VERTEX_SHADER,e.vertexSrc),i=hi(t,t.FRAGMENT_SHADER,e.fragmentSrc),n=t.createProgram();t.attachShader(n,r),t.attachShader(n,i);const s=e.extra?.transformFeedbackVaryings;if(s&&("function"!=typeof t.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):t.transformFeedbackVaryings(n,s.names,"separate"===s.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||function(t,e,r,i){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(r,t.COMPILE_STATUS)||ui(t,r),t.getShaderParameter(i,t.COMPILE_STATUS)||ui(t,i),console.error("PixiJS Error: Could not initialize shader."),""!==t.getProgramInfoLog(e)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}(t,n,r,i),e.attributeData=function(t,e){const r={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const i=e.getActiveAttrib(t,n);if(i.name.startsWith("gl_"))continue;const s=er(e,i.type),o={type:s,name:i.name,size:Qe(s),location:e.getAttribLocation(t,i.name)};r[i.name]=o}return r}(n,t),e.uniformData=function(t,e){const r={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<i;n++){const i=e.getActiveUniform(t,n),s=i.name.replace(/\[.*?\]$/,""),o=!!i.name.match(/\[.*?\]$/),a=er(e,i.type);r[s]={name:s,index:n,type:a,size:i.size,isArray:o,value:ci(a,i.size)}}return r}(n,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const r=Object.keys(e.attributeData);r.sort(((t,e)=>t>e?1:-1));for(let i=0;i<r.length;i++)e.attributeData[r[i]].location=i,t.bindAttribLocation(n,i,r[i]);t.linkProgram(n)}t.deleteShader(r),t.deleteShader(i);const o={};for(const r in e.uniformData){const i=e.uniformData[r];o[r]={location:t.getUniformLocation(n,r),value:ci(i.type,i.size)}}return new ai(n,o)}(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=i,i}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}vi.extension={type:Kt.RendererSystem,name:"shader"},Jt.add(vi);class bi{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.2.0-beta - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}bi.defaultOptions={hello:!1},bi.extension={type:[Kt.RendererSystem,Kt.CanvasRendererSystem],name:"startup"},Jt.add(bi);const xi=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=a.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new ie,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=function(t,e=[]){return e[a.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.ADD]=[t.ONE,t.ONE],e[a.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.NONE]=[0,0],e[a.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[a.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[a.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[a.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[a.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[a.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[a.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[a.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[a.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[a.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[a.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)1&e&&this.map[r].call(this,!!(t.data&1<<r)),e>>=1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(xi.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(xi.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],r=this.gl;2===e.length?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const r=this.checks.indexOf(t);e&&-1===r?this.checks.push(t):e||-1===r||this.checks.splice(r,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};let _i=xi;_i.extension={type:Kt.RendererSystem,name:"state"},Jt.add(_i);class wi extends z{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter((e=>t.systems[e])),r=[...e,...Object.keys(t.systems).filter((t=>!e.includes(t)))];for(const e of r)this.addSystem(t.systems[e],e)}addRunners(...t){t.forEach((t=>{this.runners[t]=new oe(t)}))}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const t in this.runners)this.runners[t].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach((i=>{const n=r.find((t=>this._systemsHash[t]===i));i[t.name](e[n])}))}destroy(){Object.values(this.runners).forEach((t=>{t.destroy()})),this._systemsHash={}}}const Ei=class{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Ei.defaultMaxIdle,this.checkCountMax=Ei.defaultCheckCountMax,this.mode=Ei.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==v.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let r=!1;for(let i=0;i<e.length;i++){const n=e[i];!n.framebuffer&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[i]=null,r=!0)}if(r){let t=0;for(let r=0;r<e.length;r++)null!==e[r]&&(e[t++]=e[r]);e.length=t}}unload(t){const e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let e=t.children.length-1;e>=0;e--)this.unload(t.children[e])}destroy(){this.renderer=null}};let Ti=Ei;Ti.defaultMode=v.AUTO,Ti.defaultMaxIdle=3600,Ti.defaultCheckCountMax=600,Ti.extension={type:Kt.RendererSystem,name:"textureGC"},Jt.add(Ti);class Ai{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=u.UNSIGNED_BYTE,this.internalFormat=l.RGBA,this.samplerType=0}}class Si{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new ue,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[u.UNSIGNED_BYTE]:{[l.RGBA]:t.RGBA8,[l.RGB]:t.RGB8,[l.RG]:t.RG8,[l.RED]:t.R8,[l.RGBA_INTEGER]:t.RGBA8UI,[l.RGB_INTEGER]:t.RGB8UI,[l.RG_INTEGER]:t.RG8UI,[l.RED_INTEGER]:t.R8UI,[l.ALPHA]:t.ALPHA,[l.LUMINANCE]:t.LUMINANCE,[l.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[u.BYTE]:{[l.RGBA]:t.RGBA8_SNORM,[l.RGB]:t.RGB8_SNORM,[l.RG]:t.RG8_SNORM,[l.RED]:t.R8_SNORM,[l.RGBA_INTEGER]:t.RGBA8I,[l.RGB_INTEGER]:t.RGB8I,[l.RG_INTEGER]:t.RG8I,[l.RED_INTEGER]:t.R8I},[u.UNSIGNED_SHORT]:{[l.RGBA_INTEGER]:t.RGBA16UI,[l.RGB_INTEGER]:t.RGB16UI,[l.RG_INTEGER]:t.RG16UI,[l.RED_INTEGER]:t.R16UI,[l.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[u.SHORT]:{[l.RGBA_INTEGER]:t.RGBA16I,[l.RGB_INTEGER]:t.RGB16I,[l.RG_INTEGER]:t.RG16I,[l.RED_INTEGER]:t.R16I},[u.UNSIGNED_INT]:{[l.RGBA_INTEGER]:t.RGBA32UI,[l.RGB_INTEGER]:t.RGB32UI,[l.RG_INTEGER]:t.RG32UI,[l.RED_INTEGER]:t.R32UI,[l.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[u.INT]:{[l.RGBA_INTEGER]:t.RGBA32I,[l.RGB_INTEGER]:t.RGB32I,[l.RG_INTEGER]:t.RG32I,[l.RED_INTEGER]:t.R32I},[u.FLOAT]:{[l.RGBA]:t.RGBA32F,[l.RGB]:t.RGB32F,[l.RG]:t.RG32F,[l.RED]:t.R32F,[l.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[u.HALF_FLOAT]:{[l.RGBA]:t.RGBA16F,[l.RGB]:t.RGB16F,[l.RG]:t.RG16F,[l.RED]:t.R16F},[u.UNSIGNED_SHORT_5_6_5]:{[l.RGB]:t.RGB565},[u.UNSIGNED_SHORT_4_4_4_4]:{[l.RGBA]:t.RGBA4},[u.UNSIGNED_SHORT_5_5_5_1]:{[l.RGBA]:t.RGB5_A1},[u.UNSIGNED_INT_2_10_10_10_REV]:{[l.RGBA]:t.RGB10_A2,[l.RGBA_INTEGER]:t.RGB10_A2UI},[u.UNSIGNED_INT_10F_11F_11F_REV]:{[l.RGB]:t.R11F_G11F_B10F},[u.UNSIGNED_INT_5_9_9_9_REV]:{[l.RGB]:t.RGB9_E5},[u.UNSIGNED_INT_24_8]:{[l.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[u.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[l.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:{[u.UNSIGNED_BYTE]:{[l.RGBA]:t.RGBA,[l.RGB]:t.RGB,[l.ALPHA]:t.ALPHA,[l.LUMINANCE]:t.LUMINANCE,[l.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[u.UNSIGNED_SHORT_5_6_5]:{[l.RGB]:t.RGB},[u.UNSIGNED_SHORT_4_4_4_4]:{[l.RGBA]:t.RGBA},[u.UNSIGNED_SHORT_5_5_5_1]:{[l.RGBA]:t.RGBA}},e}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let t=0;t<e;t++)this.boundTextures[t]=null;this.emptyTextures={};const r=new Ai(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Ai(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let e=0;e<6;e++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let t=0;t<this.boundTextures.length;t++)this.bind(null,t)}bind(t,e=0){const{gl:r}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const i=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,i.texture)),i.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):i.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let t=0;t<r.length;t++)r[t]===this.unknownTexture&&this.bind(null,t)}for(let i=0;i<r.length;i++)r[i]===t&&(this.currentLocation!==i&&(e.activeTexture(e.TEXTURE0+i),this.currentLocation=i),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[i]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:i}=this;if(r)for(let r=t-1;r>=0;--r){const t=e[r];t&&t._glTextures[i].samplerType!==d.FLOAT&&this.renderer.texture.unbind(t)}}initTexture(t){const e=new Ai(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,2===this.webGLVersion&&t.type===u.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const r=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(r,t,e))e.samplerType!==d.FLOAT&&(this.hasIntegerTextures=!0);else{const i=t.realWidth,n=t.realHeight,s=r.gl;(e.width!==i||e.height!==n||e.dirtyId<0)&&(e.width=i,e.height=n,s.texImage2D(t.target,0,e.internalFormat,i,n,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const e=this.managedTextures.indexOf(t);-1!==e&&kt(this.managedTextures,e,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==m.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=t.mipmap>=1:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=p.CLAMP,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==m.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===f.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const e=this.renderer.context.extensions.anisotropicFiltering;if(e&&t.anisotropicLevel>0&&t.scaleMode===f.LINEAR){const i=Math.min(t.anisotropicLevel,r.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,e.TEXTURE_MAX_ANISOTROPY_EXT,i)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===f.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===f.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}Si.extension={type:Kt.RendererSystem,name:"texture"},Jt.add(Si);class Pi{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,i=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,i)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:i}=this;e&&i.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:i}=this,n=e.createTransformFeedback();t._glTransformFeedbacks[i]=n,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n);for(let n=0;n<t.buffers.length;n++){const s=t.buffers[n];s&&(r.buffer.update(s),s._glBuffers[i].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,n,s._glBuffers[i].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],i=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let r=0;r<t.buffers.length;r++){const i=t.buffers[r];if(!i)continue;const s=i._glBuffers[this.CONTEXT_UID];s&&(s.refCount--,0!==s.refCount||e||n.dispose(i,e))}r&&(e||i.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Pi.extension={type:Kt.RendererSystem,name:"transformFeedback"},Jt.add(Pi);class Oi{constructor(t){this.renderer=t}init(t){this.screen=new Oe(0,0,t.width,t.height),this.element=t.view||T.ADAPTER.createCanvas(),this.resolution=t.resolution||T.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,i=this.element.height/this.resolution;this.screen.width=r,this.screen.height=i,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${i}px`),this.renderer.emit("resize",r,i),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}Oi.defaultOptions={width:800,height:600,resolution:T.RESOLUTION,autoDensity:!1},Oi.extension={type:[Kt.RendererSystem,Kt.CanvasRendererSystem],name:"_view"},Jt.add(Oi),T.PREFER_ENV=s.WEBGL2,T.STRICT_TEXTURE_CACHE=!1,T.RENDER_OPTIONS={...xr.defaultOptions,...yr.defaultOptions,...Oi.defaultOptions,...bi.defaultOptions},Object.defineProperties(T,{WRAP_MODE:{get:()=>ue.defaultOptions.wrapMode,set(t){K("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),ue.defaultOptions.wrapMode=t}},SCALE_MODE:{get:()=>ue.defaultOptions.scaleMode,set(t){K("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),ue.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get:()=>ue.defaultOptions.mipmap,set(t){K("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),ue.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get:()=>ue.defaultOptions.anisotropicLevel,set(t){K("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),ue.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get:()=>(K("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),gr.defaultResolution),set(t){gr.defaultResolution=t}},FILTER_MULTISAMPLE:{get:()=>(K("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),gr.defaultMultisample),set(t){gr.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get:()=>pr.defaultMaxTextures,set(t){K("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),pr.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get:()=>pr.defaultBatchSize,set(t){K("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),pr.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get:()=>pr.canUploadSameBuffer,set(t){K("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),pr.canUploadSameBuffer=t}},GC_MODE:{get:()=>Ti.defaultMode,set(t){K("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Ti.defaultMode=t}},GC_MAX_IDLE:{get:()=>Ti.defaultMaxIdle,set(t){K("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Ti.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get:()=>Ti.defaultCheckCountMax,set(t){K("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Ti.defaultCheckCountMax=t}},PRECISION_VERTEX:{get:()=>or.defaultVertexPrecision,set(t){K("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),or.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get:()=>or.defaultFragmentPrecision,set(t){K("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),or.defaultFragmentPrecision=t}}});var Ci=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(Ci||{});class Ri{constructor(t,e=null,r=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=i}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Ii=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Ri(null,null,1/0),this.deltaMS=1/Ii.targetFPMS,this.elapsedMS=1/Ii.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=Ci.NORMAL){return this._addListener(new Ri(t,e,r))}addOnce(t,e,r=Ci.NORMAL){return this._addListener(new Ri(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}else t.connect(r);return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r=r.match(t,e)?r.destroy():r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const e=t-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=t-e%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Ii.targetFPMS;const r=this._head;let i=r.next;for(;i;)i=i.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,Ii.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Ii._shared){const t=Ii._shared=new Ii;t.autoStart=!0,t._protected=!0}return Ii._shared}static get system(){if(!Ii._system){const t=Ii._system=new Ii;t.autoStart=!0,t._protected=!0}return Ii._system}};let Mi=Ii;Mi.targetFPMS=.06,Object.defineProperties(T,{TARGET_FPMS:{get:()=>Mi.targetFPMS,set(t){K("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Mi.targetFPMS=t}}});class Bi{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,Ci.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Mi.shared:new Mi,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Bi.extension=Kt.Application,Jt.add(Bi);const Di=[];Jt.handleByList(Kt.Renderer,Di);const ji="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class ki{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=_.HIGH?this.multisample=_.HIGH:e>=_.MEDIUM?this.multisample=_.MEDIUM:e>=_.LOW?this.multisample=_.LOW:this.multisample=_.NONE}destroy(){}}ki.extension={type:Kt.RendererSystem,name:"_multisample"},Jt.add(ki);class Ni{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Li{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,i=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,i.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:i}=this;if(this.boundBufferBases[e]!==t){const n=t._glBuffers[i]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,n.buffer)}}bindBufferRange(t,e,r){const{gl:i,CONTEXT_UID:n}=this;r=r||0;const s=t._glBuffers[n]||this.createGLBuffer(t);i.bindBufferRange(i.UNIFORM_BUFFER,e||0,s.buffer,256*r,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,i=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==i.updateID)if(i.updateID=t._updateID,e.bindBuffer(t.type,i.buffer),i.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const r=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;i.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,r)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],i=this.gl;t.disposeRunner.remove(this),r&&(e||i.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new Ni(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Li.extension={type:Kt.RendererSystem,name:"buffer"},Jt.add(Li);class Fi{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let i,n,s,o;if(e&&(i=e.renderTexture,n=e.clear,s=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!i,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=s,!r.context.isLost){if(i||(this.lastObjectRendered=t),!o){const e=t.enableTempParent();t.updateTransform(),t.disableTempParent(e)}r.renderTexture.bind(i),r.batch.currentRenderer.start(),(n??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),i&&(e.blit&&r.framebuffer.blit(),i.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Fi.extension={type:Kt.RendererSystem,name:"objectRenderer"},Jt.add(Fi);const Ui=class extends wi{constructor(t){super(),t=Object.assign({},T.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new hr({projectionMatrix:new Be},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Ui.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(K("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&"notMultiplied"!==t.useContextAlpha,t.backgroundAlpha=!1===t.useContextAlpha?1:t.backgroundAlpha),this._plugin.rendererPlugins=Ui.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return!t?.forceCanvas&&(void 0===Z&&(Z=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:T.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!T.ADAPTER.getWebGLRenderingContext())return!1;const e=T.ADAPTER.createCanvas();let r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const i=!!r?.getContextAttributes()?.stencil;if(r){const t=r.getExtension("WEBGL_lose_context");t&&t.loseContext()}return r=null,i}catch(t){return!1}}()),Z)}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return K("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return K("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return K("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return K("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){K("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return K("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){K("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return K("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};let Gi=Ui;Gi.extension={type:Kt.Renderer,priority:1},Gi.__plugins={},Gi.__systems={},Jt.handleByMap(Kt.RendererPlugin,Gi.__plugins),Jt.handleByMap(Kt.RendererSystem,Gi.__systems),Jt.add(Gi);class zi extends ae{constructor(t,e){const{width:r,height:i}=e||{};super(r,i),this.items=[],this.itemDirtyIds=[];for(let e=0;e<t;e++){const t=new ue;this.items.push(t),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof ae?this.addResourceAt(t[r],r):this.addResourceAt(se(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map((t=>t.resource)).filter((t=>t)).map((t=>t.load()));return this._load=Promise.all(t).then((()=>{const{realWidth:t,realHeight:e}=this.items[0];return this.resize(t,e),Promise.resolve(this)})),this._load}}const Hi=class extends zi{constructor(t,e){const{width:r,height:i,autoLoad:n,linkBaseTexture:s}=e||{};if(t&&t.length!==Hi.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:r,height:i});for(let t=0;t<Hi.SIDES;t++)this.items[t].target=c.TEXTURE_CUBE_MAP_POSITIVE_X+t;this.linkBaseTexture=!1!==s,t&&this.initFromArray(t,e),!1!==n&&this.load()}bind(t){super.bind(t),t.target=c.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,r){if(void 0===r&&(r=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=c.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,r){const i=this.itemDirtyIds;for(let n=0;n<Hi.SIDES;n++){const s=this.items[n];(i[n]<s.dirtyId||r.dirtyId<e.dirtyId)&&(s.valid&&s.resource?(s.resource.upload(t,s,r),i[n]=s.dirtyId):i[n]<-1&&(t.gl.texImage2D(s.target,0,r.internalFormat,e.realWidth,e.realHeight,0,e.format,r.type,null),i[n]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Hi.SIDES}};let Xi=Hi;Xi.SIDES=6;class Vi extends Tr{constructor(t,e){let r,i;e=e||{},"string"==typeof t?(r=Vi.EMPTY,i=t):(r=t,i=null),super(r),this.url=i,this.crossOrigin=e.crossOrigin??!0,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((async(t,e)=>{if(null!==this.url)try{const e=await T.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const r=await e.blob();if(this.destroyed)return;const i=await createImageBitmap(r,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===g.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=i,this.update(),t(this)}catch(t){if(this.destroyed)return;e(t),this.onError.emit(t)}else t(this)}))),this._load}upload(t,e,r){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&"undefined"!=typeof ImageBitmap&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){return Vi._EMPTY=Vi._EMPTY??T.ADAPTER.createCanvas(0,0),Vi._EMPTY}}const Wi=class extends Tr{constructor(t,e){e=e||{},super(T.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((t=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),t(this)},Wi.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const t=new Image;Tr.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,r=t.height;if(!e||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let i=e*this.scale,n=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/r*e,n=this._overrideHeight||this._overrideWidth/e*r),i=Math.round(i),n=Math.round(n);const s=this.source;s.width=i,s.height=n,s._pixiId=`canvas_${Ft()}`,s.getContext("2d").drawImage(t,0,0,e,r,0,0,i,n),this._resolve(),this._resolve=null}}static getSize(t){const e=Wi.SVG_SIZE.exec(t),r={};return e&&(r[e[1]]=Math.round(parseFloat(e[3])),r[e[5]]=Math.round(parseFloat(e[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return"svg"===e||"string"==typeof t&&t.startsWith("data:image/svg+xml")||"string"==typeof t&&Wi.SVG_XML.test(t)}};let Yi=Wi;Yi.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Yi.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const $i=class extends Tr{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const r=document.createElement("video");r.setAttribute("preload","auto"),r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline",""),"string"==typeof t&&(t=[t]);const i=t[0].src||t[0];Tr.crossOrigin(r,i,e.crossorigin);for(let e=0;e<t.length;++e){const i=document.createElement("source");let{src:n,mime:s}=t[e];n=n||t[e];const o=n.split("?").shift().toLowerCase(),a=o.slice(o.lastIndexOf(".")+1);s=s||$i.MIME_TYPES[a]||`video/${a}`,i.src=n,i.type=s,r.appendChild(i)}t=r}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==e.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==e.autoLoad&&this.load()}update(t=0){if(!this.destroyed){const t=Mi.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e=>{this.valid?e(this):(this._resolve=e,t.load())})),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Mi.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Mi.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._isConnectedToTicker&&(Mi.shared.remove(this.update,this),this._isConnectedToTicker=!1);const t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Mi.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Mi.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t)}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||$i.TYPES.includes(e)}};let qi=$i;qi.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],qi.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},ne.push(Vi,Ar,class extends Tr{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}},qi,Yi,he,Xi,class extends zi{constructor(t,e){const{width:r,height:i}=e||{};let n,s;Array.isArray(t)?(n=t,s=t.length):s=t,super(s,{width:r,height:i}),n&&this.initFromArray(n,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=c.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:i,itemDirtyIds:n,items:s}=this,{gl:o}=t;r.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,i,0,e.format,r.type,null);for(let t=0;t<i;t++){const i=s[t];n[t]<i.dirtyId&&(n[t]=i.dirtyId,i.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,t,i.resource.width,i.resource.height,1,e.format,r.type,i.resource.source))}return!0}});class Ki{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Oe.EMPTY:((t=t||new Oe(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:i,c:n,d:s,tx:o,ty:a}=t,h=r*e.x+n*e.y+o,l=i*e.x+s*e.y+a;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,l),this.maxY=Math.max(this.maxY,l)}addQuad(t){let e=this.minX,r=this.minY,i=this.maxX,n=this.maxY,s=t[0],o=t[1];e=s<e?s:e,r=o<r?o:r,i=s>i?s:i,n=o>n?o:n,s=t[2],o=t[3],e=s<e?s:e,r=o<r?o:r,i=s>i?s:i,n=o>n?o:n,s=t[4],o=t[5],e=s<e?s:e,r=o<r?o:r,i=s>i?s:i,n=o>n?o:n,s=t[6],o=t[7],e=s<e?s:e,r=o<r?o:r,i=s>i?s:i,n=o>n?o:n,this.minX=e,this.minY=r,this.maxX=i,this.maxY=n}addFrame(t,e,r,i,n){this.addFrameMatrix(t.worldTransform,e,r,i,n)}addFrameMatrix(t,e,r,i,n){const s=t.a,o=t.b,a=t.c,h=t.d,l=t.tx,c=t.ty;let u=this.minX,d=this.minY,f=this.maxX,p=this.maxY,m=s*e+a*r+l,g=o*e+h*r+c;u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=s*i+a*r+l,g=o*i+h*r+c,u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=s*e+a*n+l,g=o*e+h*n+c,u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=s*i+a*n+l,g=o*i+h*n+c,u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,this.minX=u,this.minY=d,this.maxX=f,this.maxY=p}addVertexData(t,e,r){let i=this.minX,n=this.minY,s=this.maxX,o=this.maxY;for(let a=e;a<r;a+=2){const e=t[a],r=t[a+1];i=e<i?e:i,n=r<n?r:n,s=e>s?e:s,o=r>o?r:o}this.minX=i,this.minY=n,this.maxX=s,this.maxY=o}addVertices(t,e,r,i){this.addVerticesMatrix(t.worldTransform,e,r,i)}addVerticesMatrix(t,e,r,i,n=0,s=n){const o=t.a,a=t.b,h=t.c,l=t.d,c=t.tx,u=t.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY;for(let t=r;t<i;t+=2){const r=e[t],i=e[t+1],g=o*r+h*i+c,y=l*i+a*r+u;d=Math.min(d,g-n),p=Math.max(p,g+n),f=Math.min(f,y-s),m=Math.max(m,y+s)}this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addBounds(t){const e=this.minX,r=this.minY,i=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>i?t.maxX:i,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,i=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,s=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=n&&i<=s){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=r<t?r:t,this.minY=i<e?i:e,this.maxX=n>o?n:o,this.maxY=s>a?s:a}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,i=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,s=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=n&&i<=s){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=r<t?r:t,this.minY=i<e?i:e,this.maxX=n>o?n:o,this.maxY=s>a?s:a}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,i,n,s){t-=n,e-=s,r+=n,i+=s,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>i?this.maxY:i}}class Zi extends z{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Xe,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Ki,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const i=e[r];Object.defineProperty(Zi.prototype,i,Object.getOwnPropertyDescriptor(t,i))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Oe),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Oe),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Ki);const e=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const i=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const s=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=i,this._bounds.updateID+=this._boundsID-n,s}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,i){return e&&(t=e.toGlobal(t,r,i)),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,r=1,i=1,n=0,s=0,o=0,a=0,h=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=i||1,this.rotation=n,this.skew.x=s,this.skew.y=o,this.pivot.x=a,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new Qi),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Ee}set angle(t){this.transform.rotation=t*Te}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,0===t._maskRefCount&&(t.renderable=!0,t.isMask=!1))}if(this._mask=t,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(0===t._maskRefCount&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class Qi extends Zi{constructor(){super(...arguments),this.sortDirty=null}}Zi.prototype.displayObjectUpdateTransform=Zi.prototype.updateTransform;const Ji=new Be;function tn(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}const en=class extends Zi{constructor(){super(),this.children=[],this.sortableChildren=en.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),i=this.getChildIndex(e);this.children[r]=e,this.children[i]=t,this.onChildrenChange(r<i?r:i)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(t);kt(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],r=this.children.indexOf(e);if(-1===r)return null;e.parent=null,e.transform._parentID=-1,kt(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,kt(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=t,i=e-r;let n;if(i>0&&i<=e){n=this.children.splice(r,i);for(let t=0;t<n.length;++t)n[t].parent=null,n[t].transform&&(n[t].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let t=0;t<n.length;++t)n[t].emit("removed",this),this.emit("childRemoved",n[t],this,t);return n}if(0===i&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){const r=this.children[e];r._lastSortedIndex=e,t||0===r.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(tn),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const r=super.getLocalBounds(t);if(!e)for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let r,i;this.cullArea?(r=this.cullArea,i=this.worldTransform):this._render!==en.prototype._render&&(r=this.getBounds(!0));const n=t.projection.transform;if(n&&(i?(i=Ji.copyFrom(i),i.prepend(n)):i=n),r&&e.intersects(r,i))this._render(t);else if(this.cullArea)return;for(let e=0,r=this.children.length;e<r;++e){const r=this.children[e],i=r.cullable;r.cullable=i||!this.cullArea,r.render(t),r.cullable=i}}render(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let t=0;t<e.length;t++)e[t].enabled&&this._enabledFilters.push(e[t])}const i=e&&this._enabledFilters?.length||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==x.NONE));if(i&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}i&&t.batch.flush(),r&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:t?.children,r=this.removeChildren(0,this.children.length);if(e)for(let e=0;e<r.length;++e)r[e].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}};let rn=en;rn.defaultSortableChildren=!1,rn.prototype.containerUpdateTransform=rn.prototype.updateTransform,Object.defineProperties(T,{SORTABLE_CHILDREN:{get:()=>rn.defaultSortableChildren,set(t){K("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),rn.defaultSortableChildren=t}}});const nn=new Se,sn=new Uint16Array([0,1,2,0,2,3]);class on extends rn{constructor(t){super(),this._anchor=new ze(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=a.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Cr.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=sn,this.pluginName="batch",this.isSprite=!0,this._roundPixels=T.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Nt(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Nt(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,r=e.a,i=e.b,n=e.c,s=e.d,o=e.tx,a=e.ty,h=this.vertexData,l=t.trim,c=t.orig,u=this._anchor;let d=0,f=0,p=0,m=0;if(l?(f=l.x-u._x*c.width,d=f+l.width,m=l.y-u._y*c.height,p=m+l.height):(f=-u._x*c.width,d=f+c.width,m=-u._y*c.height,p=m+c.height),h[0]=r*f+n*m+o,h[1]=s*m+i*f+a,h[2]=r*d+n*m+o,h[3]=s*m+i*d+a,h[4]=r*d+n*p+o,h[5]=s*p+i*d+a,h[6]=r*f+n*p+o,h[7]=s*p+i*f+a,this._roundPixels){const t=T.RESOLUTION;for(let e=0;e<h.length;++e)h[e]=Math.round(h[e]*t)/t}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,r=t.orig,i=this._anchor,n=this.transform.worldTransform,s=n.a,o=n.b,a=n.c,h=n.d,l=n.tx,c=n.ty,u=-i._x*r.width,d=u+r.width,f=-i._y*r.height,p=f+r.height;e[0]=s*u+a*f+l,e[1]=h*f+o*u+c,e[2]=s*d+a*f+l,e[3]=h*f+o*d+c,e[4]=s*d+a*p+l,e[5]=h*p+o*d+c,e[6]=s*u+a*p+l,e[7]=h*p+o*u+c}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new Ki),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Oe),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,nn);const e=this._texture.orig.width,r=this._texture.orig.height,i=-e*this.anchor.x;let n=0;return nn.x>=i&&nn.x<i+e&&(n=-r*this.anchor.y,nn.y>=n&&nn.y<n+r)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const r=t instanceof Cr?t:Cr.from(t,e);return new on(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Nt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Nt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tint}set tint(t){this._tint=t,this._tintRGB=Pt.shared.setValue(t).toLittleEndianNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Cr.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const an=new Be;Zi.prototype._cacheAsBitmap=!1,Zi.prototype._cacheData=null,Zi.prototype._cacheAsBitmapResolution=null,Zi.prototype._cacheAsBitmapMultisample=null;class hn{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Zi.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;let e;this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new hn),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}),Zi.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},Zi.prototype._initCachedDisplayObject=function(t){if(this._cacheData?.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const r=this.getLocalBounds(null,!0).clone();if(this.filters?.length){const t=this.filters[0].padding;r.pad(t)}r.ceil(T.RESOLUTION);const i=t.renderTexture.current,n=t.renderTexture.sourceFrame.clone(),s=t.renderTexture.destinationFrame.clone(),o=t.projection.transform,a=Rr.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),h=`cacheAsBitmap_${Ft()}`;this._cacheData.textureCacheId=h,ue.addToCache(a.baseTexture,h),Cr.addToCache(a,h);const l=this.transform.localTransform.copyTo(an).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:a,clear:!0,transform:l,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=o,t.renderTexture.bind(i,n,s),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const c=new on(a);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-r.x/r.width,c.anchor.y=-r.y/r.height,c.alpha=e,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c)},Zi.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},Zi.prototype._initCachedDisplayObjectCanvas=function(t){if(this._cacheData?.sprite)return;const e=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;const i=t.canvasContext.activeContext,n=t._projTransform;e.ceil(T.RESOLUTION);const s=Rr.create({width:e.width,height:e.height}),o=`cacheAsBitmap_${Ft()}`;this._cacheData.textureCacheId=o,ue.addToCache(s.baseTexture,o),Cr.addToCache(s,o);const a=an;this.transform.localTransform.copyTo(a),a.invert(),a.tx-=e.x,a.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:s,clear:!0,transform:a,skipUpdateTransform:!1}),t.canvasContext.activeContext=i,t._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const h=new on(s);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-e.x/e.width,h.anchor.y=-e.y/e.height,h.alpha=r,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)},Zi.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},Zi.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},Zi.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,ue.removeFromCache(this._cacheData.textureCacheId),Cr.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},Zi.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},Zi.prototype.name=null,rn.prototype.getChildByName=function(t,e){for(let e=0,r=this.children.length;e<r;e++)if(this.children[e].name===t)return this.children[e];if(e)for(let e=0,r=this.children.length;e<r;e++){const r=this.children[e];if(!r.getChildByName)continue;const i=r.getChildByName(t,!0);if(i)return i}return null},Zi.prototype.getGlobalPosition=function(t=new Se,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const ln={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},cn=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class un extends gr{constructor(t,e=8,r=4,i=gr.defaultResolution,n=5){const s=function(t,e){const r=Math.ceil(t/2);let i,n="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",s="";i=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let e=0;e<t;e++){let t=i.replace("%index%",e.toString());t=t.replace("%sampleIndex%",e-(r-1)+".0"),s+=t,s+="\n"}return n=n.replace("%blur%",s),n=n.replace("%size%",t.toString()),n}(n,t),o=function(t){const e=ln[t],r=e.length;let i,n=cn,s="";for(let n=0;n<t;n++){let o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",n.toString());i=n,n>=r&&(i=t-n-1),o=o.replace("%value%",e[i].toString()),s+=o,s+="\n"}return n=n.replace("%blur%",s),n=n.replace("%size%",t.toString()),n}(n);super(s,o),this.horizontal=t,this.resolution=i,this._quality=0,this.quality=r,this.blur=e}apply(t,e,r,i){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,r,i);else{const n=t.getFilterTexture(),s=t.renderer;let o=e,a=n;this.state.blend=!1,t.applyFilter(this,o,a,y.CLEAR);for(let e=1;e<this.passes-1;e++){t.bindAndClear(o,y.BLIT),this.uniforms.uSampler=a;const e=a;a=o,o=e,s.shader.bind(this),s.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,a,r,i),t.returnFilterTexture(n)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class dn extends gr{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(ji,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const[r,i,n]=Pt.shared.setValue(t).toArray(),s=[r,0,0,0,0,0,i,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(s,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),i=Math.sin(t),n=1/3,s=(0,Math.sqrt)(n),o=[r+(1-r)*n,n*(1-r)-s*i,n*(1-r)+s*i,0,0,n*(1-r)+s*i,r+n*(1-r),n*(1-r)-s*i,0,0,n*(1-r)-s*i,n*(1-r)+s*i,r+n*(1-r),0,0,0,0,0,1,0];this._loadMatrix(o,e)}contrast(t,e){const r=(t||0)+1,i=-.5*(r-1),n=[r,0,0,0,i,0,r,0,0,i,0,0,r,0,i,0,0,0,1,0];this._loadMatrix(n,e)}saturate(t=0,e){const r=2*t/3+1,i=-.5*(r-1),n=[r,i,i,0,0,i,r,i,0,0,i,i,r,0,0,0,0,0,1,0];this._loadMatrix(n,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,r,i,n){t=t||.2,e=e||.15,r=r||16770432,i=i||3375104;const s=Pt.shared,[o,a,h]=s.setValue(r).toArray(),[l,c,u]=s.setValue(i).toArray(),d=[.3,.59,.11,0,0,o,a,h,t,0,l,c,u,e,0,o-l,a-c,h-u,0,0];this._loadMatrix(d,n)}night(t,e){const r=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}dn.prototype.grayscale=dn.prototype.greyscale;const fn={AlphaFilter:class extends gr{constructor(t=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}},BlurFilter:class extends gr{constructor(t=8,e=4,r=gr.defaultResolution,i=5){super(),this.blurXFilter=new un(!0,t,e,r,i),this.blurYFilter=new un(!1,t,e,r,i),this.resolution=r,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,r,i){const n=Math.abs(this.blurXFilter.strength),s=Math.abs(this.blurYFilter.strength);if(n&&s){const n=t.getFilterTexture();this.blurXFilter.apply(t,e,n,y.CLEAR),this.blurYFilter.apply(t,n,r,i),t.returnFilterTexture(n)}else s?this.blurYFilter.apply(t,e,r,i):this.blurXFilter.apply(t,e,r,i)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}},BlurFilterPass:un,ColorMatrixFilter:dn,DisplacementFilter:class extends gr{constructor(t,e){const r=new Be;t.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=r,null==e&&(e=20),this.scale=new Se(e,e)}apply(t,e,r,i){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const n=this.maskSprite.worldTransform,s=Math.sqrt(n.a*n.a+n.b*n.b),o=Math.sqrt(n.c*n.c+n.d*n.d);0!==s&&0!==o&&(this.uniforms.rotation[0]=n.a/s,this.uniforms.rotation[1]=n.b/s,this.uniforms.rotation[2]=n.c/o,this.uniforms.rotation[3]=n.d/o),t.applyFilter(this,e,r,i)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}},FXAAFilter:class extends gr{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class extends gr{constructor(t=.5,e=Math.random()){super(ji,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}};Object.entries(fn).forEach((([t,e])=>{Object.defineProperty(fn,t,{get:()=>(K("7.1.0",`filters.${t} has moved to ${t}`),e)})}));const pn=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){!this.tickerAdded&&this.domElement&&(Mi.system.add(this.tickerUpdate,this,Ci.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Mi.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())}};class mn{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=mn.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Se,this.page=new Se,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,r,i,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class gn extends mn{constructor(){super(...arguments),this.client=new Se,this.movement=new Se,this.offset=new Se,this.global=new Se,this.screen=new Se}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,r,i,n,s,o,a,h,l,c,u,d,f,p){throw new Error("Method not implemented.")}}class yn extends gn{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class vn extends gn{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}vn.DOM_DELTA_PIXEL=0,vn.DOM_DELTA_LINE=1,vn.DOM_DELTA_PAGE=2;const bn=new Se,xn=new Se;class _n{constructor(t){this.dispatch=new z,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let r=0,i=e.length;r<i;r++)e[r].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){pn.pauseUpdate=!0;const r=this.hitTestRecursive(this.rootTarget,this.rootTarget.eventMode,bn.set(t,e),this.hitTestFn,this.hitPruneFn);return r&&r[0]}propagate(t,e){if(!t.target)return;const r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let i=0,n=r.length-1;i<n;i++)if(t.currentTarget=r[i],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let i=r.length-2;i>=0;i--)if(t.currentTarget=r[i],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,r=this.rootTarget){t.eventPhase=t.BUBBLING_PHASE;const i=r.children,n="none"===r.eventMode,s="passive"===r.eventMode&&!r.interactiveChildren,o=r.interactiveChildren,a=!n&&o&&!s;if(i&&i.length>0&&a)for(let r=0;r<i.length;r++)this.all(t,e,i[r]);t.currentTarget=r,this.notifyTarget(t,e)}propagationPath(t){const e=[t];for(let r=0;r<2048&&t!==this.rootTarget;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestRecursive(t,e,r,i,n){if(!t||!t.visible)return null;if(n(t,r))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(pn.pauseUpdate=!1),t.interactiveChildren&&t.children){const s=t.children;for(let o=s.length-1;o>=0;o--){const a=s[o],h=this.hitTestRecursive(a,this._isInteractive(e)?e:a.eventMode,r,i,n);if(h){if(h.length>0&&!h[h.length-1].parent)continue;return(h.length>0||t.isInteractive())&&h.push(t),h}}}return this._isInteractive(e)&&i(t,r)?t.isInteractive()?[t]:[]:null}_isInteractive(t){return"static"===t||"dynamic"===t}hitPruneFn(t,e){if("none"===t.eventMode)return!0;if("passive"===t.eventMode&&!t.interactiveChildren)return!0;if(t.isMask)return!0;if(t.hitArea&&(t.worldTransform.applyInverse(e,xn),!t.hitArea.contains(xn.x,xn.y)))return!0;if(t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;if(r&&!r.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return"passive"!==t.eventMode&&(!!t.hitArea||!!t.containsPoint&&t.containsPoint(e))}notifyTarget(t,e){const r=`on${e=e??t.type}`;t.currentTarget[r]?.(t);const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof yn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof yn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t),r="mouse"===e.pointerType||"pen"===e.pointerType,i=this.trackingData(t.pointerId),n=this.findMountedTarget(i.overTargets);if(i.overTargets?.length>0&&n!==e.target){const i="mousemove"===t.type?"mouseout":"pointerout",s=this.createPointerEvent(t,i,n);if(this.dispatchEvent(s,"pointerout"),r&&this.dispatchEvent(s,"mouseout"),!e.composedPath().includes(n)){const i=this.createPointerEvent(t,"pointerleave",n);for(i.eventPhase=i.AT_TARGET;i.target&&!e.composedPath().includes(i.target);)i.currentTarget=i.target,this.notifyTarget(i),r&&this.notifyTarget(i,"mouseleave"),i.target=i.target.parent;this.freeEvent(i)}this.freeEvent(s)}if(n!==e.target){const i="mousemove"===t.type?"mouseover":"pointerover",s=this.clonePointerEvent(e,i);this.dispatchEvent(s,"pointerover"),r&&this.dispatchEvent(s,"mouseover");let o=n?.parent;for(;o&&o!==this.rootTarget.parent&&o!==e.target;)o=o.parent;if(!o||o===this.rootTarget.parent){const t=this.clonePointerEvent(e,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==n&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),r&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(s)}const s=this.moveOnAll?"all":"dispatchEvent";this[s](e,"pointermove"),this.all(e,"globalpointermove"),"touch"===e.pointerType&&(this[s](e,"touchmove"),this.all(e,"globaltouchmove")),r&&(this[s](e,"mousemove"),this.all(e,"globalmousemove"),this.cursor=e.target?.cursor),i.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof yn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),r=this.createPointerEvent(t),i="mouse"===r.pointerType||"pen"===r.pointerType;this.dispatchEvent(r,"pointerover"),i&&this.dispatchEvent(r,"mouseover"),"mouse"===r.pointerType&&(this.cursor=r.target?.cursor);const n=this.clonePointerEvent(r,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),i&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;e.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(n)}mapPointerOut(t){if(!(t instanceof yn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId);if(e.overTargets){const r="mouse"===t.pointerType||"pen"===t.pointerType,i=this.findMountedTarget(e.overTargets),n=this.createPointerEvent(t,"pointerout",i);this.dispatchEvent(n),r&&this.dispatchEvent(n,"mouseout");const s=this.createPointerEvent(t,"pointerleave",i);for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),r&&this.notifyTarget(s,"mouseleave"),s.target=s.target.parent;e.overTargets=null,this.freeEvent(n),this.freeEvent(s)}this.cursor=null}mapPointerUp(t){if(!(t instanceof yn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),"touch"===r.pointerType)this.dispatchEvent(r,"touchend");else if("mouse"===r.pointerType||"pen"===r.pointerType){const t=2===r.button;this.dispatchEvent(r,t?"rightup":"mouseup")}const i=this.trackingData(t.pointerId),n=this.findMountedTarget(i.pressTargetsByButton[t.button]);let s=n;if(n&&!r.composedPath().includes(n)){let e=n;for(;e&&!r.composedPath().includes(e);){if(r.currentTarget=e,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType)this.notifyTarget(r,"touchendoutside");else if("mouse"===r.pointerType||"pen"===r.pointerType){const t=2===r.button;this.notifyTarget(r,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete i.pressTargetsByButton[t.button],s=e}if(s){const n=this.clonePointerEvent(r,"click");n.target=s,n.path=null,i.clicksByButton[t.button]||(i.clicksByButton[t.button]={clickCount:0,target:n.target,timeStamp:e});const o=i.clicksByButton[t.button];o.target===n.target&&e-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=n.target,o.timeStamp=e,n.detail=o.clickCount,"mouse"===n.pointerType?this.dispatchEvent(n,"click"):"touch"===n.pointerType&&this.dispatchEvent(n,"tap"),this.dispatchEvent(n,"pointertap"),this.freeEvent(n)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof yn))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),r=this.findMountedTarget(e.pressTargetsByButton[t.button]),i=this.createPointerEvent(t);if(r){let n=r;for(;n;)i.currentTarget=n,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType?this.notifyTarget(i,"touchendoutside"):"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.notifyTarget(i,2===i.button?"rightupoutside":"mouseupoutside"),n=n.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(i)}mapWheel(t){if(!(t instanceof vn))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let r=1;r<t.length&&t[r].parent===e;r++)e=t[r];return e}createPointerEvent(t,e,r){const i=this.allocateEvent(yn);return this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.nativeEvent=t.nativeEvent,i.originalEvent=t,i.target=r??this.hitTest(i.global.x,i.global.y),"string"==typeof e&&(i.type=e),i}createWheelEvent(t){const e=this.allocateEvent(vn);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const r=this.allocateEvent(yn);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=e??r.type,r}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof yn&&e instanceof yn&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof gn&&e instanceof gn&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const r=t.currentTarget._events[e];if(r&&t.currentTarget.isInteractive())if("fn"in r)r.fn.call(r.context,t);else for(let e=0,i=r.length;e<i&&!t.propagationImmediatelyStopped;e++)r[e].fn.call(r[e].context,t)}}const wn={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},En=class{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new _n(null),pn.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new yn(null),this.rootWheelEvent=new vn(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:r}=this.renderer;this.setTargetElement(e),this.resolution=r,En._defaultEventMode=t.eventMode??"auto"}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.domElement.style,r)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}onPointerDown(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let t=0,r=e.length;t<r;t++){const r=e[t],i=this.bootstrapEvent(this.rootPointerEvent,r);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;pn.pointerMoved();const e=this.normalizeToPointerData(t);for(let t=0,r=e.length;t<r;t++){const r=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const r=e!==this.domElement?"outside":"",i=this.normalizeToPointerData(t);for(let t=0,e=i.length;t<e;t++){const e=this.bootstrapEvent(this.rootPointerEvent,i[t]);e.type+=r,this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let t=0,r=e.length;t<r;t++){const r=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,pn.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;pn.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;pn.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,r){let i;i=this.domElement.parentElement?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const n=1/this.resolution;t.x=(e-i.left)*(this.domElement.width/i.width)*n,t.y=(r-i.top)*(this.domElement.height/i.height)*n}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,i=t.changedTouches.length;r<i;r++){const i=t.changedTouches[r];void 0===i.button&&(i.button=0),void 0===i.buttons&&(i.buttons=1),void 0===i.isPrimary&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===i.width&&(i.width=i.radiusX||1),void 0===i.height&&(i.height=i.radiusY||1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="touch"),void 0===i.pointerId&&(i.pointerId=i.identifier||0),void 0===i.pressure&&(i.pressure=i.force||.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),void 0===i.layerX&&(i.layerX=i.offsetX=i.clientX),void 0===i.layerY&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,i.type=t.type,e.push(i)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&!(this.supportsPointerEvents&&t instanceof globalThis.PointerEvent)){const r=t;void 0===r.isPrimary&&(r.isPrimary=!0),void 0===r.width&&(r.width=1),void 0===r.height&&(r.height=1),void 0===r.tiltX&&(r.tiltX=0),void 0===r.tiltY&&(r.tiltY=0),void 0===r.pointerType&&(r.pointerType="mouse"),void 0===r.pointerId&&(r.pointerId=1),void 0===r.pressure&&(r.pressure=.5),void 0===r.twist&&(r.twist=0),void 0===r.tangentialPressure&&(r.tangentialPressure=0),r.isNormalized=!0,e.push(r)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=wn[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};let Tn=En;function An(t){return"dynamic"===t||"static"===t}Tn.extension={name:"events",type:[Kt.RendererSystem,Kt.CanvasRendererSystem]},Jt.add(Tn);const Sn={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??An(Tn.defaultEventMode)},set interactive(t){K("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=t,this.eventMode=t?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Tn.defaultEventMode},set eventMode(t){this._internalInteractive=An(t),this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,r){const i="function"==typeof e?void 0:e;t="boolean"==typeof r&&r||"object"==typeof r&&r.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.on(t,e,i)},removeEventListener(t,e,r){const i="function"==typeof e?void 0:e;t="boolean"==typeof r&&r||"object"==typeof r&&r.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,i)},dispatchEvent(t){if(!(t instanceof mn))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};Zi.mixin(Sn),Zi.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class Pn{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(G.tablet||G.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let t=0;t<e.length;t++)this.updateAccessibleObjects(e[t])}update(){const t=performance.now();if(G.android.device&&t<this.androidUpdateCount)return;if(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen)return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:r,width:i,height:n}=this.renderer.view.getBoundingClientRect(),{width:s,height:o,resolution:a}=this.renderer,h=i/s*a,l=n/o*a;let c=this.div;c.style.left=`${e}px`,c.style.top=`${r}px`,c.style.width=`${s}px`,c.style.height=`${o}px`;for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.renderId!==this.renderId)e._accessibleActive=!1,kt(this.children,t,1),this.div.removeChild(e._accessibleDiv),this.pool.push(e._accessibleDiv),e._accessibleDiv=null,t--;else{c=e._accessibleDiv;let t=e.hitArea;const r=e.worldTransform;e.hitArea?(c.style.left=(r.tx+t.x*r.a)*h+"px",c.style.top=(r.ty+t.y*r.d)*l+"px",c.style.width=t.width*r.a*h+"px",c.style.height=t.height*r.d*l+"px"):(t=e.getBounds(),this.capHitArea(t),c.style.left=t.x*h+"px",c.style.top=t.y*l+"px",c.style.width=t.width*h+"px",c.style.height=t.height*l+"px",c.title!==e.accessibleTitle&&null!==e.accessibleTitle&&(c.title=e.accessibleTitle),c.getAttribute("aria-label")!==e.accessibleHint&&null!==e.accessibleHint&&c.setAttribute("aria-label",e.accessibleHint)),e.accessibleTitle===c.title&&e.tabIndex===c.tabIndex||(c.title=e.accessibleTitle,c.tabIndex=e.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:r}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>r&&(t.height=r-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:r}=t.target,i=this.renderer.events.rootBoundary,n=Object.assign(new mn(i),{target:r});i.rootTarget=this.renderer.lastObjectRendered,e.forEach((t=>i.dispatchEvent(n,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Pn.extension={name:"accessibility",type:[Kt.RendererPlugin,Kt.CanvasRendererPlugin]},Jt.add(Pn);const On=class{constructor(t){this.stage=new rn,t=Object.assign({forceCanvas:!1},t),this.renderer=function(t){for(const e of Di)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}(t),On._plugins.forEach((e=>{e.init.call(this,t)}))}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(t,e){const r=On._plugins.slice(0);r.reverse(),r.forEach((t=>{t.destroy.call(this)})),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};let Cn=On;Cn._plugins=[],Jt.handleByList(Kt.Application,Cn._plugins);class Rn{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this.cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:i}=this._resizeTo;t=r,e=i}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Rn.extension=Kt.Application,Jt.add(Rn);const In={loader:Kt.LoadParser,resolver:Kt.ResolveParser,cache:Kt.CacheParser,detection:Kt.DetectionParser};Jt.handle(Kt.Asset,(t=>{const e=t.ref;Object.entries(In).filter((([t])=>!!e[t])).forEach((([t,r])=>Jt.add(Object.assign(e[t],{extension:e[t].extension??r}))))}),(t=>{const e=t.ref;Object.keys(In).filter((t=>!!e[t])).forEach((t=>Jt.remove(e[t])))}));class Mn{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach((t=>{this._assetList.push(t)})),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Bn(t,e){const r=t.split("?")[0],i=$.extname(r).toLowerCase();return Array.isArray(e)?e.includes(i):i===e}const Dn=(t,e)=>(Array.isArray(t)||(t=[t]),e?t.map((t=>"string"==typeof t?e(t):t)):t),jn=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const r=Dn(t);let i;for(let t=0;t<this.parsers.length;t++){const n=this.parsers[t];if(n.test(e)){i=n.getCacheableAssets(r,e);break}}i||(i={},r.forEach((t=>{i[t]=e})));const n=Object.keys(i),s={cacheKeys:n,keys:r};if(r.forEach((t=>{this._cacheMap.set(t,s)})),n.forEach((t=>{this._cache.has(t)&&this._cache.get(t)!==e&&console.warn("[Cache] already has key:",t),this._cache.set(t,i[t])})),e instanceof Cr){const t=e;r.forEach((e=>{t.baseTexture!==Cr.EMPTY.baseTexture&&ue.addToCache(t.baseTexture,e),Cr.addToCache(t,e)}))}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return void console.warn(`[Assets] Asset id ${t} was not found in the Cache`);const e=this._cacheMap.get(t);e.cacheKeys.forEach((t=>{this._cache.delete(t)})),e.keys.forEach((t=>{this._cacheMap.delete(t)}))}get parsers(){return this._parsers}},kn=t=>!Array.isArray(t);class Nn{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,e){const r={promise:null,parser:null};return r.promise=(async()=>{let i=null;for(let n=0;n<this.parsers.length;n++){const s=this.parsers[n];if(s.load&&s.test?.(t,e,this)){i=await s.load(t,e,this),r.parser=s;break}}if(!r.parser)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has being added`),null;for(let t=0;t<this.parsers.length;t++){const n=this.parsers[t];n.parse&&n.parse&&await(n.testParse?.(i,e,this))&&(i=await n.parse(i,e,this)||i,r.parser=n)}return i})(),r}async load(t,e){let r=0;const i={},n=kn(t),s=Dn(t,(t=>({src:t}))),o=s.length,a=s.map((async t=>{const n=$.toAbsolute(t.src);if(!i[t.src])try{this.promiseCache[n]||(this.promiseCache[n]=this._getLoadPromiseAndParser(n,t)),i[t.src]=await this.promiseCache[n].promise,e&&e(++r/o)}catch(e){throw delete this.promiseCache[n],delete i[t.src],new Error(`[Loader.load] Failed to load ${n}.\n${e}`)}}));return await Promise.all(a),n?i[s[0].src]:i}async unload(t){const e=Dn(t,(t=>({src:t}))).map((async t=>{const e=$.toAbsolute(t.src),r=this.promiseCache[e];if(r){const i=await r.promise;r.parser?.unload?.(i,t,this),delete this.promiseCache[e]}}));await Promise.all(e)}get parsers(){return this._parsers}}var Ln=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(Ln||{});const Fn={extension:{type:Kt.LoadParser,priority:Ln.Low},test:t=>".json"===$.extname(t).toLowerCase(),async load(t){const e=await T.ADAPTER.fetch(t);return await e.json()}};Jt.add(Fn);const Un={extension:{type:Kt.LoadParser,priority:Ln.Low},test:t=>".txt"===$.extname(t).toLowerCase(),async load(t){const e=await T.ADAPTER.fetch(t);return await e.text()}};function Gn(t,e){if(Array.isArray(e)){for(const r of e)if(t.startsWith(`data:${r}`))return!0;return!1}return t.startsWith(`data:${e}`)}Jt.add(Un);const zn=["normal","bold","100","200","300","400","500","600","700","800","900"],Hn=[".ttf",".otf",".woff",".woff2"],Xn=["font/ttf","font/otf","font/woff","font/woff2"],Vn={extension:{type:Kt.LoadParser,priority:Ln.Low},test:t=>Gn(t,Xn)||Bn(t,Hn),async load(t,e){const r=T.ADAPTER.getFontFaceSet();if(r){const i=[],n=e.data?.family??function(t){const e=$.extname(t);return $.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1))).join(" ")}(t),s=e.data?.weights?.filter((t=>zn.includes(t)))??["normal"],o=e.data??{};for(let e=0;e<s.length;e++){const a=s[e],h=new FontFace(n,`url(${encodeURI(t)})`,{...o,weight:a});await h.load(),r.add(h),i.push(h)}return 1===i.length?i[0]:i}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(t){(Array.isArray(t)?t:[t]).forEach((t=>T.ADAPTER.getFontFaceSet().delete(t)))}};Jt.add(Vn);let Wn,Yn=0;const $n="\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    ",qn="\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };";let Kn;const Zn=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((t=>{const e=URL.createObjectURL(new Blob([$n],{type:"application/javascript"})),r=new Worker(e);r.addEventListener("message",(i=>{r.terminate(),URL.revokeObjectURL(e),t(i.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===Wn&&(Wn=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Wn&&(Kn||(Kn=URL.createObjectURL(new Blob([qn],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Kn),t.addEventListener("message",(t=>{this.complete(t.data),this.returnWorker(t.target),this.next()}))),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const r=new Promise(((r,i)=>{this.queue.push({id:t,arguments:e,resolve:r,reject:i})}));return this.next(),r}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),r=e.id;this.resolveHash[Yn]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Yn++,id:r})}};function Qn(t,e,r){const i=new Cr(t);return i.baseTexture.on("dispose",(()=>{delete e.promiseCache[r]})),i}const Jn=[".jpeg",".jpg",".png",".webp",".avif"],ts=["image/jpeg","image/png","image/webp","image/avif"],es={extension:{type:Kt.LoadParser,priority:Ln.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:t=>Gn(t,ts)||Bn(t,Jn),async load(t,e,r){let i=null;i=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Zn.isImageBitmapSupported()?await Zn.loadImageBitmap(t):await async function(t){const e=await T.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const r=await e.blob();return await createImageBitmap(r)}(t):await new Promise((e=>{i=new Image,i.crossOrigin=this.config.crossOrigin,i.src=t,i.complete?e(i):i.onload=()=>{e(i)}}));const n=new ue(i,{resolution:qt(t),...e.data});return n.resource.src=t,Qn(n,r,t)},unload(t){t.destroy(!0)}};Jt.add(es);const rs={extension:{type:Kt.LoadParser,priority:Ln.High},test:t=>".svg"===$.extname(t).toLowerCase(),testParse:async t=>Yi.test(t),async parse(t,e,r){const i=new Yi(t,e?.data?.resourceOptions),n=new ue(i,{resolution:qt(t),...e?.data});n.resource.src=t;const s=Qn(n,r,t);return e?.data?.resourceOptions?.autoLoad||await i.load(),s},load:async(t,e)=>(await T.ADAPTER.fetch(t)).text(),unload:es.unload};function is(t,e,r,i,n){const s=e[r];for(let o=0;o<s.length;o++){const a=s[o];r<e.length-1?is(t.replace(i[r],a),e,r+1,i,n):n.push(t.replace(i[r],a))}}function ns(t){const e=t.match(/\{(.*?)\}/g),r=[];if(e){const i=[];e.forEach((t=>{const e=t.substring(1,t.length-1).split(",");i.push(e)})),is(t,i,0,e,r)}else r.push(t);return r}Jt.add(rs);class ss{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach((t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))})),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach((t=>{this.addBundle(t.name,t.assets)}))}addBundle(t,e){const r=[];Array.isArray(e)?e.forEach((e=>{if("string"==typeof e.name){const i=this._createBundleAssetId(t,e.name);r.push(i),this.add([e.name,i],e.srcs,e.data)}else{const i=e.name.map((e=>this._createBundleAssetId(t,e)));i.forEach((t=>{r.push(t)})),this.add([...e.name,...i],e.srcs)}})):Object.keys(e).forEach((i=>{r.push(this._createBundleAssetId(t,i)),this.add([i,this._createBundleAssetId(t,i)],e[i])})),this._bundles[t]=r}add(t,e,r){const i=Dn(t);i.forEach((t=>{this.hasKey(t)&&console.warn(`[Resolver] already has key: ${t} overwriting`)})),Array.isArray(e)||(e="string"==typeof e?ns(e):[e]);const n=e.map((t=>{let e=t;if("string"==typeof t){let r=!1;for(let i=0;i<this._parsers.length;i++){const n=this._parsers[i];if(n.test(t)){e=n.parse(t),r=!0;break}}r||(e={src:t})}return e.format||(e.format=e.src.split(".").pop()),e.alias||(e.alias=i),(this._basePath||this._rootPath)&&(e.src=$.toAbsolute(e.src,this._basePath,this._rootPath)),e.src=this._appendDefaultSearchParams(e.src),e.data=e.data??r,e}));i.forEach((t=>{this._assetMap[t]=n}))}resolveBundle(t){const e=kn(t);t=Dn(t);const r={};return t.forEach((t=>{const e=this._bundles[t];if(e){const i=this.resolve(e),n={};for(const e in i){const r=i[e];n[this._extractAssetIdFromBundle(t,e)]=r}r[t]=n}})),e?r[t[0]]:r}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const r in e)t[r]=e[r].src;return t}return e.src}resolve(t){const e=kn(t);t=Dn(t);const r={};return t.forEach((t=>{if(!this._resolverHash[t])if(this._assetMap[t]){let e=this._assetMap[t];const r=this._getPreferredOrder(e),i=e[0];r?.priority.forEach((t=>{r.params[t].forEach((r=>{const i=e.filter((e=>!!e[t]&&e[t]===r));i.length&&(e=i)}))})),this._resolverHash[t]=e[0]??i}else{let e=t;(this._basePath||this._rootPath)&&(e=$.toAbsolute(e,this._basePath,this._rootPath)),e=this._appendDefaultSearchParams(e),this._resolverHash[t]={src:e}}r[t]=this._resolverHash[t]})),e?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const e=t[0],r=this._preferredOrder.find((t=>t.params.format.includes(e.format)));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){return this._defaultSearchParams?`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`:t}}const os=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new ss,this.loader=new Nn,this.cache=jn,this._backgroundLoader=new Mn(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized)return void console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let e=t.manifest;"string"==typeof e&&(e=await this.load(e)),this.resolver.addManifest(e)}const e=t.texturePreference?.resolution??1,r="number"==typeof e?[e]:e;let i=[];if(t.texturePreference?.format){const e=t.texturePreference?.format;i="string"==typeof e?[e]:e;for(const t of this._detections)await t.test()||(i=await t.remove(i))}else for(const t of this._detections)await t.test()&&(i=await t.add(i));this.resolver.prefer({params:{format:i,resolution:r}})}add(t,e,r){this.resolver.add(t,e,r)}async load(t,e){this._initialized||await this.init();const r=kn(t),i=Dn(t).map((t=>"string"!=typeof t?(this.resolver.add(t.src,t),t.src):(this.resolver.hasKey(t)||this.resolver.add(t,t),t))),n=this.resolver.resolve(i),s=await this._mapLoadToResolve(n,e);return r?s[i[0]]:s}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;"string"==typeof t&&(r=!0,t=[t]);const i=this.resolver.resolveBundle(t),n={},s=Object.keys(i);let o=0,a=0;const h=()=>{e?.(++o/a)},l=s.map((t=>{const e=i[t];return a+=Object.keys(e).length,this._mapLoadToResolve(e,h).then((e=>{n[t]=e}))}));return await Promise.all(l),r?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach((t=>{this._backgroundLoader.add(Object.values(t))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return jn.get(t);const e={};for(let r=0;r<t.length;r++)e[r]=jn.get(t[r]);return e}async _mapLoadToResolve(t,e){const r=Object.values(t),i=Object.keys(t);this._backgroundLoader.active=!1;const n=await this.loader.load(r,e);this._backgroundLoader.active=!0;const s={};return r.forEach(((t,e)=>{const r=n[t.src],o=[t.src];t.alias&&o.push(...t.alias),s[i[e]]=r,jn.set(o,r)})),s}async unload(t){this._initialized||await this.init();const e=Dn(t).map((t=>"string"!=typeof t?t.src:t)),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=Dn(t);const e=this.resolver.resolveBundle(t),r=Object.keys(e).map((t=>this._unloadFromResolved(e[t])));await Promise.all(r)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach((t=>{jn.remove(t.src)})),await this.loader.unload(e)}get detections(){return this._detections}get preferWorkers(){return es.config.preferWorkers}set preferWorkers(t){es.config.preferWorkers=t}};Jt.handleByList(Kt.LoadParser,os.loader.parsers).handleByList(Kt.ResolveParser,os.resolver.parsers).handleByList(Kt.CacheParser,os.cache.parsers).handleByList(Kt.DetectionParser,os.detections);const as={extension:Kt.CacheParser,test:t=>Array.isArray(t)&&t.every((t=>t instanceof Cr)),getCacheableAssets:(t,e)=>{const r={};return t.forEach((t=>{e.forEach(((e,i)=>{r[t+(0===i?"":i+1)]=e}))})),r}};Jt.add(as);const hs={extension:{type:Kt.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await T.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))},add:async t=>[...t,"avif"],remove:async t=>t.filter((t=>"avif"!==t))};Jt.add(hs);const ls={extension:{type:Kt.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await T.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))},add:async t=>[...t,"webp"],remove:async t=>t.filter((t=>"webp"!==t))};Jt.add(ls);const cs=["png","jpg","jpeg"],us={extension:{type:Kt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...cs],remove:async t=>t.filter((t=>!cs.includes(t)))};Jt.add(us);const ds={extension:Kt.ResolveParser,test:es.test,parse:t=>({resolution:parseFloat(T.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t})};Jt.add(ds);const fs=(t,e)=>{const r=e.split("?")[1];return r&&(t+=`?${r}`),t};var ps=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t))(ps||{});const ms={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let gs,ys;function vs(){ys={s3tc:gs.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:gs.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:gs.getExtension("WEBGL_compressed_texture_etc"),etc1:gs.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:gs.getExtension("WEBGL_compressed_texture_pvrtc")||gs.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:gs.getExtension("WEBGL_compressed_texture_atc"),astc:gs.getExtension("WEBGL_compressed_texture_astc")}}const bs={extension:{type:Kt.DetectionParser,priority:2},test:async()=>{const t=T.ADAPTER.createCanvas().getContext("webgl");return t?(gs=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async t=>{ys||vs();const e=[];for(const t in ys)ys[t]&&e.push(t);return[...e,...t]},remove:async t=>(ys||vs(),t.filter((t=>!(t in ys))))};Jt.add(bs);class xs extends he{constructor(t,e={width:1,height:1,autoLoad:!0}){let r,i;"string"==typeof t?(r=t,i=new Uint8Array):(r=null,i=t),super(i,e),this.origin=r,this.buffer=i?new te(i):null,this.origin&&!1!==e.autoLoad&&this.load(),i?.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}async load(){const t=await fetch(this.origin),e=await t.blob(),r=await e.arrayBuffer();return this.data=new Uint32Array(r),this.buffer=new te(r),this.loaded=!0,this.onBlobLoaded(r),this.update(),this}}class _s extends xs{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=_s._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||_s._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,r){const i=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let t=0,e=this.levels;t<e;t++){const{levelID:e,levelWidth:r,levelHeight:n,levelBuffer:s}=this._levelBuffers[t];i.compressedTexImage2D(i.TEXTURE_2D,e,this.format,r,n,0,s)}return!0}onBlobLoaded(){this._levelBuffers=_s._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,r,i,n,s,o){const a=new Array(r);let h=t.byteOffset,l=s,c=o,u=l+i-1&~(i-1),d=c+n-1&~(n-1),f=u*d*ms[e];for(let s=0;s<r;s++)a[s]={levelID:s,levelWidth:r>1?l:u,levelHeight:r>1?c:d,levelBuffer:new Uint8Array(t.buffer,h,f)},h+=f,l=l>>1||1,c=c>>1||1,u=l+i-1&~(i-1),d=c+n-1&~(n-1),f=u*d*ms[e];return a}}const ws=124,Es=3,Ts=4,As=7,Ss=19,Ps=2,Os=0,Cs=1,Rs=2,Is=3,Ms={827611204:ps.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:ps.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:ps.COMPRESSED_RGBA_S3TC_DXT5_EXT},Bs={70:ps.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:ps.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:ps.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:ps.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:ps.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:ps.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:ps.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:ps.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:ps.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT},Ds=[171,75,84,88,32,49,49,187,13,10,26,10],js=67305985,ks={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Ns=64,Ls={[u.UNSIGNED_BYTE]:1,[u.UNSIGNED_SHORT]:2,[u.INT]:4,[u.UNSIGNED_INT]:4,[u.FLOAT]:4,[u.HALF_FLOAT]:8},Fs={[l.RGBA]:4,[l.RGB]:3,[l.RG]:2,[l.RED]:1,[l.LUMINANCE]:1,[l.LUMINANCE_ALPHA]:2,[l.ALPHA]:1},Us={[u.UNSIGNED_SHORT_4_4_4_4]:2,[u.UNSIGNED_SHORT_5_5_5_1]:2,[u.UNSIGNED_SHORT_5_6_5]:2};function Gs(t){switch(t){case l.RGBA:return l.RGBA_INTEGER;case l.RGB:return l.RGB_INTEGER;case l.RG:return l.RG_INTEGER;case l.RED:return l.RED_INTEGER;default:return t}}const zs={extension:{type:Kt.LoadParser,priority:Ln.High},test:t=>Bn(t,".dds"),async load(t,e,r){const i=await T.ADAPTER.fetch(t),n=function(t){const e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");const r=new Uint32Array(t,0,ws/Uint32Array.BYTES_PER_ELEMENT),i=r[Es],n=r[Ts],s=r[As],o=new Uint32Array(t,Ss*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=o[1];if(4&a){const r=o[Ps];if(808540228!==r){const e=Ms[r],o=new Uint8Array(t,128);return[new _s(o,{format:e,width:n,height:i,levels:s})]}const a=128,h=new Uint32Array(e.buffer,a,20/Uint32Array.BYTES_PER_ELEMENT),l=h[Os],c=h[Cs],u=h[Rs],d=h[Is],f=Bs[l];if(void 0===f)throw new Error(`DDSParser cannot parse texture data with DXGI format ${l}`);if(4===u)throw new Error("DDSParser does not support cubemap textures");if(6===c)throw new Error("DDSParser does not supported 3D texture data");const p=new Array,m=148;if(1===d)p.push(new Uint8Array(t,m));else{const e=ms[f];let r=0,o=n,a=i;for(let t=0;t<s;t++)r+=Math.max(1,o+3&-4)*Math.max(1,a+3&-4)*e,o>>>=1,a>>>=1;let h=m;for(let e=0;e<d;e++)p.push(new Uint8Array(t,h,r)),h+=r}return p.map((t=>new _s(t,{format:f,width:n,height:i,levels:s})))}if(64&a)throw new Error("DDSParser does not support uncompressed texture data.");if(512&a)throw new Error("DDSParser does not supported YUV uncompressed texture data.");if(131072&a)throw new Error("DDSParser does not support single-channel (lumninance) texture data!");if(2&a)throw new Error("DDSParser does not support single-channel (alpha) texture data!");throw new Error("DDSParser failed to load a texture file due to an unknown reason!")}(await i.arrayBuffer()),s=n.map((i=>Qn(new ue(i,{mipmap:m.OFF,alphaMode:g.NO_PREMULTIPLIED_ALPHA,resolution:qt(t),...e.data}),r,t)));return 1===s.length?s[0]:s},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};Jt.add(zs);const Hs={extension:{type:Kt.LoadParser,priority:Ln.High},test:t=>Bn(t,".ktx"),async load(t,e,r){const i=await T.ADAPTER.fetch(t),n=await i.arrayBuffer(),{compressed:s,uncompressed:o,kvData:a}=function(t,e,r=!1){const i=new DataView(e);if(!function(t,e){for(let r=0;r<Ds.length;r++)if(e.getUint8(r)!==Ds[r])return console.error(`${t} is not a valid *.ktx file!`),!1;return!0}(t,i))return null;const n=i.getUint32(ks.ENDIANNESS,!0)===js,s=i.getUint32(ks.GL_TYPE,n),o=i.getUint32(ks.GL_FORMAT,n),a=i.getUint32(ks.GL_INTERNAL_FORMAT,n),h=i.getUint32(ks.PIXEL_WIDTH,n),l=i.getUint32(ks.PIXEL_HEIGHT,n)||1,c=i.getUint32(ks.PIXEL_DEPTH,n)||1,d=i.getUint32(ks.NUMBER_OF_ARRAY_ELEMENTS,n)||1,f=i.getUint32(ks.NUMBER_OF_FACES,n),p=i.getUint32(ks.NUMBER_OF_MIPMAP_LEVELS,n),m=i.getUint32(ks.BYTES_OF_KEY_VALUE_DATA,n);if(0===l||1!==c)throw new Error("Only 2D textures are supported");if(1!==f)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==d)throw new Error("WebGL does not support array textures");const g=h+3&-4,y=l+3&-4,v=new Array(d);let b,x=h*l;if(0===s&&(x=g*y),b=0!==s?Ls[s]?Ls[s]*Fs[o]:Us[s]:ms[a],void 0===b)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const _=r?function(t,e,r){const i=new Map;let n=0;for(;n<e;){const s=t.getUint32(Ns+n,r),o=Ns+n+4,a=3-(s+3)%4;if(0===s||s>e-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<s&&0!==t.getUint8(o+h);h++);if(-1===h){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=(new TextDecoder).decode(new Uint8Array(t.buffer,o,h)),c=new DataView(t.buffer,o+h+1,s-h-1);i.set(l,c),n+=4+s+a}return i}(i,m,n):null;let w=x*b,E=h,T=l,A=g,S=y,P=Ns+m;for(let t=0;t<p;t++){const r=i.getUint32(P,n);let o=P+4;for(let r=0;r<d;r++){let i=v[r];i||(i=v[r]=new Array(p)),i[t]={levelID:t,levelWidth:p>1||0!==s?E:A,levelHeight:p>1||0!==s?T:S,levelBuffer:new Uint8Array(e,o,w)},o+=w}P+=r+4,P=P%4!=0?P+4-P%4:P,E=E>>1||1,T=T>>1||1,A=E+4-1&-4,S=T+4-1&-4,w=A*S*b}return 0!==s?{uncompressed:v.map((t=>{let e=t[0].levelBuffer,r=!1;return s===u.FLOAT?e=new Float32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4):s===u.UNSIGNED_INT?(r=!0,e=new Uint32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)):s===u.INT&&(r=!0,e=new Int32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)),{resource:new he(e,{width:t[0].levelWidth,height:t[0].levelHeight}),type:s,format:r?Gs(o):o}})),kvData:_}:{compressed:v.map((t=>new _s(null,{format:a,width:h,height:l,levels:p,levelBuffers:t}))),kvData:_}}(t,n),h=s??o,l={mipmap:m.OFF,alphaMode:g.NO_PREMULTIPLIED_ALPHA,resolution:qt(t),...e.data},c=h.map((e=>{h===o&&Object.assign(l,{type:e.type,format:e.format});const i=new ue(e,l);return i.ktxKeyValueData=a,Qn(i,r,t)}));return 1===c.length?c[0]:c},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};Jt.add(Hs);const Xs={extension:Kt.ResolveParser,test:t=>{const e=t.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:t=>{if("ktx"===t.split("?")[0].split(".").pop()){const e=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(e.some((e=>t.endsWith(e))))return{resolution:parseFloat(T.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e.find((e=>t.endsWith(e))),src:t}}return{resolution:parseFloat(T.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t}}};Jt.add(Xs);const Vs=new Oe,Ws=class{constructor(t){this.renderer=t}async image(t,e,r){const i=new Image;return i.src=await this.base64(t,e,r),i}async base64(t,e,r){const i=this.canvas(t);if(void 0!==i.toDataURL)return i.toDataURL(e,r);if(void 0!==i.convertToBlob){const t=await i.convertToBlob({type:e,quality:r});return await new Promise((e=>{const r=new FileReader;r.onload=()=>e(r.result),r.readAsDataURL(t)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:r,width:i,height:n,flipY:s}=this._rawPixels(t,e);let o=new Vt(i,n,1);const a=o.context.getImageData(0,0,i,n);if(Ws.arrayPostDivide(r,a.data),o.context.putImageData(a,0,0),s){const t=new Vt(o.width,o.height,1);t.context.scale(1,-1),t.context.drawImage(o.canvas,0,-n),o.destroy(),o=t}return o.canvas}pixels(t,e){const{pixels:r}=this._rawPixels(t,e);return Ws.arrayPostDivide(r,r),r}_rawPixels(t,e){const r=this.renderer;let i,n,s=!1,o=!1;if(t)if(t instanceof Rr)n=t;else{const e=r.context.webGLVersion>=2?r.multisample:_.NONE;if(n=this.renderer.generateTexture(t,{multisample:e}),e!==_.NONE){const t=Rr.create({width:n.width,height:n.height});r.framebuffer.bind(n.framebuffer),r.framebuffer.blit(t.framebuffer),r.framebuffer.bind(null),n.destroy(!0),n=t}o=!0}n?(i=n.baseTexture.resolution,e=e??n.frame,s=!1,r.renderTexture.bind(n)):(i=r.resolution,e||((e=Vs).width=r.width,e.height=r.height),s=!0,r.renderTexture.bind(null));const a=Math.round(e.width*i),h=Math.round(e.height*i),l=new Uint8Array(4*a*h),c=r.gl;return c.readPixels(Math.round(e.x*i),Math.round(e.y*i),a,h,c.RGBA,c.UNSIGNED_BYTE,l),o&&n.destroy(!0),{pixels:l,width:a,height:h,flipY:s}}destroy(){this.renderer=null}static arrayPostDivide(t,e){for(let r=0;r<t.length;r+=4){const i=e[r+3]=t[r+3];0!==i?(e[r]=Math.round(Math.min(255*t[r]/i,255)),e[r+1]=Math.round(Math.min(255*t[r+1]/i,255)),e[r+2]=Math.round(Math.min(255*t[r+2]/i,255))):(e[r]=t[r],e[r+1]=t[r+1],e[r+2]=t[r+2])}}};let Ys=Ws;Ys.extension={name:"extract",type:Kt.RendererSystem},Jt.add(Ys);const $s={build(t){const e=t.points;let r,i,n,s,o,a;if(t.type===Ae.CIRC){const e=t.shape;r=e.x,i=e.y,o=a=e.radius,n=s=0}else if(t.type===Ae.ELIP){const e=t.shape;r=e.x,i=e.y,o=e.width,a=e.height,n=s=0}else{const e=t.shape,h=e.width/2,l=e.height/2;r=e.x+h,i=e.y+l,o=a=Math.max(0,Math.min(e.radius,Math.min(h,l))),n=h-o,s=l-a}if(!(o>=0&&a>=0&&n>=0&&s>=0))return void(e.length=0);const h=Math.ceil(2.3*Math.sqrt(o+a)),l=8*h+(n?4:0)+(s?4:0);if(e.length=l,0===l)return;if(0===h)return e.length=8,e[0]=e[6]=r+n,e[1]=e[3]=i+s,e[2]=e[4]=r-n,void(e[5]=e[7]=i-s);let c=0,u=4*h+(n?2:0)+2,d=u,f=l;{const t=n+o,a=s,h=r+t,l=r-t,p=i+a;if(e[c++]=h,e[c++]=p,e[--u]=p,e[--u]=l,s){const t=i-a;e[d++]=l,e[d++]=t,e[--f]=t,e[--f]=h}}for(let t=1;t<h;t++){const l=Math.PI/2*(t/h),p=n+Math.cos(l)*o,m=s+Math.sin(l)*a,g=r+p,y=r-p,v=i+m,b=i-m;e[c++]=g,e[c++]=v,e[--u]=v,e[--u]=y,e[d++]=y,e[d++]=b,e[--f]=b,e[--f]=g}{const t=s+a,o=r+n,h=r-n,l=i+t,u=i-t;e[c++]=o,e[c++]=l,e[--f]=u,e[--f]=o,n&&(e[c++]=h,e[c++]=l,e[--f]=u,e[--f]=h)}},triangulate(t,e){const r=t.points,i=e.points,n=e.indices;if(0===r.length)return;let s=i.length/2;const o=s;let a,h;if(t.type!==Ae.RREC){const e=t.shape;a=e.x,h=e.y}else{const e=t.shape;a=e.x+e.width/2,h=e.y+e.height/2}const l=t.matrix;i.push(t.matrix?l.a*a+l.c*h+l.tx:a,t.matrix?l.b*a+l.d*h+l.ty:h),s++,i.push(r[0],r[1]);for(let t=2;t<r.length;t+=2)i.push(r[t],r[t+1]),n.push(s++,o,s);n.push(o+1,o,s)}};function qs(t,e=!1){const r=t.length;if(r<6)return;let i=0;for(let e=0,n=t[r-2],s=t[r-1];e<r;e+=2){const r=t[e],o=t[e+1];i+=(r-n)*(o+s),n=r,s=o}if(!e&&i>0||e&&i<=0){const e=r/2;for(let i=e+e%2;i<r;i+=2){const e=r-i-2,n=r-i-1,s=i,o=i+1;[t[e],t[s]]=[t[s],t[e]],[t[n],t[o]]=[t[o],t[n]]}}}const Ks={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let r=t.points;const i=t.holes,n=e.points,s=e.indices;if(r.length>=6){qs(r,!1);const t=[];for(let e=0;e<i.length;e++){const n=i[e];qs(n.points,!0),t.push(r.length/2),r=r.concat(n.points)}const e=H(r,t,2);if(!e)return;const o=n.length/2;for(let t=0;t<e.length;t+=3)s.push(e[t]+o),s.push(e[t+1]+o),s.push(e[t+2]+o);for(let t=0;t<r.length;t++)n.push(r[t])}}},Zs={build(t){const e=t.shape,r=e.x,i=e.y,n=e.width,s=e.height,o=t.points;o.length=0,n>=0&&s>=0&&o.push(r,i,r+n,i,r+n,i+s,r,i+s)},triangulate(t,e){const r=t.points,i=e.points;if(0===r.length)return;const n=i.length/2;i.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),e.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},Qs={build(t){$s.build(t)},triangulate(t,e){$s.triangulate(t,e)}};var Js=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(Js||{}),to=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(to||{});const eo={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let r=Math.ceil(t/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}};class ro{static curveTo(t,e,r,i,n,s){const o=s[s.length-2],a=s[s.length-1]-e,h=o-t,l=i-e,c=r-t,u=Math.abs(a*c-h*l);if(u<1e-8||0===n)return s[s.length-2]===t&&s[s.length-1]===e||s.push(t,e),null;const d=a*a+h*h,f=l*l+c*c,p=a*l+h*c,m=n*Math.sqrt(d)/u,g=n*Math.sqrt(f)/u,y=m*p/d,v=g*p/f,b=m*c+g*h,x=m*l+g*a,_=h*(g+y),w=a*(g+y),E=c*(m+v),T=l*(m+v);return{cx:b+t,cy:x+e,radius:n,startAngle:Math.atan2(w-x,_-b),endAngle:Math.atan2(T-x,E-b),anticlockwise:h*l>c*a}}static arc(t,e,r,i,n,s,o,a,h){const l=o-s,c=eo._segmentsCount(Math.abs(l)*n,40*Math.ceil(Math.abs(l)/we)),u=l/(2*c),d=2*u,f=Math.cos(u),p=Math.sin(u),m=c-1,g=m%1/m;for(let t=0;t<=m;++t){const e=u+s+d*(t+g*t),o=Math.cos(e),a=-Math.sin(e);h.push((f*o+p*a)*n+r,(f*-a+p*o)*n+i)}}}class io{static curveLength(t,e,r,i,n,s,o,a){let h=0,l=0,c=0,u=0,d=0,f=0,p=0,m=0,g=0,y=0,v=0,b=t,x=e;for(let _=1;_<=10;++_)l=_/10,c=l*l,u=c*l,d=1-l,f=d*d,p=f*d,m=p*t+3*f*l*r+3*d*c*n+u*o,g=p*e+3*f*l*i+3*d*c*s+u*a,y=b-m,v=x-g,b=m,x=g,h+=Math.sqrt(y*y+v*v);return h}static curveTo(t,e,r,i,n,s,o){const a=o[o.length-2],h=o[o.length-1];o.length-=2;const l=eo._segmentsCount(io.curveLength(a,h,t,e,r,i,n,s));let c=0,u=0,d=0,f=0,p=0;o.push(a,h);for(let m=1,g=0;m<=l;++m)g=m/l,c=1-g,u=c*c,d=u*c,f=g*g,p=f*g,o.push(d*a+3*u*g*t+3*c*f*r+p*n,d*h+3*u*g*e+3*c*f*i+p*s)}}function no(t,e,r,i,n,s,o,a){let h,l;o?(h=i,l=-r):(h=-i,l=r);const c=t-r*n+h,u=e-i*n+l,d=t+r*s+h,f=e+i*s+l;return a.push(c,u),a.push(d,f),2}function so(t,e,r,i,n,s,o,a){const h=r-t,l=i-e;let c=Math.atan2(h,l),u=Math.atan2(n-t,s-e);a&&c<u?c+=2*Math.PI:!a&&c>u&&(u+=2*Math.PI);let d=c;const f=u-c,p=Math.abs(f),m=Math.sqrt(h*h+l*l),g=1+(15*p*Math.sqrt(m)/Math.PI>>0),y=f/g;if(d+=y,a){o.push(t,e),o.push(r,i);for(let r=1,i=d;r<g;r++,i+=y)o.push(t,e),o.push(t+Math.sin(i)*m,e+Math.cos(i)*m);o.push(t,e),o.push(n,s)}else{o.push(r,i),o.push(t,e);for(let r=1,i=d;r<g;r++,i+=y)o.push(t+Math.sin(i)*m,e+Math.cos(i)*m),o.push(t,e);o.push(n,s),o.push(t,e)}return 2*g}function oo(t,e){t.lineStyle.native?function(t,e){let r=0;const i=t.shape,n=t.points||i.points,s=i.type!==Ae.POLY||i.closeStroke;if(0===n.length)return;const o=e.points,a=e.indices,h=n.length/2,l=o.length/2;let c=l;for(o.push(n[0],n[1]),r=1;r<h;r++)o.push(n[2*r],n[2*r+1]),a.push(c,c+1),c++;s&&a.push(c,l)}(t,e):function(t,e){const r=t.shape;let i=t.points||r.points.slice();const n=e.closePointEps;if(0===i.length)return;const s=t.lineStyle,o=new Se(i[0],i[1]),a=new Se(i[i.length-2],i[i.length-1]),h=r.type!==Ae.POLY||r.closeStroke,l=Math.abs(o.x-a.x)<n&&Math.abs(o.y-a.y)<n;if(h){i=i.slice(),l&&(i.pop(),i.pop(),a.set(i[i.length-2],i[i.length-1]));const t=.5*(o.x+a.x),e=.5*(a.y+o.y);i.unshift(t,e),i.push(t,e)}const c=e.points,u=i.length/2;let d=i.length;const f=c.length/2,p=s.width/2,m=p*p,g=s.miterLimit*s.miterLimit;let y=i[0],v=i[1],b=i[2],x=i[3],_=0,w=0,E=-(v-x),T=y-b,A=0,S=0,P=Math.sqrt(E*E+T*T);E/=P,T/=P,E*=p,T*=p;const O=s.alignment,C=2*(1-O),R=2*O;h||(s.cap===to.ROUND?d+=so(y-E*(C-R)*.5,v-T*(C-R)*.5,y-E*C,v-T*C,y+E*R,v+T*R,c,!0)+2:s.cap===to.SQUARE&&(d+=no(y,v,E,T,C,R,!0,c))),c.push(y-E*C,v-T*C),c.push(y+E*R,v+T*R);for(let t=1;t<u-1;++t){y=i[2*(t-1)],v=i[2*(t-1)+1],b=i[2*t],x=i[2*t+1],_=i[2*(t+1)],w=i[2*(t+1)+1],E=-(v-x),T=y-b,P=Math.sqrt(E*E+T*T),E/=P,T/=P,E*=p,T*=p,A=-(x-w),S=b-_,P=Math.sqrt(A*A+S*S),A/=P,S/=P,A*=p,S*=p;const e=b-y,r=v-x,n=b-_,o=w-x,a=e*n+r*o,h=r*n-o*e,l=h<0;if(Math.abs(h)<.001*Math.abs(a)){c.push(b-E*C,x-T*C),c.push(b+E*R,x+T*R),a>=0&&(s.join===Js.ROUND?d+=so(b,x,b-E*C,x-T*C,b-A*C,x-S*C,c,!1)+4:d+=2,c.push(b-A*R,x-S*R),c.push(b+A*C,x+S*C));continue}const u=(-E+y)*(-T+x)-(-E+b)*(-T+v),f=(-A+_)*(-S+x)-(-A+b)*(-S+w),O=(e*f-n*u)/h,I=(o*u-r*f)/h,M=(O-b)*(O-b)+(I-x)*(I-x),B=b+(O-b)*C,D=x+(I-x)*C,j=b-(O-b)*R,k=x-(I-x)*R,N=l?C:R;M<=Math.min(e*e+r*r,n*n+o*o)+N*N*m?s.join===Js.BEVEL||M/m>g?(l?(c.push(B,D),c.push(b+E*R,x+T*R),c.push(B,D),c.push(b+A*R,x+S*R)):(c.push(b-E*C,x-T*C),c.push(j,k),c.push(b-A*C,x-S*C),c.push(j,k)),d+=2):s.join===Js.ROUND?l?(c.push(B,D),c.push(b+E*R,x+T*R),d+=so(b,x,b+E*R,x+T*R,b+A*R,x+S*R,c,!0)+4,c.push(B,D),c.push(b+A*R,x+S*R)):(c.push(b-E*C,x-T*C),c.push(j,k),d+=so(b,x,b-E*C,x-T*C,b-A*C,x-S*C,c,!1)+4,c.push(b-A*C,x-S*C),c.push(j,k)):(c.push(B,D),c.push(j,k)):(c.push(b-E*C,x-T*C),c.push(b+E*R,x+T*R),s.join===Js.ROUND?d+=l?so(b,x,b+E*R,x+T*R,b+A*R,x+S*R,c,!0)+2:so(b,x,b-E*C,x-T*C,b-A*C,x-S*C,c,!1)+2:s.join===Js.MITER&&M/m<=g&&(l?(c.push(j,k),c.push(j,k)):(c.push(B,D),c.push(B,D)),d+=2),c.push(b-A*C,x-S*C),c.push(b+A*R,x+S*R),d+=2)}y=i[2*(u-2)],v=i[2*(u-2)+1],b=i[2*(u-1)],x=i[2*(u-1)+1],E=-(v-x),T=y-b,P=Math.sqrt(E*E+T*T),E/=P,T/=P,E*=p,T*=p,c.push(b-E*C,x-T*C),c.push(b+E*R,x+T*R),h||(s.cap===to.ROUND?d+=so(b-E*(C-R)*.5,x-T*(C-R)*.5,b-E*C,x-T*C,b+E*R,x+T*R,c,!1)+2:s.cap===to.SQUARE&&(d+=no(b,x,E,T,C,R,!1,c)));const I=e.indices,M=eo.epsilon*eo.epsilon;for(let t=f;t<d+f-2;++t)y=c[2*t],v=c[2*t+1],b=c[2*(t+1)],x=c[2*(t+1)+1],_=c[2*(t+2)],w=c[2*(t+2)+1],Math.abs(y*(x-w)+b*(w-v)+_*(v-x))<M||I.push(t,t+1,t+2)}(t,e)}class ao{static curveLength(t,e,r,i,n,s){const o=t-2*r+n,a=e-2*i+s,h=2*r-2*t,l=2*i-2*e,c=4*(o*o+a*a),u=4*(o*h+a*l),d=h*h+l*l,f=2*Math.sqrt(c+u+d),p=Math.sqrt(c),m=2*c*p,g=2*Math.sqrt(d),y=u/p;return(m*f+p*u*(f-g)+(4*d*c-u*u)*Math.log((2*p+y+f)/(y+g)))/(4*m)}static curveTo(t,e,r,i,n){const s=n[n.length-2],o=n[n.length-1],a=eo._segmentsCount(ao.curveLength(s,o,t,e,r,i));let h=0,l=0;for(let c=1;c<=a;++c){const u=c/a;h=s+(t-s)*u,l=o+(e-o)*u,n.push(h+(t+(r-t)*u-h)*u,l+(e+(i-e)*u-l)*u)}}}const ho={[Ae.POLY]:Ks,[Ae.CIRC]:$s,[Ae.ELIP]:$s,[Ae.RECT]:Zs,[Ae.RREC]:Qs},lo=[],co=[];class uo{constructor(t,e=null,r=null,i=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=i,this.type=t.type}clone(){return new uo(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class fo{constructor(){this.reset()}begin(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const po=new Se,mo=class extends _e{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Ki,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),co.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),lo.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,r=null,i=null){const n=new uo(t,e,r,i);return this.graphicsData.push(n),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const r=new uo(t,null,null,e),i=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=i.lineStyle,i.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let r=0;r<e.length;++r){const i=e[r];if(i.fillStyle.visible&&i.shape&&(i.matrix?i.matrix.applyInverse(t,po):po.copyFrom(t),i.shape.contains(po.x,po.y))){let t=!1;if(i.holes)for(let e=0;e<i.holes.length;e++)if(i.holes[e].shape.contains(po.x,po.y)){t=!0;break}if(!t)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let r=null,i=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],i=r.style);for(let n=this.shapeIndex;n<e.length;n++){this.shapeIndex++;const s=e[n],o=s.fillStyle,a=s.lineStyle;ho[s.type].build(s),s.matrix&&this.transformPoints(s.points,s.matrix),(o.visible||a.visible)&&this.processHoles(s.holes);for(let e=0;e<2;e++){const n=0===e?o:a;if(!n.visible)continue;const h=n.texture.baseTexture,l=this.indices.length,c=this.points.length/2;h.wrapMode=p.REPEAT,0===e?this.processFill(s):this.processLine(s);const u=this.points.length/2-c;0!==u&&(r&&!this._compareStyles(i,n)&&(r.end(l,c),r=null),r||(r=lo.pop()||new fo,r.begin(n,l,c),this.batches.push(r),i=n),this.addUvs(this.points,t,n.texture,c,u,n.matrix))}}const n=this.indices.length,s=this.points.length/2;if(r&&r.end(n,s),0===this.batches.length)return void(this.batchable=!0);const o=s>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e)&&t.texture.baseTexture===e.texture.baseTexture&&t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const e=this.graphicsData[t],r=e.fillStyle,i=e.lineStyle;if(r&&!r.texture.baseTexture.valid)return!1;if(i&&!i.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,r=t.length;e<r;e++){const r=t[e];for(let t=0;t<r.size;t++){const e=r.start+t;this.indicesUint16[e]=this.indicesUint16[e]-r.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*mo.BATCHABLE_SIZE}buildDrawCalls(){let t=++ue._globalBatch;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),co.push(this.drawCalls[t]);this.drawCalls.length=0;const e=this.colors,r=this.textureIds;let i=co.pop();i||(i=new de,i.texArray=new ur),i.texArray.count=0,i.start=0,i.size=0,i.type=h.TRIANGLES;let n=0,s=null,o=0,a=!1,l=h.TRIANGLES,c=0;this.drawCalls.push(i);for(let u=0;u<this.batches.length;u++){const d=this.batches[u],f=8,m=d.style,g=m.texture.baseTexture;a!==!!m.native&&(a=!!m.native,l=a?h.LINES:h.TRIANGLES,s=null,n=f,t++),s!==g&&(s=g,g._batchEnabled!==t&&(n===f&&(t++,n=0,i.size>0&&(i=co.pop(),i||(i=new de,i.texArray=new ur),this.drawCalls.push(i)),i.start=c,i.size=0,i.texArray.count=0,i.type=l),g.touched=1,g._batchEnabled=t,g._batchLocation=n,g.wrapMode=p.REPEAT,i.texArray.elements[i.texArray.count++]=g,n++)),i.size+=d.size,c+=d.size,o=g._batchLocation,this.addColors(e,m.color,m.alpha,d.attribSize,d.attribStart),this.addTextureIds(r,o,d.attribSize,d.attribStart)}ue._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,r=this.colors,i=this.textureIds,n=new ArrayBuffer(3*t.length*4),s=new Float32Array(n),o=new Uint32Array(n);let a=0;for(let n=0;n<t.length/2;n++)s[a++]=t[2*n],s[a++]=t[2*n+1],s[a++]=e[2*n],s[a++]=e[2*n+1],o[a++]=r[n],s[a++]=i[n];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?Ks.triangulate(t,this):ho[t.type].triangulate(t,this)}processLine(t){oo(t,this);for(let e=0;e<t.holes.length;e++)oo(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const r=t[e];ho[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let r=0;r<t.length/2;r++){const i=t[2*r],n=t[2*r+1];t[2*r]=e.a*i+e.c*n+e.tx,t[2*r+1]=e.b*i+e.d*n+e.ty}}addColors(t,e,r,i,n=0){const s=Pt.shared.setValue(e).toLittleEndianNumber(),o=Pt.shared.setValue(s).toPremultiplied(r);t.length=Math.max(t.length,n+i);for(let e=0;e<i;e++)t[n+e]=o}addTextureIds(t,e,r,i=0){t.length=Math.max(t.length,i+r);for(let n=0;n<r;n++)t[i+n]=e}addUvs(t,e,r,i,n,s=null){let o=0;const a=e.length,h=r.frame;for(;o<n;){let r=t[2*(i+o)],n=t[2*(i+o)+1];if(s){const t=s.a*r+s.c*n+s.tx;n=s.b*r+s.d*n+s.ty,r=t}o++,e.push(r/h.width,n/h.height)}const l=r.baseTexture;(h.width<l.width||h.height<l.height)&&this.adjustUvs(e,r,a,n)}adjustUvs(t,e,r,i){const n=e.baseTexture,s=1e-6,o=r+2*i,a=e.frame,h=a.width/n.width,l=a.height/n.height;let c=a.x/a.width,u=a.y/a.height,d=Math.floor(t[r]+s),f=Math.floor(t[r+1]+s);for(let e=r+2;e<o;e+=2)d=Math.min(d,Math.floor(t[e]+s)),f=Math.min(f,Math.floor(t[e+1]+s));c-=d,u-=f;for(let e=r;e<o;e+=2)t[e]=(t[e]+c)*h,t[e+1]=(t[e+1]+u)*l}};let go=mo;go.BATCHABLE_SIZE=100;class yo{constructor(){this.color=16777215,this.alpha=1,this.texture=Cr.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new yo;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Cr.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class vo extends yo{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=to.BUTT,this.join=Js.MITER,this.miterLimit=10}clone(){const t=new vo;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const bo=new Float32Array(3),xo={},_o=class extends rn{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new yo,this._lineStyle=new vo,this._matrix=null,this._holeMode=!1,this.state=ie.for2d(),this._geometry=t||new go,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=a.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new _o(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(t){this._tint=t}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,r,i=.5,n=!1){return"number"==typeof t&&(t={width:t,color:e,alpha:r,alignment:i,native:n}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:Cr.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:to.BUTT,join:Js.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.width>0&&t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:r},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Ie,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Ie,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,i=r[r.length-2],n=r[r.length-1];return i===t&&n===e||r.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,r,i){this._initCurve();const n=this.currentPath.points;return 0===n.length&&this.moveTo(0,0),ao.curveTo(t,e,r,i,n),this}bezierCurveTo(t,e,r,i,n,s){return this._initCurve(),io.curveTo(t,e,r,i,n,s,this.currentPath.points),this}arcTo(t,e,r,i,n){this._initCurve(t,e);const s=this.currentPath.points,o=ro.curveTo(t,e,r,i,n,s);if(o){const{cx:t,cy:e,radius:r,startAngle:i,endAngle:n,anticlockwise:s}=o;this.arc(t,e,r,i,n,s)}return this}arc(t,e,r,i,n,s=!1){if(i===n)return this;if(!s&&n<=i?n+=we:s&&i<=n&&(i+=we),0==n-i)return this;const o=t+Math.cos(i)*r,a=e+Math.sin(i)*r,h=this._geometry.closePointEps;let l=this.currentPath?this.currentPath.points:null;if(l){const t=Math.abs(l[l.length-2]-o),e=Math.abs(l[l.length-1]-a);t<h&&e<h||l.push(o,a)}else this.moveTo(o,a),l=this.currentPath.points;return ro.arc(o,a,t,e,r,i,n,s,l),this}beginFill(t=0,e){return this.beginTextureFill({texture:Cr.WHITE,color:t,alpha:e})}normalizeColor(t){const e=Pt.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:Cr.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:r},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,r,i){return this.drawShape(new Oe(t,e,r,i))}drawRoundedRect(t,e,r,i,n){return this.drawShape(new Me(t,e,r,i,n))}drawCircle(t,e,r){return this.drawShape(new Ce(t,e,r))}drawEllipse(t,e,r,i){return this.drawShape(new Re(t,e,r,i))}drawPolygon(...t){let e,r=!0;const i=t[0];i.points?(r=i.closeStroke,e=i.points):e=Array.isArray(t[0])?t[0]:t;const n=new Ie(e);return n.closeStroke=r,this.drawShape(n),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==Ae.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,r=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(t.points);for(let i=0;i<r;i++){const r=t.batches[i],n=r.style.color,s=new Float32Array(this.vertexData.buffer,4*r.attribStart*2,2*r.attribSize),o=new Float32Array(t.uvsFloat32.buffer,4*r.attribStart*2,2*r.attribSize),a={vertexData:s,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*r.start,r.size),uvs:o,_batchRGB:Pt.shared.setValue(n).toRgbArray(),_tintRGB:n,_texture:r.style.texture,alpha:r.style.alpha,worldAlpha:1};this.batches[i]=a}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,r=this.batches.length;e<r;e++){const r=this.batches[e];r.worldAlpha=this.worldAlpha*r.alpha,t.plugins[this.pluginName].render(r)}}}_renderDirect(t){const e=this._resolveDirectShader(t),r=this._geometry,i=this.tint,n=this.worldAlpha,s=e.uniforms,o=r.drawCalls;s.translationMatrix=this.transform.worldTransform,Pt.shared.setValue(i).multiply([n,n,n]).setAlpha(n).toArray(s.tint),t.shader.bind(e),t.geometry.bind(r,e),t.state.set(this.state);for(let e=0,i=o.length;e<i;e++)this._renderDrawCallDirect(t,r.drawCalls[e])}_renderDrawCallDirect(t,e){const{texArray:r,type:i,size:n,start:s}=e,o=r.count;for(let e=0;e<o;e++)t.texture.bind(r.elements[e],e);t.geometry.draw(i,n,s)}_resolveDirectShader(t){let e=this.shader;const r=this.pluginName;if(!e){if(!xo[r]){const{maxTextures:e}=t.plugins[r],i=new Int32Array(e);for(let t=0;t<e;t++)i[t]=t;const n={tint:new Float32Array([1,1,1,1]),translationMatrix:new Be,default:hr.from({uSamplers:i},!0)},s=t.plugins[r]._shader.program;xo[r]=new lr(s,n)}e=xo[r]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:r,maxX:i,maxY:n}=t.bounds;this._bounds.addFrame(this.transform,e,r,i,n)}containsPoint(t){return this.worldTransform.applyInverse(t,_o._TEMP_POINT),this._geometry.containsPoint(_o._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const t=Pt.shared.setValue(this.tint).toRgbArray(bo);for(let e=0;e<this.batches.length;e++){const r=this.batches[e];r._tintRGB=Pt.shared.setValue(t).multiply(r._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,r=e.a,i=e.b,n=e.c,s=e.d,o=e.tx,a=e.ty,h=this._geometry.points,l=this.vertexData;let c=0;for(let t=0;t<h.length;t+=2){const e=h[t],u=h[t+1];l[c++]=r*e+n*u+o,l[c++]=s*u+i*e+a}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};let wo=_o;wo.curves=eo,wo._TEMP_POINT=new Se;class Eo{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const To=new Se,Ao=new Ie,So=class extends rn{constructor(t,e,r,i=h.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=r||ie.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=T.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===h.TRIANGLES&&e.length<2*So.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const i=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[i]),t.plugins[i].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const i=this.transform.worldTransform,n=i.a,s=i.b,o=i.c,a=i.d,h=i.tx,l=i.ty,c=this.vertexData;for(let t=0;t<c.length/2;t++){const r=e[2*t],i=e[2*t+1];c[2*t]=n*r+o*i+h,c[2*t+1]=s*r+a*i+l}if(this._roundPixels){const t=T.RESOLUTION;for(let e=0;e<c.length;++e)c[e]=Math.round(c[e]*t)/t}this.vertexDirty=r}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Eo(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,To);const e=this.geometry.getBuffer("aVertexPosition").data,r=Ao.points,i=this.geometry.getIndex().data,n=i.length,s=4===this.drawMode?3:1;for(let t=0;t+2<n;t+=s){const n=2*i[t],s=2*i[t+1],o=2*i[t+2];if(r[0]=e[n],r[1]=e[n+1],r[2]=e[s],r[3]=e[s+1],r[4]=e[o],r[5]=e[o+1],Ao.contains(To.x,To.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let Po=So;Po.BATCHABLE_SIZE=100;class Oo extends xe{constructor(t,e,r){super();const i=new pe(t),n=new pe(e,!0),s=new pe(r,!0,!0);this.addAttribute("aVertexPosition",i,2,!1,u.FLOAT).addAttribute("aTextureCoord",n,2,!1,u.FLOAT).addIndex(s),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class Co extends lr{constructor(t,e){const r={uSampler:t,alpha:1,uTextureMatrix:Be.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(r,e.uniforms),super(e.program||or.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),r),this._colorDirty=!1,this.uvMatrix=new Xr(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this.tint=e.tint,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this._tint&&(this._tint=t,this._tintRGB=Pt.shared.setValue(t).toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tint}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;Pt.shared.setValue(this._tint).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Ro{constructor(t,e,r){this.geometry=new xe,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let r=0;r<t.length;++r){let i=t[r];i={attributeName:i.attributeName,size:i.size,uploadFunction:i.uploadFunction,type:i.type||u.FLOAT,offset:i.offset},e[r]?this.dynamicProperties.push(i):this.staticProperties.push(i)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new pe(function(t,e=null){const r=6*t;if((e=e||new Uint16Array(r)).length!==r)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${r}`);for(let t=0,i=0;t<r;t+=6,i+=4)e[t+0]=i+0,e[t+1]=i+1,e[t+2]=i+2,e[t+3]=i+0,e[t+4]=i+2,e[t+5]=i+3;return e}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let t=0;t<this.dynamicProperties.length;++t){const r=this.dynamicProperties[t];r.offset=e,e+=r.size,this.dynamicStride+=r.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new pe(this.dynamicData,!1,!1);let i=0;this.staticStride=0;for(let t=0;t<this.staticProperties.length;++t){const e=this.staticProperties[t];e.offset=i,i+=e.size,this.staticStride+=e.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new pe(this.staticData,!0,!1);for(let e=0;e<this.dynamicProperties.length;++e){const r=this.dynamicProperties[e];t.addAttribute(r.attributeName,this.dynamicBuffer,0,r.type===u.UNSIGNED_BYTE,r.type,4*this.dynamicStride,4*r.offset)}for(let e=0;e<this.staticProperties.length;++e){const r=this.staticProperties[e];t.addAttribute(r.attributeName,this.staticBuffer,0,r.type===u.UNSIGNED_BYTE,r.type,4*this.staticStride,4*r.offset)}}uploadDynamic(t,e,r){for(let i=0;i<this.dynamicProperties.length;i++){const n=this.dynamicProperties[i];n.uploadFunction(t,e,r,n.type===u.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,r){for(let i=0;i<this.staticProperties.length;i++){const n=this.staticProperties[i];n.uploadFunction(t,e,r,n.type===u.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class Io extends dr{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Be,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:u.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=lr.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=ie.for2d()}render(t){const e=t.children,r=t._maxSize,i=t._batchSize,n=this.renderer;let s=e.length;if(0===s)return;s>r&&!t.autoResize&&(s=r);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const a=e[0]._texture.baseTexture,h=a.alphaMode>0;this.state.blendMode=It(t.blendMode,h),n.state.set(this.state);const l=n.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=Pt.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);let u=!1;for(let r=0,a=0;r<s;r+=i,a+=1){let h=s-r;h>i&&(h=i),a>=o.length&&o.push(this._generateOneMoreBuffer(t));const c=o[a];c.uploadDynamic(e,r,h);const d=t._bufferUpdateIDs[a]||0;u=u||c._updateID<d,u&&(c._updateID=t._updateID,c.uploadStatic(e,r,h)),n.geometry.bind(c.geometry),l.drawElements(l.TRIANGLES,6*h,l.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],r=t._maxSize,i=t._batchSize,n=t._properties;for(let t=0;t<r;t+=i)e.push(new Ro(this.properties,n,i));return e}_generateOneMoreBuffer(t){const e=t._batchSize,r=t._properties;return new Ro(this.properties,r,e)}uploadVertices(t,e,r,i,n,s){let o=0,a=0,h=0,l=0;for(let c=0;c<r;++c){const r=t[e+c],u=r._texture,d=r.scale.x,f=r.scale.y,p=u.trim,m=u.orig;p?(a=p.x-r.anchor.x*m.width,o=a+p.width,l=p.y-r.anchor.y*m.height,h=l+p.height):(o=m.width*(1-r.anchor.x),a=m.width*-r.anchor.x,h=m.height*(1-r.anchor.y),l=m.height*-r.anchor.y),i[s]=a*d,i[s+1]=l*f,i[s+n]=o*d,i[s+n+1]=l*f,i[s+2*n]=o*d,i[s+2*n+1]=h*f,i[s+3*n]=a*d,i[s+3*n+1]=h*f,s+=4*n}}uploadPosition(t,e,r,i,n,s){for(let o=0;o<r;o++){const r=t[e+o].position;i[s]=r.x,i[s+1]=r.y,i[s+n]=r.x,i[s+n+1]=r.y,i[s+2*n]=r.x,i[s+2*n+1]=r.y,i[s+3*n]=r.x,i[s+3*n+1]=r.y,s+=4*n}}uploadRotation(t,e,r,i,n,s){for(let o=0;o<r;o++){const r=t[e+o].rotation;i[s]=r,i[s+n]=r,i[s+2*n]=r,i[s+3*n]=r,s+=4*n}}uploadUvs(t,e,r,i,n,s){for(let o=0;o<r;++o){const r=t[e+o]._texture._uvs;r?(i[s]=r.x0,i[s+1]=r.y0,i[s+n]=r.x1,i[s+n+1]=r.y1,i[s+2*n]=r.x2,i[s+2*n+1]=r.y2,i[s+3*n]=r.x3,i[s+3*n+1]=r.y3,s+=4*n):(i[s]=0,i[s+1]=0,i[s+n]=0,i[s+n+1]=0,i[s+2*n]=0,i[s+2*n+1]=0,i[s+3*n]=0,i[s+3*n+1]=0,s+=4*n)}}uploadTint(t,e,r,i,n,s){for(let o=0;o<r;++o){const r=t[e+o],a=Pt.shared.setValue(r._tintRGB).toPremultiplied(r.alpha);i[s]=a,i[s+n]=a,i[s+2*n]=a,i[s+3*n]=a,s+=4*n}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Io.extension={name:"particle",type:Kt.RendererPlugin},Jt.add(Io);var Mo=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(Mo||{});const Bo={willReadFrequently:!0},Do=class{static get experimentalLetterSpacingSupported(){let t=Do._experimentalLetterSpacingSupported;if(void 0!==t){const e=T.ADAPTER.getCanvasRenderingContext2D().prototype;t=Do._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,r,i,n,s,o,a,h){this.text=t,this.style=e,this.width=r,this.height=i,this.lines=n,this.lineWidths=s,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=h}static measureText(t,e,r,i=Do._canvas){r=null==r?e.wordWrap:r;const n=e.toFontString(),s=Do.measureFont(n);0===s.fontSize&&(s.fontSize=e.fontSize,s.ascent=e.fontSize);const o=i.getContext("2d",Bo);o.font=n;const a=(r?Do.wordWrap(t,e,i):t).split(/(?:\r\n|\r|\n)/),h=new Array(a.length);let l=0;for(let t=0;t<a.length;t++){const r=Do._measureText(a[t],e.letterSpacing,o);h[t]=r,l=Math.max(l,r)}let c=l+e.strokeThickness;e.dropShadow&&(c+=e.dropShadowDistance);const u=e.lineHeight||s.fontSize+e.strokeThickness;let d=Math.max(u,s.fontSize+2*e.strokeThickness)+(a.length-1)*(u+e.leading);return e.dropShadow&&(d+=e.dropShadowDistance),new Do(t,e,c,d,a,h,u+e.leading,l,s)}static _measureText(t,e,r){let i=!1;Do.experimentalLetterSpacingSupported&&(Do.experimentalLetterSpacing?(r.letterSpacing=`${e}px`,r.textLetterSpacing=`${e}px`,i=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let n=r.measureText(t).width;return n>0&&(i?n-=e:n+=(Do.graphemeSegmenter(t).length-1)*e),n}static wordWrap(t,e,r=Do._canvas){const i=r.getContext("2d",Bo);let n=0,s="",o="";const a=Object.create(null),{letterSpacing:h,whiteSpace:l}=e,c=Do.collapseSpaces(l),u=Do.collapseNewlines(l);let d=!c;const f=e.wordWrapWidth+h,p=Do.tokenize(t);for(let t=0;t<p.length;t++){let r=p[t];if(Do.isNewline(r)){if(!u){o+=Do.addLine(s),d=!c,s="",n=0;continue}r=" "}if(c){const t=Do.isBreakingSpace(r),e=Do.isBreakingSpace(s[s.length-1]);if(t&&e)continue}const l=Do.getFromCache(r,h,a,i);if(l>f)if(""!==s&&(o+=Do.addLine(s),s="",n=0),Do.canBreakWords(r,e.breakWords)){const t=Do.wordWrapSplit(r);for(let l=0;l<t.length;l++){let c=t[l],u=c,p=1;for(;t[l+p];){const i=t[l+p];if(Do.canBreakChars(u,i,r,l,e.breakWords))break;c+=i,u=i,p++}l+=p-1;const m=Do.getFromCache(c,h,a,i);m+n>f&&(o+=Do.addLine(s),d=!1,s="",n=0),s+=c,n+=m}}else{s.length>0&&(o+=Do.addLine(s),s="",n=0);const e=t===p.length-1;o+=Do.addLine(r,!e),d=!1,s="",n=0}else l+n>f&&(d=!1,o+=Do.addLine(s),s="",n=0),(s.length>0||!Do.isBreakingSpace(r)||d)&&(s+=r,n+=l)}return o+=Do.addLine(s,!1),o}static addLine(t,e=!0){return t=Do.trimRight(t),e?`${t}\n`:t}static getFromCache(t,e,r,i){let n=r[t];return"number"!=typeof n&&(n=Do._measureText(t,e,i)+e,r[t]=n),n}static collapseSpaces(t){return"normal"===t||"pre-line"===t}static collapseNewlines(t){return"normal"===t}static trimRight(t){if("string"!=typeof t)return"";for(let e=t.length-1;e>=0;e--){const r=t[e];if(!Do.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static isNewline(t){return"string"==typeof t&&Do._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return"string"==typeof t&&Do._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let r="";if("string"!=typeof t)return e;for(let i=0;i<t.length;i++){const n=t[i],s=t[i+1];Do.isBreakingSpace(n,s)||Do.isNewline(n)?(""!==r&&(e.push(r),r=""),e.push(n)):r+=n}return""!==r&&e.push(r),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,i,n){return!0}static wordWrapSplit(t){return Do.graphemeSegmenter(t)}static measureFont(t){if(Do._fonts[t])return Do._fonts[t];const e={ascent:0,descent:0,fontSize:0},r=Do._canvas,i=Do._context;i.font=t;const n=Do.METRICS_STRING+Do.BASELINE_SYMBOL,s=Math.ceil(i.measureText(n).width);let o=Math.ceil(i.measureText(Do.BASELINE_SYMBOL).width);const a=Math.ceil(Do.HEIGHT_MULTIPLIER*o);if(o=o*Do.BASELINE_MULTIPLIER|0,0===s||0===a)return Do._fonts[t]=e,e;r.width=s,r.height=a,i.fillStyle="#f00",i.fillRect(0,0,s,a),i.font=t,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(n,0,o);const h=i.getImageData(0,0,s,a).data,l=h.length,c=4*s;let u=0,d=0,f=!1;for(u=0;u<o;++u){for(let t=0;t<c;t+=4)if(255!==h[d+t]){f=!0;break}if(f)break;d+=c}for(e.ascent=o-u,d=l-c,f=!1,u=a;u>o;--u){for(let t=0;t<c;t+=4)if(255!==h[d+t]){f=!0;break}if(f)break;d-=c}return e.descent=u-o,e.fontSize=e.ascent+e.descent,Do._fonts[t]=e,e}static clearMetrics(t=""){t?delete Do._fonts[t]:Do._fonts={}}static get _canvas(){if(!Do.__canvas){let t;try{const e=new OffscreenCanvas(0,0),r=e.getContext("2d",Bo);if(r?.measureText)return Do.__canvas=e,e;t=T.ADAPTER.createCanvas()}catch(e){t=T.ADAPTER.createCanvas()}t.width=t.height=10,Do.__canvas=t}return Do.__canvas}static get _context(){return Do.__context||(Do.__context=Do._canvas.getContext("2d",Bo)),Do.__context}};let jo=Do;jo.METRICS_STRING="|q",jo.BASELINE_SYMBOL="M",jo.BASELINE_MULTIPLIER=1.4,jo.HEIGHT_MULTIPLIER=2,jo.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),jo.experimentalLetterSpacing=!1,jo._fonts={},jo._newlines=[10,13],jo._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const ko=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],No=class{constructor(t){this.styleID=0,this.reset(),Uo(this,t,t)}clone(){const t={};return Uo(t,this,No.defaultStyle),new No(t)}reset(){Uo(this,No.defaultStyle,No.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=Fo(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=Fo(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=Fo(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let t=e.length-1;t>=0;t--){let r=e[t].trim();/([\"\'])[^\'\"]+\1/.test(r)||ko.includes(r)||(r=`"${r}"`),e[t]=r}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};let Lo=No;function Fo(t){const e=Pt.shared;return Array.isArray(t)?t.map((t=>e.setValue(t).toHex())):e.setValue(t).toHex()}function Uo(t,e,r){for(const i in r)Array.isArray(e[i])?t[i]=e[i].slice():t[i]=e[i]}Lo.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Mo.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};const Go={texture:!0,children:!1,baseTexture:!0},zo=class extends on{constructor(t,e,r){let i=!1;r||(r=T.ADAPTER.createCanvas(),i=!0),r.width=3,r.height=3;const n=Cr.from(r);n.orig=new Oe,n.trim=new Oe,super(n),this._ownCanvas=i,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=zo.defaultResolution??T.RESOLUTION,this._autoResolution=zo.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return jo.experimentalLetterSpacing}static set experimentalLetterSpacing(t){K("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),jo.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const r=this.context,i=jo.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=i.width,s=i.height,o=i.lines,a=i.lineHeight,h=i.lineWidths,l=i.maxLineWidth,c=i.fontProperties;let u,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,s)+2*e.padding)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=e.strokeThickness,r.textBaseline=e.textBaseline,r.lineJoin=e.lineJoin,r.miterLimit=e.miterLimit;const f=e.dropShadow?2:1;for(let t=0;t<f;++t){const n=e.dropShadow&&0===t,f=n?Math.ceil(Math.max(1,s)+2*e.padding):0,p=f*this._resolution;if(n){r.fillStyle="black",r.strokeStyle="black";const t=e.dropShadowColor,i=e.dropShadowBlur*this._resolution,n=e.dropShadowDistance*this._resolution;r.shadowColor=Pt.shared.setValue(t).setAlpha(e.dropShadowAlpha).toRgbaString(),r.shadowBlur=i,r.shadowOffsetX=Math.cos(e.dropShadowAngle)*n,r.shadowOffsetY=Math.sin(e.dropShadowAngle)*n+p}else r.fillStyle=this._generateFillStyle(e,o,i),r.strokeStyle=e.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let m=(a-c.fontSize)/2;a-c.fontSize<0&&(m=0);for(let t=0;t<o.length;t++)u=e.strokeThickness/2,d=e.strokeThickness/2+t*a+c.ascent+m,"right"===e.align?u+=l-h[t]:"center"===e.align&&(u+=(l-h[t])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[t],u+e.padding,d+e.padding-f,!0),e.fill&&this.drawLetterSpacing(o[t],u+e.padding,d+e.padding-f)}this.updateTexture()}drawLetterSpacing(t,e,r,i=!1){const n=this._style.letterSpacing;let s=!1;if(jo.experimentalLetterSpacingSupported&&(jo.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,s=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===n||s)return void(i?this.context.strokeText(t,e,r):this.context.fillText(t,e,r));let o=e;const a=jo.graphemeSegmenter(t);let h=this.context.measureText(t).width,l=0;for(let t=0;t<a.length;++t){const e=a[t];i?this.context.strokeText(e,o,r):this.context.fillText(e,o,r);let s="";for(let e=t+1;e<a.length;++e)s+=a[e];l=this.context.measureText(s).width,o+=h-l+n,h=l}}updateTexture(){const t=this.canvas;if(this._style.trim){const e=function(t){const e=function(t){const{width:e,height:r}=t,i=t.getContext("2d",{willReadFrequently:!0});if(null===i)throw new TypeError("Failed to get canvas 2D context");const n=i.getImageData(0,0,e,r).data;let s=0,o=0,a=e-1,h=r-1;for(;o<r&&Wt(n,e,o);)++o;if(o===r)return Gt.EMPTY;for(;Wt(n,e,h);)--h;for(;Yt(n,e,s,o,h);)++s;for(;Yt(n,e,a,o,h);)--a;return++a,++h,new Gt(s,o,a,h)}(t),{width:r,height:i}=e;let n=null;if(!e.isEmpty()){const s=t.getContext("2d");if(null===s)throw new TypeError("Failed to get canvas 2D context");n=s.getImageData(e.left,e.top,r,i)}return{width:r,height:i,data:n}}(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}const e=this._texture,r=this._style,i=r.trim?0:r.padding,n=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-i,e.trim.y=-i,e.orig.width=e._frame.width-2*i,e.orig.height=e._frame.height-2*i,this._onTextureUpdate(),n.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),-1===this._textureID&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,r){const i=t.fill;if(!Array.isArray(i))return i;if(1===i.length)return i[0];let n;const s=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,a=this.canvas.width/this._resolution-s-2*o,h=this.canvas.height/this._resolution-s-2*o,l=i.slice(),c=t.fillGradientStops.slice();if(!c.length){const t=l.length+1;for(let e=1;e<t;++e)c.push(e/t)}if(l.unshift(i[0]),c.unshift(0),l.push(i[i.length-1]),c.push(1),t.fillGradientType===Mo.LINEAR_VERTICAL){n=this.context.createLinearGradient(a/2,o,a/2,h+o);const i=r.fontProperties.fontSize+t.strokeThickness;for(let t=0;t<e.length;t++){const s=r.lineHeight*(t-1)+i,o=r.lineHeight*t;let a=o;t>0&&s>o&&(a=(o+s)/2);const u=o+i,d=r.lineHeight*(t+1);let f=u;t+1<e.length&&d<u&&(f=(u+d)/2);const p=(f-a)/h;for(let t=0;t<l.length;t++){let e=0;e="number"==typeof c[t]?c[t]:t/l.length;let r=Math.min(1,Math.max(0,a/h+e*p));r=Number(r.toFixed(5)),n.addColorStop(r,l[t])}}}else{n=this.context.createLinearGradient(o,h/2,a+o,h/2);const t=l.length+1;let e=1;for(let r=0;r<l.length;r++){let i;i="number"==typeof c[r]?c[r]:e/t,n.addColorStop(i,l[r]),e++}}return n}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Go,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=Nt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=Nt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},this._style=t instanceof Lo?t:new Lo(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};let Ho=zo;Ho.defaultAutoResolution=!0;class Xo{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Vo(t,e){let r=!1;if(t?._textures?.length)for(let i=0;i<t._textures.length;i++)if(t._textures[i]instanceof Cr){const n=t._textures[i].baseTexture;e.includes(n)||(e.push(n),r=!0)}return r}function Wo(t,e){if(t.baseTexture instanceof ue){const r=t.baseTexture;return e.includes(r)||e.push(r),!0}return!1}function Yo(t,e){if(t._texture&&t._texture instanceof Cr){const r=t._texture.baseTexture;return e.includes(r)||e.push(r),!0}return!1}function $o(t,e){return e instanceof Ho&&(e.updateText(!0),!0)}function qo(t,e){if(e instanceof Lo){const t=e.toFontString();return jo.measureFont(t),!0}return!1}function Ko(t,e){if(t instanceof Ho){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);const r=t._texture.baseTexture;return e.includes(r)||e.push(r),!0}return!1}function Zo(t,e){return t instanceof Lo&&(e.includes(t)||e.push(t),!0)}const Qo=class{constructor(t){this.limiter=new Xo(Qo.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Ko),this.registerFindHook(Zo),this.registerFindHook(Vo),this.registerFindHook(Wo),this.registerFindHook(Yo),this.registerUploadHook($o),this.registerUploadHook(qo)}upload(t){return new Promise((e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Mi.system.addOnce(this.tick,this,Ci.UTILITY))):e()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let r=0,i=this.uploadHooks.length;r<i;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)Mi.system.addOnce(this.tick,this,Ci.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,r=t.length;e<r;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof rn)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Mi.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let Jo=Qo;function ta(t,e){return e instanceof ue&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function ea(t,e){if(!(e instanceof wo))return!1;const{geometry:r}=e;e.finishPoly(),r.updateBatches();const{batches:i}=r;for(let e=0;e<i.length;e++){const{texture:r}=i[e].style;r&&ta(t,r.baseTexture)}return r.batchable||t.geometry.bind(r,e._resolveDirectShader(t)),!0}function ra(t,e){return t instanceof wo&&(e.push(t),!0)}Jo.uploadsPerFrame=4,Object.defineProperties(T,{UPLOADS_PER_FRAME:{get:()=>Jo.uploadsPerFrame,set(t){K("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Jo.uploadsPerFrame=t}}});class ia extends Jo{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(ra),this.registerUploadHook(ta),this.registerUploadHook(ea)}}ia.extension={name:"prepare",type:Kt.RendererSystem},Jt.add(ia);class na extends on{constructor(t,e=!0){super(t[0]instanceof Cr?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=e,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Mi.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Mi.shared.add(this.update,this,Ci.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=this.animationSpeed*t,r=this.currentFrame;if(null!==this._durations){let r=this._currentTime%1*this._durations[this.currentFrame];for(r+=e/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):r!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<r||this.animationSpeed<0&&this.currentFrame>r)&&this.onLoop(),this.updateTexture())}updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const e=[];for(let r=0;r<t.length;++r)e.push(Cr.from(t[r]));return new na(e)}static fromImages(t){const e=[];for(let r=0;r<t.length;++r)e.push(Cr.from(t[r]));return new na(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof Cr)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Mi.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Mi.shared.add(this.update,this),this._isConnectedToTicker=!0))}}new Se;var sa="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const oa=new Be;class aa extends dr{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Br,this.state=ie.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=lr.from(sa,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?lr.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):lr.from(sa,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,r=this.quad;let i=r.vertices;i[0]=i[6]=t._width*-t.anchor.x,i[1]=i[3]=t._height*-t.anchor.y,i[2]=i[4]=t._width*(1-t.anchor.x),i[5]=i[7]=t._height*(1-t.anchor.y);const n=t.uvRespectAnchor?t.anchor.x:0,s=t.uvRespectAnchor?t.anchor.y:0;i=r.uvs,i[0]=i[6]=-n,i[1]=i[3]=-s,i[2]=i[4]=1-n,i[5]=i[7]=1-s,r.invalidate();const o=t._texture,a=o.baseTexture,h=a.alphaMode>0,l=t.tileTransform.localTransform,c=t.uvMatrix;let u=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;u&&(a._glTextures[e.CONTEXT_UID]?u=a.wrapMode!==p.CLAMP:a.wrapMode===p.CLAMP&&(a.wrapMode=p.REPEAT));const d=u?this.simpleShader:this.shader,f=o.width,m=o.height,g=t._width,y=t._height;oa.set(l.a*f/g,l.b*f/y,l.c*m/g,l.d*m/y,l.tx/g,l.ty/y),oa.invert(),u?oa.prepend(c.mapCoord):(d.uniforms.uMapCoord=c.mapCoord.toArray(!0),d.uniforms.uClampFrame=c.uClampFrame,d.uniforms.uClampOffset=c.uClampOffset),d.uniforms.uTransform=oa.toArray(!0),d.uniforms.uColor=Pt.shared.setValue(t.tint).premultiply(t.worldAlpha,h).toArray(d.uniforms.uColor),d.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),d.uniforms.uSampler=o,e.shader.bind(d),e.geometry.bind(r),this.state.blendMode=It(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}aa.extension={name:"tilingSprite",type:Kt.RendererPlugin},Jt.add(aa);const ha=class{constructor(t,e,r=null){this.linkedSheets=[],this._texture=t instanceof Cr?t:null,this.baseTexture=t instanceof ue?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const i=this.baseTexture.resource;this.resolution=this._updateResolution(r||(i?i.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let r=qt(t,null);return null===r&&(r=parseFloat(e??"1")),1!==r&&this.baseTexture.setResolution(r),r}parse(){return new Promise((t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=ha.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(t){let e=t;const r=ha.BATCH_SIZE;for(;e-t<r&&e<this._frameKeys.length;){const t=this._frameKeys[e],r=this._frames[t],i=r.frame;if(i){let e=null,n=null;const s=!1!==r.trimmed&&r.sourceSize?r.sourceSize:r.frame,o=new Oe(0,0,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution);e=r.rotated?new Oe(Math.floor(i.x)/this.resolution,Math.floor(i.y)/this.resolution,Math.floor(i.h)/this.resolution,Math.floor(i.w)/this.resolution):new Oe(Math.floor(i.x)/this.resolution,Math.floor(i.y)/this.resolution,Math.floor(i.w)/this.resolution,Math.floor(i.h)/this.resolution),!1!==r.trimmed&&r.spriteSourceSize&&(n=new Oe(Math.floor(r.spriteSourceSize.x)/this.resolution,Math.floor(r.spriteSourceSize.y)/this.resolution,Math.floor(i.w)/this.resolution,Math.floor(i.h)/this.resolution)),this.textures[t]=new Cr(this.baseTexture,e,o,n,r.rotated?2:0,r.anchor,r.borders),Cr.addToCache(this.textures[t],t)}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let r=0;r<t[e].length;r++){const i=t[e][r];this.animations[e].push(this.textures[i])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*ha.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*ha.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(t=!1){for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let la=ha;la.BATCH_SIZE=1e3;const ca=["jpg","png","jpeg","avif","webp"];function ua(t,e,r){const i={};if(t.forEach((t=>{i[t]=e})),Object.keys(e.textures).forEach((t=>{i[t]=e.textures[t]})),!r){const r=$.dirname(t[0]);e.linkedSheets.forEach(((t,n)=>{const s=ua([`${r}/${e.data.meta.related_multi_packs[n]}`],t,!0);Object.assign(i,s)}))}return i}const da={extension:Kt.Asset,cache:{test:t=>t instanceof la,getCacheableAssets:(t,e)=>ua(t,e,!1)},resolver:{test:t=>{const e=t.split("?")[0].split("."),r=e.pop(),i=e.pop();return"json"===r&&ca.includes(i)},parse:t=>{const e=t.split(".");return{resolution:parseFloat(T.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{extension:{type:Kt.LoadParser,priority:Ln.Normal},testParse:async(t,e)=>".json"===$.extname(e.src).toLowerCase()&&!!t.frames,async parse(t,e,r){let i=$.dirname(e.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let n=i+t.meta.image;n=fs(n,e.src);const s=(await r.load([n]))[n],o=new la(s.baseTexture,t,e.src);await o.parse();const a=t?.meta?.related_multi_packs;if(Array.isArray(a)){const t=[];for(const n of a){if("string"!=typeof n)continue;let s=i+n;e.data?.ignoreMultiPack||(s=fs(s,e.src),t.push(r.load({src:s,data:{ignoreMultiPack:!0}})))}const n=await Promise.all(t);o.linkedSheets=n,n.forEach((t=>{t.linkedSheets=[o].concat(o.linkedSheets.filter((e=>e!==t)))}))}return o},unload(t){t.destroy(!0)}}};Jt.add(da);class fa{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class pa{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const t in e){const i=e[t].match(/^[a-z]+/gm)[0],n=e[t].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),s={};for(const t in n){const e=n[t].split("="),r=e[0],i=e[1].replace(/"/gm,""),o=parseFloat(i),a=isNaN(o)?i:o;s[r]=a}r[i].push(s)}const i=new fa;return r.info.forEach((t=>i.info.push({face:t.face,size:parseInt(t.size,10)}))),r.common.forEach((t=>i.common.push({lineHeight:parseInt(t.lineHeight,10)}))),r.page.forEach((t=>i.page.push({id:parseInt(t.id,10),file:t.file}))),r.char.forEach((t=>i.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)}))),r.kerning.forEach((t=>i.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)}))),r.distanceField.forEach((t=>i.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType}))),i}}class ma{static test(t){const e=t;return"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new fa,r=t.getElementsByTagName("info"),i=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),s=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),a=t.getElementsByTagName("distanceField");for(let t=0;t<r.length;t++)e.info.push({face:r[t].getAttribute("face"),size:parseInt(r[t].getAttribute("size"),10)});for(let t=0;t<i.length;t++)e.common.push({lineHeight:parseInt(i[t].getAttribute("lineHeight"),10)});for(let t=0;t<n.length;t++)e.page.push({id:parseInt(n[t].getAttribute("id"),10)||0,file:n[t].getAttribute("file")});for(let t=0;t<s.length;t++){const r=s[t];e.char.push({id:parseInt(r.getAttribute("id"),10),page:parseInt(r.getAttribute("page"),10)||0,x:parseInt(r.getAttribute("x"),10),y:parseInt(r.getAttribute("y"),10),width:parseInt(r.getAttribute("width"),10),height:parseInt(r.getAttribute("height"),10),xoffset:parseInt(r.getAttribute("xoffset"),10),yoffset:parseInt(r.getAttribute("yoffset"),10),xadvance:parseInt(r.getAttribute("xadvance"),10)})}for(let t=0;t<o.length;t++)e.kerning.push({first:parseInt(o[t].getAttribute("first"),10),second:parseInt(o[t].getAttribute("second"),10),amount:parseInt(o[t].getAttribute("amount"),10)});for(let t=0;t<a.length;t++)e.distanceField.push({fieldType:a[t].getAttribute("fieldType"),distanceRange:parseInt(a[t].getAttribute("distanceRange"),10)});return e}}class ga{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&ma.test(T.ADAPTER.parseXML(t))}static parse(t){return ma.parse(T.ADAPTER.parseXML(t))}}const ya=[pa,ma,ga];function va(t,e,r,i,n,s,o){const a=r.text,h=r.fontProperties;e.translate(i,n),e.scale(s,s);const l=o.strokeThickness/2,c=-o.strokeThickness/2;if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=function(t,e,r,i,n,s){const o=r.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const h=r.dropShadow?r.dropShadowDistance:0,l=r.padding||0,c=t.width/i-h-2*l,u=t.height/i-h-2*l,d=o.slice(),f=r.fillGradientStops.slice();if(!f.length){const t=d.length+1;for(let e=1;e<t;++e)f.push(e/t)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),r.fillGradientType===Mo.LINEAR_VERTICAL){a=e.createLinearGradient(c/2,l,c/2,u+l);let t=0;const i=(s.fontProperties.fontSize+r.strokeThickness)/u;for(let e=0;e<n.length;e++){const r=s.lineHeight*e;for(let e=0;e<d.length;e++){let n=0;n="number"==typeof f[e]?f[e]:e/d.length;const s=r/u+n*i;let o=Math.max(t,s);o=Math.min(o,1),a.addColorStop(o,d[e]),t=o}}}else{a=e.createLinearGradient(l,u/2,c+l,u/2);const t=d.length+1;let r=1;for(let e=0;e<d.length;e++){let i;i="number"==typeof f[e]?f[e]:r/t,a.addColorStop(i,d[e]),r++}}return a}(t,e,o,s,[a],r),e.strokeStyle=o.stroke,o.dropShadow){const t=o.dropShadowColor,r=o.dropShadowBlur*s,i=o.dropShadowDistance*s;e.shadowColor=Pt.shared.setValue(t).setAlpha(o.dropShadowAlpha).toRgbaString(),e.shadowBlur=r,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*i,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*i}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,l,c+r.lineHeight-h.descent),o.fill&&e.fillText(a,l,c+r.lineHeight-h.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function ba(t){return Array.from?Array.from(t):t.split("")}function xa(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}const _a=class{constructor(t,e,r){const[i]=t.info,[n]=t.common,[s]=t.page,[o]=t.distanceField,a=qt(s.file),h={};this._ownsTextures=r,this.font=i.face,this.size=i.size,this.lineHeight=n.lineHeight/a,this.chars={},this.pageTextures=h;for(let r=0;r<t.page.length;r++){const{id:i,file:n}=t.page[r];h[i]=e instanceof Array?e[r]:e[n],o?.fieldType&&"none"!==o.fieldType&&(h[i].baseTexture.alphaMode=g.NO_PREMULTIPLIED_ALPHA,h[i].baseTexture.mipmap=m.OFF)}for(let e=0;e<t.char.length;e++){const{id:r,page:i}=t.char[e];let{x:n,y:s,width:o,height:l,xoffset:c,yoffset:u,xadvance:d}=t.char[e];n/=a,s/=a,o/=a,l/=a,c/=a,u/=a,d/=a;const f=new Oe(n+h[i].frame.x/a,s+h[i].frame.y/a,o,l);this.chars[r]={xOffset:c,yOffset:u,xAdvance:d,kerning:{},texture:new Cr(h[i].baseTexture,f),page:i}}for(let e=0;e<t.kerning.length;e++){let{first:r,second:i,amount:n}=t.kerning[e];r/=a,i/=a,n/=a,this.chars[i]&&(this.chars[i].kerning[r]=n)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,r){let i;if(t instanceof fa)i=t;else{const e=function(t){for(let e=0;e<ya.length;e++)if(ya[e].test(t))return ya[e];return null}(t);if(!e)throw new Error("Unrecognized data format for font.");i=e.parse(t)}e instanceof Cr&&(e=[e]);const n=new _a(i,e,r);return _a.available[n.font]=n,n}static uninstall(t){const e=_a.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete _a.available[t]}static from(t,e,r){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:i,padding:n,resolution:s,textureWidth:o,textureHeight:a,...h}=Object.assign({},_a.defaultOptions,r),l=function(t){"string"==typeof t&&(t=[t]);const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];if(Array.isArray(i)){if(2!==i.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);const t=i[0].charCodeAt(0),r=i[1].charCodeAt(0);if(r<t)throw new Error("[BitmapFont]: Invalid character range.");for(let i=t,n=r;i<=n;i++)e.push(String.fromCharCode(i))}else e.push(...ba(i))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(i),c=e instanceof Lo?e:new Lo(e),u=o,d=new fa;d.info[0]={face:c.fontFamily,size:c.fontSize},d.common[0]={lineHeight:c.fontSize};let f,p,m,g=0,y=0,v=0;const b=[],x=[];for(let t=0;t<l.length;t++){f||(f=T.ADAPTER.createCanvas(),f.width=o,f.height=a,p=f.getContext("2d"),m=new ue(f,{resolution:s,...h}),b.push(m),x.push(new Cr(m)),d.page.push({id:x.length-1,file:""}));const e=l[t],r=jo.measureText(e,c,!1,f),i=r.width,_=Math.ceil(r.height),w=Math.ceil(("italic"===c.fontStyle?2:1)*i);if(y>=a-_*s){if(0===y)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${e}')`);--t,f=null,p=null,m=null,y=0,g=0,v=0;continue}if(v=Math.max(_+r.fontProperties.descent,v),w*s+g>=u){if(0===g)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${e}')`);--t,y+=v*s,y=Math.ceil(y),g=0,v=0;continue}va(f,p,r,g,y,s,c);const E=xa(r.text);d.char.push({id:E,page:x.length-1,x:g/s,y:y/s,width:w,height:_,xoffset:0,yoffset:0,xadvance:i-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),g+=(w+2*n)*s,g=Math.ceil(g)}for(let t=0,e=l.length;t<e;t++){const r=l[t];for(let t=0;t<e;t++){const e=l[t],i=p.measureText(r).width,n=p.measureText(e).width,s=p.measureText(r+e).width-(i+n);s&&d.kerning.push({first:xa(r),second:xa(e),amount:s})}}const _=new _a(d,x,!0);return void 0!==_a.available[t]&&_a.uninstall(t),_a.available[t]=_,_}};let wa=_a;wa.ALPHA=[["a","z"],["A","Z"]," "],wa.NUMERIC=[["0","9"]],wa.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],wa.ASCII=[[" ","~"]],wa.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:_a.ALPHANUMERIC},wa.available={};const Ea=[],Ta=[],Aa=[],Sa=class extends rn{constructor(t,e={}){super(),this._tint=16777215;const{align:r,tint:i,maxWidth:n,letterSpacing:s,fontName:o,fontSize:a}=Object.assign({},Sa.styleDefaults,e);if(!wa.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tint=i,this._font=void 0,this._fontName=o,this._fontSize=a,this.text=t,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=s,this._anchor=new ze((()=>{this.dirty=!0}),this,0,0),this._roundPixels=T.ROUND_PIXELS,this.dirty=!0,this._resolution=T.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const t=wa.available[this._fontName],e=this.fontSize,r=e/t.size,i=new Se,n=[],s=[],o=[],h=ba(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),l=this._maxWidth*t.size/e,c="none"===t.distanceFieldType?Ea:Ta;let u=null,d=0,f=0,p=0,m=-1,g=0,y=0,v=0,b=0;for(let e=0;e<h.length;e++){const r=h[e],a=xa(r);if(/(?:\s)/.test(r)&&(m=e,g=d,b++),"\r"===r||"\n"===r){s.push(d),o.push(-1),f=Math.max(f,d),++p,++y,i.x=0,i.y+=t.lineHeight,u=null,b=0;continue}const c=t.chars[a];if(!c)continue;u&&c.kerning[u]&&(i.x+=c.kerning[u]);const x=Aa.pop()||{texture:Cr.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Se};x.texture=c.texture,x.line=p,x.charCode=a,x.position.x=Math.round(i.x+c.xOffset+this._letterSpacing/2),x.position.y=Math.round(i.y+c.yOffset),x.prevSpaces=b,n.push(x),d=x.position.x+Math.max(c.xAdvance-c.xOffset,c.texture.orig.width),i.x+=c.xAdvance+this._letterSpacing,v=Math.max(v,c.yOffset+c.texture.height),u=a,-1!==m&&l>0&&i.x>l&&(++y,kt(n,1+m-y,1+e-m),e=m,m=-1,s.push(g),o.push(n.length>0?n[n.length-1].prevSpaces:0),f=Math.max(f,g),p++,i.x=0,i.y+=t.lineHeight,u=null,b=0)}const x=h[h.length-1];"\r"!==x&&"\n"!==x&&(/(?:\s)/.test(x)&&(d=g),s.push(d),f=Math.max(f,d),o.push(-1));const _=[];for(let t=0;t<=p;t++){let e=0;"right"===this._align?e=f-s[t]:"center"===this._align?e=(f-s[t])/2:"justify"===this._align&&(e=o[t]<0?0:(f-s[t])/o[t]),_.push(e)}const w=n.length,E={},T=[],A=this._activePagesMeshData;c.push(...A);for(let e=0;e<w;e++){const r=n[e].texture,i=r.baseTexture.uid;if(!E[i]){let e=c.pop();if(!e){const r=new Oo;let i,n;"none"===t.distanceFieldType?(i=new Co(Cr.EMPTY),n=a.NORMAL):(i=new Co(Cr.EMPTY,{program:or.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r\n\r\n}\r\n"),uniforms:{uFWidth:0}}),n=a.NORMAL_NPM);const s=new Po(r,i);s.blendMode=n,e={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:s,vertices:null,uvs:null,indices:null}}e.index=0,e.indexCount=0,e.vertexCount=0,e.uvsCount=0,e.total=0;const{_textureCache:n}=this;n[i]=n[i]||new Cr(r.baseTexture),e.mesh.texture=n[i],e.mesh.tint=this._tint,T.push(e),E[i]=e}E[i].total++}for(let t=0;t<A.length;t++)T.includes(A[t])||this.removeChild(A[t].mesh);for(let t=0;t<T.length;t++)T[t].mesh.parent!==this&&this.addChild(T[t].mesh);this._activePagesMeshData=T;for(const t in E){const e=E[t],r=e.total;if(!(e.indices?.length>6*r)||e.vertices.length<2*Po.BATCHABLE_SIZE)e.vertices=new Float32Array(8*r),e.uvs=new Float32Array(8*r),e.indices=new Uint16Array(6*r);else{const t=e.total,r=e.vertices;for(let e=4*t*2;e<r.length;e++)r[e]=0}e.mesh.size=6*r}for(let t=0;t<w;t++){const e=n[t];let i=e.position.x+_[e.line]*("justify"===this._align?e.prevSpaces:1);this._roundPixels&&(i=Math.round(i));const s=i*r,o=e.position.y*r,a=e.texture,h=E[a.baseTexture.uid],l=a.frame,c=a._uvs,u=h.index++;h.indices[6*u+0]=0+4*u,h.indices[6*u+1]=1+4*u,h.indices[6*u+2]=2+4*u,h.indices[6*u+3]=0+4*u,h.indices[6*u+4]=2+4*u,h.indices[6*u+5]=3+4*u,h.vertices[8*u+0]=s,h.vertices[8*u+1]=o,h.vertices[8*u+2]=s+l.width*r,h.vertices[8*u+3]=o,h.vertices[8*u+4]=s+l.width*r,h.vertices[8*u+5]=o+l.height*r,h.vertices[8*u+6]=s,h.vertices[8*u+7]=o+l.height*r,h.uvs[8*u+0]=c.x0,h.uvs[8*u+1]=c.y0,h.uvs[8*u+2]=c.x1,h.uvs[8*u+3]=c.y1,h.uvs[8*u+4]=c.x2,h.uvs[8*u+5]=c.y2,h.uvs[8*u+6]=c.x3,h.uvs[8*u+7]=c.y3}this._textWidth=f*r,this._textHeight=(i.y+t.lineHeight)*r;for(const t in E){const e=E[t];if(0!==this.anchor.x||0!==this.anchor.y){let t=0;const r=this._textWidth*this.anchor.x,i=this._textHeight*this.anchor.y;for(let n=0;n<e.total;n++)e.vertices[t++]-=r,e.vertices[t++]-=i,e.vertices[t++]-=r,e.vertices[t++]-=i,e.vertices[t++]-=r,e.vertices[t++]-=i,e.vertices[t++]-=r,e.vertices[t++]-=i}this._maxLineHeight=v*r;const i=e.mesh.geometry.getBuffer("aVertexPosition"),n=e.mesh.geometry.getBuffer("aTextureCoord"),s=e.mesh.geometry.getIndex();i.data=e.vertices,n.data=e.uvs,s.data=e.indices,i.update(),n.update(),s.update()}for(let t=0;t<n.length;t++)Aa.push(n[t]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:r,size:i}=wa.available[this._fontName];if("none"!==r){const{a:r,b:n,c:s,d:o}=this.worldTransform,a=Math.sqrt(r*r+n*n),h=Math.sqrt(s*s+o*o),l=(Math.abs(a)+Math.abs(h))/2,c=this.fontSize/i,u=t._view.resolution;for(const t of this._activePagesMeshData)t.mesh.shader.uniforms.uFWidth=l*e*c*u}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=wa.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(t){if(this._tint!==t){this._tint=t;for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!wa.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??wa.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,r="none"===wa.available[this._fontName].distanceFieldType?Ea:Ta;r.push(...this._activePagesMeshData);for(const t of this._activePagesMeshData)this.removeChild(t.mesh);this._activePagesMeshData=[],r.filter((t=>e[t.mesh.texture.baseTexture.uid])).forEach((t=>{t.mesh.texture=Cr.EMPTY}));for(const t in e)e[t].destroy(),delete e[t];this._font=null,this._textureCache=null,super.destroy(t)}};Sa.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const Pa=[".xml",".fnt"],Oa={extension:{type:Kt.LoadParser,priority:Ln.Normal},test:t=>Pa.includes($.extname(t).toLowerCase()),testParse:async t=>pa.test(t)||ga.test(t),async parse(t,e,r){const i=pa.test(t)?pa.parse(t):ga.parse(t),{src:n}=e,{page:s}=i,o=[];for(let t=0;t<s.length;++t){const e=s[t].file;let r=$.join($.dirname(n),e);r=fs(r,n),o.push(r)}const a=await r.load(o),h=o.map((t=>a[t]));return wa.install(i,h,!0)},load:async(t,e)=>(await T.ADAPTER.fetch(t)).text(),unload(t){t.destroy()}};Jt.add(Oa);const Ca=class extends Lo{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new Ca(Object.keys(Ca.defaultOptions).reduce(((e,r)=>({...e,[r]:t[r]})),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach((t=>{URL.revokeObjectURL(t.src),t.refs--,0===t.refs&&(t.fontFace&&document.fonts.delete(t.fontFace),delete Ca.availableFonts[t.originalUrl])})),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:r}=Ca;if(r[t]){const e=r[t];return this._fonts.push(e),e.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return T.ADAPTER.fetch(t).then((t=>t.blob())).then((async t=>new Promise(((e,r)=>{const i=URL.createObjectURL(t),n=new FileReader;n.onload=()=>e([i,n.result]),n.onerror=r,n.readAsDataURL(t)})))).then((async([i,n])=>{const s=Object.assign({family:$.basename(t,$.extname(t)),weight:"normal",style:"normal",src:i,dataSrc:n,refs:1,originalUrl:t,fontFace:null},e);r[t]=s,this._fonts.push(s),this.styleID++;const o=new FontFace(s.family,`url(${s.src})`,{weight:s.weight,style:s.style});s.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(...t){const e=t.filter((t=>!this._overrides.includes(t)));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter((t=>this._overrides.includes(t)));e.length>0&&(this._overrides=this._overrides.filter((t=>!e.includes(t))),this.styleID++)}toCSS(t){return["display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize*t}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing*t}px`,`text-align: ${this.align}`,`padding: ${this.padding*t}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight*t}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth*t}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness*t}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness*t}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS(t)]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(((t,e)=>`${t}\n            @font-face {\n                font-family: "${e.family}";\n                src: url('${e.dataSrc}');\n                font-weight: ${e.weight};\n                font-style: ${e.style}; \n            }`),this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=Ct(t)),"number"==typeof t?(e=t,K("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Pt.shared.setValue(e).toHex()):t;var e}dropShadowToCSS(t){let e=this.normalizeColor(this.dropShadowColor);const r=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),n=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&r<1&&(e+=(255*r|0).toString(16).padStart(2,"0"));const s=`${i*t}px ${n*t}px`;return this.dropShadowBlur>0?`text-shadow: ${s} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${s} ${e}`}reset(){Object.assign(this,Ca.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise((t=>setTimeout(t,100))):Promise.resolve()}get isSafari(){const{userAgent:t}=T.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};let Ra=Ca;Ra.availableFonts={},Ra.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const Ia=class extends on{constructor(t="",e={}){super(Cr.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const r=new Image,i=Cr.from(r,{scaleMode:T.SCALE_MODE,resourceOptions:{autoLoad:!1}});i.orig=new Oe,i.trim=new Oe,this.texture=i;const n="http://www.w3.org/2000/svg",s="http://www.w3.org/1999/xhtml",o=document.createElementNS(n,"svg"),a=document.createElementNS(n,"foreignObject"),h=document.createElementNS(s,"div"),l=document.createElementNS(s,"style");a.setAttribute("width","10000"),a.setAttribute("height","10000"),a.style.overflow="hidden",o.appendChild(a),this.maxWidth=Ia.defaultMaxWidth,this.maxHeight=Ia.defaultMaxHeight,this._domElement=h,this._styleElement=l,this._svgRoot=o,this._foreignObject=a,this._foreignObject.appendChild(l),this._foreignObject.appendChild(h),this._image=r,this._autoResolution=Ia.defaultAutoResolution,this._resolution=Ia.defaultResolution??T.RESOLUTION,this.text=t,this.style=e}measureText(t){const{text:e,style:r,resolution:i}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:r.toCSS(i)}),this._styleElement.textContent=r.toGlobalCSS(),document.body.appendChild(this._svgRoot);const n=this._domElement.getBoundingClientRect();this._svgRoot.remove();const s=Math.min(this.maxWidth,Math.ceil(n.width)),o=Math.min(this.maxHeight,Math.ceil(n.height));return this._svgRoot.setAttribute("width",s.toString()),this._svgRoot.setAttribute("height",o.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),r!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(i)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:s+2*r.padding,height:o+2*r.padding}}async updateText(t=!0){const{style:e,_image:r}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:i,height:n}=this.measureText();r.width=Math.ceil(Math.max(1,i)),r.height=Math.ceil(Math.max(1,n)),this._loading||(this._loading=!0,await new Promise((t=>{r.onload=async()=>{await e.onBeforeDraw(),this._loading=!1,this.updateTexture(),t()};const i=(new XMLSerializer).serializeToString(this._svgRoot);r.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(i)}`})))}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:r,resolution:i}=this,{padding:n}=t,{baseTexture:s}=e;e.trim.width=e._frame.width=r.width/i,e.trim.height=e._frame.height=r.height/i,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-2*n,e.orig.height=e._frame.height-2*n,this._onTextureUpdate(),s.setRealSize(r.width,r.height,i),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Ia.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=e,this._svgRoot?.remove(),this._svgRoot=e,this._domElement?.remove(),this._domElement=e,this._foreignObject?.remove(),this._foreignObject=e,this._styleElement?.remove(),this._styleElement=e,this._image.onload=null,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=Nt(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=Nt(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&((t=t||{})instanceof Ra?(this.ownsStyle=!1,this._style=t):t instanceof Lo?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=Ra.from(t)):(this.ownsStyle=!0,this._style=new Ra(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(""===t||null==t?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let Ma=Ia;Ma.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Ma.defaultMaxWidth=2024,Ma.defaultMaxHeight=2024,Ma.defaultAutoResolution=!0,r.p;var Ba=r(379),Da=r.n(Ba),ja=r(795),ka=r.n(ja),Na=r(569),La=r.n(Na),Fa=r(565),Ua=r.n(Fa),Ga=r(216),za=r.n(Ga),Ha=r(589),Xa=r.n(Ha),Va=r(9),Wa={};Wa.styleTagTransform=Xa(),Wa.setAttributes=Ua(),Wa.insert=La().bind(null,"head"),Wa.domAPI=ka(),Wa.insertStyleElement=za(),Da()(Va.Z,Wa),Va.Z&&Va.Z.locals&&Va.Z.locals;class Ya extends gr{constructor(t,e=.05,r=t.length){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform float epsilon;\n\nconst int MAX_COLORS = %maxColors%;\n\nuniform vec3 originalColors[MAX_COLORS];\nuniform vec3 targetColors[MAX_COLORS];\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\n\n    float alpha = gl_FragColor.a;\n    if (alpha < 0.0001)\n    {\n      return;\n    }\n\n    vec3 color = gl_FragColor.rgb / alpha;\n\n    for(int i = 0; i < MAX_COLORS; i++)\n    {\n      vec3 origColor = originalColors[i];\n      if (origColor.r < 0.0)\n      {\n        break;\n      }\n      vec3 colorDiff = origColor - color;\n      if (length(colorDiff) < epsilon)\n      {\n        vec3 targetColor = targetColors[i];\n        gl_FragColor = vec4((targetColor + colorDiff) * alpha, alpha);\n        return;\n      }\n    }\n}\n".replace(/%maxColors%/g,r.toFixed(0))),this._replacements=[],this._maxColors=0,this.epsilon=e,this._maxColors=r,this.uniforms.originalColors=new Float32Array(3*r),this.uniforms.targetColors=new Float32Array(3*r),this.replacements=t}set replacements(t){const e=this.uniforms.originalColors,r=this.uniforms.targetColors,i=t.length;if(i>this._maxColors)throw new Error(`Length of replacements (${i}) exceeds the maximum colors length (${this._maxColors})`);e[3*i]=-1;for(let n=0;n<i;n++){const i=t[n];let s=i[0];"number"==typeof s?s=Ot(s):i[0]=Ct(s),e[3*n]=s[0],e[3*n+1]=s[1],e[3*n+2]=s[2];let o=i[1];"number"==typeof o?o=Ot(o):i[1]=Ct(o),r[3*n]=o[0],r[3*n+1]=o[1],r[3*n+2]=o[2]}this._replacements=t}get replacements(){return this._replacements}refresh(){this.replacements=this._replacements}get maxColors(){return this._maxColors}set epsilon(t){this.uniforms.epsilon=t}get epsilon(){return this.uniforms.epsilon}}function $a(t){var e=t.split("_")[1],r=t.split("_")[0];return"interface/".concat(e,"/").concat(r,"_").concat(e,".png")}function qa(t){switch(t){case 1:return"000_256";case 2:return"000_258";case 3:return"000_261"}}function Ka(t,e,r){var i=r.cache.get(e.civ.toLowerCase()).buildings;return i[e.age][t]?i[e.age][t]:i[e.age-1][t]?i[e.age-1][t]:i[e.age-2][t]?i[e.age-2][t]:void 0}function Za(t,e){var r=t.split("_")[1],i=t.split("_")[0],n=e.cache.get(r),s="".concat(i,"_").concat(r,".png");return n.textures[s]}var Qa=["blue","red","yellow","brown","orange","green","grey","cyan"];function Ja(t,e){if("blue"!==e){var r=[9681879,7576519,5733299,4153247,2572175,1517435,462695,87],i={red:[16748431,16736095,16723759,14879488,13047552,9379584,7277319,5442304],yellow:[14934784,14667535,14667535,12821275,10711831,8873767,7031591,5191459],brown:[13607747,12028715,10711887,9132855,7554855,6239003,4142883,2302751],orange:[16490271,16222999,15955727,15688455,13583104,10433280,8858368,7283456],green:[9150287,8358711,6519599,4942635,3628839,1786651,1258259,727819],grey:[14408667,13092807,11776947,9408399,7039851,4671303,3618615,2302755],cyan:[6280095,2867091,43923,33659,28523,20303,16195,8999]};if(i[e]){for(var n=[],s=0;s<r.length;s++)n.push([r[s],i[e][s]]);t.filters=[new Ya(n,.1)]}}}function th(t){var e=new wo;e.name="selection",e.zIndex=3,e.lineStyle(1,65280);var r=[-32*t.size,0,0,-16*t.size,32*t.size,0,0,16*t.size];e.drawPolygon(r),t.addChildAt(e,0),setTimeout((function(){e.alpha=0,setTimeout((function(){e.alpha=1,setTimeout((function(){e.alpha=0,setTimeout((function(){e.alpha=1,setTimeout((function(){t.removeChild(e)}),300)}),300)}),300)}),500)}),500)}function eh(t,e,r,i,n,s){t.fillStyle=s,t.fillRect(e,r,i,n),t.fill()}function rh(t,e,r,i,n,s){t.save(),t.beginPath(),t.moveTo(e,r),t.lineTo(e-i/2,r+n/2),t.lineTo(e,r+n),t.lineTo(e+i/2,r+n/2),t.closePath(),t.fillStyle=s,t.fill()}function ih(t,e,r){t.onFrameChange=function(t){return t===e&&r()}}function nh(t,e){Object.keys(e).forEach((function(r){t[r]+=e[r]}))}function sh(t,e){Object.keys(e).forEach((function(r){t[r]-=e[r]}))}function oh(t,e){return!Object.keys(e).some((function(r){return t[r]<e[r]}))}var ah=63,hh=30,lh=16,ch=1,uh=20,dh=["meat","wheat","berry"],fh=16777215,ph=16711680,mh=15262687,gh="#647B2F",yh="#17277B",vh="#CFA443",bh="#274F1F",xh="#DECF10",_h="#B3B3B3",wh="#7B9051",Eh=10;function Th(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(t){return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}))}function Ah(t){return("00"+t).slice(-3)}function Sh(t,e){return[Math.floor((t-e)*ah/2),Math.floor((t+e)*hh/2)]}function Ph(t,e){return[Math.round((t/(ah/2)+e/(hh/2))/2),Math.round((e/(hh/2)-t/(ah/2))/2)]}function Oh(t,e){return Math.floor(t/e*100)}function Ch(t,e){return Math.floor(e*t/100)}function Rh(t,e){return(t+e)/2}function Ih(t,e,r,i){var n=(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y);if(0==n)return!1;var s=((r.x-t.x)*(e.x-t.x)+(r.y-t.y)*(e.y-t.y))/n;if(s<0)return Math.sqrt((t.x-r.x)*(t.x-r.x)+(t.y-r.y)*(t.y-r.y))<=i;if(0<=s&&s<=1){var o=((t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y))/n;return Math.abs(o)*Math.sqrt(n)<=i}return Math.sqrt((e.x-r.x)*(e.x-r.x)+(e.y-r.y)*(e.y-r.y))<=i}function Mh(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function Bh(t){return t[Math.round(Math.random()*(t.length-1))]}function Dh(t,e){return arguments.length>2&&void 0!==arguments[2]&&!arguments[2]?Uh(t.x,t.y,e.x,e.y):Uh(t.i,t.j,e.i,e.j)}function jh(t){var e=Ph(t.x,t.y+t.z*lh);return e[0]+e[1]}function kh(t,e){return Math.abs(t-e)}function Nh(t,e,r){return Lh(t.x,t.y,e,r)}function Lh(t,e,r,i){var n=r-t,s=i-e;return Math.round(180*Math.atan2(s,n)/Math.PI+180)}function Fh(t){return t*(Math.PI/180)}function Uh(t,e,r,i){var n=t-r,s=e-i;return Math.floor(Math.sqrt(n*n+s*s))}function Gh(t,e,r,i,n,s){return arguments.length>6&&void 0!==arguments[6]&&arguments[6]?t>r&&t<r+n&&e>i&&e<i+s||t<r&&t>r+n&&e<i&&e>i+s||t>r&&t<r+n&&e<i&&e>i+s||t<r&&t>r+n&&e>i&&e<i+s:t>r&&t<r+n&&e>i&&e<i+s}function zh(t,e){return Math.abs(e.i-t.i)===Math.abs(e.j-t.j)}function Hh(t){return t>67.5&&t<112.5?"north":t>247.5&&t<292.5?"south":t>337.5||t<22.5?"west":t>=22.5&&t<=67.5?"northwest":t>=292.5&&t<=337.5?"southwest":t>157.5&&t<202.5?"est":t>112.5&&t<157.5?"northest":t>202.5&&t<247.5?"southest":void 0}function Xh(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=null,n=!0;return function(){var s=arguments,o=this,a=function(){t.apply(o,s),i=null};r&&n&&(n=!1,a()),i||(i=setTimeout(a,e))}}var Vh=function(t,e){if(!t)return!0;var r=t.op,i=t.key,n=t.value,s=e[i];switch(r){case"=":case"!=":var o=Array.isArray(n)?JSON.stringify(n.sort())===JSON.stringify(s).sort():n===s;return"!="===r?!o:o;case"<":return s<n;case"<=":return s<=n;case">=":return s>=n;case">":return s>n;case"includes":return s.includes(n);case"notincludes":return!s.includes(n);default:throw new Error("Invalid condition operation provided (".concat(r,")"))}},Wh=function(t,e,r,i){if(!r)return!1;var n={delivery:function(t){return e.hitPoints>0&&e.isBuilt&&("TownCenter"===e.type||!t||t.buildingType&&e.type===t.buildingType)},takemeat:function(){return"Villager"===t.type&&"animal"===e.name&&e.quantity>0&&e.isDead&&!e.isDestroyed},hunt:function(){return"Villager"===t.type&&"animal"===e.name&&e.quantity>0&&e.hitPoints>0&&!e.isDead},chopwood:function(){return"Villager"===t.type&&"Tree"===e.type&&e.quantity>0&&!e.isDead},farm:function(){return"Villager"===t.type&&"Farm"===e.type&&e.hitPoints>0&&e.owner===t.owner&&e.quantity>0&&(!e.isUsedBy||e.isUsedBy===t)&&!e.isDead},forageberry:function(){return"Villager"===t.type&&"Berrybush"===e.type&&e.quantity>0&&!e.isDead},minestone:function(){return"Villager"===t.type&&"Stone"===e.type&&e.quantity>0&&!e.isDead},minegold:function(){return"Villager"===t.type&&"Gold"===e.type&&e.quantity>0&&!e.isDead},build:function(){return"Villager"===t.type&&e.owner===t.owner&&"building"===e.name&&e.hitPoints>0&&(!e.isBuilt||e.hitPoints<e.totalHitPoints)&&!e.isDead},attack:function(){return e&&e.owner!==t.owner&&("building"===e.name||"unit"===e.name||"animal"===e.name)&&e.hitPoints>0&&!e.isDead},heal:function(){return e&&e.owner===t.owner&&"unit"===e.name&&e.hitPoints>0&&e.hitPoints<e.totalHitPoints&&!e.isDead}};return e&&e!==t&&t.hitPoints>0&&!t.isDead&&n[r](i)};function Yh(t){return Yh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yh(t)}function $h(t,e){if(t){if("string"==typeof t)return qh(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qh(t,e):void 0}}function qh(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function Kh(t,e){return Math.floor(instancesDistance(t,e))<=(e.size-1||1)&&!e.isDestroyed}function Zh(t,e,r,i){var n=pointsDistance(e,r,t.x,t.y),s=e-t.x,o=r-t.y,a=s/n*(i*ch),h=o/n*(i*ch);t.degree=getInstanceDegree(t,e,r),t.x+=a,t.y+=h}function Qh(t){var e=t.size-1||1,r=0;return ll(t.i,t.j,t.parent.grid,e,(function(t){return t.solid&&r++,!0})).length===r}function Jh(t,e,r){for(var i=function(){var i=t.size-1||1,s=[];if(ll(e.i,e.j,r.grid,i*n,(function(n){n.has&&n.has.type===e.type&&ll(n.i,n.j,r.grid,i,(function(e){if(!e.solid){var i=el(t,e.i,e.j,r);i.length&&s.push({target:n.has,path:i})}}))})),s.sort((function(t,e){return t.path.length-e.path.length})),s[0])return{v:s[0]}},n=1;n<100;n++){var s=i();if("object"===Yh(s))return s.v}return null}function tl(t,e,r){var i=e.size||e.has&&e.has.size||1,n=[];return ll(e.i,e.j,r.grid,3===i?2:1,(function(e){var i=el(t,e.i,e.j,r);i.length&&n.push(i)})),n.sort((function(t,e){return t.length-e.length})),n[0]?n[0]:[]}function el(t,e,r,i){for(var n=i.grid[e][r],s=i.grid[t.i][t.j],o=Math.max(Math.min(s.i,n.i)-10,0),a=Math.min(Math.max(s.i,n.i)+10,i.size),h=Math.max(Math.min(s.j,n.j)-10,0),l=Math.min(Math.max(s.j,n.j)+10,i.size),c=[],u=o;u<=a;u++)for(var d=h;d<=l;d++)null==c[u]&&(c[u]=[]),c[u][d]={i:u,j:d,x:i.grid[u][d].x,y:i.grid[u][d].y,z:i.grid[u][d].z,solid:i.grid[u][d].solid};var f,p=!1,m=[],g=[],y=[],v=c[n.i][n.j],b=c[s.i][s.j];g.push(b);for(var x=function(){if(g.length>0){for(var t=0,e=0;e<g.length;e++)g[e].f<g[t].f&&(t=e),g[e].f==g[t].f&&g[e].g>g[t].g&&(t=e);var r=g[t];r===v&&(p=!0),m=[v];for(var i=r;i.previous;)m.push(i.previous),i=i.previous;g.splice(g.indexOf(r),1),y.push(r),ll(r.i,r.j,c,1,(function(t){var e=!cellIsDiag(r,t)||!c[r.i][t.j].solid&&!c[t.i][r.j].solid;if(!y.includes(t)&&!t.solid&&e){var i=r.g+instancesDistance(t,r);g.includes(t)||(g.push(t),t.g=i,t.h=instancesDistance(t,v),t.f=t.g+t.h,t.previous=r)}}))}else m=[],p=!0};!p;)x();return m.pop(),function(t){if(Array.isArray(t))return qh(t)}(f=m)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(f)||$h(f)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rl(t,e,r,i){for(var n=t.minX;n<=t.maxX;n++)for(var s=function(){if(!e[n]||!e[n][o])return"continue";var t=!0;return hl(n,o,e,r,(function(e){i(e)||(t=!1)})),t?{v:{i:n,j:o}}:void 0},o=t.minY;o<=t.maxY;o++){var a=s();if("continue"!==a&&"object"===Yh(a))return a.v}}function il(t,e){for(var r=[],i=t.i-t.sight;i<t.i+t.sight;i++)for(var n=t.j-t.sight;n<t.j+t.sight;n++)if(pointsDistance(t.i,t.j,i,n)<=t.sight&&t.parent.grid[i]&&t.parent.grid[i][n]){var s=t.parent.grid[i][n];s.has&&"function"==typeof e&&e(s.has)&&r.push(s.has)}return r}function nl(t){var e=t.context.player,r=t.parent.grid[t.i][t.j];t.owner.isPlayed||t.parent.revealEverything||al(t,e)||"building"===t.name&&t.owner.views[t.i][t.j].has&&t.owner.views[t.i][t.j].has.id===t.id?r.removeFog():r.setFog(),hl(t.i,t.j,t.owner.views,t.sight,(function(e){if(pointsDistance(t.i,t.j,e.i,e.j)<=t.sight){var r=t.parent.grid[e.i][e.j];t.owner.isPlayed&&!t.parent.revealEverything?r.removeFog():"AI"!==t.owner.type||!r.has||e.has&&e.has.id===r.has.id||(e.has=r.has,"Tree"===r.has.type&&r.has.quantity>0&&-1===t.owner.foundedTrees.indexOf(r.has)&&t.owner.foundedTrees.push(r.has),"Berrybush"===r.has.type&&r.has.quantity>0&&-1===t.owner.foundedBerrybushs.indexOf(r.has)&&t.owner.foundedBerrybushs.push(r.has),"building"===r.has.name&&r.has.hitPoints>0&&r.has.owner!==t.owner&&-1===t.owner.foundedEnemyBuildings.indexOf(r.has)&&t.owner.foundedEnemyBuildings.push(r.has)),r.has&&r.has.sight&&instancesDistance(t,r.has)<=r.has.sight&&"function"==typeof r.has.detect&&r.has.detect(t),-1===e.viewBy.indexOf(t)&&e.viewBy.push(t),e.viewed||(e.onViewed(),e.viewed=!0)}}))}function sl(t){t.parent.revealEverything||hl(t.i,t.j,t.owner.views,t.sight,(function(e){if(pointsDistance(t.i,t.j,e.i,e.j)<=t.sight&&(e.viewBy.splice(e.viewBy.indexOf(t),1),t.parent)){var r=t.parent.grid[e.i][e.j];e.viewBy.length||!t.owner.isPlayed||t.parent.revealEverything||r.setFog()}}))}function ol(t,e,r,i){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0,o=r[1],a=r[0];return rl({minX:t.i-o,minY:t.j-o,maxX:t.i+o,maxY:t.j+o},e,i,(function(e){return e.i>0&&e.j>0&&e.i<e.parent.size&&e.j<e.parent.size&&instancesDistance(t,e,!0)>a&&instancesDistance(t,e,!0)<o&&!e.solid&&!e.border&&(n||!e.inclined)&&(!s||s(e))}))||null}function al(t,e){return e.views[t.i][t.j].viewBy.length>0}function hl(t,e,r,i,n){var s=[];if(!i){var o=r[t][e];return"function"==typeof n?n(o)&&s.push(o):s.push(o),s}for(var a=t-i;a<=t+i;a++)for(var h=e-i;h<=e+i;h++)if(r[a]&&r[a][h]){var l=r[a][h];"function"==typeof n?n(l)&&s.push(l):s.push(l)}return s}function ll(t,e,r,i,n){var s=i-1,o=[];if(!i){var a=r[t][e];return"function"==typeof n?n(a)&&o.push(a):o.push(a),o}for(var h=t-i,l=e-i,c=0,u=1,d=0,f=0,p=0;p<8+8*s;p++){if(l+=d,r[h+=u]&&r[h][l]){var m=r[h][l];"function"==typeof n?n(m)&&o.push(m):o.push(m)}if(++f==2*i){var g=c>0?-1:1;c%2?(u=g,d=0):(u=0,d=g),f=0,c++}}return o}function cl(t,e){for(var r=[],i=0;i<e.length;i++)r.push({instance:e[i],dist:instancesDistance(t,e[i])});return r.sort((function(t,e){return t.dist-e.dist})),r.length&&r[0].instance||!1}function ul(t,e){for(var r=[],i=0;i<e.length;i++){var n=tl(t,e[i],t.parent);n.length&&r.push({instance:e[i],path:n})}return r.sort((function(t,e){return t.path.length-e.path.length})),r[0]||null}function dl(t){return dl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dl(t)}function fl(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==dl(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==dl(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key),"symbol"===dl(n)?n:String(n)),i)}var n}function pl(t,e){return pl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pl(t,e)}function ml(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function gl(t){return gl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},gl(t)}Object.entries(t).forEach((function(t){var e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var i,n,s,o,a=[],h=!0,l=!1;try{if(s=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;h=!1}else for(;!(h=(i=s.call(r)).done)&&(a.push(i.value),a.length!==e);h=!0);}catch(t){l=!0,n=t}finally{try{if(!h&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(l)throw n}}return a}}(t,e)||$h(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,2),r=e[0],i=e[1];return window[r]=i}));var yl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pl(t,e)}(o,t);var e,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=gl(i);if(n){var r=gl(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===dl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ml(t)}(this,t)});function o(t,e){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(r=s.call(this)).context=e;var i=ml(r).context.map;r.setParent(i),r.name="cell",Object.keys(t).forEach((function(e){r[e]=t[e]}));var n=ml(r),a=n.i,h=n.j,l=n.z,c=n.sprite,u=Sh(a,h);return r.map=i,r.x=u[0],r.y=u[1]-l*lh,r.zIndex=0,r.inclined=!1,r.border=!1,r.has=null,r.corpses=[],r.visible=!1,r.viewed=!1,r.viewBy=[],c&&(c.anchor.set(.5,.5),c.roundPixels=!0,c.allowMove=!1,c.interactive=!1,c.allowClick=!1,r.addChild(c)),r.interactive=!1,r.allowMove=!1,r.allowClick=!1,r}return e=o,r=[{key:"updateVisible",value:function(){var t=this.context,e=t.map,r=t.player;function i(t){(e.revealEverything||!t.owner||t.owner.isPlayed||al(t,r)||"building"===t.name&&r.views[this.i][this.j].has&&r.views[this.i][this.j].has.id===t.id)&&(t.visible=!0)}if((e.revealEverything||r.views[this.i][this.j].viewed)&&(this.visible=!0,this.has&&i(this.has),this.corpses.length))for(var n=0;n<this.corpses.length;n++)i(this.corpses[n])}},{key:"setDesertBorder",value:function(t){for(var e,r="20002",i=this.getChildByName("sprite").texture.textureCacheIds[0].split("_")[0],n={},s=0,o=0;o<25;o++)if(n[o]=[],o<9)n[o].push(0,1,2,3);else{for(var a=s;a<s+4;a++)n[o].push(a+4);s+=4}switch(t){case"west":e=n[1*i][0];break;case"north":e=n[1*i][1];break;case"south":e=n[1*i][2];break;case"est":e=n[1*i][3]}var h=os.cache.get(r).textures[Ah(e)+"_"+r+".png"],l=on.from(h);l.direction=t,l.anchor.set(.5,.5),l.type="border",this.addChild(l)}},{key:"setWaterBorder",value:function(t,e){var r=this.getChildByName("sprite"),i=os.cache.get(t).textures[e+"_"+t+".png"];this.type="desert",this.border=!0,this.has&&"function"==typeof this.has.die&&this.has.die(!0),r.texture=i}},{key:"setReliefBorder",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.getChildByName("sprite"),i=r.texture.textureCacheIds[0].split("_")[1].split(".")[0],n=os.cache.get(i).textures[t+"_"+i+".png"];e&&(this.y-=e),this.inclined=!0,this.has&&"function"==typeof this.has.die&&this.has.die(!0),r.name="sprite",r.anchor.set(.5,.5),r.texture=n}},{key:"fillWaterCellsAroundCell",value:function(){var t=this,e=this.parent.grid;ll(this.i,this.j,e,2,(function(r){if("water"===r.type&&"water"===t.type){var i=Dh(t,r),n=Math.round((t.i-r.i)/i),s=Math.round((t.j-r.j)/i);if(e[r.i+n]&&e[r.i+n][r.j+s]){var o=e[r.i+n][r.j+s],a=e[t.i+r.i-o.i][t.j+r.j-o.j];if(o.type!==t.type&&a.type!==t.type&&2===Math.floor(Dh(t,r))){var h=o.getChildByName("sprite"),l=Ah(Mh(0,3)),c="15002",u=os.cache.get(c);h.texture=u.textures[l+"_"+c+".png"],o.type="water",o.solid=!0}}}}))}},{key:"fillReliefCellsAroundCell",value:function(){var t=this,e=this.parent.grid;ll(this.i,this.j,e,2,(function(r){if(r.z===t.z){var i=Dh(t,r),n=Math.round((t.i-r.i)/i),s=Math.round((t.j-r.j)/i);if(e[r.i+n]&&e[r.i+n][r.j+s]){var o=e[r.i+n][r.j+s],a=e[t.i+r.i-o.i][t.j+r.j-o.j];o.z<=t.z&&o.z!==t.z&&a.z!==t.z&&2===Math.floor(Dh(t,r))&&o.setCellLevel(o.z+1)}}}))}},{key:"setCellLevel",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(0===t)return this.y+=lh,void(this.z=t);var r=this.parent.grid;ll(this.i,this.j,r,t-e,(function(t){t.z<e&&(t.y-=(e-t.z)*lh,t.z=e,t.fillReliefCellsAroundCell(r))})),e+1<t&&this.setCellLevel(t,e+1),this.has&&(this.has.zIndex=jh(this.has))}},{key:"setFog",value:function(){var t=6710886;function e(e){if("unit"!==e.name&&"animal"!==e.name||e.owner.isPlayed)for(var r=0;r<e.children.length;r++)e.children[r].tint&&(e.children[r].tint=t),e.children[r].cacheAsBitmap=!0;else e.visible=!1}for(var r=0;r<this.children.length;r++)this.children[r].tint&&(this.children[r].tint=t),this.children[r].cacheAsBitmap=!0;if(this.has&&e(this.has),this.corpses.length)for(var i=0;i<this.corpses.length;i++)e(this.corpses[i])}},{key:"removeFog",value:function(){var t=this.context.controls;function e(e){t.instanceInCamera(e)&&(e.visible=!0);for(var r=0;r<e.children.length;r++)e.children[r].tint&&(e.children[r].tint=fh),e.children[r].cacheAsBitmap=!1}this.visible||(this.visible=!0);for(var r=0;r<this.children.length;r++)this.children[r].tint&&(this.children[r].tint=fh),this.children[r].cacheAsBitmap=!1;if(this.has&&e(this.has),this.corpses.length)for(var i=0;i<this.corpses.length;i++)e(this.corpses[i])}}],r&&fl(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(rn);function vl(t){return vl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vl(t)}function bl(t,e){return bl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},bl(t,e)}function xl(t){return xl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},xl(t)}var _l=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bl(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=xl(r);if(i){var n=xl(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===vl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r=t.i,i=t.j,o=t.z;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var a=Mh(0,8),h="15000",l=os.cache.get(h).textures[Ah(a)+"_"+h+".png"],c=on.from(l);return c.name="sprite",n.call(this,{i:r,j:i,z:o,sprite:c,solid:!1,color:vh,type:"desert"},e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(yl);function wl(t){return wl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wl(t)}function El(t,e){return El=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},El(t,e)}function Tl(t){return Tl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Tl(t)}var Al=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&El(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Tl(r);if(i){var n=Tl(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===wl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r=t.i,i=t.j,o=t.z;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var a=Mh(0,8),h="15001",l=os.cache.get(h).textures[Ah(a)+"_"+h+".png"],c=on.from(l);return c.name="sprite",n.call(this,{i:r,j:i,z:o,sprite:c,color:gh,solid:!1,type:"grass"},e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(yl);function Sl(t){return Sl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sl(t)}function Pl(t,e){return Pl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Pl(t,e)}function Ol(t){return Ol=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ol(t)}var Cl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pl(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ol(r);if(i){var n=Ol(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Sl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r=t.i,i=t.j,o=t.z;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var a=Mh(0,8),h="15001",l=os.cache.get(h).textures[Ah(a)+"_"+h+".png"],c=on.from(l);return c.name="sprite",n.call(this,{i:r,j:i,z:o,sprite:c,color:gh,solid:!1,type:"jungle"},e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(yl);function Rl(t){return Rl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rl(t)}function Il(t,e){return Il=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Il(t,e)}function Ml(t){return Ml=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ml(t)}var Bl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Il(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ml(r);if(i){var n=Ml(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Rl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r=t.i,i=t.j,o=t.z;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var a=Mh(0,3),h="15002",l=os.cache.get(h).textures[Ah(a)+"_"+h+".png"],c=on.from(l);return c.name="sprite",n.call(this,{i:r,j:i,z:o,sprite:c,solid:!0,color:yh,type:"water"},e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(yl);function Dl(t){return Dl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dl(t)}function jl(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==Dl(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Dl(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key),"symbol"===Dl(n)?n:String(n)),i)}var n}function kl(t,e){return kl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},kl(t,e)}function Nl(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ll(t){return Ll=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ll(t)}var Fl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&kl(t,e)}(o,t);var e,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ll(i);if(n){var r=Ll(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Dl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Nl(t)}(this,t)});function o(t,e){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(r=s.call(this)).context=e;var i=Nl(r).context.map;r.setParent(i),r.id=i.children.length,r.name="resource",Object.keys(t).forEach((function(e){r[e]=t[e]})),r.x=i.grid[r.i][r.j].x,r.y=i.grid[r.i][r.j].y,r.z=i.grid[r.i][r.j].z,r.zIndex=jh(Nl(r)),r.selected=!1,r.visible=!1,r.isDead=!1,r.isDestroyed=!1,r.hitPoints=r.totalHitPoints;var n=i.grid[r.i][r.j];return n.solid=!0,n.has=Nl(r),r.interactive=!1,r.allowClick=!1,r.allowMove=!1,r.sprite&&(r.sprite.allowMove=!1,r.sprite.interactive=!0,r.sprite.roundPixels=!0,r.sprite.on("pointertap",(function(){var t=Nl(r).context,e=t.player,n=t.menu;e.selectedUnits.length||!al(Nl(r),e)&&!i.revealEverything||(e.unselectAll(),r.select(),n.setBottombar(Nl(r)),e.selectedOther=Nl(r))})),r.addChild(r.sprite)),r}return e=o,r=[{key:"select",value:function(){if(!this.selected){this.selected=!0;var t=new wo;t.name="selection",t.zIndex=3,t.lineStyle(1,16777215);var e=[-32*this.size,0,0,-16*this.size,32*this.size,0,0,16*this.size];t.drawPolygon(e),this.addChildAt(t,0)}}},{key:"unselect",value:function(){if(this.selected){this.selected=!1;var t=this.getChildByName("selection");t&&this.removeChild(t)}}},{key:"die",value:function(t){if(!this.isDead){var e=this.context,r=e.player,i=e.players,n=e.map,s=e.menu;this.selected&&r.selectedOther===this&&r.unselectAll();for(var o="founded"+this.type+"s",a=0;a<i.length;a++)if("AI"===i[a].type){var h=i[a][o],l=h.indexOf(this);h.splice(l,1)}var c=n.resources.indexOf(this);c>=0&&n.resources.splice(c,1),s.updateResourcesMiniMap(),this.isDead=!0,"function"!=typeof this.onDie||t?this.clear():this.onDie()}}},{key:"clear",value:function(){if(!this.isDestroyed){var t=this.context.map;this.isDestroyed=!0,t.grid[this.i][this.j].has===this&&(t.grid[this.i][this.j].has=null,t.grid[this.i][this.j].solid=!1);var e=t.grid[this.i][this.j].corpses.indexOf(this);e>=0&&t.grid[this.i][this.j].corpses.splice(e,1),t.removeChild(this),this.destroy({child:!0,texture:!0})}}},{key:"setDefaultInterface",value:function(t,e){var r=this.context.menu,i=document.createElement("div");i.id="type",i.textContent=this.type,t.appendChild(i);var n=document.createElement("img");if(n.id="icon",n.src=$a(e.icon),t.appendChild(n),this.hitPoints){var s=document.createElement("div");s.id="hitPoints",s.textContent=this.hitPoints+"/"+this.totalHitPoints,t.appendChild(s)}if(this.quantity){var o,a=document.createElement("div");switch(a.id="quantity",a.className="resource-quantity",this.type){case"Tree":o=r.icons.wood;break;case"Berrybush":o=r.icons.food;break;case"Stone":o=r.icons.stone;break;case"Gold":o=r.icons.gold}var h=document.createElement("img");h.src=o,h.className="resource-quantity-icon";var l=document.createElement("div");l.id="quantity-text",l.textContent=this.quantity,a.appendChild(h),a.appendChild(l),t.appendChild(a)}}}],r&&jl(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(rn);function Ul(t){return Ul="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ul(t)}function Gl(t,e){return Gl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Gl(t,e)}function zl(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Hl(t){return Hl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Hl(t)}var Xl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gl(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Hl(r);if(i){var n=Hl(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ul(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return zl(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var a="Berrybush",h=os.cache.get("config").resources[a],l=os.cache.get("240"),c="000_".concat("240",".png"),u=l.textures[c],d=on.from(u);return d.updateAnchor=!0,d.name="sprite",d.hitArea=new Ie(l.data.frames[c].hitArea),d.on("pointerup",(function(){var t=zl(r).context,e=t.player,i=t.controls;if(!i.mouseBuilding&&!i.mouseRectangle&&i.isMouseInApp()){i.mouse.prevent=!0;for(var n=!1,s=0;s<e.selectedUnits.length;s++){var o=e.selectedUnits[s];"Villager"===o.type?(n=!0,o.sendToBerrybush(zl(r))):o.sendTo(zl(r))}n&&th(zl(r))}})),r=n.call(this,{i,j:o,type:a,sprite:d,size:1,color:wh,quantity:h.quantity,interface:{info:function(t){r.setDefaultInterface(t,h)}}},e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Fl);function Vl(t){return Vl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vl(t)}function Wl(t,e){return Wl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Wl(t,e)}function Yl(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function $l(t){return $l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$l(t)}var ql=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Wl(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$l(r);if(i){var n=$l(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Vl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Yl(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var a="Gold",h=os.cache.get("config").resources[a],l=Mh(0,6),c=os.cache.get("481"),u="00".concat(l,"_").concat("481",".png"),d=c.textures[u],f=on.from(d);return f.updateAnchor=!0,f.name="sprite",f.hitArea=new Ie(c.data.frames[u].hitArea),f.on("pointerup",(function(){var t=Yl(r).context,e=t.player,i=t.controls;if(!i.mouseBuilding&&!i.mouseRectangle&&i.isMouseInApp()){i.mouse.prevent=!0;for(var n=!1,s=0;s<e.selectedUnits.length;s++){var o=e.selectedUnits[s];"Villager"===o.type?(n=!0,o.sendToGold(Yl(r))):o.sendTo(Yl(r))}n&&th(Yl(r))}})),r=n.call(this,{i,j:o,type:a,sprite:f,color:xh,size:1,quantity:h.quantity,interface:{info:function(t){r.setDefaultInterface(t,h)}}},e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Fl);function Kl(t){return Kl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kl(t)}function Zl(t,e){return Zl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Zl(t,e)}function Ql(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Jl(t){return Jl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Jl(t)}var tc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Zl(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Jl(r);if(i){var n=Jl(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Kl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ql(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var a="Stone",h=os.cache.get("config").resources[a],l=Mh(0,6),c=os.cache.get("622"),u="00".concat(l,"_").concat("622",".png"),d=c.textures[u],f=on.from(d);return f.updateAnchor=!0,f.name="sprite",f.hitArea=new Ie(c.data.frames[u].hitArea),f.on("pointerup",(function(){var t=Ql(r).context,e=t.player,i=t.controls;if(!i.mouseBuilding&&!i.mouseRectangle&&i.isMouseInApp()){i.mouse.prevent=!0;for(var n=!1,s=0;s<e.selectedUnits.length;s++){var o=e.selectedUnits[s];"Villager"===o.type?(n=!0,o.sendToStone(Ql(r))):o.sendTo(Ql(r))}n&&th(Ql(r))}})),r=n.call(this,{i,j:o,type:a,sprite:f,size:1,color:_h,quantity:h.quantity,interface:{info:function(t){r.setDefaultInterface(t,h)}}},e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Fl);function ec(t){return ec="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ec(t)}function rc(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==ec(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==ec(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key),"symbol"===ec(n)?n:String(n)),i)}var n}function ic(t,e){return ic=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ic(t,e)}function nc(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function sc(t){return sc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},sc(t)}var oc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ic(t,e)}(o,t);var e,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=sc(i);if(n){var r=sc(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===ec(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return nc(t)}(this,t)});function o(t,e){var r,i=t.i,n=t.j;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var a="Tree",h=os.cache.get("config").resources[a],l=["492","493","494","503","509"],c=l;switch(e.map.grid[i][n].type){case"desert":case"jungle":c=["463","464","465","466"];break;default:c=l}var u=Bh(c),d=os.cache.get(u),f="000_".concat(u,".png"),p=d.textures[f],m=on.from(p);return m.updateAnchor=!0,m.name="sprite",m.hitArea=new Ie(d.data.frames[f].hitArea),m.on("pointerup",(function(){var t=nc(r).context,e=t.player,i=t.controls;if(!i.mouseBuilding&&!i.mouseRectangle&&i.isMouseInApp()){i.mouse.prevent=!0;for(var n=!1,s=nc(r),o=0;o<e.selectedUnits.length;o++){var a=e.selectedUnits[o];if(Qh(nc(r))){var h=Jh(a,nc(r),r.parent);h&&(s=h.target)}"Villager"===a.type?(n=!0,a.sendToTree(s)):a.sendTo(s)}n&&th(s)}})),r=s.call(this,{i,j:n,type:a,sprite:m,size:1,color:bh,quantity:h.quantity,totalHitPoints:h.totalHitPoints,interface:{info:function(t){r.setDefaultInterface(t,h)}}},e)}return e=o,(r=[{key:"setCuttedTreeTexture",value:function(){var t=this.getChildByName("sprite"),e=os.cache.get("636"),r="00".concat(Mh(0,3),"_636.png"),i=e.textures[r];t.texture=i;var n=[-ah/2,0,0,-hh/2,ah/2,0,0,hh/2];t.hitArea=new Ie(n),t.anchor.set(i.defaultAnchor.x,i.defaultAnchor.y)}},{key:"onDie",value:function(){var t=this.context.map,e=os.cache.get("623"),r="00".concat(Mh(0,3),"_623.png"),i=e.textures[r],n=this.getChildByName("sprite");n.texture=i,n.interactive=!1,this.zIndex--,t.grid[this.i][this.j].has===this&&(t.grid[this.i][this.j].has=null,t.grid[this.i][this.j].corpses.push(this),t.grid[this.i][this.j].solid=!1)}}])&&rc(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(Fl);function ac(t){return ac="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ac(t)}function hc(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==ac(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==ac(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key),"symbol"===ac(n)?n:String(n)),i)}var n}function lc(t,e){return lc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},lc(t,e)}function cc(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function uc(t){return uc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},uc(t)}var dc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lc(t,e)}(o,t);var e,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=uc(i);if(n){var r=uc(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===ac(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return cc(t)}(this,t)});function o(t,e){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(r=s.call(this)).context=e;var i=cc(r).context.map;r.setParent(i),r.id=i.children.length,r.name="projectile",Object.keys(t).forEach((function(e){r[e]=t[e]}));var n=r.destination||r.target,a=n.x,h=n.y;r.distance=Dh(cc(r),r.target,!1);var l=r.degree||getPointsDegree(r.x,r.y,a,h),c=new wo;c.beginFill(mh),c.drawRect(1,1,r.size,1),c.rotation=Fh(l),c.name="sprite",c.allowMove=!1,c.interactive=!1,c.allowClick=!1,c.roundPixels=!0,r.addChild(c);var u=setInterval((function(){if(Uh(r.x,r.y,a,h)<=Math.max(r.speed,r.size))return Uh(a,h,r.target.x,r.target.y)<=Rh(r.target.width,r.target.height)&&r.onHit(r.target),clearInterval(u),void r.die();Zh(cc(r),a,h,r.speed)}),uh);return r}return e=o,(r=[{key:"onHit",value:function(t){var e=this.context,r=e.menu,i=e.player;t.hitPoints=Math.max(t.hitPoints-(this.attack||this.owner.attack),0),t.selected&&i.selectedOther===t&&r.updateInfo("hitPoints",(function(e){return e.textContent=t.hitPoints+"/"+t.totalHitPoints})),t.hitPoints<=0?t.die():"function"==typeof t.isAttacked&&t.isAttacked(this.owner)}},{key:"die",value:function(){this.isDead=!0,this.destroy({child:!0,texture:!0})}}])&&hc(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(rn);function fc(t){return fc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fc(t)}function pc(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function mc(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?pc(Object(r),!0).forEach((function(e){gc(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):pc(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function gc(t,e,r){return(e=yc(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function yc(t){var e=function(t,e){if("object"!==fc(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==fc(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===fc(e)?e:String(e)}function vc(t,e){return vc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},vc(t,e)}function bc(t){return bc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},bc(t)}var xc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vc(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=bc(r);if(i){var n=bc(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===fc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var r=t.owner;return n.call(this,mc(mc({x:r.x,y:r.y-r.sprite.height/2,type:"Arrow"},t),{},{size:3,speed:14}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(dc);function _c(t){return _c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_c(t)}function wc(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function Ec(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?wc(Object(r),!0).forEach((function(e){Tc(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):wc(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Tc(t,e,r){return(e=Ac(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ac(t){var e=function(t,e){if("object"!==_c(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==_c(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===_c(e)?e:String(e)}function Sc(t,e){return Sc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Sc(t,e)}function Pc(t){return Pc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Pc(t)}var Oc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Sc(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Pc(r);if(i){var n=Pc(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===_c(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var r=t.owner,i={x:r.x,y:r.y-r.sprite.height/2};return n.call(this,Ec(Ec({x:i.x,y:i.y,type:"Spear"},t),{},{size:10,speed:8}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(dc);function Cc(t){return Cc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cc(t)}function Rc(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==Cc(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Cc(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key),"symbol"===Cc(n)?n:String(n)),i)}var n}function Ic(t,e){return Ic=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ic(t,e)}function Mc(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Bc(t){return Bc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Bc(t)}var Dc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ic(t,e)}(o,t);var e,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Bc(i);if(n){var r=Bc(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Cc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Mc(t)}(this,t)});function o(t,e){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(r=s.call(this)).context=e;var i=e.map;e.player,r.setParent(i),r.id=i.children.length,r.name="building",Object.keys(t).forEach((function(e){r[e]=t[e]})),r.x=i.grid[r.i][r.j].x,r.y=i.grid[r.i][r.j].y,r.z=i.grid[r.i][r.j].z,r.zIndex=jh(Mc(r)),r.selected=!1,r.queue=[],r.technology=null,r.loading=null,r.isDead=!1,r.isDestroyed=!1,r.interval,r.attackInterval,r.timeout,i.revealEverything||(r.visible=!1),r.hitPoints=r.isBuilt?r.totalHitPoints:1;var n=3===r.size?1:0;return hl(r.i,r.j,i.grid,n,(function(t){var e=t.getChildByName("set");e&&t.removeChild(e);for(var n=0;n<t.corpses.length;n++)"function"==typeof t.corpses[n].clear&&t.corpses[n].clear();t.has=Mc(r),t.solid=!0,r.owner.views[t.i][t.j].viewBy.push(Mc(r)),r.owner.isPlayed&&!i.revealEverything&&t.removeFog()})),r.allowMove=!1,r.sprite&&(r.sprite.allowMove=!1,r.sprite.interactive=!0,r.sprite.roundPixels=!0,r.sprite.on("pointertap",(function(){var t=Mc(r).context,e=t.controls,n=t.player,s=t.menu;if(!e.mouseBuilding&&!e.mouseRectangle&&e.isMouseInApp()){var o=!1;if(e.mouse.prevent=!0,r.owner.isPlayed){if(r.isBuilt){if(n.selectedUnits){for(var a=0;a<n.selectedUnits.length;a++){var h=n.selectedUnits[a];if("Villager"===h.type)if(r.hitPoints<r.totalHitPoints)o=!0,h.previousDest=null,h.sendToBuilding(Mc(r));else switch(r.type){case"Farm":o=!0,h.sendToFarm(Mc(r));break;case"StoragePit":case"Granary":case"TownCenter":h.loading>0&&("TownCenter"===r.type||r.accept&&r.accept.includes(h.loadingType))&&(o=!0,h.previousDest=null,h.sendTo(Mc(r),"delivery"))}}if(o)return void th(Mc(r))}}else{for(var l=0;l<n.selectedUnits.length;l++){var c=n.selectedUnits[l];Wh(c,Mc(r),"build")&&(o=!0,c.sendToBuilding(Mc(r)),th(Mc(r)))}if(o)return}n.unselectAll(),r.select(),s.setBottombar(Mc(r)),n.selectedBuilding=Mc(r)}else if(n.selectedUnits.length){th(Mc(r));for(var u=0;u<n.selectedUnits.length;u++){var d=n.selectedUnits[u];"Villager"===d.type?d.sendToAttack(Mc(r)):d.sendTo(Mc(r),"attack")}}else(al(Mc(r),n)||i.revealEverything)&&(n.unselectAll(),r.select(),s.setBottombar(Mc(r)),n.selectedOther=Mc(r))}})),r.addChild(r.sprite)),r.isBuilt&&(r.updateTexture(),nl(Mc(r)),"function"==typeof r.onBuilt&&r.onBuilt()),r}return e=o,r=[{key:"attackAction",value:function(t){var e=this,r=this.context.map;this.startAttackInterval((function(){if(Wh(e,t,"attack")&&Dh(e,t)<=e.range)if(t.hitPoints<=0)t.die();else{var i=new xc({owner:e,target:t},e.context);r.addChild(i)}else e.stopAttackInterval()}),this.rateOfFire)}},{key:"startInterval",value:function(t,e){this.stopInterval(),this.interval=setInterval(t,1e3*e/100/ch)}},{key:"stopInterval",value:function(){this.interval&&(clearInterval(this.interval),this.interval=null)}},{key:"startAttackInterval",value:function(t,e){this.stopAttackInterval(),t(),this.attackInterval=setInterval(t,1e3*e)}},{key:"stopAttackInterval",value:function(){this.attackInterval&&(clearInterval(this.attackInterval),this.attackInterval=null)}},{key:"startTimeout",value:function(t,e){this.stopTimeout(),this.timeout=setTimeout((function(){return t()}),1e3*e/ch)}},{key:"stopTimeout",value:function(){this.timeout&&(clearInterval(this.timeout),this.timeout=null)}},{key:"isAttacked",value:function(t){this.range&&Wh(this,t,"attack")&&Dh(this,t)<=this.range&&this.attackAction(t),this.updateLife("attack")}},{key:"updateTexture",value:function(){var t=this.context.menu,e=Oh(this.hitPoints,this.totalHitPoints),r=this.sprite.texture.textureCacheIds[0].split("_")[1].split(".")[0],i=os.cache.get(r);if(e>=25&&e<50){var n="001_".concat(r,".png");this.sprite.texture=i.textures[n]}else if(e>=50&&e<75){var s="002_".concat(r,".png");this.sprite.texture=i.textures[s]}else if(e>=75&&e<99){var o="003_".concat(r,".png");this.sprite.texture=i.textures[o]}else e>=100&&(this.finalTexture(),this.isBuilt||"function"!=typeof this.onBuilt||this.onBuilt(),this.isBuilt=!0,this.owner.hasBuilt.includes(this.type)||this.owner.hasBuilt.push(this.type),this.owner&&this.owner.isPlayed&&this.selected&&t.setBottombar(this),nl(this))}},{key:"finalTexture",value:function(){var t=Ka(this.type,this.owner,os);this.sprite.texture=Za(t.images.final,os),this.sprite.anchor.set(this.sprite.texture.defaultAnchor.x,this.sprite.texture.defaultAnchor.y);var e=this.getChildByName("color");if(e&&e.destroy(),t.images.color){var r=on.from(Za(t.images.color,os));r.name="color",Ja(r,this.owner.color),this.addChild(r)}else Ja(this.sprite,this.owner.color);"function"==typeof this.afterFinalTextures&&this.afterFinalTextures()}},{key:"updateLife",value:function(t){this.hitPoints>this.totalHitPoints&&(this.hitPoints=this.totalHitPoints);var e=Oh(this.hitPoints,this.totalHitPoints);if(this.hitPoints<=0&&this.die(),"build"!==t||this.isBuilt){if(("attack"===t&&this.isBuilt||"build"===t&&this.isBuilt)&&(e>0&&e<25&&i(this,"450"),e>=25&&e<50&&i(this,"452"),e>=50&&e<75&&i(this,"347"),e>=75)){var r=this.getChildByName("fire");r&&this.removeChild(r)}}else this.updateTexture();function i(t,e){var r=t.getChildByName("fire"),i=os.cache.get(e);if(r)for(var n=0;n<r.children.length;n++)r.children[n].textures=i.animations.fire,r.children[n].play();else{var s=new rn;s.name="fire",s.allowMove=!1,s.allowClick=!1,s.interactive=!1;var o=[[0,0]];3===t.size&&(o=[[0,-32],[-64,0],[0,32],[64,0]]);for(var a=0;a<o.length;a++){var h=new na(i.animations.fire);h.allowMove=!1,h.allowClick=!1,h.interactive=!1,h.roundPixels=!0,h.x=o[a][0],h.y=o[a][1],h.play(),h.animationSpeed=.2*ch,s.addChild(h)}t.addChild(s)}}}},{key:"die",value:function(){var t=this;if(!this.isDead){var e=this.context,r=e.map,i=e.player;this.stopInterval(),this.isDead=!0,this.selected&&i&&i.unselectAll();var n=this.owner.buildings.indexOf(this);n>=0&&this.owner.buildings.splice(n,1);for(var s=0;s<r.players.length;s++)if("AI"===r.players[s].type){var o=r.players[s].foundedEnemyBuildings;o.splice(o.indexOf(this),1)}var a=this.getChildByName("color");a&&a.destroy();var h=this.getChildByName("deco");h&&h.destroy();var l=this.getChildByName("fire");l&&l.destroy();var c=function(t){switch(t){case 1:return"000_153";case 2:return"000_154";case 3:return"000_155"}}(this.size);"Farm"===this.type&&(c="000_239"),this.sprite.texture=Za(c,os),this.sprite.allowMove=!1,this.sprite.interactive=!1,this.sprite.allowClick=!1,this.zIndex--,"Farm"===this.type&&Ja(this.sprite,this.owner.color),sl(this);var u=3===this.size?1:0;hl(this.i,this.j,r.grid,u,(function(e){e.has===t&&(e.has=null,e.solid=!1,e.corpses.push(t))})),this.startTimeout((function(){return t.clear()}),120)}}},{key:"clear",value:function(){var t=this;if(!this.isDestroyed){var e=this.context.map,r=3===this.size?1:0;hl(this.i,this.j,e.grid,r,(function(e){var r=e.corpses.indexOf(t);r>=0&&e.corpses.splice(r,1)})),this.isDestroyed=!0,this.destroy({child:!0,texture:!0})}}},{key:"select",value:function(){var t=this,e=this.context.menu;if(!this.selected){this.selected=!0;var r=new wo;r.name="selection",r.zIndex=3,r.lineStyle(1,16777215);var i=[-32*this.size,0,0,-16*this.size,32*this.size,0,0,16*this.size];r.drawPolygon(i),this.loading&&this.owner.isPlayed&&e.updateInfo("loading",(function(e){return e.textContent=t.loading+"%"})),this.addChildAt(r,0),e.updatePlayerMiniMapEvt(this.owner)}}},{key:"unselect",value:function(){if(this.selected){var t=this.context.menu;this.selected=!1;var e=this.getChildByName("selection");e&&this.removeChild(e),t.updatePlayerMiniMapEvt(this.owner)}}},{key:"placeUnit",value:function(t){var e=this,r=this.context,i=r.map,n=r.menu,s=function(t,e,r,i){for(var n=r-1;n<50;n++){var s=ll(t,e,i,n,(function(t){return!t.solid}));if(s.length)return randomItem(s)}return null}(this.i,this.j,this.size,i.grid);s&&(this.owner.population++,this.owner.createUnit(s.i,s.j,t,i),this.owner.isPlayed&&this.owner.selectedBuilding&&"House"===this.owner.selectedBuilding.type&&n.updateInfo("population",(function(t){return t.textContent=e.owner.population+"/"+e.owner.populationMax})))}},{key:"buyUnit",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.context.menu,n=os.cache.get("config").units[t];if(this.isBuilt&&!this.isDead&&(oh(this.owner,n.cost)||r)&&(r||("AI"===this.owner.type&&null===this.loading?sh(this.owner,n.cost):(sh(this.owner,n.cost),this.queue.push(t),this.selected&&this.owner.isPlayed&&i.updateButtonContent(t,(function(r){return r.textContent=e.queue.filter((function(e){return e===t})).length}))),this.owner.isPlayed&&i.updateTopbar()),null===this.loading)){var s=!1;this.loading=0,this.selected&&this.owner.isPlayed&&i.updateInfo("loading",(function(t){return t.textContent=e.loading+"%"})),this.startInterval((function(){if(e.queue[0]!==t){if(e.stopInterval(),e.loading=null,e.queue.length&&e.buyUnit(e.queue[0],!0),s=!1,e.selected&&e.owner.isPlayed){var r=e.queue.filter((function(e){return e===t})).length;i.updateButtonContent(t,(function(t){return t.textContent=r||""})),0===r&&i.toggleButtonCancel(t,!1),i.updateInfo("loading",(function(t){return t.textContent=""}))}}else if(e.loading<100)e.owner.population<e.owner.populationMax?e.loading+=1:e.owner.isPlayed&&!s&&(i.showMessage("You need to build more houses"),s=!0),e.selected&&e.owner.isPlayed&&i.updateInfo("loading",(function(t){return t.textContent=e.loading+"%"}));else if(e.loading>=100&&(e.stopInterval(),e.placeUnit(t),e.loading=null,e.queue.shift(),e.queue.length&&e.buyUnit(e.queue[0],!0),s=!1,e.selected&&e.owner.isPlayed)){var n=e.queue.filter((function(e){return e===t})).length;i.updateButtonContent(t,(function(t){return t.textContent=n||""})),0===n&&i.toggleButtonCancel(t,!1),i.updateInfo("loading",(function(t){return t.textContent=""}))}}),n.trainingTime)}}},{key:"cancelTechnology",value:function(){var t=this.context,e=t.player,r=t.menu;this.stopInterval(),nh(e,this.technology.cost),this.technology=null,this.loading=null,this.selected&&this.owner.isPlayed&&r.setBottombar(this),r.updateTopbar()}},{key:"buyTechnology",value:function(t,e){var r=this,i=this.context,n=i.player,s=i.menu;!this.queue.length&&this.isBuilt&&null===this.loading&&!this.isDead&&oh(this.owner,t.cost)&&(sh(this.owner,t.cost),this.owner.isPlayed&&s.updateTopbar(),this.loading=0,this.technology=t,this.selected&&this.owner.isPlayed&&s.setBottombar(this),this.startInterval((function(){if(r.loading<100)r.loading+=1,r.selected&&r.owner.isPlayed&&s.updateInfo("loading",(function(t){return t.textContent=r.loading+"%"}));else if(r.loading>=100){if(r.stopInterval(),r.loading=null,r.technology=null,Array.isArray(n[t.key])?n[t.key].push(t.value||e):n[t.key]=t.value||e,t.action&&"upgrade"===t.action.type)for(var i=0;i<n.units.length;i++){var o=n.units[i];o.type===t.action.source&&o.upgrade(t.action.target)}var a="on".concat((h=t.key).charAt(0).toUpperCase()+h.slice(1),"Change");"function"==typeof n[a]&&n[a](t.value),r.selected&&r.owner.isPlayed&&s.setBottombar(r),s.updateTopbar()}var h}),t.researchTime))}},{key:"setDefaultInterface",value:function(t,e){var r=this.context.menu,i=document.createElement("div");i.id="civ",i.textContent=this.owner.civ,t.appendChild(i);var n=document.createElement("div");n.id="type",n.textContent=this.type,t.appendChild(n);var s=document.createElement("img");if(s.id="icon",s.src=$a(e.icon),t.appendChild(s),this.owner&&this.owner.isPlayed){var o=document.createElement("div");o.id="hitPoints",o.textContent=this.hitPoints+"/"+this.totalHitPoints,t.appendChild(o);var a=document.createElement("div");if(a.id="loading",a.textContent=this.loading?this.loading+"%":"",t.appendChild(a),"Farm"===this.type&&this.isBuilt&&this.quantity){var h=document.createElement("div");h.id="quantity",h.className="resource-quantity";var l=document.createElement("img");l.src=r.icons.food,l.className="resource-quantity-icon";var c=document.createElement("div");c.id="quantity-text",c.textContent=this.quantity,h.appendChild(l),h.appendChild(c),t.appendChild(h)}}}}],r&&Rc(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(rn);function jc(t){return jc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jc(t)}function kc(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function Nc(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?kc(Object(r),!0).forEach((function(e){Lc(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):kc(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Lc(t,e,r){return(e=Fc(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Fc(t){var e=function(t,e){if("object"!==jc(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==jc(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===jc(e)?e:String(e)}function Uc(t,e){return Uc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Uc(t,e)}function Gc(t){return Gc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Gc(t)}var zc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Uc(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Gc(r);if(i){var n=Gc(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===jc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.owner,h=t.isBuilt,l=void 0!==h&&h;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var c="Academy",u=os.cache.get("config").buildings[c],d=Za(qa(u.size),os),f=on.from(d);return f.updateAnchor=!0,f.name="sprite",r=n.call(this,Nc(Nc({i,j:o,owner:a,type:c,sprite:f,isBuilt:l},u),{},{interface:{info:function(t){var e=Ka(r.type,r.owner,os);r.setDefaultInterface(t,e)},menu:(a.isPlayed,[])}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Dc);function Hc(t){return Hc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hc(t)}function Xc(t){return function(t){if(Array.isArray(t))return Vc(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Vc(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Vc(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vc(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function Wc(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function Yc(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Wc(Object(r),!0).forEach((function(e){$c(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Wc(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function $c(t,e,r){return(e=qc(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function qc(t){var e=function(t,e){if("object"!==Hc(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Hc(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Hc(e)?e:String(e)}function Kc(t,e){return Kc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Kc(t,e)}function Zc(t){return Zc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Zc(t)}var Qc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Kc(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Zc(r);if(i){var n=Zc(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Hc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.owner,h=t.isBuilt,l=void 0!==h&&h;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var c="ArcheryRange",u=os.cache.get("config").buildings[c],d=Za(qa(u.size),os),f=on.from(d);f.updateAnchor=!0,f.name="sprite";var p=["Bowman","ImprovedBowman","CompositeBowman","ChariotArcher"].map((function(t){return e.menu.getUnitButton(t)})),m=["ImprovedBow","ShortSword","BroadSword"].map((function(t){return e.menu.getTechnologyButton(t)}));return r=n.call(this,Yc(Yc({i,j:o,owner:a,type:c,sprite:f,isBuilt:l},u),{},{interface:{info:function(t){var e=Ka(r.type,r.owner,os);r.setDefaultInterface(t,e)},menu:a.isPlayed?[].concat(Xc(p),Xc(m)):[]}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Dc);function Jc(t){return Jc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jc(t)}function tu(t){return function(t){if(Array.isArray(t))return eu(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return eu(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?eu(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eu(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function ru(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function iu(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ru(Object(r),!0).forEach((function(e){nu(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ru(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function nu(t,e,r){return(e=su(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function su(t){var e=function(t,e){if("object"!==Jc(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Jc(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Jc(e)?e:String(e)}function ou(t,e){return ou=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ou(t,e)}function au(t){return au=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},au(t)}var hu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ou(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=au(r);if(i){var n=au(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Jc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.owner,h=t.isBuilt,l=void 0!==h&&h;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var c="Barracks",u=os.cache.get("config").buildings[c],d=Za(qa(u.size),os),f=on.from(d);f.updateAnchor=!0,f.name="sprite";var p=["Clubman","Axeman","ShortSwordsman","BroadSwordsman"].map((function(t){return e.menu.getUnitButton(t)})),m=["BattleAxe","ShortSword","BroadSword"].map((function(t){return e.menu.getTechnologyButton(t)}));return r=n.call(this,iu(iu({i,j:o,owner:a,type:c,sprite:f,isBuilt:l},u),{},{interface:{info:function(t){var e=Ka(r.type,r.owner,os);r.setDefaultInterface(t,e)},menu:a.isPlayed?[].concat(tu(p),tu(m)):[]}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Dc);function lu(t){return lu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lu(t)}function cu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function uu(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?cu(Object(r),!0).forEach((function(e){du(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):cu(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function du(t,e,r){return(e=fu(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function fu(t){var e=function(t,e){if("object"!==lu(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==lu(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===lu(e)?e:String(e)}function pu(t,e){return pu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pu(t,e)}function mu(t){return mu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},mu(t)}var gu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pu(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=mu(r);if(i){var n=mu(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===lu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.owner,h=t.isBuilt,l=void 0!==h&&h;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var c="Farm",u=os.cache.get("config").buildings[c],d=Za(qa(u.size),os),f=on.from(d);return f.updateAnchor=!0,f.name="sprite",r=n.call(this,uu(uu({i,j:o,owner:a,type:c,sprite:f,isBuilt:l,isUsedBy:null},u),{},{interface:{info:function(t){var e=Ka(r.type,r.owner,os);r.setDefaultInterface(t,e)}}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Dc);function yu(t){return yu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yu(t)}function vu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function bu(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?vu(Object(r),!0).forEach((function(e){xu(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):vu(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function xu(t,e,r){return(e=_u(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _u(t){var e=function(t,e){if("object"!==yu(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==yu(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===yu(e)?e:String(e)}function wu(t,e){return wu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},wu(t,e)}function Eu(t){return Eu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Eu(t)}var Tu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wu(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Eu(r);if(i){var n=Eu(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===yu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.owner,h=t.isBuilt,l=void 0!==h&&h;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var c="GovernmentCenter",u=os.cache.get("config").buildings[c],d=Za(qa(u.size),os),f=on.from(d);return f.updateAnchor=!0,f.name="sprite",r=n.call(this,bu(bu({i,j:o,owner:a,type:c,sprite:f,isBuilt:l},u),{},{interface:{info:function(t){var e=Ka(r.type,r.owner,os);r.setDefaultInterface(t,e)},menu:(a.isPlayed,[])}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Dc);function Au(t){return Au="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Au(t)}function Su(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function Pu(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Su(Object(r),!0).forEach((function(e){Ou(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Su(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Ou(t,e,r){return(e=Cu(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Cu(t){var e=function(t,e){if("object"!==Au(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Au(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Au(e)?e:String(e)}function Ru(t,e){return Ru=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ru(t,e)}function Iu(t){return Iu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Iu(t)}var Mu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ru(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Iu(r);if(i){var n=Iu(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Au(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.owner,h=t.isBuilt,l=void 0!==h&&h;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var c="Granary",u=os.cache.get("config").buildings[c],d=Za(qa(u.size),os),f=on.from(d);f.updateAnchor=!0,f.name="sprite";var p=["ResearchWatchTower","ResearchSmallWall"].map((function(t){return e.menu.getTechnologyButton(t)}));return r=n.call(this,Pu(Pu({i,j:o,owner:a,type:c,sprite:f,isBuilt:l},u),{},{interface:{info:function(t){var e=Ka(r.type,r.owner,os);r.setDefaultInterface(t,e)},menu:a.isPlayed?p:[]}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Dc);function Bu(t){return Bu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bu(t)}function Du(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function ju(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Du(Object(r),!0).forEach((function(e){ku(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Du(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ku(t,e,r){return(e=Lu(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Nu(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Lu(i.key),i)}}function Lu(t){var e=function(t,e){if("object"!==Bu(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Bu(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Bu(e)?e:String(e)}function Fu(t,e){return Fu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Fu(t,e)}function Uu(t){return Uu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Uu(t)}var Gu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Fu(t,e)}(o,t);var e,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Uu(i);if(n){var r=Uu(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Bu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(t,e){var r,i=t.i,n=t.j,a=t.owner,h=t.isBuilt,l=void 0!==h&&h;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var c="House",u=os.cache.get("config").buildings[c],d=Za(0===a.age?"000_489":qa(u.size),os),f=on.from(d);return f.updateAnchor=!0,f.name="sprite",r=s.call(this,ju(ju({i,j:n,owner:a,type:c,sprite:f,isBuilt:l},u),{},{interface:{info:function(t){var e=Ka(r.type,r.owner,os);if(r.setDefaultInterface(t,e),r.owner.isPlayed&&r.isBuilt){var i=document.createElement("div");i.id="population",i.textContent=r.owner.population+"/"+r.owner.populationMax,t.appendChild(i)}}}}),e)}return e=o,(r=[{key:"afterFinalTextures",value:function(){if(0===this.owner.age){var t=os.cache.get("347"),e=new na(t.animations.fire);e.name="deco",e.allowMove=!1,e.allowClick=!1,e.interactive=!1,e.roundPixels=!0,e.x=10,e.y=5,e.play(),e.animationSpeed=.2*ch,this.addChild(e)}else{var r=this.getChildByName("deco");r&&r.destroy()}}},{key:"onBuilt",value:function(){var t=this,e=this.context.menu;this.owner.populationMax+=4,this.selected&&this.owner.isPlayed&&e.updateInfo("population",(function(e){return e.textContent=t.owner.population+"/"+t.owner.populationMax}))}}])&&Nu(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(Dc);function zu(t){return zu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zu(t)}function Hu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function Xu(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Hu(Object(r),!0).forEach((function(e){Vu(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Hu(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Vu(t,e,r){return(e=Wu(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Wu(t){var e=function(t,e){if("object"!==zu(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==zu(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===zu(e)?e:String(e)}function Yu(t,e){return Yu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Yu(t,e)}function $u(t){return $u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$u(t)}var qu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Yu(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$u(r);if(i){var n=$u(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===zu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.owner,h=t.isBuilt,l=void 0!==h&&h;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var c="Market",u=os.cache.get("config").buildings[c],d=Za(qa(u.size),os),f=on.from(d);return f.updateAnchor=!0,f.name="sprite",r=n.call(this,Xu(Xu({i,j:o,owner:a,type:c,sprite:f,isBuilt:l},u),{},{interface:{info:function(t){var e=Ka(r.type,r.owner,os);r.setDefaultInterface(t,e)},menu:a.isPlayed?[e.menu.getTechnologyButton("Woodworking")]:[]}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Dc);function Ku(t){return Ku="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ku(t)}function Zu(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function Qu(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Zu(Object(r),!0).forEach((function(e){Ju(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Zu(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Ju(t,e,r){return(e=td(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function td(t){var e=function(t,e){if("object"!==Ku(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Ku(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Ku(e)?e:String(e)}function ed(t,e){return ed=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ed(t,e)}function rd(t){return rd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},rd(t)}var id=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ed(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=rd(r);if(i){var n=rd(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ku(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.owner,h=t.isBuilt,l=void 0!==h&&h;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var c="SiegeWorkshop",u=os.cache.get("config").buildings[c],d=Za(qa(u.size),os),f=on.from(d);return f.updateAnchor=!0,f.name="sprite",r=n.call(this,Qu(Qu({i,j:o,owner:a,type:c,sprite:f,isBuilt:l},u),{},{interface:{info:function(t){var e=Ka(r.type,r.owner,os);r.setDefaultInterface(t,e)},menu:(a.isPlayed,[])}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Dc);function nd(t){return nd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nd(t)}function sd(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function od(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?sd(Object(r),!0).forEach((function(e){ad(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):sd(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ad(t,e,r){return(e=hd(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function hd(t){var e=function(t,e){if("object"!==nd(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==nd(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===nd(e)?e:String(e)}function ld(t,e){return ld=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ld(t,e)}function cd(t){return cd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},cd(t)}var ud=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ld(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=cd(r);if(i){var n=cd(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===nd(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.owner,h=t.isBuilt,l=void 0!==h&&h;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var c="Stable",u=os.cache.get("config").buildings[c],d=Za(qa(u.size),os),f=on.from(d);return f.updateAnchor=!0,f.name="sprite",r=n.call(this,od(od({i,j:o,owner:a,type:c,sprite:f,isBuilt:l},u),{},{interface:{info:function(t){var e=Ka(r.type,r.owner,os);r.setDefaultInterface(t,e)},menu:a.isPlayed?[e.menu.getUnitButton("Scout")]:[]}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Dc);function dd(t){return dd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dd(t)}function fd(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function pd(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?fd(Object(r),!0).forEach((function(e){md(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):fd(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function md(t,e,r){return(e=gd(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function gd(t){var e=function(t,e){if("object"!==dd(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==dd(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===dd(e)?e:String(e)}function yd(t,e){return yd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yd(t,e)}function vd(t){return vd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vd(t)}var bd=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yd(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=vd(r);if(i){var n=vd(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===dd(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.owner,h=t.isBuilt,l=void 0!==h&&h;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var c="StoragePit",u=os.cache.get("config").buildings[c],d=Za(qa(u.size),os),f=on.from(d);return f.updateAnchor=!0,f.name="sprite",r=n.call(this,pd(pd({i,j:o,owner:a,type:c,sprite:f,isBuilt:l},u),{},{interface:{info:function(t){var e=Ka(r.type,r.owner,os);r.setDefaultInterface(t,e)}}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Dc);function xd(t){return xd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xd(t)}function _d(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function wd(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_d(Object(r),!0).forEach((function(e){Ed(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_d(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Ed(t,e,r){return(e=Td(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Td(t){var e=function(t,e){if("object"!==xd(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==xd(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===xd(e)?e:String(e)}function Ad(t,e){return Ad=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ad(t,e)}function Sd(t){return Sd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Sd(t)}var Pd=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ad(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Sd(r);if(i){var n=Sd(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===xd(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.owner,h=t.isBuilt,l=void 0!==h&&h;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var c="Temple",u=os.cache.get("config").buildings[c],d=Za(qa(u.size),os),f=on.from(d);return f.updateAnchor=!0,f.name="sprite",r=n.call(this,wd(wd({i,j:o,owner:a,type:c,sprite:f,isBuilt:l},u),{},{interface:{info:function(t){var e=Ka(r.type,r.owner,os);r.setDefaultInterface(t,e)},menu:a.isPlayed?[e.menu.getUnitButton("Priest")]:[]}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Dc);function Od(t){return Od="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Od(t)}function Cd(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function Rd(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Cd(Object(r),!0).forEach((function(e){Id(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Cd(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Id(t,e,r){return(e=Bd(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Md(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Bd(i.key),i)}}function Bd(t){var e=function(t,e){if("object"!==Od(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Od(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Od(e)?e:String(e)}function Dd(t,e){return Dd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Dd(t,e)}function jd(t){return jd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},jd(t)}var kd=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Dd(t,e)}(o,t);var e,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=jd(i);if(n){var r=jd(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Od(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(t,e){var r,i=t.i,n=t.j,a=t.owner,h=t.isBuilt,l=void 0!==h&&h;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var c="TownCenter",u=os.cache.get("config").buildings[c],d=Za(qa(u.size),os),f=on.from(d);return f.updateAnchor=!0,f.name="sprite",r=s.call(this,Rd(Rd({i,j:n,owner:a,type:c,sprite:f,isBuilt:l},u),{},{interface:{info:function(t){var e=Ka(r.type,r.owner,os);r.setDefaultInterface(t,e)},menu:a.isPlayed?[e.menu.getUnitButton("Villager"),e.menu.getTechnologyButton("ToolAge"),e.menu.getTechnologyButton("BronzeAge"),e.menu.getTechnologyButton("IronAge")]:[]}}),e)}return e=o,(r=[{key:"onBuilt",value:function(){var t=this,e=this.context.menu;this.owner.populationMax+=4,this.selected&&this.owner.isPlayed&&e.updateInfo("population",(function(e){return e.textContent=t.owner.population+"/"+t.owner.populationMax}))}}])&&Md(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(Dc);function Nd(t){return Nd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nd(t)}function Ld(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function Fd(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ld(Object(r),!0).forEach((function(e){Ud(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ld(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Ud(t,e,r){return(e=Gd(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Gd(t){var e=function(t,e){if("object"!==Nd(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Nd(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Nd(e)?e:String(e)}function zd(t,e){return zd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},zd(t,e)}function Hd(t){return Hd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Hd(t)}var Xd=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zd(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Hd(r);if(i){var n=Hd(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Nd(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.owner,h=t.isBuilt,l=void 0!==h&&h;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var c="WatchTower",u=os.cache.get("config").buildings[c],d=Za(qa(u.size),os),f=on.from(d);return f.updateAnchor=!0,f.name="sprite",r=n.call(this,Fd(Fd({i,j:o,owner:a,type:c,sprite:f,isBuilt:l,isUsedBy:null},u),{},{interface:{info:function(t){var e=Ka(r.type,r.owner,os);r.setDefaultInterface(t,e)}}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Dc);function Vd(t){return Vd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vd(t)}function Wd(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var i,n,s,o,a=[],h=!0,l=!1;try{if(s=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;h=!1}else for(;!(h=(i=s.call(r)).done)&&(a.push(i.value),a.length!==e);h=!0);}catch(t){l=!0,n=t}finally{try{if(!h&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(l)throw n}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Yd(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Yd(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yd(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function $d(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==Vd(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Vd(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key),"symbol"===Vd(n)?n:String(n)),i)}var n}function qd(t,e){return qd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},qd(t,e)}function Kd(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Zd(t){return Zd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Zd(t)}var Qd=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qd(t,e)}(a,t);var r,i,n,s,o=(n=a,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Zd(n);if(s){var r=Zd(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Vd(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Kd(t)}(this,t)});function a(t,e){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this)).context=e;var i=Kd(r).context.map;r.setParent(i),r.id=i.children.length,r.name="unit",Object.keys(t).forEach((function(e){r[e]=t[e]})),r.x=i.grid[r.i][r.j].x,r.y=i.grid[r.i][r.j].y,r.z=i.grid[r.i][r.j].z,r.dest=null,r.realDest=null,r.previousDest=null,r.path=[],r.zIndex=jh(Kd(r)),r.selected=!1,r.degree=Mh(1,360),r.currentFrame=Mh(0,4),r.action=null,r.loading=0,r.loadingType=null,r.loadingMax=10,r.currentSheet=null,r.size=1,r.visible=!1,r.currentCell=i.grid[r.i][r.j],r.currentCell.has=Kd(r),r.currentCell.solid=!0,r.isDead=!1,r.isDestroyed=!1;for(var n=0,s=Object.entries(r.assets);n<s.length;n++){var h=Wd(s[n],2),l=h[0],c=h[1];r[l]=os.cache.get(c)}return r.hitPoints=r.totalHitPoints,r.inactif=!0,r.allowMove=!1,r.interactive=!0,r.sprite=new na(r.standingSheet.animations.south),r.sprite.name="sprite",r.sprite.allowMove=!1,r.sprite.interactive=!1,r.sprite.allowClick=!1,r.sprite.roundPixels=!0,r.on("pointerdown",(function(){var t=Kd(r).context,e=t.controls,i=t.player;e.mouseBuilding||e.mouseRectangle||!e.isMouseInApp()||(e.clicked&&(r.owner.isPlayed&&e.getCellOnCamera((function(t){i.selectedUnits.length<Eh&&t.has&&t.has.owner===r.owner&&t.has.type===r.type&&(t.has.select(),i.selectedUnits.push(t.has))})),e.doubleClicked=!0),e.clicked=!1)})),r.on("pointerup",(function(){var t=Kd(r).context,e=t.controls,n=t.player,s=t.menu;if(!(e.doubleClicked||e.mouseBuilding||e.mouseRectangle)&&e.isMouseInApp())if(e.mouse.prevent=!0,e.clicked=!0,e.double=setTimeout((function(){e.clicked=!1,e.doubleClicked=!1}),600),r.owner.isPlayed){var o=!1;if(n.selectedUnits.length)for(var a=0;a<n.selectedUnits.length;a++){var h=n.selectedUnits[a];"healer"===h.work&&r.getActionCondition(h,"heal")&&(o=!0,h.sendTo(Kd(r),"heal"))}o?th(Kd(r)):(r.owner.unselectAll(),r.select(),s.setBottombar(Kd(r)),r.owner.selectedUnit=Kd(r),r.owner.selectedUnits=[Kd(r)])}else{var l=!1;if(n.selectedUnits.length)for(var c=0;c<n.selectedUnits.length;c++){var u=n.selectedUnits[c];r.getActionCondition(u,"attack")&&("Villager"===u.type?(l=!0,u.sendToAttack(Kd(r))):"attacker"===u.work&&(l=!0,u.sendTo(Kd(r),"attack")))}l?th(Kd(r)):(al(Kd(r),n)||i.revealEverything)&&(n.unselectAll(),r.select(),s.setBottombar(Kd(r)),n.selectedOther=Kd(r))}})),Ja(r.sprite,r.owner.color),r.interval=null,r.sprite.updateAnchor=!0,r.addChild(r.sprite),r.stop(),nl(Kd(r)),r}return r=a,i=[{key:"select",value:function(){if(!this.selected){var t=this.context.menu;this.selected=!0;var e=new wo;e.name="selection",e.zIndex=3,e.lineStyle(1,16777215),e.drawPolygon([-16,0,0,-8,16,0,0,8]),this.addChildAt(e,0),t.updatePlayerMiniMapEvt(this.owner)}}},{key:"unselect",value:function(){if(this.selected){var t=this.context.menu;this.selected=!1;var e=this.getChildByName("selection");e&&this.removeChild(e),t.updatePlayerMiniMapEvt(this.owner)}}},{key:"hasPath",value:function(){return this.path.length>0}},{key:"setDest",value:function(t){t?(this.dest=t,this.realDest={i:t.i,j:t.j,x:t.x,y:t.y,id:t.id}):this.stop()}},{key:"setPath",value:function(t){var e=this;t.length?(this.setTextures("walkingSheet"),this.inactif=!1,this.path=t,this.startInterval((function(){return e.step()}),uh)):this.stop()}},{key:"handleChangeDest",value:function(){this.dest&&this.dest.isUsedBy===this&&(this.dest.isUsedBy=null)}},{key:"sendTo",value:function(t,e){var r=this.context.map;this.handleChangeDest(),this.stopInterval();var i=[];if(t){if(this.isUnitAtDest(e,t))return this.setDest(t),this.action=e,this.degree=Nh(this,t.x,t.y),void this.getAction(e);if(r.grid[t.i]&&r.grid[t.i][t.j]&&r.grid[t.i][t.j].solid){if(!(i=tl(this,t,r)).length&&this.work)return this.action=e,void this.affectNewDest()}else i=el(this,t.i,t.j,r);i.length?(this.setDest(t),this.action=e,this.setPath(i)):this.stop()}}},{key:"getActionCondition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.action;return Wh(this,t,e,arguments.length>2?arguments[2]:void 0)}},{key:"goBackToPrevious",value:function(){var t=this.context.map,e={Stone:"minestone",Gold:"minegold",Berrybush:"forageberry",Tree:"chopwood"};if(this.previousDest){var r=this.previousDest;if(this.previousDest=null,"animal"===r.name)this.getActionCondition(r,"takemeat")?this.sendToTakeMeat(r):this.sendTo(t.grid[r.i][r.j],"hunt");else if("building"===r.name)this.getActionCondition(r,"build")?this.sendToBuilding(r):this.sendTo(t.grid[r.i][r.j],"build");else if(e[r.type])if(this.getActionCondition(r,e[r.type])){var i="sendTo".concat(r.type);"function"==typeof this[i]?this[i](r):this.stop()}else this.sendTo(t.grid[r.i][r.j],e[r.type]);else this.sendTo(t.grid[r.i][r.j])}else this.stop()}},{key:"getAction",value:function(t){var r=this,i=this.context,n=i.menu,s=i.player,o=i.map;switch(this.sprite.onLoop=null,this.sprite.onFrameChange=null,t){case"delivery":if(!this.getActionCondition(this.dest,this.action))return void this.stop();this.owner[dh.includes(this.loadingType)?"food":this.loadingType]+=this.loading,this.owner.isPlayed&&n.updateTopbar(),this.loading=0,this.updateInterfaceLoading(),this.allAssets[this.work]&&(this.standingSheet=os.cache.get(this.allAssets[this.work].standingSheet),this.walkingSheet=os.cache.get(this.allAssets[this.work].walkingSheet)),this.previousDest?this.goBackToPrevious():this.stop();break;case"farm":if(!this.getActionCondition(this.dest))return void this.affectNewDest();this.dest.isUsedBy=this,this.setTextures("actionSheet"),this.startInterval((function(){return r.getActionCondition(r.dest)?(r.dest.isUsedBy=r,r.loading!==r.loadingMax&&r.dest?(r.loading++,r.loadingType="wheat",r.updateInterfaceLoading(),r.dest.quantity=Math.max(r.dest.quantity-r.attack,0),r.dest.selected&&r.owner.isPlayed&&n.updateInfo("quantity-text",(function(t){return t.textContent=r.dest.quantity})),r.dest.quantity<=0&&(r.dest.die(),r.affectNewDest()),void(r.loading>0&&(r.allAssets[r.work]&&(r.walkingSheet=os.cache.get(r.allAssets[r.work].loadedSheet)),r.standingSheet=null))):(r.sendToDelivery(),void(r.dest.isUsedBy=null))):(r.dest.quantity<=0&&r.dest.die(),void r.affectNewDest())}),1e3*this.gatheringRate[this.work],!1);break;case"chopwood":if(!this.getActionCondition(this.dest))return void this.affectNewDest();this.setTextures("actionSheet"),this.startInterval((function(){if(!r.getActionCondition(r.dest))return r.dest.quantity<=0&&r.dest.die(),void r.affectNewDest();r.loading!==r.loadingMax&&r.dest?r.dest.hitPoints>0?(r.dest.hitPoints=Math.max(r.dest.hitPoints-r.attack,0),r.dest.selected&&r.owner.isPlayed&&n.updateInfo("hitPoints",(function(t){return r.dest.hitPoints>0?t.textContent=r.dest.hitPoints+"/"+r.dest.totalHitPoints:t.textContent=""})),r.dest.hitPoints<=0&&(r.dest.hitPoints=0,r.dest.setCuttedTreeTexture())):(r.loading++,r.loadingType="wood",r.updateInterfaceLoading(),r.dest.quantity=Math.max(r.dest.quantity-r.attack,0),r.dest.selected&&r.owner.isPlayed&&n.updateInfo("quantity-text",(function(t){return t.textContent=r.dest.quantity})),r.dest.quantity<=0&&(r.dest.die(),r.affectNewDest()),r.loading>0&&(r.allAssets[r.work]&&(r.walkingSheet=os.cache.get(r.allAssets[r.work].loadedSheet)),r.standingSheet=null)):r.sendToDelivery()}),1e3*this.gatheringRate[this.work],!1);break;case"forageberry":if(!this.getActionCondition(this.dest))return void this.affectNewDest();this.setTextures("actionSheet"),this.startInterval((function(){if(!r.getActionCondition(r.dest))return r.dest.quantity<=0&&r.dest.die(),void r.affectNewDest();r.loading!==r.loadingMax&&r.dest?(r.loading++,r.loadingType="berry",r.updateInterfaceLoading(),r.dest.quantity=Math.max(r.dest.quantity-r.attack,0),r.dest.selected&&r.owner.isPlayed&&n.updateInfo("quantity-text",(function(t){return t.textContent=r.dest.quantity})),r.dest.quantity<=0&&(r.dest.die(),r.affectNewDest()),r.loading>0&&(r.allAssets[r.work]&&(r.walkingSheet=os.cache.get(r.allAssets[r.work].loadedSheet)),r.standingSheet=null)):r.sendToDelivery()}),1e3*this.gatheringRate[this.work],!1);break;case"minestone":if(!this.getActionCondition(this.dest))return void this.affectNewDest();this.setTextures("actionSheet"),this.startInterval((function(){if(!r.getActionCondition(r.dest))return r.dest.quantity<=0&&r.dest.die(),void r.affectNewDest();r.loading!==r.loadingMax&&r.dest?(r.loading++,r.loadingType="stone",r.updateInterfaceLoading(),r.dest.quantity=Math.max(r.dest.quantity-r.attack,0),r.dest.selected&&r.owner.isPlayed&&n.updateInfo("quantity-text",(function(t){return t.textContent=r.dest.quantity})),r.dest.quantity<=0&&(r.dest.die(),r.affectNewDest()),r.loading>0&&(r.allAssets[r.work]&&(r.walkingSheet=os.cache.get(r.allAssets[r.work].loadedSheet)),r.standingSheet=null)):r.sendToDelivery()}),1e3*this.gatheringRate[this.work],!1);break;case"minegold":if(!this.getActionCondition(this.dest))return void this.affectNewDest();this.setTextures("actionSheet"),this.startInterval((function(){r.getActionCondition(r.dest)?r.loading!==r.loadingMax&&r.dest?(r.loading++,r.loadingType="gold",r.updateInterfaceLoading(),r.dest.quantity=Math.max(r.dest.quantity-r.attack,0),r.dest.selected&&r.owner.isPlayed&&n.updateInfo("quantity-text",(function(t){return t.textContent=r.dest.quantity})),r.dest.quantity<=0&&(r.dest.die(),r.affectNewDest()),r.loading>0&&(r.allAssets[r.work]&&(r.walkingSheet=os.cache.get(r.allAssets[r.work].loadedSheet)),r.standingSheet=null)):r.sendToDelivery():r.affectNewDest()}),1e3*this.gatheringRate[this.work],!1);break;case"build":if(!this.getActionCondition(this.dest))return void this.affectNewDest();this.setTextures("actionSheet"),this.startInterval((function(){if(!r.getActionCondition(r.dest))return"Farm"!==r.dest.type||r.dest.isUsedBy||r.sendToFarm(r.dest),void r.affectNewDest();r.dest.hitPoints<r.dest.totalHitPoints?(r.dest.hitPoints=Math.min(Math.round(r.dest.hitPoints+r.dest.totalHitPoints/r.dest.constructionTime),r.dest.totalHitPoints),r.dest.selected&&r.owner.isPlayed&&n.updateInfo("hitPoints",(function(t){return t.textContent=r.dest.hitPoints+"/"+r.dest.totalHitPoints})),r.dest.updateLife(r.action)):(r.dest.isBuilt||(r.dest.updateLife(r.action),r.dest.isBuilt=!0,"Farm"!==r.dest.type||r.dest.isUsedBy||r.sendToFarm(r.dest)),r.affectNewDest())}),1e3,!1);break;case"attack":if(!this.getActionCondition(this.dest))return void this.affectNewDest();this.setTextures("actionSheet"),this.range&&"Villager"!==this.type?(this.sprite.onLoop=function(){if(!r.getActionCondition(r.dest))return r.dest&&r.dest.hitPoints<=0&&r.dest.die(),void r.affectNewDest();if(r.isUnitAtDest(r.action,r.dest)){if(r.destHasMoved()){r.realDest.i=r.dest.i,r.realDest.j=r.dest.j,r.realDest.x=r.dest.x,r.realDest.y=r.dest.y;var t=r.degree;r.degree=Nh(r,r.dest.x,r.dest.y),Hh(t)!==Hh(r.degree)&&r.setTextures("actionSheet")}}else r.stop()},ih(this.sprite,6,(function(){var t=new e[r.projectile]({owner:r,target:r.dest,destination:r.realDest},r.context);o.addChild(t)}))):this.startInterval((function(){if(!r.getActionCondition(r.dest))return r.dest&&r.dest.hitPoints<=0&&r.dest.die(),void r.affectNewDest();if(r.destHasMoved()){r.realDest.i=r.dest.i,r.realDest.j=r.dest.j,r.realDest.x=r.dest.x,r.realDest.y=r.dest.y;var t=r.degree;r.degree=Nh(r,r.dest.x,r.dest.y),Hh(t)!==Hh(r.degree)&&r.setTextures("actionSheet")}r.isUnitAtDest(r.action,r.dest)?r.dest.hitPoints>0&&(r.dest.hitPoints=Math.max(r.dest.hitPoints-r.attack,0),!r.dest.selected||s.selectedUnit!==r.dest&&s.selectedBuilding!==r.dest&&s.selectedOther!==r.dest||n.updateInfo("hitPoints",(function(t){return t.textContent=r.dest.hitPoints+"/"+r.dest.totalHitPoints})),r.dest.isAttacked(r),r.dest.hitPoints<=0&&(r.dest.die(),r.affectNewDest())):r.sendTo(r.dest,"attack")}),1e3*this.rateOfFire,!1);break;case"heal":if(!this.getActionCondition(this.dest))return void this.affectNewDest();this.setTextures("actionSheet"),this.sprite.onLoop=function(){if(r.getActionCondition(r.dest)){if(r.destHasMoved()){r.realDest.i=r.dest.i,r.realDest.j=r.dest.j,r.realDest.x=r.dest.x,r.realDest.y=r.dest.y;var t=r.degree;r.degree=Nh(r,r.dest.x,r.dest.y),Hh(t)!==Hh(r.degree)&&r.setTextures("actionSheet")}r.isUnitAtDest(r.action,r.dest)?r.dest.hitPoints<r.dest.totalHitPoints&&(r.dest.hitPoints=Math.min(r.dest.hitPoints+r.healing,r.dest.totalHitPoints),r.dest.selected&&s.selectedUnit===r.dest&&n.updateInfo("hitPoints",(function(t){return t.textContent=r.dest.hitPoints+"/"+r.dest.totalHitPoints}))):r.sendTo(r.dest,"heal")}else r.affectNewDest()};break;case"takemeat":if(!this.getActionCondition(this.dest))return void this.affectNewDest();this.setTextures("actionSheet"),this.startInterval((function(){r.getActionCondition(r.dest)?r.loading!==r.loadingMax&&r.dest?(r.loading++,r.loadingType="meat",r.updateInterfaceLoading(),r.dest.quantity=Math.max(r.dest.quantity-r.attack,0),r.dest.updateTexture(),r.dest.selected&&r.owner.isPlayed&&n.updateInfo("quantity-text",(function(t){return t.textContent=r.dest.quantity})),r.loading>0&&(r.allAssets[r.work]&&(r.walkingSheet=os.cache.get(r.allAssets[r.work].loadedSheet)),r.standingSheet=null),r.dest.quantity<=0&&r.affectNewDest()):r.sendToDelivery():r.affectNewDest()}),1e3*this.gatheringRate[this.work],!1);break;case"hunt":if(!this.getActionCondition(this.dest))return void this.affectNewDest();this.dest.isDead&&(this.previousDest?this.goBackToPrevious():this.sendToTakeMeat(this.dest)),this.setTextures("actionSheet"),this.sprite.onLoop=function(){if(!r.getActionCondition(r.dest))return r.dest&&r.dest.hitPoints<=0?(r.dest.die(),void(r.previousDest?r.goBackToPrevious():r.sendToTakeMeat(r.dest))):void r.affectNewDest();if(r.isUnitAtDest(r.action,r.dest)){if(r.destHasMoved()){r.realDest.i=r.dest.i,r.realDest.j=r.dest.j,r.realDest.x=r.dest.x,r.realDest.y=r.dest.y;var t=r.degree;r.degree=Nh(r,r.dest.x,r.dest.y),Hh(t)!==Hh(r.degree)&&r.setTextures("actionSheet")}}else r.stop()},ih(this.sprite,6,(function(){var t=new Oc({owner:r,target:r.dest,destination:r.realDest,attack:4},r.context);o.addChild(t)}));break;default:this.stop()}}},{key:"handleAffectNewDestHunter",value:function(){var t=this,e=il(this,(function(e){return t.getActionCondition(e,"takemeat")}));if(e.length){var r=ul(this,e);if(r)return"takemeat"!==this.action&&(this.action="takemeat",this.allAssets[this.work]&&(this.actionSheet=os.cache.get(this.allAssets[this.work].harvestSheet))),Kh(this,r)?(this.degree=Nh(this,r.x,r.y),this.getAction(this.action),!0):(this.setDest(r.instance),this.setPath(r.path),!0)}var i=il(this,(function(e){return t.getActionCondition(e,"hunt")}));if(i.length){var n=ul(this,i);if(n)return"hunt"!==this.action&&(this.action="hunt",this.allAssets[this.work]&&(this.actionSheet=os.cache.get(this.allAssets[this.work].actionSheet))),Kh(this,n)?(this.degree=Nh(this,n.x,n.y),this.getAction(this.action),!0):(this.setDest(n.instance),this.setPath(n.path),!0)}return!1}},{key:"upgrade",value:function(t){var e=this.context,r=e.player,i=e.menu,n=os.cache.get("config").units[t];this.type=t,this.hitPoints=n.totalHitPoints-(this.totalHitPoints-this.hitPoints);for(var s=0,o=Object.entries(n);s<o.length;s++){var a=Wd(o[s],2),h=a[0],l=a[1];this[h]=l}for(var c=0,u=Object.entries(this.assets);c<u.length;c++){var d=Wd(u[c],2),f=d[0],p=d[1];this[f]=os.cache.get(p)}r.selectedUnit===this&&i.setBottombar(this),this.action&&!this.path.length?this.getAction(this.action):this.setTextures(this.currentSheet)}},{key:"affectNewDest",value:function(){var t=this;if(this.stopInterval(),this.previousDest&&"delivery"!==this.work)this.goBackToPrevious();else{var e=!1;if("Villager"!==this.type||"takemeat"!==this.action&&"hunt"!==this.action){if(!this.dest||"animal"!==this.dest.name){var r=il(this,(function(e){return t.getActionCondition(e)}));if(r.length){var i=ul(this,r);if(i)return Kh(this,i)?(this.degree=Nh(this,i.x,i.y),void this.getAction(this.action)):(this.setDest(i.instance),void this.setPath(i.path))}}}else e=this.handleAffectNewDestHunter();e||(this.loading&&!["builder","attacker","healer"].includes(this.work)?this.sendToDelivery():this.stop())}}},{key:"isUnitAtDest",value:function(t,e){return!!t&&(e?!("Villager"===this.type&&"hunt"!==t||!this.range||!(Dh(this,e)<=this.range))||Kh(this,e):(this.affectNewDest(),!1))}},{key:"destHasMoved",value:function(){return(this.dest.i!==this.realDest.i||this.dest.j!==this.realDest.j)&&Dh(this,this.dest)<=this.sight}},{key:"moveToPath",value:function(){var t=this.context.map,e=this.path[this.path.length-1],r=t.grid[e.i][e.j];if(this.dest&&!this.dest.isDestroyed)if(r.has&&("unit"===r.has.name||"animal"===r.has.name)&&r.has!==this&&r.has.hasPath()&&Dh(this,r.has)<=1&&r.has.sprite.playing)this.sprite.stop();else if(r.solid&&this.dest)this.sendTo(this.dest,this.action);else if(this.sprite.playing||this.sprite.play(),this.zIndex=jh(this),Dh(this,r,!1)<=this.speed){if(sl(this),this.z=r.z,this.i=r.i,this.j=r.j,this.currentCell.has===this&&(this.currentCell.has=null,this.currentCell.solid=!1),this.currentCell=t.grid[this.i][this.j],null===this.currentCell.has&&(this.currentCell.has=this,this.currentCell.solid=!0),nl(this),this.path.pop(),this.destHasMoved())return void this.sendTo(this.dest,this.action);if(this.isUnitAtDest(this.action,this.dest))return this.path=[],this.stopInterval(),this.degree=Nh(this,this.dest.x,this.dest.y),void this.getAction(this.action);this.path.length||this.stop()}else{var i=this.context.menu,n=this.degree;Zh(this,r.x,r.y,this.speed),i.updatePlayerMiniMap(this.owner),Hh(n)!==Hh(this.degree)&&this.setTextures("walkingSheet")}else this.affectNewDest()}},{key:"isAttacked",value:function(t){if(t&&this.dest!==t){var e=this.dest;"Villager"===this.type?"animal"===t.name?this.sendToHunt(t):this.sendToAttack(t):this.sendTo(t,"attack"),this.previousDest=e}}},{key:"stop",value:function(){this.currentCell.has!==this&&this.currentCell.solid?this.sendTo(this.currentCell):(this.handleChangeDest(),this.inactif=!0,this.action=null,this.dest=null,this.realDest=null,this.currentCell.has=this,this.currentCell.solid=!0,this.path=[],this.stopInterval(),this.setTextures("standingSheet"))}},{key:"startInterval",value:function(t,e){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.stopInterval(),r&&t(),this.interval=setInterval(t,e)}},{key:"stopInterval",value:function(){this.interval&&(clearInterval(this.interval),this.interval=null)}},{key:"step",value:function(){this.hitPoints<=0&&this.die(),this.hasPath()&&this.moveToPath()}},{key:"explore",value:function(){for(var t,e=this,r=this.context.map,i=3;i<50;i++)if(ll(this.i,this.j,r.grid,i,(function(r){e.owner.views[r.i][r.j].viewed||r.solid||(t=e.owner.views[r.i][r.j])})),t){this.sendTo(t);break}}},{key:"runaway",value:function(t){var e=this,r=this.context.map,i=null;ll(this.i,this.j,r.grid,this.sight,(function(r){r.solid||i&&!(pointsDistance(r.i,r.j,t.i,t.j)>pointsDistance(i.i,i.j,t.i,t.j))||(i=e.owner.views[r.i][r.j])})),i?this.sendTo(i):this.stop()}},{key:"die",value:function(){var t=this,e=this.context,r=e.player,i=e.map;if(!this.isDead){if(this.stopInterval(),this.selected&&r.selectedOther===this&&r.unselectUnit(this),this.dest&&this.dest.isUsedBy===this&&(this.dest.isUsedBy=null),this.path=[],this.action=null,this.interactive=!1,this.isDead=!0,this.unselect(),clearInterval(this.interval),this.owner){this.owner.population--;var n=this.owner.units.indexOf(this);n>=0&&this.owner.units.splice(n,1),this.owner.selectedUnits&&(n=this.owner.selectedUnits.indexOf(this))>=0&&this.owner.selectedUnits.splice(n,1)}this.setTextures("dyingSheet"),this.sprite.loop=!1,this.sprite.onComplete=function(){sl(t),t.setTextures("corpseSheet"),t.zIndex--,i.grid[t.i][t.j].has===t&&(i.grid[t.i][t.j].has=null,i.grid[t.i][t.j].corpses.push(t),i.grid[t.i][t.j].solid=!1),t.sprite.animationSpeed=1/12e4*ch,t.sprite.onComplete=function(){t.clear()}}}}},{key:"clear",value:function(){if(!this.isDestroyed){var t=this.context.map;this.isDestroyed=!0,t.grid[this.i][this.j].corpses.splice(t.grid[this.i][this.j].corpses.indexOf(this),1),t.removeChild(this),this.destroy({child:!0,texture:!0})}}},{key:"setTextures",value:function(t){if(!this[t])return"walkingSheet"!==this.currentSheet&&this.walkingSheet?this.sprite.textures=[this.walkingSheet.textures[Object.keys(this.walkingSheet.textures)[0]]]:this.sprite.textures=[this.sprite.textures[this.sprite.currentFrame]],this.currentSheet="walkingSheet",this.sprite.stop(),void this.sprite.anchor.set(this.sprite.textures[this.sprite.currentFrame].defaultAnchor.x,this.sprite.textures[this.sprite.currentFrame].defaultAnchor.y);["actionSheet"].includes(t)||(this.sprite.onLoop=null,this.sprite.onFrameChange=null),this.currentSheet=t;var e=Hh(this.degree);switch(e){case"southest":this.sprite.scale.x=-1,this.sprite.textures=this[t].animations.southwest;break;case"northest":this.sprite.scale.x=-1,this.sprite.textures=this[t].animations.northwest;break;case"est":this.sprite.scale.x=-1,this.sprite.textures=this[t].animations.west;break;default:this.sprite.scale.x=1,this.sprite.textures=this[t].animations[e]}this.sprite.animationSpeed=(this[t].data.animationSpeed||("standingSheet"===t?.15:.3))*ch,this.sprite.play()}},{key:"setDefaultInterface",value:function(t,e){var r=document.createElement("div");r.id="civ",r.textContent=this.owner.civ,t.appendChild(r);var i=document.createElement("div");i.id="type",i.textContent=this.type,t.appendChild(i);var n=document.createElement("img");n.id="icon",n.src=$a(e.icon),t.appendChild(n);var s=document.createElement("div");s.id="hitPoints",s.textContent=this.hitPoints+"/"+this.totalHitPoints,t.appendChild(s)}}],i&&$d(r.prototype,i),Object.defineProperty(r,"prototype",{writable:!1}),a}(rn);function Jd(t){return Jd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jd(t)}function tf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function ef(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?tf(Object(r),!0).forEach((function(e){rf(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):tf(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function rf(t,e,r){return(e=nf(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function nf(t){var e=function(t,e){if("object"!==Jd(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Jd(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Jd(e)?e:String(e)}function sf(t,e){return sf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},sf(t,e)}function of(t){return of=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},of(t)}var af=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&sf(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=of(r);if(i){var n=of(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Jd(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.type,h=t.owner;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var l=os.cache.get("config").units[a];return r=n.call(this,ef(ef({i,j:o,owner:h,type:a},l),{},{work:"Priest"===a?"healer":"attacker",interface:{info:function(t){var e=os.cache.get("config").units[r.type];r.setDefaultInterface(t,e)}}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Qd);function hf(t){return hf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hf(t)}function lf(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var i,n,s,o,a=[],h=!0,l=!1;try{if(s=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;h=!1}else for(;!(h=(i=s.call(r)).done)&&(a.push(i.value),a.length!==e);h=!0);}catch(t){l=!0,n=t}finally{try{if(!h&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(l)throw n}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return cf(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?cf(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cf(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function uf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function df(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?uf(Object(r),!0).forEach((function(e){ff(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):uf(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ff(t,e,r){return(e=mf(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function pf(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,mf(i.key),i)}}function mf(t){var e=function(t,e){if("object"!==hf(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==hf(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===hf(e)?e:String(e)}function gf(t,e){return gf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},gf(t,e)}function yf(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function vf(t){return vf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vf(t)}var bf={default:{standingSheet:"418",walkingSheet:"657",dyingSheet:"314",corpseSheet:"373"},attack:{actionSheet:"224",standingSheet:"418",dyingSheet:"314",walkingSheet:"657",corpseSheet:"373"},hunter:{actionSheet:"624",harvestSheet:"626",standingSheet:"435",walkingSheet:"676",dyingSheet:"332",corpseSheet:"389",loadedSheet:"272"},farmer:{actionSheet:"630",standingSheet:"430",walkingSheet:"670",dyingSheet:"326",corpseSheet:"388",loadedSheet:"672"},forager:{actionSheet:"632",standingSheet:"432",walkingSheet:"672",dyingSheet:"328",corpseSheet:"390",loadedSheet:"672"},stoneminer:{actionSheet:"633",standingSheet:"441",walkingSheet:"683",dyingSheet:"315",corpseSheet:"400",loadedSheet:"274"},goldminer:{actionSheet:"633",standingSheet:"441",walkingSheet:"683",dyingSheet:"315",corpseSheet:"400",loadedSheet:"281"},woodcutter:{actionSheet:"625",standingSheet:"440",walkingSheet:"682",dyingSheet:"315",corpseSheet:"399",loadedSheet:"273"},builder:{actionSheet:"628",standingSheet:"419",walkingSheet:"658",dyingSheet:"315",corpseSheet:"374"}},xf=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gf(t,e)}(o,t);var e,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=vf(i);if(n){var r=vf(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===hf(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return yf(t)}(this,t)});function o(t,e){var r,i=t.i,n=t.j,a=t.owner;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var h="Villager",l=os.cache.get("config").units[h],c=os.cache.get("config").buildings,u=e.menu,d=Object.keys(c).map((function(t){return u.getBuildingButton(t)}));return r=s.call(this,df(df({i,j:n,owner:a,type:h,gatheringRate:{forager:1/.45,hunter:1/.4725,fisherman:1/.6,farmer:1/.45,woodcutter:1/.55,stoneminer:1/.5175,goldminer:1/.5175}},l),{},{assets:bf.default,allAssets:bf,interface:{info:function(t){var e=yf(r).owner;r.setDefaultInterface(t,l),e.isPlayed&&t.appendChild(r.getLoadingElement())},menu:a.isPlayed?[{icon:"interface/50721/002_50721.png",children:d}]:[]}}),e)}return e=o,(r=[{key:"updateInterfaceLoading",value:function(){var t=this,e=this.context.menu;this.selected&&this.owner.isPlayed&&this.owner.selectedUnit===this&&(1===this.loading?e.updateInfo("loading",(function(e){return e.innerHTML=t.getLoadingElement().outerHTML})):this.loading>1?e.updateInfo("loading-text",(function(e){return e.textContent=t.loading})):e.updateInfo("loading",(function(t){return t.innerHTML=""})))}},{key:"getLoadingElement",value:function(){var t=this.context.menu,e=document.createElement("div");if(e.className="unit-loading",e.id="loading",this.loading){var r=document.createElement("img");r.className="unit-loading-icon",r.src=t.icons[dh.includes(this.loadingType)?"food":this.loadingType];var i=document.createElement("div");i.id="loading-text",i.textContent=this.loading,e.appendChild(r),e.appendChild(i)}return e}},{key:"sendToAttack",value:function(t){return this.updateInterfaceLoading(),this.work="attacker",this.actionSheet=os.cache.get(bf.attack.actionSheet),this.standingSheet=os.cache.get(bf.attack.standingSheet),this.loading||(this.walkingSheet=os.cache.get(bf.attack.walkingSheet),this.dyingSheet=os.cache.get(bf.attack.dyingSheet),this.corpseSheet=os.cache.get(bf.attack.corpseSheet)),this.previousDest=null,this.sendTo(t,"attack")}},{key:"sendToTakeMeat",value:function(t){return dh.includes(this.loadingType)||(this.loading=0,this.updateInterfaceLoading()),"hunter"===this.work&&"takemeat"===this.action||(this.work="hunter",this.actionSheet=os.cache.get(bf.hunter.harvestSheet),this.standingSheet=os.cache.get(bf.hunter.standingSheet),this.loading||(this.walkingSheet=os.cache.get(bf.hunter.walkingSheet),this.dyingSheet=os.cache.get(bf.hunter.dyingSheet),this.corpseSheet=os.cache.get(bf.hunter.corpseSheet))),this.previousDest=null,this.sendTo(t,"takemeat")}},{key:"sendToHunt",value:function(t){return dh.includes(this.loadingType)||(this.loading=0,this.updateInterfaceLoading()),"hunter"===this.work&&"hunt"===this.action||(this.work="hunter",this.actionSheet=os.cache.get(bf.hunter.actionSheet),this.standingSheet=os.cache.get(bf.hunter.standingSheet),this.loading||(this.walkingSheet=os.cache.get(bf.hunter.walkingSheet),this.dyingSheet=os.cache.get(bf.hunter.dyingSheet),this.corpseSheet=os.cache.get(bf.hunter.corpseSheet))),this.previousDest=null,this.sendTo(t,"hunt")}},{key:"sendToDelivery",value:function(){for(var t=this,e=this.context.map,r=null,i=os.cache.get("config").buildings,n=0,s=Object.entries(i);n<s.length;n++){var o=lf(s[n],2),a=o[0],h=o[1];if("TownCenter"!==a&&h.accept&&h.accept.includes(this.loadingType)){r=a;break}}var l=cl(this,this.owner.buildings.filter((function(e){return Wh(t,e,"delivery",{buildingType:r})})));this.dest?this.previousDest=this.dest:this.previousDest=e.grid[this.i][this.j],this.sendTo(l,"delivery")}},{key:"sendToBuilding",value:function(t){return"builder"!==this.work&&(this.updateInterfaceLoading(),this.work="builder",this.actionSheet=os.cache.get(bf.builder.actionSheet),this.loading||(this.standingSheet=os.cache.get(bf.builder.standingSheet),this.walkingSheet=os.cache.get(bf.builder.walkingSheet),this.dyingSheet=os.cache.get(bf.builder.dyingSheet),this.corpseSheet=os.cache.get(bf.builder.corpseSheet))),this.previousDest=null,this.sendTo(t,"build")}},{key:"sendToFarm",value:function(t){return dh.includes(this.loadingType)||(this.loading=0,this.updateInterfaceLoading()),"farmer"!==this.work&&(this.work="farmer",this.actionSheet=os.cache.get(bf.farmer.actionSheet),this.loading||(this.standingSheet=os.cache.get(bf.farmer.standingSheet),this.walkingSheet=os.cache.get(bf.farmer.walkingSheet),this.dyingSheet=os.cache.get(bf.farmer.dyingSheet),this.corpseSheet=os.cache.get(bf.farmer.corpseSheet))),this.previousDest=null,this.sendTo(t,"farm")}},{key:"sendToTree",value:function(t){return"woodcutter"!==this.work&&(this.loading=0,this.updateInterfaceLoading(),this.work="woodcutter",this.actionSheet=os.cache.get(bf.woodcutter.actionSheet),this.standingSheet=os.cache.get(bf.woodcutter.standingSheet),this.walkingSheet=os.cache.get(bf.woodcutter.walkingSheet),this.dyingSheet=os.cache.get(bf.woodcutter.dyingSheet),this.corpseSheet=os.cache.get(bf.woodcutter.corpseSheet)),this.previousDest=null,this.sendTo(t,"chopwood")}},{key:"sendToBerrybush",value:function(t){return dh.includes(this.loadingType)||(this.loading=0,this.updateInterfaceLoading()),"forager"!==this.work&&(this.work="forager",this.actionSheet=os.cache.get(bf.forager.actionSheet),this.loading||(this.standingSheet=os.cache.get(bf.forager.standingSheet),this.walkingSheet=os.cache.get(bf.forager.walkingSheet),this.dyingSheet=os.cache.get(bf.forager.dyingSheet),this.corpseSheet=os.cache.get(bf.forager.corpseSheet))),this.previousDest=null,this.sendTo(t,"forageberry")}},{key:"sendToStone",value:function(t){return"stoneminer"!==this.work&&(this.loading=0,this.updateInterfaceLoading(),this.work="stoneminer",this.actionSheet=os.cache.get(bf.stoneminer.actionSheet),this.standingSheet=os.cache.get(bf.stoneminer.standingSheet),this.walkingSheet=os.cache.get(bf.stoneminer.walkingSheet),this.dyingSheet=os.cache.get(bf.stoneminer.dyingSheet),this.corpseSheet=os.cache.get(bf.stoneminer.corpseSheet)),this.previousDest=null,this.sendTo(t,"minestone")}},{key:"sendToGold",value:function(t){return"goldminer"!==this.work&&(this.loading=0,this.updateInterfaceLoading(),this.work="goldminer",this.actionSheet=os.cache.get(bf.goldminer.actionSheet),this.standingSheet=os.cache.get(bf.goldminer.standingSheet),this.walkingSheet=os.cache.get(bf.goldminer.walkingSheet),this.dyingSheet=os.cache.get(bf.goldminer.dyingSheet),this.corpseSheet=os.cache.get(bf.goldminer.corpseSheet)),this.previousDest=null,this.sendTo(t,"minegold")}}])&&pf(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(Qd);function _f(t){return _f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_f(t)}function wf(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function Ef(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==_f(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==_f(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key),"symbol"===_f(n)?n:String(n)),i)}var n}var Tf=function(){function t(e,r){var n=this,s=e.i,o=e.j,a=e.age,h=e.civ,l=e.color,c=e.type,u=e.isPlayed,d=void 0!==u&&u;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name="player",this.context=r;var f=r.map;this.id=Th(),this.parent=f,this.i=s,this.j=o,this.civ=h,this.age=a,this.wood=1e4,this.food=1e4,this.stone=1e4,this.gold=1e4,this.type=c,this.units=[],this.buildings=[],this.population=0,this.populationMax=996,this.color=l,this.colorHex={blue:"#3f5f9f",red:"#e30b00",yellow:"#c3a31b",brown:"#8b5b37",orange:"#ef6307",green:"#4b6b2b",grey:"#8f8f8f",cyan:"#00837b"}[l]||"#ffffff",this.isPlayed=d,this.hasBuilt=Object.keys(i),this.technologies=[];for(var p=[],m=function(t){for(var e=function(e){null==p[t]&&(p[t]=[]),p[t][e]={i:t,j:e,has:null,viewBy:[],onViewed:function(){var r=n.context,i=r.menu,s=r.map;n.isPlayed&&!s.revealEverything&&i.updateTerrainMiniMap(t,e)},viewed:!1}},r=0;r<=f.size;r++)e(r)},g=0;g<=f.size;g++)m(g);this.views=p}var e,r;return e=t,r=[{key:"spawnBuilding",value:function(){var t=this.createBuilding.apply(this,arguments);if(this.isPlayed)for(var e=0;e<this.selectedUnits.length;e++){var r=this.selectedUnits[e];"Villager"===r.type&&(th(t),r.sendToBuilding(t))}return t}},{key:"onAgeChange",value:function(){for(var t=this.context,e=t.players,r=t.menu,i=0;i<this.buildings.length;i++){var n=this.buildings[i];n.isBuilt&&!n.isDead&&n.finalTexture()}for(var s=0;s<e.length;s++){var o=e[s];"Human"===o.type&&(o.selectedUnit&&o.selectedUnit.owner===this?r.setBottombar(o.selectedUnit):o.selectedBuilding&&o.selectedBuilding.owner===this?r.setBottombar(o.selectedBuilding):o.selectedOther&&o.selectedOther.owner===this&&r.setBottombar(o.selectedOther))}}},{key:"otherPlayers",value:function(){var t,e=this.context.players,r=function(t){if(Array.isArray(t))return wf(t)}(t=e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return wf(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?wf(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();return r.splice(e.indexOf(this),1),r}},{key:"buyBuilding",value:function(t,e,r){var i=this.context.menu,n=os.cache.get("config").buildings[r];return!!oh(this,n.cost)&&(this.spawnBuilding(t,e,r),sh(this,n.cost),this.isPlayed&&i.updateTopbar(),!0)}},{key:"createUnit",value:function(t,e,r){var i,n=this.context;return i="Villager"===r?new xf({i:t,j:e,owner:this},n):new af({i:t,j:e,type:r,owner:this},n),this.units.push(i),n.menu.updatePlayerMiniMap(this),i}},{key:"createBuilding",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=this.context,o=new i[r]({i:t,j:e,owner:this,isBuilt:n},s);return this.buildings.push(o),s.menu.updatePlayerMiniMap(this),o}}],r&&Ef(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Af(t){return Af="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Af(t)}function Sf(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==Af(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Af(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key),"symbol"===Af(n)?n:String(n)),i)}var n}function Pf(t,e){return Pf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Pf(t,e)}function Of(t){return Of=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Of(t)}var Cf=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pf(t,e)}(o,t);var e,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Of(i);if(n){var r=Of(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Af(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(t,e){var r,i=t.i,n=t.j,a=t.age,h=t.civ,l=t.color;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(r=s.call(this,{i,j:n,age:a,civ:h,color:l,type:"AI"},e)).foundedTrees=[],r.foundedBerrybushs=[],r.foundedEnemyBuildings=[],r.interval=setInterval((function(){return r.step()}),4e3),r}return e=o,r=[{key:"step",value:function(){var t=this,e=this.units.filter((function(t){return"Villager"===t.type&&t.hitPoints>0})),r=this.units.filter((function(t){return"Clubman"===t.type&&t.hitPoints>0})),i=this.buildings.filter((function(t){return"TownCenter"===t.type})),n=this.buildings.filter((function(t){return"StoragePit"===t.type})),s=this.buildings.filter((function(t){return"Granary"===t.type})),o=this.buildings.filter((function(t){return"Barracks"===t.type})),a=this.buildings.filter((function(t){return!t.isBuilt||t.hitPoints>0&&t.hitPoints<t.totalHitPoints})),h=a.filter((function(t){return"House"===t.type})),l=e.filter((function(t){return!t.inactif&&"builder"===t.work})),c=e.filter((function(t){return!t.inactif&&"woodcutter"===t.work})),u=e.filter((function(t){return!t.inactif&&"forager"===t.work})),d=e.filter((function(t){return t.inactif&&"attack"!==t.action})),f=r.filter((function(t){return t.inactif&&"attack"!==t.action&&t.assault})),p=r.filter((function(t){return t.inactif&&"attack"!==t.action&&!t.assault})),m=Ch(e.length,30),g=Ch(e.length,70);if(0!==this.buildings.length||0!==this.units.length){if(u.length<=g&&(i.length||s.length))if(this.foundedBerrybushs.length)for(var y=0;y<Math.min(g,d.length);y++){var v=cl(d[y],this.foundedBerrybushs);d[y].sendToBerrybush(v);var b=cl(v,i),x=cl(v,s);if(Dh(b,v)>6&&(!Dh(x,v)||Dh(x,v)>15)){var _=hl(v.i,v.j,this.parent.grid,2,(function(t){return t.has&&"Berrybush"===t.has.type}));if(_.length>3){var w=ol(v,this.parent.grid,[0,6],2);w&&this.buyBuilding(w.i,w.j,"Granary")}}}else for(var E=0;E<Math.min(g,d.length);E++)d[E].explore();if(c.length<=m&&(i.length||n.length))if(this.foundedTrees.length)for(var T=0;T<Math.min(m,d.length);T++){var A=cl(d[T],this.foundedTrees);d[T].sendToTree(A);var S=cl(A,i),P=cl(A,n);if(Dh(S,A)>6&&(!Dh(P,A)||Dh(P,A)>15)){var O=hl(A.i,A.j,this.parent.grid,2,(function(t){return t.has&&"Tree"===t.has.type}));if(O.length>5){var C=ol(A,this.parent.grid,[0,6],2);C&&this.buyBuilding(C.i,C.j,"StoragePit")}}}else for(var R=0;R<Math.min(m,d.length);R++)d[R].explore();if(a.length>0)for(var I=0;I<a.length&&!(l.length>=4);I++){var M=e.filter((function(t){return"attack"!==t.action&&"builder"!==t.work||t.inactif})),B=cl(a[I],M);B&&B.sendToBuilding(a[I])}if(p.length>=5)if(this.foundedEnemyBuildings.length)for(var D=0;D<p.length;D++)p[D].sendTo(this.foundedEnemyBuildings[0],"attack");else{var j=randomRange(0,this.otherPlayers().length-1),k=this.otherPlayers()[j],N=k.i+randomRange(-5,5),L=k.j+randomRange(-5,5);if(this.parent.grid[N]&&this.parent.grid[N][L])for(var F=this.parent.grid[N][L],U=0;U<p.length;U++)p[U].assault=!0,p[U].sendTo(F,"attack")}if(f.length)if(this.foundedEnemyBuildings.length)for(var G=0;G<f.length;G++)f[G].sendTo(this.foundedEnemyBuildings[0],"attack");else for(var z=0;z<f.length;z++)f[z].explore();if(e.length<20)for(var H=0;H<20-e.length;H++)i[H]&&i[H].buyUnit("Villager");if(r.length<10)for(var X=0;X<10-r.length;X++)o[X]&&o[X].buyUnit("Clubman");if(this.population+3>this.populationMax&&!h.length){var V=ol(i[0],this.parent.grid,[3,12],2);V&&this.buyBuilding(V.i,V.j,"House")}if(e.length>10&&0===o.length){var W=ol(i[0],this.parent.grid,[4,20],3,!1,(function(e){for(var r=!0,n=0;n<t.otherPlayers().length;n++)Dh(e,t.otherPlayers()[n])>Dh(i[0],t.otherPlayers()[n])&&(r=!1);return r}));W&&this.buyBuilding(W.i,W.j,"Barracks")}}else this.die()}},{key:"die",value:function(){var t=this.context.players;clearInterval(this.interval),t.splice(t.indexOf(this),1)}}],r&&Sf(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(Tf);function Rf(t){return Rf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rf(t)}function If(t,e){return If=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},If(t,e)}function Mf(t){return Mf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Mf(t)}var Bf=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&If(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Mf(r);if(i){var n=Mf(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Rf(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),n.call(this,{i:0,j:0,type:"Gaia"},t)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Tf);function Df(t){return Df="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Df(t)}function jf(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==Df(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Df(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key),"symbol"===Df(n)?n:String(n)),i)}var n}function kf(t,e){return kf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},kf(t,e)}function Nf(t){return Nf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Nf(t)}var Lf=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&kf(t,e)}(o,t);var e,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Nf(i);if(n){var r=Nf(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Df(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(t,e){var r,i=t.i,n=t.j,a=t.age,h=t.civ,l=t.color,c=t.isPlayed;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(r=s.call(this,{i,j:n,age:a,civ:h,color:l,type:"Human",isPlayed:c},e)).selectedUnits=[],r.selectedUnit=null,r.selectedBuilding=null,r.selectedOther=null,r}return e=o,r=[{key:"unselectUnit",value:function(t){var e,r=this.context.menu,i=this.selectedUnits.indexOf(t);if(this.selectedUnits.splice(i,1),!this.selectedUnits.length)return this.selectedUnit=null,this.selectedUnits=[],void r.setBottombar();if(this.selectedUnit===t)for(var n=0;n<this.selectedUnits.length;n++)if("Villager"===this.selectedUnits[n].type){e=this.selectedUnits[n].type;break}this.selectedUnit=e||this.selectedUnits[0],r.setBottombar(this.selectedUnit)}},{key:"unselectAllUnits",value:function(){for(var t=this.context.menu,e=0;e<this.selectedUnits.length;e++)this.selectedUnits[e].unselect();this.selectedUnit=null,this.selectedUnits=[],t.setBottombar()}},{key:"unselectAll",value:function(){this.selectedBuilding&&(this.selectedBuilding.unselect(),this.selectedBuilding=null),this.selectedOther&&(this.selectedOther.unselect(),this.selectedOther=null),this.unselectAllUnits()}}],r&&jf(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(Tf);function Ff(t){return Ff="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ff(t)}function Uf(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==Ff(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Ff(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key),"symbol"===Ff(n)?n:String(n)),i)}var n}function Gf(t,e){return Gf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Gf(t,e)}function zf(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Hf(t){return Hf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Hf(t)}var Xf=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gf(t,e)}(o,t);var e,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Hf(i);if(n){var r=Hf(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ff(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return zf(t)}(this,t)});function o(t,e){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(r=s.call(this)).context=e;var i=zf(r).context.map;return r.setParent(i),r.id=i.children.length,r.name="animal",Object.keys(t).forEach((function(e){r[e]=t[e]})),r.x=i.grid[r.i][r.j].x,r.y=i.grid[r.i][r.j].y,r.z=i.grid[r.i][r.j].z,r.dest=null,r.realDest=null,r.previousDest=null,r.path=[],r.zIndex=jh(zf(r)),r.selected=!1,r.degree=Mh(1,360),r.currentFrame=Mh(0,4),r.action=null,r.work=null,r.currentSheet=null,r.size=1,r.visible=!1,r.currentCell=i.grid[r.i][r.j],r.currentCell.has=zf(r),r.currentCell.solid=!0,r.isDead=!1,r.isDestroyed=!1,r.hitPoints=r.totalHitPoints,r.quantityMax=r.quantity,r.inactif=!0,r.allowMove=!1,r.interactive=!0,r.sprite=new na(r.standingSheet.animations.south),r.sprite.name="sprite",r.sprite.allowMove=!1,r.sprite.interactive=!1,r.sprite.allowClick=!1,r.sprite.roundPixels=!0,r.on("pointerup",(function(){var t=zf(r).context,e=t.controls,n=t.player,s=t.menu;if(!e.mouseBuilding&&!e.mouseRectangle&&e.isMouseInApp()){e.mouse.prevent=!0;var o=!1;if(n.selectedUnits.length)for(var a=0;a<n.selectedUnits.length;a++){var h=n.selectedUnits[a];Wh(h,zf(r),"hunt")?(h.sendToHunt(zf(r)),o=!0):Wh(h,zf(r),"attack")?(h.sendTo(zf(r),"attack"),o=!0):Wh(h,zf(r),"takemeat")&&(h.sendToTakeMeat(zf(r)),o=!0)}else n.selectedBuilding&&n.selectedBuilding.range?Wh(n.selectedBuilding,zf(r),"attack")&&Dh(n.selectedBuilding,zf(r))<=n.selectedBuilding.range&&(n.selectedBuilding.attackAction(zf(r)),o=!0):(al(zf(r),n)||i.revealEverything)&&r.quantity>0&&(n.unselectAll(),r.select(),s.setBottombar(zf(r)),n.selectedOther=zf(r));o&&th(zf(r))}})),r.interval=null,r.sprite.updateAnchor=!0,r.addChild(r.sprite),r.stop(),nl(zf(r)),r}return e=o,r=[{key:"startInterval",value:function(t,e){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.stopInterval(),r&&t(),this.interval=setInterval(t,e)}},{key:"stopInterval",value:function(){this.interval&&(clearInterval(this.interval),this.interval=null)}},{key:"select",value:function(){if(!this.selected){this.context.menu,this.selected=!0;var t=new wo;t.name="selection",t.zIndex=3,t.lineStyle(1,16777215),t.drawPolygon([-16,0,0,-8,16,0,0,8]),this.addChildAt(t,0)}}},{key:"unselect",value:function(){if(this.selected){this.selected=!1;var t=this.getChildByName("selection");t&&this.removeChild(t)}}},{key:"hasPath",value:function(){return this.path.length>0}},{key:"setDest",value:function(t){t?(this.dest=t,this.realDest={i:t.i,j:t.j}):this.stop()}},{key:"setPath",value:function(t){var e=this;t.length?(this.setTextures("walkingSheet"),this.inactif=!1,this.path=t,this.startInterval((function(){return e.step()}),uh,!0)):this.stop()}},{key:"isAnimalAtDest",value:function(t,e){return!!t&&(e?Kh(this,e):(this.affectNewDest(),!1))}},{key:"sendTo",value:function(t,e){var r=this.context.map;this.stopInterval();var i=[];if(t){if(this.isAnimalAtDest(e,t))return this.setDest(t),this.action=e,this.degree=Nh(this,t.x,t.y),void this.getAction(e);if(r.grid[t.i]&&r.grid[t.i][t.j]&&r.grid[t.i][t.j].solid){if(!(i=tl(this,t,r)).length&&this.work)return this.action=e,void this.affectNewDest()}else i=el(this,t.i,t.j,r);i.length?(this.setDest(t),this.action=e,this.setPath(i)):this.stop()}else this.stop()}},{key:"getActionCondition",value:function(t){return Wh(this,t,this.action)}},{key:"getAction",value:function(t){var e=this,r=this.context,i=r.menu,n=r.player;if("attack"===t){if(!this.getActionCondition(this.dest))return void this.affectNewDest();this.setTextures("actionSheet"),this.startInterval((function(){if(!e.getActionCondition(e.dest))return e.dest&&e.dest.hitPoints<=0&&e.dest.die(),void e.affectNewDest();e.destHasMoved()&&(e.degree=Nh(e,e.dest.x,e.dest.y),e.setTextures("actionSheet")),Kh(e,e.dest)?(e.dest.hitPoints>0&&(e.dest.hitPoints=Math.max(e.dest.hitPoints-e.attack,0),e.dest.selected&&n&&(n.selectedUnit===e.dest||n.selectedBuilding===e.dest)&&i.updateInfo("hitPoints",(function(t){return t.textContent=e.dest.hitPoints+"/"+e.dest.totalHitPoints})),e.dest.isAttacked(e)),e.dest.hitPoints<=0&&(e.dest.die(),e.affectNewDest())):e.sendTo(e.dest,"attack")}),1e3*this.rateOfFire,!1)}else this.stop()}},{key:"affectNewDest",value:function(){var t=this;this.stopInterval();var e=il(this,(function(e){return t.getActionCondition(e)}));if(e.length){var r=ul(this,e);if(r)return Kh(this,r)?(this.degree=Nh(this,r.x,r.y),void this.getAction(this.action)):(this.setDest(r.instance),void this.setPath(r.path))}this.stop()}},{key:"destHasMoved",value:function(){return(this.dest.i!==this.realDest.i||this.dest.j!==this.realDest.j)&&Dh(this,this.dest)<=this.sight}},{key:"moveToPath",value:function(){var t=this.context.map,e=this.path[this.path.length-1],r=t.grid[e.i][e.j];if(this.dest&&!this.dest.isDestroyed)if(r.has&&("unit"===r.has.name||"animal"===r.has.name)&&r.has!==this&&r.has.hasPath()&&Dh(this,r.has)<=1&&r.has.sprite.playing)this.sprite.stop();else if(r.solid&&this.dest)this.sendTo(this.dest,this.action);else if(this.sprite.playing||this.sprite.play(),this.zIndex=jh(this),Dh(this,r,!1)<this.speed){if(sl(this),this.z=r.z,this.i=r.i,this.j=r.j,this.currentCell.has===this&&(this.currentCell.has=null,this.currentCell.solid=!1),this.currentCell=t.grid[this.i][this.j],null===this.currentCell.has&&(this.currentCell.has=this,this.currentCell.solid=!0),nl(this),this.path.pop(),this.destHasMoved())return void this.sendTo(this.dest,this.action);if(this.isAnimalAtDest(this.action,this.dest))return this.path=[],this.stopInterval(),this.degree=Nh(this,this.dest.x,this.dest.y),void this.getAction(this.action);this.path.length||this.stop()}else{this.context.menu;var i=this.degree,n=this.speed;this.loading>0&&(n*=.8),Zh(this,r.x,r.y,n),degreeToDirection(i)!==degreeToDirection(this.degree)&&this.setTextures("walkingSheet")}else this.affectNewDest()}},{key:"getReaction",value:function(t){"runaway"===this.strategy?this.runaway(t):this.sendTo(t,"attack")}},{key:"detect",value:function(t){!this.strategy||!t||"unit"!==t.name||this.isDead||this.path.length||this.dest||this.getReaction(t)}},{key:"isAttacked",value:function(t){t&&!this.dest&&this.getReaction(t)}},{key:"stop",value:function(){this.currentCell.has!==this&&this.currentCell.solid?this.sendTo(this.currentCell):(this.inactif=!0,this.action=null,this.dest=null,this.realDest=null,this.currentCell.has=this,this.currentCell.solid=!0,this.path=[],this.stopInterval(),this.setTextures("standingSheet"))}},{key:"step",value:function(){this.hitPoints<=0&&this.die(),this.hasPath()&&this.moveToPath()}},{key:"runaway",value:function(t){var e=this,r=this.context.map,i=null;ll(this.i,this.j,r.grid,this.sight,(function(r){r.solid||i&&!(Uh(r.i,r.j,t.i,t.j)>Uh(i.i,i.j,t.i,t.j))||(i=e.owner.views[r.i][r.j])})),i?this.sendTo(i):this.stop()}},{key:"die",value:function(){var t=this;if(!this.isDead){var e=this.context,r=e.player,i=e.menu;this.stopInterval(),this.isDead=!0,this.path=[],this.action=null,this.zIndex--,this.setTextures("dyingSheet"),this.sprite.loop=!1,this.sprite.onComplete=function(){t.owner.population--,t.setTextures("corpseSheet"),t.sprite.animationSpeed=0,t.startInterval((function(){t.quantity>0&&(t.quantity--,t.selected&&r.selectedOther===t&&i.updateInfo("quantity-text",(function(e){return e.textContent=t.quantity}))),t.updateTexture()}),5e3)}}}},{key:"updateTexture",value:function(){var t=this,e=this.context,r=e.player,i=e.map,n=getPercentage(this.quantity,this.quantityMax);n>25&&n<50?this.sprite.currentFrame=1:n>0&&n<=25?this.sprite.currentFrame=2:n<=0&&(this.stopInterval(),i.grid[this.i][this.j].has===this&&(i.grid[this.i][this.j].has=null,i.grid[this.i][this.j].corpses.push(this),i.grid[this.i][this.j].solid=!1),this.selected&&r.selectedOther===this&&r.unselectAll(),this.sprite.currentFrame=3,setTimeout((function(){t.clear()}),12e4))}},{key:"clear",value:function(){if(!this.isDestroyed){var t=this.context.map;this.isDestroyed=!0,t.grid[this.i][this.j].corpses.splice(t.grid[this.i][this.j].corpses.indexOf(this),1),t.removeChild(this),this.destroy({child:!0,texture:!0})}}},{key:"setTextures",value:function(t){if(!this[t])return"walkingSheet"!==this.currentSheet&&this.walkingSheet?this.sprite.textures=[this.walkingSheet.textures[Object.keys(this.walkingSheet.textures)[0]]]:this.sprite.textures=[this.sprite.textures[this.sprite.currentFrame]],this.currentSheet="walkingSheet",this.sprite.stop(),void this.sprite.anchor.set(this.sprite.textures[this.sprite.currentFrame].defaultAnchor.x,this.sprite.textures[this.sprite.currentFrame].defaultAnchor.y);["actionSheet"].includes(t)||(this.sprite.onLoop=null),this.currentSheet=t,this.degree>67.5&&this.degree<112.5?(this.sprite.scale.x=1,this.sprite.textures=this[t].animations.north):this.degree>247.5&&this.degree<292.5?(this.sprite.scale.x=1,this.sprite.textures=this[t].animations.south):this.degree>337.5||this.degree<22.5?(this.sprite.scale.x=1,this.sprite.textures=this[t].animations.west):this.degree>=22.5&&this.degree<=67.5?(this.sprite.scale.x=1,this.sprite.textures=this[t].animations.northwest):this.degree>=292.5&&this.degree<=337.5?(this.sprite.scale.x=1,this.sprite.textures=this[t].animations.southwest):this.degree>157.5&&this.degree<202.5?(this.sprite.scale.x=-1,this.sprite.textures=this[t].animations.west):this.degree>112.5&&this.degree<157.5?(this.sprite.scale.x=-1,this.sprite.textures=this[t].animations.northwest):this.degree>202.5&&this.degree<247.5&&(this.sprite.scale.x=-1,this.sprite.textures=this[t].animations.southwest),this.sprite.animationSpeed=(this[t].data.animationSpeed||("standingSheet"===t?.15:.3))*ch,this.sprite.play()}},{key:"setDefaultInterface",value:function(t,e){var r=this.context.menu,i=document.createElement("div");i.id="civ",i.textContent="",t.appendChild(i);var n=document.createElement("div");n.id="type",n.textContent=this.type,t.appendChild(n);var s=document.createElement("img");s.id="icon",s.src=$a(e.icon),t.appendChild(s);var o=document.createElement("div");o.id="hitPoints",o.textContent=this.hitPoints+"/"+this.totalHitPoints,t.appendChild(o);var a=document.createElement("div");a.id="quantity",a.className="resource-quantity";var h=document.createElement("img");h.src=r.icons.food,h.className="resource-quantity-icon";var l=document.createElement("div");l.id="quantity-text",l.textContent=this.quantity,a.appendChild(h),a.appendChild(l),t.appendChild(a)}}],r&&Uf(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(rn);function Vf(t){return Vf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vf(t)}function Wf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function Yf(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Wf(Object(r),!0).forEach((function(e){$f(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Wf(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function $f(t,e,r){return(e=qf(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function qf(t){var e=function(t,e){if("object"!==Vf(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Vf(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Vf(e)?e:String(e)}function Kf(t,e){return Kf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Kf(t,e)}function Zf(t){return Zf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Zf(t)}var Qf=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Kf(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Zf(r);if(i){var n=Zf(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Vf(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.owner;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var h="Crocodile",l=os.cache.get("config").animals[h];return r=n.call(this,Yf(Yf({i,j:o,owner:a,type:h},l),{},{actionSheet:os.cache.get("217"),standingSheet:os.cache.get("433"),walkingSheet:os.cache.get("673"),dyingSheet:os.cache.get("330"),corpseSheet:os.cache.get("391"),interface:{info:function(t){r.setDefaultInterface(t,l)}}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Xf);function Jf(t){return Jf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jf(t)}function tp(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function ep(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?tp(Object(r),!0).forEach((function(e){rp(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):tp(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function rp(t,e,r){return(e=ip(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ip(t){var e=function(t,e){if("object"!==Jf(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Jf(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Jf(e)?e:String(e)}function np(t,e){return np=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},np(t,e)}function sp(t){return sp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},sp(t)}var op=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&np(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=sp(r);if(i){var n=sp(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Jf(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.owner;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var h="Elephant",l=os.cache.get("config").animals[h];return r=n.call(this,ep(ep({i,j:o,owner:a,type:h},l),{},{actionSheet:os.cache.get("215"),standingSheet:os.cache.get("428"),walkingSheet:os.cache.get("667"),dyingSheet:os.cache.get("324"),corpseSheet:os.cache.get("386"),interface:{info:function(t){r.setDefaultInterface(t,l)}}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Xf);function ap(t){return ap="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ap(t)}function hp(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function lp(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?hp(Object(r),!0).forEach((function(e){cp(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):hp(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function cp(t,e,r){return(e=up(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function up(t){var e=function(t,e){if("object"!==ap(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==ap(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===ap(e)?e:String(e)}function dp(t,e){return dp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},dp(t,e)}function fp(t){return fp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fp(t)}var pp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&dp(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=fp(r);if(i){var n=fp(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===ap(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.owner;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var h="Gazelle",l=os.cache.get("config").animals[h];return r=n.call(this,lp(lp({i,j:o,owner:a,type:h},l),{},{standingSheet:os.cache.get("479"),walkingSheet:os.cache.get("478"),runningSheet:os.cache.get("480"),dyingSheet:os.cache.get("331"),corpseSheet:os.cache.get("392"),interface:{info:function(t){r.setDefaultInterface(t,l)}}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Xf);function mp(t){return mp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mp(t)}function gp(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function yp(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?gp(Object(r),!0).forEach((function(e){vp(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):gp(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function vp(t,e,r){return(e=bp(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function bp(t){var e=function(t,e){if("object"!==mp(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==mp(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===mp(e)?e:String(e)}function xp(t,e){return xp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},xp(t,e)}function _p(t){return _p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_p(t)}var wp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&xp(t,e)}(s,t);var e,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=_p(r);if(i){var n=_p(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===mp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function s(t,e){var r,i=t.i,o=t.j,a=t.owner;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var h="Lion",l=os.cache.get("config").animals[h];return r=n.call(this,yp(yp({i,j:o,owner:a,type:h},l),{},{actionSheet:os.cache.get("222"),standingSheet:os.cache.get("497"),walkingSheet:os.cache.get("680"),dyingSheet:os.cache.get("336"),corpseSheet:os.cache.get("397"),interface:{info:function(t){r.setDefaultInterface(t,l)}}}),e)}return e=s,Object.defineProperty(e,"prototype",{writable:!1}),e}(Xf);function Ep(t){return Ep="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ep(t)}function Tp(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==Ep(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Ep(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key),"symbol"===Ep(n)?n:String(n)),i)}var n}function Ap(t,e){return Ap=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ap(t,e)}function Sp(t){return Sp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Sp(t)}var Pp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ap(t,e)}(a,t);var e,r,i,s,o=(i=a,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Sp(i);if(s){var r=Sp(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ep(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this)).context=t,e.size,e.reliefRange=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,3],e.chanceOfRelief=.06,e.chanceOfSets=.02,e.revealEverything=!0,e.noAI=!0,e.grid=[],e.sortableChildren=!0,e.x=0,e.y=0,e.startingUnits=5,e.players=[],e.gaia=null,e.resources=[],e.interactive=!1,e.allowMove=!1,e.allowClick=!1,e}return e=a,r=[{key:"setCoordinate",value:function(t,e){this.x=t,this.y=e}},{key:"generateMap",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(this.removeChildren(),this.generateCells(),this.size){case 120:default:this.positionsCount=2;break;case 144:this.positionsCount=3;break;case 168:case 200:case 220:this.positionsCount=4}if(this.playersPos=this.findPlayerPlaces(),this.playersPos.length<this.positionsCount)return t>=10&&alert("Error while generating the map"),void this.generateMap(t+1);if(!this.revealEverything)for(var e=0;e<=this.size;e++)for(var r=0;r<=this.size;r++)this.grid[e][r].setFog();this.generateResourcesAroundPlayers(this.playersPos)}},{key:"stylishMap",value:function(){var t=this.context.menu;this.gaia=new Bf(this.context),this.generateMapRelief(),this.formatCellsRelief(),this.formatCellsWaterBorder(),this.formatCellsDesert(),this.generateSets(),t.updateResourcesMiniMap()}},{key:"generatePlayers",value:function(){for(var t=this.context,e=[],r=[],i=Array.from(Array(this.playersPos.length).keys()),n=0;n<this.playersPos.length;n++){var s=Bh(i);r.push(s),i.splice(i.indexOf(s),1)}for(var o=0;o<this.positionsCount;o++){var a=this.playersPos[r[o]].i,h=this.playersPos[r[o]].j,l=Qa[o];o?this.noAI||e.push(new Cf({i:a,j:h,age:0,civ:"Greek",color:l},t)):e.push(new Lf({i:a,j:h,age:1,civ:"Greek",color:l,isPlayed:!0},t))}return e}},{key:"placePlayers",value:function(){for(var t=this.context.players,e=0;e<t.length;e++)for(var r=t[e],i=r.spawnBuilding(r.i,r.j,"TownCenter",!0),n=0;n<this.startingUnits;n++)i.placeUnit("Villager"),i.placeUnit("Clubman")}},{key:"generateResourcesAroundPlayers",value:function(t){for(var e=0;e<t.length;e++)this.placeResourceGroup(t[e],"Berrybush",6,[5,10]),this.placeResourceGroup(t[e],"Stone",7,[10,15]),this.placeResourceGroup(t[e],"Gold",7,[10,15]),this.placeResourceGroup(t[e],"Tree",20,[10,25]),this.placeResourceGroup(t[e],"Tree",30,[10,25]),this.placeResourceGroup(t[e],"Tree",20,[10,25]),this.placeResourceGroup(t[e],"Tree",30,[10,25]),this.placeResourceGroup(t[e],"Tree",50,[10,30])}},{key:"generateCells",value:function(){var t=os.cache.get("0").split("\n").filter(Boolean);this.size=t.length-1;for(var e=0;e<=this.size;e++)for(var r=t[e].split("").filter(Boolean),i=0;i<=this.size;i++)switch(this.grid[e]||(this.grid[e]=[]),r[i]){case"0":this.grid[e][i]=new Al({i:e,j:i,z:0},this.context);break;case"1":this.grid[e][i]=new _l({i:e,j:i,z:0},this.context);break;case"2":this.grid[e][i]=new Al({i:e,j:i,z:0},this.context),this.resources.push(new oc({i:e,j:i},this.context));break;case"3":this.grid[e][i]=new Bl({i:e,j:i,z:0},this.context);break;case"4":this.grid[e][i]=new _l({i:e,j:i,z:0},this.context),this.resources.push(new oc({i:e,j:i},this.context));break;case"5":this.grid[e][i]=new Cl({i:e,j:i,z:0},this.context),this.resources.push(new oc({i:e,j:i},this.context))}for(var n=0;n<=this.size;n++)for(var s=0;s<=this.size;s++)this.grid[n][s].fillWaterCellsAroundCell()}},{key:"generateSets",value:function(){for(var t=0;t<=this.size;t++)for(var e=0;e<=this.size;e++){var r=this.grid[t][e];if(!(ll(t,e,this.grid,1,(function(t){return t.solid})).length>0)&&r.type&&"water"!==r.type&&!r.has&&!r.solid&&!r.border&&!r.inclined){if(Math.random()<.03&&t>1&&e>1&&t<this.size&&e<this.size){var i=Mh(292,301).toString(),s=os.cache.get(i).textures["000_"+i+".png"],o=on.from(s);o.name="floor",o.roundPixels=!0,o.allowMove=!1,o.interactive=!1,o.allowClick=!1,o.updateAnchor=!0,r.addChild(o)}if(Math.random()<this.chanceOfSets)switch(Bh(["tree","rock","animal"])){case"tree":this.resources.push(new oc({i:t,j:e},this.context));break;case"rock":var a=Mh(531,534).toString(),h=os.cache.get(a).textures["000_"+a+".png"],l=on.from(h);l.name="set",l.roundPixels=!0,l.allowMove=!1,l.interactive=!1,l.allowClick=!1,l.updateAnchor=!0,r.addChild(l);break;case"animal":var c=Bh(Object.keys(n));new n[c]({i:t,j:e,owner:this.gaia},this.context)}}}}},{key:"generateMapRelief",value:function(){for(var t=this,e=0;e<=this.size;e++)for(var r=function(){var r=t.grid[e][i];if(Math.random()<t.chanceOfRelief){var n=Bh(t.reliefRange),s=!0;hl(e,i,t.grid,2*n,(function(t){("water"===t.type||t.has&&"building"===t.has.name)&&(s=!1)})),s&&r.setCellLevel(n)}},i=0;i<=this.size;i++)r();for(var n=0;n<=this.size;n++)for(var s=function(){var e=t.grid[n][o];if(1===e.z){var r=!0,i=0;ll(n,o,t.grid,1,(function(t){t.z>0&&i++,i>=3&&(r=!1)})),r&&e.setCellLevel(0)}},o=0;o<=this.size;o++)s();for(var a=0;a<=this.size;a++)for(var h=0;h<=this.size;h++)this.grid[a][h].fillReliefCellsAroundCell()}},{key:"formatCellsRelief",value:function(){for(var t=0;t<=this.size;t++)for(var e=0;e<=this.size;e++){var r=this.grid[t][e];this.grid[t-1]&&this.grid[t-1][e].z-r.z==1&&(!this.grid[t+1]||this.grid[t+1][e].z<=r.z)&&(!this.grid[t][e-1]||this.grid[t][e-1].z<=r.z)&&(!this.grid[t][e+1]||this.grid[t][e+1].z<=r.z)?r.setReliefBorder("014",lh/2):this.grid[t+1]&&this.grid[t+1][e].z-r.z==1&&(!this.grid[t-1]||this.grid[t-1][e].z<=r.z)&&(!this.grid[t][e-1]||this.grid[t][e-1].z<=r.z)&&(!this.grid[t][e+1]||this.grid[t][e+1].z<=r.z)?r.setReliefBorder("015",lh/2):this.grid[t][e-1]&&this.grid[t][e-1].z-r.z==1&&(!this.grid[t+1]||this.grid[t+1][e].z<=r.z)&&(!this.grid[t][e+1]||this.grid[t][e+1].z<=r.z)&&(!this.grid[t-1]||this.grid[t-1][e].z<=r.z)?r.setReliefBorder("016",lh/2):this.grid[t][e+1]&&this.grid[t][e+1].z-r.z==1&&(!this.grid[t+1]||this.grid[t+1][e].z<=r.z)&&(!this.grid[t][e-1]||this.grid[t][e-1].z<=r.z)&&(!this.grid[t-1]||this.grid[t-1][e].z<=r.z)?r.setReliefBorder("013",lh/2):this.grid[t-1]&&this.grid[t-1][e-1]&&this.grid[t-1][e-1].z-r.z==1&&(!this.grid[t][e-1]||this.grid[t][e-1].z<=r.z)&&(!this.grid[t-1]||this.grid[t-1][e].z<=r.z)?r.setReliefBorder("010",lh/2):this.grid[t+1]&&this.grid[t+1][e-1]&&this.grid[t+1][e-1].z-r.z==1&&(!this.grid[t][e-1]||this.grid[t][e-1].z<=r.z)&&(!this.grid[t+1]||this.grid[t+1][e].z<=r.z)?r.setReliefBorder("012"):this.grid[t-1]&&this.grid[t-1][e+1]&&this.grid[t-1][e+1].z-r.z==1&&(!this.grid[t][e+1]||this.grid[t][e+1].z<=r.z)&&(!this.grid[t-1]||this.grid[t-1][e].z<=r.z)?r.setReliefBorder("011"):this.grid[t+1]&&this.grid[t+1][e+1]&&this.grid[t+1][e+1].z-r.z==1&&(!this.grid[t][e+1]||this.grid[t][e+1].z<=r.z)&&(!this.grid[t+1]||this.grid[t+1][e].z<=r.z)?r.setReliefBorder("009",lh/2):this.grid[t][e-1]&&this.grid[t][e-1].z-r.z==1&&this.grid[t-1]&&this.grid[t-1][e].z-r.z==1?r.setReliefBorder("022",lh/2):this.grid[t][e+1]&&this.grid[t][e+1].z-r.z==1&&this.grid[t+1]&&this.grid[t+1][e].z-r.z==1?r.setReliefBorder("021",lh/2):this.grid[t][e-1]&&this.grid[t][e-1].z-r.z==1&&this.grid[t+1]&&this.grid[t+1][e].z-r.z==1?r.setReliefBorder("023",lh):this.grid[t][e+1]&&this.grid[t][e+1].z-r.z==1&&this.grid[t-1]&&this.grid[t-1][e].z-r.z==1&&r.setReliefBorder("024",lh)}}},{key:"formatCellsWaterBorder",value:function(){for(var t=0;t<=this.size;t++)for(var e=0;e<=this.size;e++){var r=this.grid[t][e];"water"!==r.type?!this.grid[t-1]||"water"!==this.grid[t-1][e].type||this.grid[t+1]&&"water"===this.grid[t+1][e].type||this.grid[t][e-1]&&"water"===this.grid[t][e-1].type||this.grid[t][e+1]&&"water"===this.grid[t][e+1].type?!this.grid[t+1]||"water"!==this.grid[t+1][e].type||this.grid[t-1]&&"water"===this.grid[t-1][e].type||this.grid[t][e-1]&&"water"===this.grid[t][e-1].type||this.grid[t][e+1]&&"water"===this.grid[t][e+1].type?!this.grid[t][e-1]||"water"!==this.grid[t][e-1].type||this.grid[t+1]&&"water"===this.grid[t+1][e].type||this.grid[t][e+1]&&"water"===this.grid[t][e+1].type||this.grid[t-1]&&"water"===this.grid[t-1][e].type?!this.grid[t][e+1]||"water"!==this.grid[t][e+1].type||this.grid[t+1]&&"water"===this.grid[t+1][e].type||this.grid[t][e-1]&&"water"===this.grid[t][e-1].type||this.grid[t-1]&&"water"===this.grid[t-1][e].type?!this.grid[t-1]||!this.grid[t-1][e-1]||"water"!==this.grid[t-1][e-1].type||this.grid[t][e-1]&&"water"===this.grid[t][e-1].type||this.grid[t-1]&&"water"===this.grid[t-1][e].type?!this.grid[t+1]||!this.grid[t+1][e-1]||"water"!==this.grid[t+1][e-1].type||this.grid[t][e-1]&&"water"===this.grid[t][e-1].type||this.grid[t+1]&&"water"===this.grid[t+1][e].type?!this.grid[t-1]||!this.grid[t-1][e+1]||"water"!==this.grid[t-1][e+1].type||this.grid[t][e+1]&&"water"===this.grid[t][e+1].type||this.grid[t-1]&&"water"===this.grid[t-1][e].type?!this.grid[t+1]||!this.grid[t+1][e+1]||"water"!==this.grid[t+1][e+1].type||this.grid[t][e+1]&&"water"===this.grid[t][e+1].type||this.grid[t+1]&&"water"===this.grid[t+1][e].type?this.grid[t][e-1]&&"water"===this.grid[t][e-1].type&&this.grid[t-1]&&"water"===this.grid[t-1][e].type?r.setWaterBorder("20000","001"):this.grid[t][e+1]&&"water"===this.grid[t][e+1].type&&this.grid[t+1]&&"water"===this.grid[t+1][e].type?r.setWaterBorder("20000","002"):this.grid[t][e-1]&&"water"===this.grid[t][e-1].type&&this.grid[t+1]&&"water"===this.grid[t+1][e].type?r.setWaterBorder("20000","003"):this.grid[t][e+1]&&"water"===this.grid[t][e+1].type&&this.grid[t-1]&&"water"===this.grid[t-1][e].type&&r.setWaterBorder("20000","000"):r.setWaterBorder("20000","006"):r.setWaterBorder("20000","004"):r.setWaterBorder("20000","007"):r.setWaterBorder("20000","005"):r.setWaterBorder("20000","010"):r.setWaterBorder("20000","011"):r.setWaterBorder("20000","009"):r.setWaterBorder("20000","008"):r.has&&r.has.destroy()}}},{key:"findPlayerPlaces",value:function(){for(var t=[],e=20,r=Math.floor(this.size/4),i=[{minX:e,minY:this.size/2+r,maxX:this.size/2-r,maxY:this.size-e},{minX:e,minY:e,maxX:this.size/2-r,maxY:this.size/2-r},{minX:this.size/2+r,minY:e,maxX:this.size-e,maxY:this.size/2-r},{minX:this.size/2+r,minY:this.size/2+r,maxX:this.size-e,maxY:this.size-e}],n=0;n<i.length;n++){var s=rl(i[n],this.grid,5,(function(t){return!t.border&&!t.solid&&!t.inclined}));s&&t.push(s)}return t}},{key:"placeResourceGroup",value:function(t,e,r,i){var n=this.context,s=this.grid,o={Tree:oc,Berrybush:Xl,Stone:tc,Gold:ql},a=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(n>100)return[];var o=Mh(i[0],i[1]),a=Mh(i[0],i[1]),h=t.i+Bh([-o,o]),l=t.j+Bh([-a,a]),c=0;if(s[h]&&s[h][l]){var u=Math.round(Math.sqrt(r,2)),d=hl(h,l,s,u,(function(t){if(c++,!(t.solid||t.has||t.border||t.inclined))return!0}));return d.length>=c?d:e(n+1)}return e(n+1)}();if(a.length)for(var h=0;h<r;h++){var l=Bh(a);a.splice(a.indexOf(l),1),this.resources.push(new o[e]({i:l.i,j:l.j},n))}}},{key:"formatCellsDesert",value:function(){for(var t=0;t<=this.size;t++)for(var e=0;e<=this.size;e++){var r=["grass","jungle"];"desert"===this.grid[t][e].type&&(this.grid[t-1]&&this.grid[t-1][e]&&r.includes(this.grid[t-1][e].type)&&this.grid[t-1][e].setDesertBorder("est"),this.grid[t+1]&&this.grid[t+1][e]&&r.includes(this.grid[t+1][e].type)&&this.grid[t+1][e].setDesertBorder("west"),this.grid[t][e-1]&&r.includes(this.grid[t][e-1].type)&&this.grid[t][e-1].setDesertBorder("south"),this.grid[t][e+1]&&r.includes(this.grid[t][e+1].type)&&this.grid[t][e+1].setDesertBorder("north"))}}}],r&&Tp(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(rn);function Op(t){return Op="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Op(t)}function Cp(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function Rp(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Cp(Object(r),!0).forEach((function(e){Ip(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Cp(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Ip(t,e,r){return(e=Bp(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Mp(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Bp(i.key),i)}}function Bp(t){var e=function(t,e){if("object"!==Op(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Op(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Op(e)?e:String(e)}var Dp=function(){function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.context=e,this.topbar=document.createElement("div"),this.topbar.id="topbar",this.topbar.className="topbar bar",this.icons={wood:"interface/50732/000_50732.png",food:"interface/50732/002_50732.png",stone:"interface/50732/001_50732.png",gold:"interface/50732/003_50732.png"},this.resources=document.createElement("div"),this.resources.className="resources",["wood","food","stone","gold"].forEach((function(t){r.setResourceBox(t)})),this.age=document.createElement("div"),this.age.className="age",this.options=document.createElement("div"),this.topbar.appendChild(this.resources),this.topbar.appendChild(this.age),this.topbar.appendChild(this.options),document.body.prepend(this.topbar),this.bottombar=document.createElement("div"),this.bottombar.className="bottombar bar",this.bottombarInfo=document.createElement("div"),this.bottombarInfo.className="bottombar-info",this.bottombarMenu=document.createElement("div"),this.bottombarMenu.className="bottombar-menu";var i=document.createElement("div");i.className="bottombar-map-wrap",this.bottombarMap=document.createElement("div"),this.bottombarMap.className="bottombar-map",this.bottombarMap.addEventListener("pointerup",(function(t){var e=r.context.controls;if(!e.mouseBuilding&&!e.mouseRectangle){var i=r.getMinimapFactor(),n=t.target.getBoundingClientRect(),s=(t.clientX-n.left-n.width/2)*i,o=(t.clientY-n.top-3)*i;e.clearInstancesOnScreen(),e.setCamera(s,o)}})),i.appendChild(this.bottombarMap),this.terrainMinimap=document.createElement("canvas"),this.playersMinimap=[],this.resourcesMinimap=document.createElement("canvas"),this.cameraMinimap=document.createElement("canvas"),this.cameraMinimap.style.zIndex=1,this.bottombarMap.appendChild(this.terrainMinimap),this.bottombarMap.appendChild(this.resourcesMinimap),this.bottombarMap.appendChild(this.cameraMinimap),this.bottombar.appendChild(this.bottombarInfo),this.bottombar.appendChild(this.bottombarMenu),this.bottombar.appendChild(i),document.body.appendChild(this.bottombar),this.updatePlayerMiniMap=Xh(this.updatePlayerMiniMapEvt,100),this.updateResourcesMiniMap=Xh(this.updateResourcesMiniMapEvt,100),this.updateCameraMiniMap=Xh(this.updateCameraMiniMapEvt,100),this.miniMapAlpha=1.284,this.updateTopbar()}var e,r;return e=t,r=[{key:"init",value:function(){this.initMiniMap(),this.updateTopbar()}},{key:"getMinimapFactor",value:function(){var t=this.context.map;return(ah/2+t.size*ah/2)/234*2}},{key:"initMiniMap",value:function(){var t=this.context.map,e=this.terrainMinimap.getContext("2d"),r=this.cameraMinimap.getContext("2d"),i=this.resourcesMinimap.getContext("2d"),n=this.getMinimapFactor()/this.miniMapAlpha,s=(ah/2+t.size*ah/2)/2/n;e.translate(s,0),r.translate(s,0),i.translate(s,0),t.revealEverything&&this.revealTerrainMinimap()}},{key:"revealTerrainMinimap",value:function(){var t=this.context.map,e=this.terrainMinimap,r=e.getContext("2d"),i=this.getMinimapFactor()/this.miniMapAlpha,n=(ah/2+t.size*ah/2)/2/i;r.clearRect(-n,0,e.width,e.height);for(var s=0;s<=t.size;s++)for(var o=0;o<=t.size;o++){var a=t.grid[s][o];rh(r,a.x/i+n,a.y/i,ah/i+1,hh/i+1,a.color)}}},{key:"updateTerrainMiniMap",value:function(t,e){var r=this.context.map,i=this.terrainMinimap.getContext("2d"),n=this.getMinimapFactor()/this.miniMapAlpha,s=(ah/2+r.size*ah/2)/2/n,o=r.grid[t][e],a=o.color;rh(i,o.x/n+s,o.y/n,ah/n+1,hh/n+1,a),o.has&&"resource"===o.has.name&&this.updateResourceMiniMap(o.has)}},{key:"updateResourceMiniMap",value:function(t){var e=this.context.map,r=this.resourcesMinimap.getContext("2d"),i=this.getMinimapFactor()/this.miniMapAlpha,n=(ah/2+e.size*ah/2)/2/i;eh(r,t.x/i-2+n,t.y/i-2,4,4,t.color)}},{key:"updateResourcesMiniMapEvt",value:function(){var t=this.context,e=t.map,r=t.player,i=this.resourcesMinimap,n=i.getContext("2d"),s=this.getMinimapFactor()/this.miniMapAlpha,o=(ah/2+e.size*ah/2)/2/s;n.clearRect(-o,0,i.width,i.height),e.resources.forEach((function(t){if(r.views[t.i][t.j].viewed||e.revealEverything){var i=t.x/s-2,a=t.y/s-2;eh(n,i+o,a,4,4,t.color)}}))}},{key:"updateCameraMiniMapEvt",value:function(){var t=this.context,e=t.app,r=t.map,i=t.controls,n=this.cameraMinimap,s=n.getContext("2d"),o=this.getMinimapFactor()/this.miniMapAlpha,a=(ah/2+r.size*ah/2)/2/o;s.clearRect(-a,0,n.width,n.height),function(t,e,r,i,n,s){t.strokeStyle="white",t.strokeRect(e,r,i,n)}(s,i.camera.x/o+a,i.camera.y/o,e.screen.width/o,e.screen.height/o)}},{key:"updatePlayerMiniMapEvt",value:function(t){if(t){var e,r,i=this.context.map,n=this.playersMinimap.find((function(e){return e.id==="minimap-".concat(t.id)})),s=t.colorHex,o=this.getMinimapFactor()/this.miniMapAlpha,a=(ah/2+i.size*ah/2)/2/o;n?(e=n.canvas,r=n.context):(e=document.createElement("canvas"),(r=e.getContext("2d")).translate(a,0),this.playersMinimap.push({id:"minimap-".concat(t.id),canvas:e,context:r}),this.bottombarMap.appendChild(e)),r.clearRect(-a,0,e.width,e.height),t.buildings.forEach((function(t){var e=t.x,i=t.y,n=t.size,h=t.selected,l=4+n;eh(r,e/o-l/2+a,i/o-l/2,l,l,h?"white":s)})),t.units.forEach((function(t){var e=t.x,i=t.y,n=t.selected;eh(r,e/o-2+a,i/o-2,4,4,n?"white":s)}))}}},{key:"getMessage",value:function(t){var e=this.context.player,r=Object.keys(t).find((function(r){return e[r]<t[r]}));return"You need more ".concat(r," !")}},{key:"showMessage",value:function(t){document.getElementById("msg")&&document.getElementById("msg").remove();var e=document.createElement("div");e.id="msg",e.className="message",Object.assign(e.style,{bottom:this.bottombar.clientHeight+5+"px"});var r=document.createElement("span");r.textContent=t,r.className="message-content",e.appendChild(r),window.gamebox.appendChild(e),setTimeout((function(){e.remove()}),3e3)}},{key:"setResourceBox",value:function(t){var e=document.createElement("div");e.className="resource";var r=document.createElement("img");r.className="resource-content",r.src=this.icons[t],this[t]=document.createElement("div"),e.appendChild(r),e.appendChild(this[t]),this.resources.appendChild(e)}},{key:"updateTopbar",value:function(){var t=this,e=this.context.player,r={0:"Stone Age",1:"Tool Age",2:"Bronze Age",3:"Iron Age"};["wood","food","stone","gold","age"].forEach((function(i){var n=Math.min(e&&e[i]||0,99999);t[i].textContent="age"===i?r[n]:n}))}},{key:"resetInfo",value:function(){this.bottombarInfo.textContent="",this.bottombarInfo.style.background="transparent"}},{key:"generateInfo",value:function(t){this.resetInfo(),this.bottombarInfo.style.background="black","function"==typeof t.interface.info&&t.interface.info(this.bottombarInfo)}},{key:"updateInfo",value:function(t,e){var r=this.bottombarInfo.querySelector("[id=".concat(t,"]"));if(r&&"function"==typeof e)return e(r)}},{key:"updateButtonContent",value:function(t,e){var r=this.bottombarMenu.querySelector("[id=".concat(t,"]"));if(r&&"function"==typeof e){var i=r.querySelector("[id=content]");if(i)return e(i)}}},{key:"toggleButtonCancel",value:function(t,e){var r=this.bottombarMenu.querySelector("[id=".concat(t,"-cancel]"));r&&(r.style.display=e?"block":"none")}},{key:"setBottombar",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=this.context,r=e.controls,i=e.player;function n(t,e,s,o){if(s.filter((function(t){return!t.hide||!t.hide()})).forEach((function(i,o){var a=document.createElement("div");if(a.className="bottombar-menu-box",a.id=i.id||"btn-".concat(o),"function"==typeof i.onCreate)i.onCreate(t,a);else{var h=document.createElement("img");h.src="function"==typeof i.icon?i.icon():i.icon,h.className="img",a.appendChild(h)}i.children?a.addEventListener("pointerup",(function(){e.textContent="",r.removeMouseBuilding(),n(t,e,i.children,s)})):"function"==typeof i.onClick&&a.addEventListener("pointerup",(function(e){return i.onClick(t,e)})),e.appendChild(a)})),o||t.selected){var a=document.createElement("div");a.className="bottombar-menu-box";var h=document.createElement("img");h.className="img",a.id="interfaceBackBtn",h.src="interface/50721/010_50721.png",o?a.addEventListener("pointerup",(function(){e.textContent="",r.removeMouseBuilding(),n(t,e,o)})):a.addEventListener("pointerup",(function(){r.removeMouseBuilding(),i.unselectAll()})),a.appendChild(h),e.appendChild(a)}}this.resetInfo(),this.bottombarMenu.textContent="",this.selection=t,r.mouseBuilding&&r.removeMouseBuilding(),t&&t.interface&&(this.generateInfo(t),"building"===t.name?t.isBuilt?t.technology?n(t,this.bottombarMenu,[{icon:"interface/50721/003_50721.png",id:"".concat(type,"-cancel"),onClick:function(t){t.cancelTechnology()}}]):n(t,this.bottombarMenu,t.interface.menu||[]):n(t,this.bottombarMenu,[]):n(t,this.bottombarMenu,t.interface.menu||[]))}},{key:"getUnitButton",value:function(t){var e=this,r=this.context.player,i=os.cache.get("config").units[t];return{id:t,icon:function(){return $a(i.icon)},hide:function(){return(i.conditions||[]).some((function(t){return!Vh(t,r)}))},onCreate:function(n,s){var o=document.createElement("div");o.className="bottombar-menu-column";var a=document.createElement("img");a.id="".concat(t,"-cancel"),a.className="img",a.src="interface/50721/003_50721.png",n.queue.filter((function(e){return e===t})).length||(a.style.display="none"),a.addEventListener("pointerup",(function(){for(var s=0;s<n.queue.length;s++)n.queue[s]===t&&nh(r,i.cost);e.updateTopbar(),n.queue=n.queue.filter((function(e){return e!==t})),n.queue[0]!==t&&(e.updateButtonContent(t,(function(t){return t.textContent=""})),e.toggleButtonCancel(t,!1))}));var h=document.createElement("img");h.src=$a(i.icon),h.className="img",h.addEventListener("pointerup",(function(){oh(r,i.cost)?(r.population>=r.populationMax&&e.showMessage("You need to build more houses"),e.toggleButtonCancel(t,!0),n.buyUnit(t)):e.showMessage(e.getMessage(i.cost))}));var l=n.queue.filter((function(e){return e===t})).length,c=document.createElement("div");c.id="content",c.textContent=l||"",c.style.padding="1px",c.style.position="absolute",o.appendChild(h),o.appendChild(a),s.appendChild(o),s.appendChild(c)}}}},{key:"getBuildingButton",value:function(t){var e=this,r=this.context,i=r.controls,n=r.player,s=os.cache.get("config").buildings[t];return{id:t,icon:function(){return $a(Ka(t,n,os).icon)},hide:function(){return(s.conditions||[]).some((function(t){return!Vh(t,n)}))},onClick:function(){var r=Ka(t,n,os);i.removeMouseBuilding(),oh(n,s.cost)?i.setMouseBuilding(Rp(Rp(Rp({},s),r),{},{type:t})):e.showMessage(e.getMessage(s.cost))}}}},{key:"getTechnologyButton",value:function(t){var e=this,r=this.context,i=r.controls,n=r.player,s=os.cache.get("technology")[t];return{icon:$a(s.icon),id:t,hide:function(){return(s.conditions||[]).some((function(e){return n.technologies.includes(t)||!Vh(e,n)}))},onClick:function(r){i.removeMouseBuilding(),oh(n,s.cost)?r.buyTechnology(s,t):e.showMessage(e.getMessage(s.cost))}}}}],r&&Mp(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function jp(t){return jp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jp(t)}function kp(t){return function(t){if(Array.isArray(t))return Np(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Np(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Np(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Np(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function Lp(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==jp(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==jp(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key),"symbol"===jp(n)?n:String(n)),i)}var n}function Fp(t,e){return Fp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Fp(t,e)}function Up(t){return Up=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Up(t)}var Gp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Fp(t,e)}(o,t);var e,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Up(i);if(n){var r=Up(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===jp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=s.call(this)).context=t;var r=t.map;return e.sortableChildren=!0,e.mouse={x:0,y:0,prevent:!1},e.camera,e.setCamera(Math.floor(r.size/2),Math.floor(r.size/2)),e.clicked=!1,e.double=null,e.doubleClicked=!1,e.keysPressed={},e.interactive=!1,e.allowMove=!1,e.allowClick=!1,e.minimapRectangle=new wo,e.addChild(e.minimapRectangle),document.addEventListener("keydown",(function(t){return e.onKeyDown(t)})),document.addEventListener("keyup",(function(t){return e.onKeyUp(t)})),document.addEventListener("pointermove",(function(t){return e.onPointerMove(t)})),document.addEventListener("pointerdown",(function(t){return e.onPointerDown(t)})),document.addEventListener("pointerup",(function(t){return e.onPointerUp(t)})),e}return e=o,r=[{key:"onKeyDown",value:function(t){if("Delete"!==t.key){t.repeat||(this.keysPressed[t.key]=!0);var e=!1;this.keysPressed.ArrowLeft&&(this.moveCamera("left",null,e),e=!0),this.keysPressed.ArrowUp&&(this.moveCamera("up",null,e),e=!0),this.keysPressed.ArrowDown&&(this.moveCamera("down",null,e),e=!0),this.keysPressed.ArrowRight&&(this.moveCamera("right",null,e),e=!0)}else{for(var r=this.context.player,i=0;i<r.selectedUnits.length;i++)r.selectedUnits[i].die();r.selectedBuilding&&r.selectedBuilding.die()}}},{key:"onKeyUp",value:function(t){t.repeat||delete this.keysPressed[t.key]}},{key:"onPointerMove",value:function(t){var e=this.context,r=e.map,i=e.player,n=e.app;if(this.mouse.x=t.pageX,this.mouse.y=t.pageY,this.mouseBuilding){var s=Ph(this.mouse.x-r.x,this.mouse.y>=n.screen.height?n.screen.height-r.y:this.mouse.y-r.y),o=Math.min(Math.max(s[0],0),r.size),a=Math.min(Math.max(s[1],0),r.size);if(r.grid[o]&&r.grid[o][a]){var h=r.grid[o][a];this.mouseBuilding.x=h.x-this.camera.x,this.mouseBuilding.y=h.y-this.camera.y;var l=!0;hl(o,a,r.grid,1,(function(t){(t.solid||t.inclined||t.border||!t.visible)&&(l=!1)}));var c=this.mouseBuilding.getChildByName("sprite"),u=this.mouseBuilding.getChildByName("color");l?(c.tint=fh,u&&(u.tint=fh)):(c.tint=ph,u&&(u.tint=ph)),this.mouseBuilding.isFree=l}}else!this.mouseRectangle&&this.pointerStart&&Uh(this.mouse.x,this.mouse.y,this.pointerStart.x,this.pointerStart.y)>5&&(this.mouseRectangle={x:this.pointerStart.x,y:this.pointerStart.y,width:0,height:0,graph:new wo},this.addChild(this.mouseRectangle.graph)),this.mouseRectangle&&!this.mouseBuilding&&((i.selectedUnits.length||i.selectedBuilding)&&i.unselectAll(),this.mouseRectangle.graph.clear(),this.mouseRectangle.width=Math.round(this.mouse.x-this.mouseRectangle.x),this.mouseRectangle.height=this.mouse.y>=n.screen.height?Math.round(n.screen.height-2-this.mouseRectangle.y):Math.round(this.mouse.y-this.mouseRectangle.y),this.mouseRectangle.graph.lineStyle(1,fh,1),this.mouseRectangle.graph.drawRect(Math.min(this.mouseRectangle.x,this.mouseRectangle.x+this.mouseRectangle.width),Math.min(this.mouseRectangle.y,this.mouseRectangle.y+this.mouseRectangle.height),Math.abs(this.mouseRectangle.width),Math.abs(this.mouseRectangle.height)))}},{key:"onPointerDown",value:function(){this.isMouseInApp()&&(this.pointerStart={x:this.mouse.x,y:this.mouse.y})}},{key:"onPointerUp",value:function(){var t=this.context,e=t.menu,r=t.map,i=t.player;if(this.pointerStart=null,!this.isMouseInApp()||this.mouse.prevent||this.doubleClicked)this.mouse.prevent=!1;else{if(this.mouseRectangle){var n,s=0;i.unselectAll();for(var o=0;o<i.units.length;o++){var a=i.units[o];i.selectedUnits.length<Eh&&Gh(a.x-this.camera.x,a.y-this.camera.y,this.mouseRectangle.x,this.mouseRectangle.y,this.mouseRectangle.width,this.mouseRectangle.height,!0)&&(a.select(),s++,"Villager"===a.type&&(n=a),i.selectedUnits.push(a))}return s&&(n?(i.selectedUnit=n,e.setBottombar(n)):(i.selectedUnit=i.selectedUnits[0],e.setBottombar(i.selectedUnits[0]))),void(this.mouseRectangle&&(this.mouseRectangle.graph.destroy(!0),this.mouseRectangle=null))}if(this.isMouseInApp()){var h=Ph(this.mouse.x-r.x,this.mouse.y-r.y),l=Math.min(Math.max(h[0],0),r.size),c=Math.min(Math.max(h[1],0),r.size);if(r.grid[l]&&r.grid[l][c]){var u=r.grid[l][c];if((u.solid||u.has)&&u.visible)return;if(this.mouseBuilding){if(u.inclined||u.border)return;this.mouseBuilding.isFree&&i.buyBuilding(l,c,this.mouseBuilding.type)&&(this.removeMouseBuilding(),e.selection&&e.setBottombar(e.selection))}else if(i.selectedUnits.length){var d=os.cache.get("50405"),f=new na(d.animations.animation);f.animationSpeed=.2*ch,f.loop=!1,f.anchor.set(.5,.5),f.x=this.mouse.x,f.y=this.mouse.y,f.allowMove=!1,f.allowClick=!1,f.interactive=!1,f.roundPixels=!0,f.onComplete=function(){f.destroy()},f.play(),this.addChild(f);for(var p=Math.min.apply(Math,kp(i.selectedUnits.map((function(t){return t.i})))),m=Math.min.apply(Math,kp(i.selectedUnits.map((function(t){return t.j})))),g=Math.max.apply(Math,kp(i.selectedUnits.map((function(t){return t.i})))),y=Math.max.apply(Math,kp(i.selectedUnits.map((function(t){return t.j})))),v=p+Math.round((g-p)/2),b=m+Math.round((y-m)/2),x=0;x<i.selectedUnits.length;x++){var _=i.selectedUnits[x],w=_.i-v,E=_.j-b,T=u.i+w,A=u.j+E;r.grid[T]&&r.grid[T][A]?i.selectedUnits[x].sendTo(r.grid[T][A]):i.selectedUnits[x].sendTo(u)}}}}}}},{key:"isMouseInApp",value:function(){var t=this.context,e=t.app,r=t.menu;return this.mouse.y>r.topbar.clientHeight&&this.mouse.y<e.screen.height-r.bottombar.clientHeight}},{key:"removeMouseBuilding",value:function(){this.mouseBuilding&&(this.removeChild(this.mouseBuilding),this.mouseBuilding.destroy(),this.mouseBuilding=null)}},{key:"setMouseBuilding",value:function(t){var e=this.context.player;this.mouseBuilding=new rn;var r=on.from(Za(t.images.final,os));if(r.name="sprite",this.mouseBuilding.addChild(r),this.mouseBuilding.type=t.type,this.mouseBuilding.size=t.size,this.mouseBuilding.x=this.mouse.x,this.mouseBuilding.y=this.mouse.y,this.mouseBuilding.name="mouseBuilding",t.images.color){var i=on.from(Za(t.images.color,os));i.name="color",Ja(i,e.color),this.mouseBuilding.addChild(i)}else Ja(r,e.color);this.addChild(this.mouseBuilding)}},{key:"moveCamera",value:function(t,e,r){var i=this.context,n=i.map,s=i.app,o=i.menu,a=(e||20)/(r?2:1),h={x:ah/2-this.camera.x,y:-this.camera.y},l={x:ah/2-n.size*ah/2-this.camera.x,y:n.size*hh/2-this.camera.y},c={x:ah/2+n.size*ah/2-this.camera.x,y:n.size*hh/2-this.camera.y},u={x:ah/2-this.camera.x,y:n.size*hh-this.camera.y},d={x:this.camera.x+s.screen.width/2-this.camera.x,y:this.camera.y+s.screen.height/2-this.camera.y};this.clearInstancesOnScreen(),"left"===t?d.x-100>l.x&&Ih(h,l,d,50)?(this.camera.y+=a/(ah/hh),this.camera.x-=a):d.x-100>l.x&&Ih(l,u,d,50)?(this.camera.y-=a/(ah/hh),this.camera.x-=a):d.x-100>l.x&&(this.camera.x-=a):"right"===t&&(d.x+100<c.x&&Ih(h,c,d,50)?(this.camera.y+=a/(ah/hh),this.camera.x+=a):d.x+100<c.x&&Ih(c,u,d,50)?(this.camera.y-=a/(ah/hh),this.camera.x+=a):d.x+100<c.x&&(this.camera.x+=a)),"up"===t?d.y-50>h.y&&Ih(h,l,d,50)?(this.camera.y-=a/(ah/hh),this.camera.x+=a):d.y-50>h.y&&Ih(h,c,d,50)?(this.camera.y-=a/(ah/hh),this.camera.x-=a):d.y-50>h.y&&(this.camera.y-=a):"down"===t&&(d.y+50<u.y&&Ih(c,u,d,50)?(this.camera.y+=a/(ah/hh),this.camera.x-=a):d.y+50<u.y&&Ih(l,u,d,50)?(this.camera.y+=a/(ah/hh),this.camera.x+=a):d.y+100<u.y&&(this.camera.y+=a)),o.updateCameraMiniMap(),n.setCoordinate(-this.camera.x,-this.camera.y),this.displayInstancesOnScreen()}},{key:"instanceInCamera",value:function(t){var e=this.context.app;return Gh(t.x,t.y,this.camera.x,this.camera.y,e.screen.width,e.screen.height)}},{key:"getCellOnCamera",value:function(t){for(var e=this.context,r=e.map,i=e.app,n=Math.floor(this.camera.x),s=Math.floor(this.camera.y),o=ah,a=n-o;a<=n+i.screen.width+o;a+=ah/2)for(var h=s-o;h<=s+i.screen.height-120+o;h+=hh/2){var l=Ph(a,h),c=Math.min(Math.max(l[0],0),r.size),u=Math.min(Math.max(l[1],0),r.size);r.grid[c]&&r.grid[c][u]&&t(r.grid[c][u])}}},{key:"clearInstancesOnScreen",value:function(){this.getCellOnCamera((function(t){t.visible=!1,t.has&&(t.has.visible=!1)}))}},{key:"displayInstancesOnScreen",value:function(){this.getCellOnCamera((function(t){return t.updateVisible()}))}},{key:"init",value:function(){var t=this.context.player;t.buildings.length?this.setCamera(t.buildings[0].x,t.buildings[0].y):t.units.length&&this.setCamera(t.units[0].x,t.units[0].y)}},{key:"setCamera",value:function(t,e){var r=this.context,i=r.map,n=r.app,s=r.menu;this.camera={x:t-n.screen.width/2,y:e-n.screen.height/2},s&&s.updateCameraMiniMap(),i.setCoordinate(-this.camera.x,-this.camera.y),this.displayInstancesOnScreen()}}],r&&Lp(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(rn);function zp(t){return zp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zp(t)}function Hp(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==zp(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==zp(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key),"symbol"===zp(n)?n:String(n)),i)}var n}function Xp(t,e){return Xp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Xp(t,e)}function Vp(t){return Vp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Vp(t)}var Wp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xp(t,e)}(o,t);var e,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Vp(i);if(n){var r=Vp(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===zp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=s.call(this)).app=t,e.start(),e}return e=o,r=[{key:"start",value:function(){var t={app:this.app,menu:null,player:null,players:[],map:null,controls:null};t.map=new Pp(t),t.controls=new Gp(t),t.menu=new Dp(t),t.map.generateMap(),t.players=t.map.generatePlayers(),t.player=t.players[0],t.menu.init(),t.map.placePlayers(),t.map.stylishMap(),t.controls.init(),this.addChild(t.map),this.addChild(t.controls),window.addEventListener("resize",(function(){t.controls&&(t.controls.clearInstancesOnScreen(),t.controls.displayInstancesOnScreen()),t.menu&&t.menu.updateCameraMiniMap()}))}}],r&&Hp(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(rn);function Yp(t){return Yp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yp(t)}function $p(){$p=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function h(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var s=e&&e.prototype instanceof d?e:d,o=Object.create(s.prototype),a=new A(n||[]);return i(o,"_invoke",{value:_(t,r,a)}),o}function c(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var u={};function d(){}function f(){}function p(){}var m={};h(m,s,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(S([])));y&&y!==e&&r.call(y,s)&&(m=y);var v=p.prototype=d.prototype=Object.create(m);function b(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(i,s,o,a){var h=c(t[i],t,s);if("throw"!==h.type){var l=h.arg,u=l.value;return u&&"object"==Yp(u)&&r.call(u,"__await")?e.resolve(u.__await).then((function(t){n("next",t,o,a)}),(function(t){n("throw",t,o,a)})):e.resolve(u).then((function(t){l.value=t,o(l)}),(function(t){return n("throw",t,o,a)}))}a(h.arg)}var s;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return s=s?s.then(i,i):i()}})}function _(t,e,r){var i="suspendedStart";return function(n,s){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===n)throw s;return{value:void 0,done:!0}}for(r.method=n,r.arg=s;;){var o=r.delegate;if(o){var a=w(o,r);if(a){if(a===u)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i="executing";var h=c(t,e,r);if("normal"===h.type){if(i=r.done?"completed":"suspendedYield",h.arg===u)continue;return{value:h.arg,done:r.done}}"throw"===h.type&&(i="completed",r.method="throw",r.arg=h.arg)}}}function w(t,e){var r=e.method,i=t.iterator[r];if(void 0===i)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),u;var n=c(i,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,u;var s=n.arg;return s?s.done?(e[t.resultName]=s.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):s:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function S(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(r.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:P}}function P(){return{value:void 0,done:!0}}return f.prototype=p,i(v,"constructor",{value:p,configurable:!0}),i(p,"constructor",{value:f,configurable:!0}),f.displayName=h(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,h(t,a,"GeneratorFunction")),t.prototype=Object.create(v),t},t.awrap=function(t){return{__await:t}},b(x.prototype),h(x.prototype,o,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,i,n,s){void 0===s&&(s=Promise);var o=new x(l(e,r,i,n),s);return t.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},b(v),h(v,a,"Generator"),h(v,s,(function(){return this})),h(v,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var i in e)r.push(i);return r.reverse(),function t(){for(;r.length;){var i=r.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},t.values=S,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(r,i){return o.type="throw",o.arg=t,e.next=r,i&&(e.method="next",e.arg=void 0),!!i}for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n],o=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var a=r.call(s,"catchLoc"),h=r.call(s,"finallyLoc");if(a&&h){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(a){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,u):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var n=i.arg;T(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},t}function qp(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function Kp(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?qp(Object(r),!0).forEach((function(e){Zp(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):qp(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Zp(t,e,r){return(e=tm(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Qp(t,e,r,i,n,s,o){try{var a=t[s](o),h=a.value}catch(t){return void r(t)}a.done?e(h):Promise.resolve(h).then(i,n)}function Jp(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,tm(i.key),i)}}function tm(t){var e=function(t,e){if("object"!==Yp(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==Yp(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Yp(e)?e:String(e)}function em(t,e){return em=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},em(t,e)}function rm(t){return rm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},rm(t)}var im=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&em(t,e)}(h,t);var e,r,i,n,s,o,a=(s=h,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=rm(s);if(o){var r=rm(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Yp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function h(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),(t=a.call(this)).app,t.loadingDiv=document.createElement("div"),t.loadingDiv.className="loading",document.body.prepend(t.loadingDiv),t.done=function(){},t}return e=h,r=[{key:"start",value:(i=$p().mark((function t(){var e;return $p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return os.addBundle("config",{config:"config.json",greek:"greek.json",technology:"technology.json"}),os.addBundle("interface",{50405:"interface/50405/texture.json"}),os.addBundle("seeds",{0:"seeds/2.txt"}),os.addBundle("terrain",{15e3:"terrain/15000/texture.json",15001:"terrain/15001/texture.json",15002:"terrain/15002/texture.json"}),os.addBundle("border",{2e4:"border/20000/texture.json",20002:"border/20002/texture.json"}),e=["60","61","62","63","64","65","66","67","68","69","70","71","72","73","75","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","94","153","154","155","203","205","206","212","215","217","218","219","222","224","227","230","231","232","233","234","235","236","237","239","240","254","256","258","261","272","273","274","280","281","292","293","294","295","296","297","298","299","300","301","308","311","312","314","315","321","324","326","328","330","331","332","333","336","339","343","347","367","370","371","373","374","380","386","388","389","390","391","392","394","397","399","400","403","413","415","416","418","419","425","428","430","431","432","433","435","436","440","441","445","447","450","452","463","464","465","466","478","479","480","481","489","492","493","494","497","500","503","509","527","531","532","533","534","593","609","622","623","624","625","626","628","630","632","633","636","651","652","654","655","657","658","664","667","670","672","673","676","677","680","682","683","688"],os.addBundle("graphics",e.reduce((function(t,e){return Kp(Kp({},t),{},Zp({},e,"graphics/".concat(e,"/texture.json")))}),{})),this.loadingDiv.innerHTML="Loading config..",t.next=10,os.loadBundle("config");case 10:return this.loadingDiv.innerHTML="Loading interface..",t.next=13,os.loadBundle("interface");case 13:return this.loadingDiv.innerHTML="Loading seeds..",t.next=16,os.loadBundle("seeds");case 16:return this.loadingDiv.innerHTML="Loading terrain..",t.next=19,os.loadBundle("terrain");case 19:return this.loadingDiv.innerHTML="Loading border..",t.next=22,os.loadBundle("border");case 22:return this.loadingDiv.innerHTML="Loading graphics..",t.next=25,os.loadBundle("graphics");case 25:this.onComplete();case 26:case"end":return t.stop()}}),t,this)})),n=function(){var t=this,e=arguments;return new Promise((function(r,n){var s=i.apply(t,e);function o(t){Qp(s,r,n,o,a,"next",t)}function a(t){Qp(s,r,n,o,a,"throw",t)}o(void 0)}))},function(){return n.apply(this,arguments)})},{key:"onComplete",value:function(){this.loadingDiv.remove(),this.done()}},{key:"onLoaded",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.done=t}}],r&&Jp(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),h}(rn),nm=new Cn({antialias:!1,width:window.innerWidth,height:window.innerHeight,resizeTo:window,powerPreference:"high-performance"});window.document.removeEventListener("mousemove",nm.renderer.plugins.interaction.onPointerMove,!0),window.document.removeEventListener("pointermove",nm.renderer.plugins.interaction.onPointerMove,!0);var sm=new im,om=document.getElementById("game");om.addEventListener("contextmenu",(function(t){t.preventDefault()})),window.app=nm,window.gamebox=om,om.appendChild(nm.view),nm.stage.addChild(sm),sm.start(),sm.onLoaded((function(){var t=new Wp(nm);nm.stage.removeChild(sm),nm.stage.addChild(t)}))})()})();
//# sourceMappingURL=bundle.js.map